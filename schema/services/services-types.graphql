# =============================================================================
# Service Instance Management GraphQL Schema
# =============================================================================
# This schema defines types and operations for downloadable network services
# (Feature Marketplace): Tor, sing-box, Xray-core, MTProxy, Psiphon, AdGuard Home
# =============================================================================

# ============================================
# SERVICE TYPES
# ============================================

"""
Available service that can be installed from the Feature Marketplace.
Represents a downloadable network service with metadata from the manifest.
"""
type AvailableService {
  """
  Unique service identifier (e.g., 'tor', 'sing-box', 'xray')
  """
  id: ID!

  """
  Display name
  """
  name: String!

  """
  Service description
  """
  description: String!

  """
  Service version
  """
  version: String!

  """
  Service category (VPN, Privacy, DNS, Messaging)
  """
  category: String!

  """
  Service author
  """
  author: String!

  """
  License
  """
  license: String!

  """
  Homepage URL
  """
  homepage: String

  """
  Icon filename or URL
  """
  icon: String

  """
  Tags for filtering and search
  """
  tags: [String!]!

  """
  Supported architectures
  """
  architectures: [String!]!

  """
  Minimum RouterOS version required
  """
  minRouterOSVersion: String

  """
  Required packages
  """
  requiredPackages: [String!]!

  """
  Required ports
  """
  requiredPorts: [Int!]!

  """
  Required memory in MB
  """
  requiredMemoryMB: Int!

  """
  Required disk space in MB
  """
  requiredDiskMB: Int!

  """
  Docker image name
  """
  dockerImage: String!

  """
  Docker image tag
  """
  dockerTag: String!

  """
  Default configuration (JSON)
  """
  defaultConfig: JSON

  """
  Configuration schema (JSON Schema)
  """
  configSchema: JSON
}

"""
Service instance running on a router.
Represents an installed and potentially running service instance.
"""
type ServiceInstance implements Node {
  """
  Instance ID (ULID)
  """
  id: ID!

  """
  Feature identifier (e.g., 'tor', 'sing-box')
  """
  featureID: String!

  """
  Human-readable instance name
  """
  instanceName: String!

  """
  Router ID this instance belongs to
  """
  routerID: String!

  """
  Current lifecycle status
  """
  status: ServiceInstanceStatus!

  """
  VLAN ID for network isolation
  """
  vlanID: Int

  """
  IP address to bind the service to
  """
  bindIP: String

  """
  Ports used by this service instance
  """
  ports: [Int!]!

  """
  Service-specific configuration (JSON)
  """
  config: JSON

  """
  Path to the service binary
  """
  binaryPath: String

  """
  Version of the service binary
  """
  binaryVersion: String

  """
  SHA256 checksum of the binary
  """
  binaryChecksum: String

  """
  Binary verification information (null if verification not enabled)
  """
  verification: BinaryVerification

  """
  When the instance was created
  """
  createdAt: DateTime!

  """
  Last update timestamp
  """
  updatedAt: DateTime!

  """
  The router this instance belongs to
  """
  router: Router
}

"""
Service instance lifecycle status.
"""
enum ServiceInstanceStatus {
  """
  Binary is being downloaded and installed
  """
  INSTALLING

  """
  Binary installed, ready to start
  """
  INSTALLED

  """
  Process is starting
  """
  STARTING

  """
  Process is running
  """
  RUNNING

  """
  Process is stopping
  """
  STOPPING

  """
  Process is stopped
  """
  STOPPED

  """
  Operation failed
  """
  FAILED

  """
  Instance is being deleted
  """
  DELETING
}

"""
Installation progress event.
"""
type InstallProgress {
  """
  Instance ID
  """
  instanceID: ID!

  """
  Feature ID
  """
  featureID: String!

  """
  Bytes downloaded
  """
  bytesDownloaded: Int!

  """
  Total bytes to download
  """
  totalBytes: Int!

  """
  Download progress percentage (0-100)
  """
  percent: Float!

  """
  Current status (downloading, verifying, completed, failed)
  """
  status: String!

  """
  Error message if failed
  """
  errorMessage: String
}

"""
Instance status change event.
"""
type InstanceStatusChanged {
  """
  Instance ID
  """
  instanceID: ID!

  """
  Previous status
  """
  previousStatus: ServiceInstanceStatus!

  """
  New status
  """
  newStatus: ServiceInstanceStatus!

  """
  Timestamp of the change
  """
  timestamp: DateTime!
}
