# ============================================
# SERVICE UPDATE MANAGER (NAS-8.7)
# ============================================

"""
Update severity classification for available updates.
"""
enum UpdateSeverity {
  """Critical security fix - auto-apply recommended"""
  CRITICAL

  """Major version with breaking changes"""
  MAJOR

  """Minor version with new features"""
  MINOR

  """Patch version with bug fixes"""
  PATCH
}

"""
Available update information for a service instance.
"""
type UpdateInfo {
  """Instance ID"""
  instanceID: ID!

  """Feature ID"""
  featureID: String!

  """Current installed version"""
  currentVersion: String!

  """Available update version"""
  availableVersion: String!

  """Update severity"""
  severity: UpdateSeverity!

  """Release notes/changelog"""
  releaseNotes: String!

  """When the update was published"""
  publishedAt: DateTime!

  """Download URL for the new binary"""
  downloadURL: String!

  """Checksum URL for verification"""
  checksumURL: String

  """Binary size in bytes"""
  sizeBytes: Int!

  """Target architecture"""
  architecture: String!
}

"""
Update stage during atomic update process.
"""
enum UpdateStage {
  """Downloading and verifying new binary"""
  STAGING

  """Backing up current binary"""
  BACKUP

  """Swapping binaries"""
  SWAP

  """Running config migrations"""
  MIGRATION

  """Validating new version"""
  VALIDATION

  """Finalizing update"""
  COMMIT

  """Restoring from backup"""
  ROLLBACK
}

"""
Update progress during atomic update process.
"""
type UpdateProgress {
  """Instance ID"""
  instanceID: ID!

  """Feature ID"""
  featureID: String!

  """Current version"""
  fromVersion: String!

  """Target version"""
  toVersion: String!

  """Current stage"""
  stage: UpdateStage!

  """Progress percentage (0-100)"""
  progress: Int!

  """Current stage message"""
  message: String!

  """Timestamp"""
  timestamp: DateTime!
}

"""
Input for configuring update check schedule for an instance.
"""
input UpdateCheckScheduleInput {
  """Router ID"""
  routerID: ID!

  """Instance ID"""
  instanceID: ID!

  """Update check schedule (e.g., '6h', '12h', '24h', 'manual')"""
  checkSchedule: String!

  """Minimum severity to auto-apply (CRITICAL, MAJOR, MINOR, PATCH, MANUAL)"""
  autoApplyThreshold: String!
}

"""
Update result after completion or failure.
"""
type UpdateResult {
  """Whether the update succeeded"""
  success: Boolean!

  """Instance ID"""
  instanceID: ID!

  """Version updated to (if successful)"""
  version: String

  """Error message (if failed)"""
  errorMessage: String

  """Whether rollback occurred"""
  rolledBack: Boolean!

  """Total duration in milliseconds"""
  durationMs: Int!

  """Update stages completed"""
  completedStages: [UpdateStage!]!

  """Stage where failure occurred (if failed)"""
  failedStage: UpdateStage

  """Timestamp"""
  timestamp: DateTime!
}
