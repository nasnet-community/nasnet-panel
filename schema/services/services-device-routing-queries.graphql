# ============================================
# DEVICE ROUTING QUERIES, MUTATIONS, SUBSCRIPTIONS
# ============================================

extend type Query {
  """
  Get the complete device routing matrix for a router.
  Includes discovered devices, available interfaces, and current routings.
  """
  deviceRoutingMatrix(
    """Router ID"""
    routerID: ID!
  ): DeviceRoutingMatrix!

  """
  Get all device routing assignments for a router.
  """
  deviceRoutings(
    """Router ID"""
    routerID: ID!
  ): [DeviceRouting!]!

  """
  Get a specific device routing assignment.
  """
  deviceRouting(
    """Router ID"""
    routerID: ID!

    """Device routing ID"""
    routingID: ID!
  ): DeviceRouting

  """
  Get kill switch status for a specific device routing.
  Returns current kill switch configuration and state.
  """
  killSwitchStatus(
    """Router ID"""
    routerID: ID!

    """Device ID"""
    deviceID: String!
  ): KillSwitchStatus!
}

extend type Mutation {
  """
  Assign a device to route through a specific service instance.
  Creates a MikroTik mangle rule for Policy-Based Routing (PBR).
  """
  assignDeviceRouting(input: AssignDeviceRoutingInput!): DeviceRouting!

  """
  Remove a device routing assignment.
  Deletes the MikroTik mangle rule and database record.
  """
  removeDeviceRouting(
    """Router ID"""
    routerID: ID!

    """Device ID to unroute"""
    deviceID: String!
  ): Boolean!

  """
  Assign multiple devices to routing in a single operation.
  Each assignment is processed independently (partial success allowed).
  """
  bulkAssignRouting(input: BulkAssignRoutingInput!): BulkRoutingResult!

  """
  Enable or update kill switch for a device routing.
  Creates MikroTik filter rules to block traffic when service is unhealthy.
  """
  setKillSwitch(input: SetKillSwitchInput!): DeviceRouting!
}

extend type Subscription {
  """
  Subscribe to device routing changes for a router.
  Emits events when devices are assigned, removed, or updated.
  """
  deviceRoutingChanged(
    """Router ID to subscribe to"""
    routerID: ID!
  ): DeviceRoutingEvent!

  """
  Subscribe to kill switch state changes for a router.
  Emits events when kill switch is activated, deactivated, or configuration changes.
  """
  killSwitchChanged(
    """Router ID to subscribe to"""
    routerID: ID!
  ): DeviceRoutingEvent!
}
