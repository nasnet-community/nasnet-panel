# ============================================
# LOGS & DIAGNOSTICS INPUTS AND OPERATIONS
# ============================================

"""
Input for running diagnostics on a service instance.
"""
input RunDiagnosticsInput {
  """
  Router ID
  """
  routerID: ID!

  """
  Instance ID to run diagnostics on
  """
  instanceID: ID!

  """
  Specific test names to run (empty = run all tests)
  """
  testNames: [String!]
}

"""
Payload for run diagnostics mutation.
"""
type RunDiagnosticsPayload {
  """
  Whether the operation succeeded
  """
  success: Boolean!

  """
  Diagnostic results
  """
  results: [DiagnosticResult!]

  """
  Run group ID linking these results together
  """
  runGroupID: String

  """
  Mutation errors
  """
  errors: [MutationError!]
}

"""
Real-time diagnostic progress event for subscriptions.
Emitted as each test completes during a diagnostic run.
"""
type DiagnosticsProgress {
  """
  Instance ID
  """
  instanceID: ID!

  """
  Run group ID
  """
  runGroupID: String!

  """
  Test result that just completed
  """
  result: DiagnosticResult!

  """
  Progress (0-100)
  """
  progress: Int!

  """
  Completed tests count
  """
  completedTests: Int!

  """
  Total tests count
  """
  totalTests: Int!

  """
  Timestamp
  """
  timestamp: DateTime!
}

extend type Query {
  """
  Get recent log entries for a service instance.
  Returns the last N lines from the log file.
  """
  serviceLogFile(
    """
    Router ID
    """
    routerID: ID!

    """
    Instance ID
    """
    instanceID: ID!

    """
    Maximum number of lines to return (default 100)
    """
    maxLines: Int
  ): ServiceLogFile!

  """
  Get diagnostic history for a service instance.
  Returns past diagnostic results grouped by run_group_id.
  """
  diagnosticHistory(
    """
    Router ID
    """
    routerID: ID!

    """
    Instance ID
    """
    instanceID: ID!

    """
    Maximum number of run groups to return (default 10)
    """
    limit: Int
  ): [StartupDiagnostics!]!

  """
  Get available diagnostic tests for a service type.
  Returns the diagnostic suite definition.
  """
  availableDiagnostics(
    """
    Service name (e.g., 'tor', 'singbox', 'adguard')
    """
    serviceName: String!
  ): DiagnosticSuite!
}

extend type Mutation {
  """
  Manually run diagnostics on a service instance.
  Executes health checks and connectivity tests.
  """
  runServiceDiagnostics(input: RunDiagnosticsInput!): RunDiagnosticsPayload!
}

extend type Subscription {
  """
  Subscribe to real-time log stream for a service instance.
  Emits new log entries as they are generated.
  """
  serviceLogs(
    """
    Router ID to subscribe to
    """
    routerID: ID!

    """
    Instance ID to monitor
    """
    instanceID: ID!

    """
    Optional log level filter
    """
    levelFilter: LogLevel
  ): LogEntry!

  """
  Subscribe to diagnostic progress updates.
  Emits events as each test completes during a diagnostic run.
  """
  diagnosticsProgress(
    """
    Router ID to subscribe to
    """
    routerID: ID!

    """
    Instance ID to monitor
    """
    instanceID: ID!
  ): DiagnosticsProgress!
}
