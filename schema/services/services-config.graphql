# =============================================================================
# SERVICE CONFIGURATION SCHEMA (NAS-8.5)
# =============================================================================

"""
Configuration field type for dynamic form generation
"""
enum ConfigFieldType {
  """
  Single-line text input
  """
  TEXT

  """
  Multi-line text area
  """
  TEXT_AREA

  """
  Number input
  """
  NUMBER

  """
  Boolean toggle/checkbox
  """
  TOGGLE

  """
  Single-select dropdown
  """
  SELECT

  """
  Multi-select dropdown
  """
  MULTI_SELECT

  """
  Array of text inputs
  """
  TEXT_ARRAY

  """
  Password input (masked)
  """
  PASSWORD

  """
  IP address input
  """
  IP

  """
  Port number input
  """
  PORT

  """
  Email input
  """
  EMAIL

  """
  URL input
  """
  URL
}

"""
Configuration field definition for a service
"""
type ConfigSchemaField {
  """
  Field name (internal identifier)
  """
  name: String!

  """
  Field label (display name)
  """
  label: String!

  """
  Field type for UI rendering
  """
  type: ConfigFieldType!

  """
  Field description/help text
  """
  description: String

  """
  Whether the field is required
  """
  required: Boolean!

  """
  Default value (as JSON)
  """
  defaultValue: JSON

  """
  Placeholder text
  """
  placeholder: String

  """
  Minimum value (for NUMBER/PORT types)
  """
  min: Int

  """
  Maximum value (for NUMBER/PORT types)
  """
  max: Int

  """
  Options for SELECT/MULTI_SELECT types
  """
  options: [String!]

  """
  Whether the field contains sensitive data
  """
  sensitive: Boolean!

  """
  Validation function name
  """
  validateFunc: String

  """
  Logical group/section this field belongs to (e.g., 'Basic', 'Advanced', 'Network')
  """
  group: String
}

"""
Configuration schema for a service type
"""
type ConfigSchema {
  """
  Service type identifier
  """
  serviceType: String!

  """
  Schema version
  """
  version: String!

  """
  Configuration fields
  """
  fields: [ConfigSchemaField!]!
}

"""
Validation error for a configuration field
"""
type ConfigValidationError {
  """
  Field name
  """
  field: String!

  """
  Error message
  """
  message: String!
}

"""
Service configuration validation result
"""
type ConfigValidationResult {
  """
  Whether the configuration is valid
  """
  valid: Boolean!

  """
  List of validation errors (empty if valid)
  """
  errors: [ConfigValidationError!]!
}

"""
Result of applying configuration
"""
type ApplyConfigPayload {
  """
  Whether the operation succeeded
  """
  success: Boolean!

  """
  Updated service instance (if successful)
  """
  instance: ServiceInstance

  """
  Error messages (if failed)
  """
  errors: [String!]!

  """
  Path to generated config file
  """
  configPath: String
}

"""
Input for validating service configuration
"""
input ValidateServiceConfigInput {
  """
  Router ID
  """
  routerID: ID!

  """
  Service instance ID
  """
  instanceID: ID!

  """
  Configuration to validate (as JSON)
  """
  config: JSON!
}

"""
Input for applying service configuration
"""
input ApplyServiceConfigInput {
  """
  Router ID
  """
  routerID: ID!

  """
  Service instance ID
  """
  instanceID: ID!

  """
  Configuration to apply (as JSON)
  """
  config: JSON!
}

extend type Query {
  """
  Get configuration schema for a service type.
  Returns field definitions for dynamic form generation.
  """
  serviceConfigSchema(
    """
    Service type (e.g., 'tor', 'sing-box', 'xray')
    """
    serviceType: String!
  ): ConfigSchema!

  """
  Get current configuration for a service instance.
  Returns the persisted configuration from the database.
  """
  instanceConfig(
    """
    Router ID
    """
    routerID: ID!

    """
    Service instance ID
    """
    instanceID: ID!
  ): JSON!
}

extend type Mutation {
  """
  Validate service configuration without applying it.
  Returns validation errors if any.
  """
  validateServiceConfig(input: ValidateServiceConfigInput!): ConfigValidationResult!

  """
  Apply configuration to a service instance.
  Validates, generates config file, and persists to database.
  """
  applyServiceConfig(input: ApplyServiceConfigInput!): ApplyConfigPayload!
}
