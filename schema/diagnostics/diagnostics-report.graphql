# =============================================================================
# Connection Diagnostics - Report and Attempt Types
# =============================================================================
# Diagnostic types, enums, port/TLS/auth status, suggestions,
# diagnostic report, and connection attempt types.
# Story: NAS-3.10 - Implement Connection Diagnostics
# =============================================================================

# -----------------------------------------------------------------------------
# Diagnostic Types
# -----------------------------------------------------------------------------

"""
Severity level for diagnostic suggestions
"""
enum SuggestionSeverity {
  "Informational message, no action required"
  INFO
  "Warning that may affect functionality"
  WARNING
  "Error that needs to be addressed"
  ERROR
  "Critical issue blocking connectivity"
  CRITICAL
}

"""
Category of connection error for classification
"""
enum ErrorCategory {
  "Connection or response timeout"
  TIMEOUT
  "Connection actively refused"
  REFUSED
  "Authentication failed"
  AUTH_FAILED
  "Protocol-level error"
  PROTOCOL_ERROR
  "Network unreachable or DNS failure"
  NETWORK_ERROR
  "TLS/SSL certificate or handshake error"
  TLS_ERROR
}

"""
Status of a single port check
"""
type PortStatus {
  "Port number checked"
  port: Int!
  "Service name (API, API-SSL, SSH, Telnet, HTTP, HTTPS)"
  service: String!
  "Whether the port is open and accepting connections"
  open: Boolean!
  "Response time in milliseconds (if port is open)"
  responseTimeMs: Int
  "Error message (if port is closed)"
  error: String
}

"""
TLS certificate status for secure connections
"""
type TLSStatus {
  "Whether the certificate is valid"
  valid: Boolean!
  "Certificate issuer"
  issuer: String
  "Certificate subject"
  subject: String
  "Certificate expiration date"
  expiresAt: DateTime
  "Error message (if certificate is invalid)"
  error: String
}

"""
Authentication test status
"""
type AuthStatus {
  "Whether authentication was tested"
  tested: Boolean!
  "Whether authentication succeeded"
  success: Boolean!
  "Error message (if authentication failed)"
  error: String
  "Error code mapped to ErrorCodes (A5xx)"
  errorCode: String
}

"""
Actionable diagnostic suggestion
"""
type DiagnosticSuggestion {
  "Severity level of the issue"
  severity: SuggestionSeverity!
  "Short title describing the issue"
  title: String!
  "Detailed description of the issue"
  description: String!
  "Recommended action to resolve the issue"
  action: String!
  "Link to relevant documentation"
  docsUrl: String
}

"""
Comprehensive diagnostic report for a router
"""
type DiagnosticReport {
  "Router ID being diagnosed"
  routerId: ID!
  "When the diagnostic was run"
  timestamp: DateTime!
  "Whether the router is reachable on the network"
  networkReachable: Boolean!
  "Status of each checked port"
  portStatus: [PortStatus!]!
  "TLS certificate status (if TLS ports were checked)"
  tlsStatus: TLSStatus
  "Authentication test status"
  authStatus: AuthStatus!
  "Actionable suggestions based on diagnostic results"
  suggestions: [DiagnosticSuggestion!]!
  "Raw text report for clipboard/export"
  rawReport: String!
}

"""
Record of a single protocol connection attempt
"""
type ConnectionAttempt {
  "Protocol that was attempted"
  protocol: Protocol!
  "When the attempt started"
  startedAt: DateTime!
  "When the attempt ended"
  endedAt: DateTime!
  "Whether the attempt succeeded"
  success: Boolean!
  "Error code if failed"
  errorCode: String
  "Error message if failed"
  errorMessage: String
  "Error category for classification"
  errorCategory: ErrorCategory
}
