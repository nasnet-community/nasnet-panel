# ============================================
# INPUT TYPES
# ============================================

"""
Input for creating a new address list entry.
List will be created if it doesn't exist.
"""
input CreateAddressListEntryInput {
  """
  Target list name (will create if doesn't exist)
  """
  list: String! @validate(minLength: 1, maxLength: 64, pattern: "^[a-zA-Z0-9_-]+$")

  """
  IP address, CIDR notation (e.g., 192.168.1.0/24), or IP range (e.g., 192.168.1.1-192.168.1.100)
  """
  address: String! @validate(minLength: 7, maxLength: 100)

  """
  Optional description
  """
  comment: String @validate(maxLength: 200)

  """
  Optional timeout (e.g., "1d", "12h", "30m")
  """
  timeout: String @validate(pattern: "^\\d+[smhdw]$")
}

"""
Input for bulk address import.
Used with bulkCreateAddressListEntries mutation.
"""
input BulkAddressInput {
  """
  IP address, CIDR notation, or IP range
  """
  address: String!

  """
  Optional description
  """
  comment: String @validate(maxLength: 200)

  """
  Optional timeout
  """
  timeout: String @validate(pattern: "^\\d+[smhdw]$")
}

# ============================================
# MUTATION RESPONSES
# ============================================

"""
Result of bulk address list entry creation.
Includes success count, failure count, and error details.
"""
type BulkCreateResult {
  """
  Number of entries successfully created
  """
  successCount: Int!

  """
  Number of entries that failed
  """
  failedCount: Int!

  """
  Details of failed entries
  """
  errors: [BulkCreateError!]!
}

"""
Details of a single failed entry in bulk import.
"""
type BulkCreateError {
  """
  Index in the input array
  """
  index: Int!

  """
  The address that failed
  """
  address: String!

  """
  Error message
  """
  message: String!
}

# ============================================
# QUERIES
# ============================================

extend type Query {
  """
  Get all address lists with aggregated statistics.
  Returns a list of address lists with entry counts and referencing rule counts.
  """
  addressLists(routerId: ID!): [AddressList!]!

  """
  Get entries for a specific address list with cursor-based pagination.
  Supports infinite scrolling for large lists (10,000+ entries).
  """
  addressListEntries(routerId: ID!, listName: String!, first: Int, after: String): AddressListEntryConnection!

  """
  Get firewall rules that reference a specific address list.
  Includes filter, NAT, and mangle rules.
  """
  rulesReferencingAddressList(routerId: ID!, listName: String!): [FirewallRule!]!
}
