# =============================================================================
# WAN Link Configuration GraphQL Schema
# =============================================================================
# WAN interface types, health monitoring, and connection management
# Extends base Interface type from schema.graphql
# =============================================================================

# -----------------------------------------------------------------------------
# WAN Interface Types
# -----------------------------------------------------------------------------

"""
WAN interface status with connection details
"""
type WANInterface implements Node {
  "Unique identifier"
  id: ID!

  "Underlying network interface"
  interface: Interface! @mikrotik(path: "/interface", field: "name")

  "WAN connection type"
  type: WANConnectionType!

  "Current connection status"
  status: WANStatus!

  "Public IP address (if connected)"
  publicIP: IPv4 @mikrotik(path: "/ip/address", field: "address")

  "Gateway IP address"
  gateway: IPv4

  "Primary DNS server"
  primaryDNS: IPv4

  "Secondary DNS server"
  secondaryDNS: IPv4

  "Connection uptime"
  uptime: Duration

  "Last connection time"
  lastConnected: DateTime

  "Health check status"
  health: WANHealthStatus

  "DHCP client configuration (if type is DHCP)"
  dhcpClient: DhcpClient

  "PPPoE client configuration (if type is PPPOE)"
  pppoeClient: PppoeClient

  "Static IP configuration (if type is STATIC)"
  staticConfig: StaticIPConfig

  "LTE modem configuration (if type is LTE)"
  lteModem: LteModem

  "Whether this is the default route"
  isDefaultRoute: Boolean!

  "Traffic statistics"
  statistics: InterfaceStats
}

"""
WAN connection type classification
"""
enum WANConnectionType {
  "DHCP client (dynamic IP)"
  DHCP
  "PPPoE dial-up connection"
  PPPOE
  "Static IP configuration"
  STATIC
  "LTE/cellular connection"
  LTE
  "Not configured"
  NONE
}

"""
WAN connection status
"""
enum WANStatus {
  "Connected and online"
  CONNECTED
  "Connecting/authenticating"
  CONNECTING
  "Disconnected"
  DISCONNECTED
  "Connection failed"
  ERROR
  "Disabled"
  DISABLED
}

# -----------------------------------------------------------------------------
# DHCP Client Types
# -----------------------------------------------------------------------------

"""
DHCP client configuration for dynamic WAN IP
"""
type DhcpClient implements Node {
  "Unique identifier"
  id: ID!

  "Interface name"
  interface: String! @mikrotik(path: "/ip/dhcp-client", field: "interface")

  "Whether DHCP client is disabled"
  disabled: Boolean! @mikrotik(path: "/ip/dhcp-client", field: "disabled")

  "Add default route from DHCP"
  addDefaultRoute: Boolean! @mikrotik(path: "/ip/dhcp-client", field: "add-default-route")

  "Use DNS servers from DHCP"
  usePeerDNS: Boolean! @mikrotik(path: "/ip/dhcp-client", field: "use-peer-dns")

  "Use NTP servers from DHCP"
  usePeerNTP: Boolean! @mikrotik(path: "/ip/dhcp-client", field: "use-peer-ntp")

  "Current DHCP status"
  status: String! @mikrotik(path: "/ip/dhcp-client", field: "status")

  "Assigned IP address"
  address: IPv4 @mikrotik(path: "/ip/dhcp-client", field: "address")

  "DHCP server address"
  dhcpServer: IPv4 @mikrotik(path: "/ip/dhcp-client", field: "dhcp-server")

  "Gateway from DHCP"
  gateway: IPv4 @mikrotik(path: "/ip/dhcp-client", field: "gateway")

  "Lease expiry time"
  expiresAfter: Duration @mikrotik(path: "/ip/dhcp-client", field: "expires-after")

  "User comment"
  comment: String @mikrotik(path: "/ip/dhcp-client", field: "comment")
}

"""
Input for creating/updating DHCP client
"""
input DhcpClientInput {
  "Interface to enable DHCP client on"
  interface: String! @validate(minLength: 1, maxLength: 100)

  "Add default route (default: true)"
  addDefaultRoute: Boolean

  "Use peer DNS (default: true)"
  usePeerDNS: Boolean

  "Use peer NTP (default: true)"
  usePeerNTP: Boolean

  "User comment"
  comment: String @validate(maxLength: 255)
}

# -----------------------------------------------------------------------------
# PPPoE Client Types
# -----------------------------------------------------------------------------

"""
PPPoE client configuration for dial-up WAN
"""
type PppoeClient implements Node {
  "Unique identifier"
  id: ID!

  "PPPoE interface name"
  name: String! @mikrotik(path: "/interface/pppoe-client", field: "name")

  "Underlying interface (ethernet/bridge)"
  interface: String! @mikrotik(path: "/interface/pppoe-client", field: "interface")

  "Whether PPPoE is disabled"
  disabled: Boolean! @mikrotik(path: "/interface/pppoe-client", field: "disabled")

  "Username for authentication"
  username: String! @mikrotik(path: "/interface/pppoe-client", field: "user")

  "Service name (optional)"
  serviceName: String @mikrotik(path: "/interface/pppoe-client", field: "service-name")

  "Add default route"
  addDefaultRoute: Boolean! @mikrotik(path: "/interface/pppoe-client", field: "add-default-route")

  "Use peer DNS"
  usePeerDNS: Boolean! @mikrotik(path: "/interface/pppoe-client", field: "use-peer-dns")

  "Current connection status"
  running: Boolean! @mikrotik(path: "/interface/pppoe-client", field: "running")

  "MTU setting"
  mtu: Int @mikrotik(path: "/interface/pppoe-client", field: "mtu")

  "MRU setting"
  mru: Int @mikrotik(path: "/interface/pppoe-client", field: "mru")

  "User comment"
  comment: String @mikrotik(path: "/interface/pppoe-client", field: "comment")
}

"""
Input for creating/updating PPPoE client
"""
input PppoeClientInput {
  "PPPoE interface name"
  name: String! @validate(minLength: 1, maxLength: 100, pattern: "^[a-zA-Z0-9_-]+$")

  "Physical interface (ether1, bridge, etc.)"
  interface: String! @validate(minLength: 1, maxLength: 100)

  "Username for ISP authentication"
  username: String! @validate(minLength: 1, maxLength: 128)

  "Password for ISP authentication"
  password: String! @validate(minLength: 1, maxLength: 128)

  "Service name (optional, ISP-specific)"
  serviceName: String @validate(maxLength: 100)

  "Add default route (default: true)"
  addDefaultRoute: Boolean

  "Use peer DNS (default: true)"
  usePeerDNS: Boolean

  "MTU (default: auto)"
  mtu: Int @validate(min: 576, max: 1500)

  "MRU (default: auto)"
  mru: Int @validate(min: 576, max: 1500)

  "User comment"
  comment: String @validate(maxLength: 255)
}

# -----------------------------------------------------------------------------
# Static IP Types
# -----------------------------------------------------------------------------

"""
Static IP WAN configuration
"""
type StaticIPConfig implements Node {
  "Unique identifier"
  id: ID!

  "Interface name"
  interface: String!

  "Static IP address with CIDR"
  address: CIDR! @mikrotik(path: "/ip/address", field: "address")

  "Gateway IP address"
  gateway: IPv4! @mikrotik(path: "/ip/route", field: "gateway")

  "Primary DNS server"
  primaryDNS: IPv4

  "Secondary DNS server"
  secondaryDNS: IPv4

  "User comment"
  comment: String
}

"""
Input for configuring static IP WAN
"""
input StaticIPInput {
  "Interface to configure"
  interface: String! @validate(minLength: 1, maxLength: 100)

  "Static IP address with CIDR (e.g., 203.0.113.5/30)"
  address: CIDR!

  "Gateway IP address"
  gateway: IPv4!

  "Primary DNS server"
  primaryDNS: IPv4

  "Secondary DNS server"
  secondaryDNS: IPv4

  "User comment"
  comment: String @validate(maxLength: 255)
}

# -----------------------------------------------------------------------------
# LTE Modem Types
# -----------------------------------------------------------------------------

"""
LTE/cellular modem configuration
"""
type LteModem implements Node {
  "Unique identifier"
  id: ID!

  "LTE interface name"
  name: String! @mikrotik(path: "/interface/lte", field: "name")

  "APN (Access Point Name)"
  apn: String! @mikrotik(path: "/interface/lte", field: "apn")

  "Signal strength (RSSI in dBm)"
  signalStrength: Int @mikrotik(path: "/interface/lte", field: "rssi")

  "Connection status"
  running: Boolean! @mikrotik(path: "/interface/lte", field: "running")

  "Operator name"
  operator: String @mikrotik(path: "/interface/lte", field: "current-operator")

  "Network type (LTE, 3G, etc.)"
  networkType: String @mikrotik(path: "/interface/lte", field: "current-cellid")

  "PIN code configured"
  pinConfigured: Boolean!

  "User comment"
  comment: String @mikrotik(path: "/interface/lte", field: "comment")
}

"""
Input for configuring LTE modem
"""
input LteModemInput {
  "LTE interface name"
  name: String! @validate(minLength: 1, maxLength: 100)

  "APN (Access Point Name)"
  apn: String! @validate(minLength: 1, maxLength: 100)

  "PIN code (optional, for SIM card)"
  pin: String @validate(minLength: 4, maxLength: 8, pattern: "^[0-9]+$")

  "User comment"
  comment: String @validate(maxLength: 255)
}

# -----------------------------------------------------------------------------
# Health Monitoring Types
# -----------------------------------------------------------------------------

"""
WAN health check status
"""
type WANHealthStatus {
  "Overall health status"
  status: HealthCheckStatus!

  "Target host being monitored"
  target: String!

  "Check interval"
  interval: Duration!

  "Current latency (if reachable)"
  latency: Int

  "Packet loss percentage (0-100)"
  packetLoss: Int!

  "Consecutive successful checks"
  successCount: Int!

  "Consecutive failed checks"
  failureCount: Int!

  "Last check timestamp"
  lastCheck: DateTime!

  "Whether health check is enabled"
  enabled: Boolean!
}

"""
Health check status
"""
enum HealthCheckStatus {
  "Target is reachable (healthy)"
  HEALTHY
  "Target is unreachable (unhealthy)"
  UNHEALTHY
  "Health check is disabled"
  DISABLED
  "Health check is starting"
  UNKNOWN
}

"""
Input for configuring WAN health check
"""
input WANHealthCheckInput {
  "Target host to ping (IP or hostname)"
  target: String! @validate(minLength: 1, maxLength: 255)

  "Check interval in seconds"
  interval: Int! @validate(min: 5, max: 300)

  "Enable health check"
  enabled: Boolean!
}

# -----------------------------------------------------------------------------
# Connection History Types
# -----------------------------------------------------------------------------

"""
WAN connection history entry
"""
type WANConnectionEvent {
  "Event ID"
  id: ID!

  "WAN interface ID"
  wanInterfaceId: ID!

  "Event type"
  eventType: WANEventType!

  "Event timestamp"
  timestamp: DateTime!

  "Public IP at the time (if applicable)"
  publicIP: IPv4

  "Gateway IP"
  gateway: IPv4

  "Reason/error message (if applicable)"
  reason: String

  "Connection duration (for disconnect events)"
  duration: Duration
}

"""
WAN event types for history tracking
"""
enum WANEventType {
  "Connection established"
  CONNECTED
  "Connection lost"
  DISCONNECTED
  "Authentication failed"
  AUTH_FAILED
  "IP address changed"
  IP_CHANGED
  "Gateway changed"
  GATEWAY_CHANGED
  "Health check failed"
  HEALTH_FAILED
  "Health check recovered"
  HEALTH_RECOVERED
}

"""
Connection history pagination
"""
type WANConnectionEventConnection implements Connection {
  edges: [WANConnectionEventEdge!]!
  pageInfo: PageInfo!
  totalCount: Int
}

type WANConnectionEventEdge implements Edge {
  node: WANConnectionEvent!
  cursor: String!
}

# -----------------------------------------------------------------------------
# Mutation Results
# -----------------------------------------------------------------------------

"""
Result of WAN configuration mutation
"""
type WANMutationResult {
  "Whether the operation succeeded"
  success: Boolean!

  "The configured WAN interface"
  wanInterface: WANInterface

  "Configuration preview (RouterOS commands)"
  preview: ConfigPreview

  "Errors that occurred"
  errors: [MutationError!]
}

# -----------------------------------------------------------------------------
# Query Extensions
# -----------------------------------------------------------------------------

extend type Query {
  """
  Get all WAN interfaces on a router
  """
  wanInterfaces(
    "Router ID"
    routerId: ID!
  ): [WANInterface!]! @capability(requires: ["interface"])

  """
  Get a specific WAN interface by ID
  """
  wanInterface(
    "Router ID"
    routerId: ID!
    "WAN interface ID"
    id: ID!
  ): WANInterface @capability(requires: ["interface"])

  """
  Get connection history for a WAN interface
  """
  wanConnectionHistory(
    "Router ID"
    routerId: ID!
    "WAN interface ID"
    wanInterfaceId: ID!
    "Pagination"
    pagination: PaginationInput
  ): WANConnectionEventConnection! @capability(requires: ["interface"])
}

# -----------------------------------------------------------------------------
# Mutation Extensions
# -----------------------------------------------------------------------------

extend type Mutation {
  """
  Configure DHCP client on a WAN interface
  """
  configureDhcpWAN(
    "Router ID"
    routerId: ID!
    "DHCP configuration"
    input: DhcpClientInput!
  ): WANMutationResult! @capability(requires: ["interface"])

  """
  Configure PPPoE client on a WAN interface
  """
  configurePppoeWAN(
    "Router ID"
    routerId: ID!
    "PPPoE configuration"
    input: PppoeClientInput!
  ): WANMutationResult! @capability(requires: ["interface"])

  """
  Configure static IP on a WAN interface
  """
  configureStaticWAN(
    "Router ID"
    routerId: ID!
    "Static IP configuration"
    input: StaticIPInput!
  ): WANMutationResult! @capability(requires: ["interface"])

  """
  Configure LTE modem
  """
  configureLteWAN(
    "Router ID"
    routerId: ID!
    "LTE configuration"
    input: LteModemInput!
  ): WANMutationResult! @capability(requires: ["interface"])

  """
  Configure health check for WAN interface
  """
  configureWANHealthCheck(
    "Router ID"
    routerId: ID!
    "WAN interface ID"
    wanInterfaceId: ID!
    "Health check configuration"
    input: WANHealthCheckInput!
  ): WANMutationResult! @capability(requires: ["interface"])

  """
  Delete WAN configuration (revert to unconfigured)
  """
  deleteWANConfiguration(
    "Router ID"
    routerId: ID!
    "WAN interface ID"
    wanInterfaceId: ID!
  ): DeleteResult! @capability(requires: ["interface"])
}

# -----------------------------------------------------------------------------
# Subscription Extensions
# -----------------------------------------------------------------------------

extend type Subscription {
  """
  Subscribe to WAN status changes
  """
  wanStatusChanged(
    "Router ID"
    routerId: ID!
    "Optional WAN interface ID filter"
    wanInterfaceId: ID
  ): WANInterface! @capability(requires: ["interface"])

  """
  Subscribe to WAN health check updates
  """
  wanHealthChanged(
    "Router ID"
    routerId: ID!
    "WAN interface ID"
    wanInterfaceId: ID!
  ): WANHealthStatus! @capability(requires: ["interface"])
}
