# =============================================================================
# Alert Rules and Notifications Schema
# =============================================================================
# Defines alert rules, alerts, notification channels, and real-time subscriptions
# for the NasNetConnect monitoring and alerting system.
# =============================================================================

# -----------------------------------------------------------------------------
# Alert Rule Template Types (NAS-18.12)
# -----------------------------------------------------------------------------

"""
Alert rule template for quick rule creation
Pre-configured templates with variables for common alert scenarios
"""
type AlertRuleTemplate implements Node {
  """
  Globally unique identifier
  """
  id: ID!

  """
  Template name
  """
  name: String!

  """
  Template description
  """
  description: String!

  """
  Template category
  """
  category: AlertRuleTemplateCategory!

  """
  Alert severity level
  """
  severity: AlertSeverity!

  """
  Event type this template monitors
  """
  eventType: String!

  """
  Pre-configured conditions
  """
  conditions: [AlertCondition!]!

  """
  Throttle configuration
  """
  throttle: ThrottleConfig

  """
  Default notification channels
  """
  channels: [String!]!

  """
  Template variables for customization
  """
  variables: [AlertRuleTemplateVariable!]!

  """
  Whether this is a built-in template
  """
  isBuiltIn: Boolean!

  """
  Template version
  """
  version: String!

  """
  Record creation timestamp
  """
  createdAt: DateTime!

  """
  Last update timestamp
  """
  updatedAt: DateTime!
}

"""
Variable definition for alert rule templates
"""
type AlertRuleTemplateVariable {
  """
  Variable name (used for substitution)
  """
  name: String!

  """
  Display label
  """
  label: String!

  """
  Variable type
  """
  type: AlertRuleTemplateVariableType!

  """
  Whether this variable is required
  """
  required: Boolean!

  """
  Default value
  """
  defaultValue: String

  """
  Minimum value (for INTEGER, DURATION, PERCENTAGE)
  """
  min: Int

  """
  Maximum value (for INTEGER, DURATION, PERCENTAGE)
  """
  max: Int

  """
  Unit label (e.g., "seconds", "percent", "MB")
  """
  unit: String

  """
  Variable description
  """
  description: String
}

"""
Preview result for alert rule template
"""
type AlertRuleTemplatePreview {
  """
  The template being previewed
  """
  template: AlertRuleTemplate!

  """
  Resolved conditions with variable substitution
  """
  resolvedConditions: [AlertCondition!]!

  """
  Validation information
  """
  validationInfo: TemplateValidationInfo!
}

# -----------------------------------------------------------------------------
# Alert Notification Template Types
# -----------------------------------------------------------------------------

"""
Alert notification template
Templates define message format for different event types and channels
"""
type AlertTemplate implements Node {
  """
  Globally unique identifier
  """
  id: ID!

  """
  Template name
  """
  name: String!

  """
  Template description
  """
  description: String!

  """
  Event type this template applies to
  """
  eventType: String!

  """
  Notification channel
  """
  channel: NotificationChannel!

  """
  Subject/title template
  """
  subjectTemplate: String

  """
  Body template with Go template syntax
  """
  bodyTemplate: String!

  """
  Template variables
  """
  variables: [AlertTemplateVariable!]!

  """
  Whether this is a built-in template
  """
  isBuiltIn: Boolean!

  """
  Whether this is a system default template
  """
  isDefault: Boolean!

  """
  Tags for categorization
  """
  tags: [String!]!

  """
  Channel-specific metadata
  """
  metadata: JSON

  """
  Record creation timestamp
  """
  createdAt: DateTime!

  """
  Last update timestamp
  """
  updatedAt: DateTime!
}

"""
Template variable definition
"""
type AlertTemplateVariable {
  """
  Variable name (used in template as {{.Name}})
  """
  name: String!

  """
  Display label
  """
  label: String!

  """
  Variable type
  """
  type: AlertTemplateVariableType!

  """
  Whether this variable is required
  """
  required: Boolean!

  """
  Default value
  """
  defaultValue: String

  """
  Variable description
  """
  description: String

  """
  Options for enum-type variables
  """
  options: [String!]
}

"""
Template preview result
"""
type TemplatePreview {
  """
  The template that was previewed
  """
  template: AlertTemplate!

  """
  Rendered subject after variable substitution
  """
  renderedSubject: String!

  """
  Rendered body after variable substitution
  """
  renderedBody: String!

  """
  Variables used in preview
  """
  variables: JSON!

  """
  Validation information
  """
  validationInfo: TemplateValidationInfo!
}

"""
Template validation information
"""
type TemplateValidationInfo {
  """
  Whether the template is valid with provided variables
  """
  isValid: Boolean!

  """
  Missing required variables
  """
  missingVariables: [String!]!

  """
  Validation warnings
  """
  warnings: [String!]!
}

# -----------------------------------------------------------------------------
# Alert Types
# -----------------------------------------------------------------------------

"""
Email notification configuration
"""
type EmailConfig {
  """
  Whether email notifications are enabled
  """
  enabled: Boolean!

  """
  SMTP server hostname
  """
  host: String

  """
  SMTP server port
  """
  port: Int

  """
  SMTP username for authentication
  """
  username: String

  """
  Email sender address
  """
  fromAddress: String

  """
  Email sender display name
  """
  fromName: String

  """
  Array of recipient email addresses
  """
  toAddresses: [String!]!

  """
  Whether to use TLS/SSL
  """
  useTLS: Boolean

  """
  Skip TLS certificate verification (use with caution)
  """
  skipVerify: Boolean
}

"""
Alert rule defines conditions that trigger notifications when met
"""
type AlertRule implements Node {
  """
  Globally unique identifier
  """
  id: ID!

  """
  Human-readable alert rule name
  """
  name: String!

  """
  Optional description of what this rule monitors
  """
  description: String

  """
  Event type to match (e.g., 'router.offline', 'interface.down', 'cpu.high')
  """
  eventType: String!

  """
  Array of conditions for event matching
  """
  conditions: [AlertCondition!]!

  """
  Alert severity level
  """
  severity: AlertSeverity!

  """
  Notification channels to use
  """
  channels: [String!]!

  """
  Throttle configuration to prevent alert spam
  """
  throttle: ThrottleConfig

  """
  Quiet hours configuration for non-critical alerts
  """
  quietHours: QuietHoursConfig

  """
  Escalation configuration for unacknowledged alerts (NAS-18.9)
  """
  escalation: EscalationConfig

  """
  Optional device ID filter - rule only applies to this device
  """
  deviceId: ID

  """
  Whether this alert rule is enabled
  """
  enabled: Boolean!

  """
  Record creation timestamp
  """
  createdAt: DateTime!

  """
  Last update timestamp
  """
  updatedAt: DateTime!

  """
  Alerts triggered by this rule
  """
  alerts(
    """
    Filter by acknowledged status
    """
    acknowledged: Boolean
    """
    Limit number of results
    """
    limit: Int = 50
  ): [Alert!]!
}

"""
Individual alert instance triggered when rule conditions are met
"""
type Alert implements Node {
  """
  Globally unique identifier
  """
  id: ID!

  """
  Alert rule that triggered this alert
  """
  rule: AlertRule!

  """
  Event type that triggered this alert
  """
  eventType: String!

  """
  Alert severity level
  """
  severity: AlertSeverity!

  """
  Alert title/summary
  """
  title: String!

  """
  Detailed alert message
  """
  message: String!

  """
  Event data and context information
  """
  data: JSON

  """
  Device ID that triggered this alert
  """
  deviceId: ID

  """
  When alert was triggered
  """
  triggeredAt: DateTime!

  """
  When alert was acknowledged
  """
  acknowledgedAt: DateTime

  """
  User who acknowledged the alert
  """
  acknowledgedBy: String

  """
  Delivery status per channel
  """
  deliveryStatus: JSON

  """
  Escalation tracking for this alert (NAS-18.9)
  """
  escalation: AlertEscalation

  """
  Number of alerts suppressed by throttling (if this alert is part of a throttle group)
  """
  suppressedCount: Int

  """
  Reason for suppression (e.g., "throttled", "storm_detected")
  """
  suppressReason: String

  """
  Last update timestamp
  """
  updatedAt: DateTime!
}

"""
Condition for event matching in alert rules
"""
type AlertCondition {
  """
  Field name to evaluate
  """
  field: String!

  """
  Comparison operator
  """
  operator: ConditionOperator!

  """
  Value to compare against
  """
  value: String!
}

"""
Throttle status for an alert rule
Shows current throttling state and suppressed alert counts
"""
type ThrottleStatus {
  """
  Alert rule ID
  """
  ruleId: ID!

  """
  Whether the rule is currently throttled
  """
  isThrottled: Boolean!

  """
  Number of alerts suppressed in current throttle window
  """
  suppressedCount: Int!

  """
  When the current throttle window started
  """
  windowStart: DateTime

  """
  When the current throttle window ends
  """
  windowEnd: DateTime

  """
  Throttle groups (if groupByField is configured)
  """
  groups: [ThrottleGroupStatus!]!
}

"""
Throttle status for a specific group (when groupByField is used)
"""
type ThrottleGroupStatus {
  """
  Group identifier (value of groupByField)
  """
  groupKey: String!

  """
  Whether this group is currently throttled
  """
  isThrottled: Boolean!

  """
  Number of alerts suppressed for this group
  """
  suppressedCount: Int!

  """
  When the throttle window for this group started
  """
  windowStart: DateTime!

  """
  When the throttle window for this group ends
  """
  windowEnd: DateTime!
}

"""
Storm detection status
Shows if alert storm is detected and current metrics
"""
type StormStatus {
  """
  Whether storm is currently detected
  """
  isStormDetected: Boolean!

  """
  Number of alerts in current window
  """
  alertCount: Int!

  """
  Storm detection threshold
  """
  threshold: Int!

  """
  Window duration in seconds
  """
  windowSeconds: Int!

  """
  When storm detection started
  """
  stormStartedAt: DateTime

  """
  When current window started
  """
  windowStart: DateTime!

  """
  When current window ends
  """
  windowEnd: DateTime!

  """
  Top alert rules contributing to the storm
  """
  topRules: [StormRuleContribution!]!
}

"""
Alert rule contribution to storm detection
"""
type StormRuleContribution {
  """
  Alert rule ID
  """
  ruleId: ID!

  """
  Alert rule name
  """
  ruleName: String!

  """
  Number of alerts from this rule in current window
  """
  alertCount: Int!

  """
  Percentage of total alerts
  """
  percentage: Float!
}

"""
Throttle configuration to prevent alert spam
"""
type ThrottleConfig {
  """
  Maximum number of alerts allowed
  """
  maxAlerts: Int!

  """
  Time period in seconds
  """
  periodSeconds: Int!

  """
  Optional field to group alerts by
  """
  groupByField: String
}

"""
Quiet hours configuration
"""
type QuietHoursConfig {
  """
  Start time in HH:MM format
  """
  startTime: String!

  """
  End time in HH:MM format
  """
  endTime: String!

  """
  Timezone (IANA timezone database name)
  """
  timezone: String!

  """
  Whether critical alerts bypass quiet hours
  """
  bypassCritical: Boolean!

  """
  Days of week when quiet hours apply (0=Sunday, 1=Monday, 2=Tuesday, 3=Wednesday, 4=Thursday, 5=Friday, 6=Saturday). Empty array means all days.
  """
  daysOfWeek: [Int!]!
}

"""
Escalation configuration for unacknowledged alerts (NAS-18.9)
"""
type EscalationConfig {
  """
  Whether escalation is enabled
  """
  enabled: Boolean!

  """
  Whether alert must be acknowledged to stop escalation
  """
  requireAck: Boolean!

  """
  Delay in seconds before first escalation
  """
  escalationDelay: Int!

  """
  Maximum number of escalation levels
  """
  maxEscalations: Int!

  """
  Additional notification channels to add during escalation
  """
  additionalChannels: [String!]!

  """
  Per-level delay intervals in seconds
  """
  repeatIntervals: [Int!]!
}

"""
Alert escalation tracking record (NAS-18.9)
"""
type AlertEscalation implements Node {
  """
  Globally unique identifier
  """
  id: ID!

  """
  Alert being tracked for escalation
  """
  alertId: ID!

  """
  Alert rule with escalation configuration
  """
  ruleId: ID!

  """
  Current escalation level (0 = initial)
  """
  currentLevel: Int!

  """
  Maximum escalation level
  """
  maxLevel: Int!

  """
  Escalation status
  """
  status: EscalationStatus!

  """
  When next escalation level should trigger
  """
  nextEscalationAt: DateTime

  """
  When escalation was resolved
  """
  resolvedAt: DateTime

  """
  Reason for resolution
  """
  resolvedBy: String

  """
  Record creation timestamp
  """
  createdAt: DateTime!

  """
  Last update timestamp
  """
  updatedAt: DateTime!
}

# -----------------------------------------------------------------------------
# Enums
# -----------------------------------------------------------------------------

"""
Alert rule template categories
"""
enum AlertRuleTemplateCategory {
  """
  Network connectivity and interface monitoring
  """
  NETWORK

  """
  Security and firewall events
  """
  SECURITY

  """
  Resource usage (CPU, memory, disk)
  """
  RESOURCES

  """
  VPN and tunnel monitoring
  """
  VPN

  """
  DHCP and IP address management
  """
  DHCP

  """
  System events and maintenance
  """
  SYSTEM

  """
  Custom user-defined templates
  """
  CUSTOM
}

"""
Variable types for alert rule templates
"""
enum AlertRuleTemplateVariableType {
  """
  String value
  """
  STRING

  """
  Integer value
  """
  INTEGER

  """
  Duration in seconds
  """
  DURATION

  """
  Percentage (0-100)
  """
  PERCENTAGE
}

"""
Notification channel types
"""
enum NotificationChannel {
  """
  Email notifications
  """
  EMAIL

  """
  Telegram notifications
  """
  TELEGRAM

  """
  Pushover notifications
  """
  PUSHOVER

  """
  Webhook notifications
  """
  WEBHOOK

  """
  In-app notifications
  """
  INAPP
}

"""
Template variable types for notification templates
"""
enum AlertTemplateVariableType {
  """
  String value
  """
  STRING

  """
  Numeric value
  """
  NUMBER

  """
  Timestamp value
  """
  TIMESTAMP

  """
  Boolean value
  """
  BOOLEAN

  """
  Interface name
  """
  INTERFACE

  """
  IP address
  """
  IPADDRESS
}

"""
Alert severity levels
"""
enum AlertSeverity {
  """
  Critical - requires immediate attention
  """
  CRITICAL

  """
  Warning - attention needed soon
  """
  WARNING

  """
  Info - informational only
  """
  INFO
}

"""
Webhook authentication types
"""
enum WebhookAuthType {
  """
  No authentication required
  """
  NONE

  """
  Bearer token authentication
  """
  BEARER

  """
  HTTP Basic authentication
  """
  BASIC
}

"""
Webhook template types for predefined formats
"""
enum WebhookTemplate {
  """
  Generic JSON format
  """
  GENERIC

  """
  Slack incoming webhook format
  """
  SLACK

  """
  Discord webhook format
  """
  DISCORD

  """
  Microsoft Teams webhook format
  """
  TEAMS

  """
  Custom template with user-defined format
  """
  CUSTOM
}

"""
Condition comparison operators
"""
enum ConditionOperator {
  """
  Exact match
  """
  EQUALS

  """
  Not equal
  """
  NOT_EQUALS

  """
  Numeric greater than
  """
  GREATER_THAN

  """
  Numeric less than
  """
  LESS_THAN

  """
  String contains
  """
  CONTAINS

  """
  Regular expression match
  """
  REGEX
}

"""
Alert action types for subscriptions
"""
enum AlertAction {
  """
  Alert was created/triggered
  """
  CREATED

  """
  Alert was acknowledged
  """
  ACKNOWLEDGED

  """
  Alert was resolved
  """
  RESOLVED
}

"""
Escalation status (NAS-18.9)
"""
enum EscalationStatus {
  """
  Escalation is pending/in progress
  """
  PENDING

  """
  Escalation was resolved (alert acknowledged)
  """
  RESOLVED

  """
  Maximum escalation level reached
  """
  MAX_REACHED
}

# -----------------------------------------------------------------------------
# Input Types
# -----------------------------------------------------------------------------

"""
Input for saving custom alert rule template
"""
input SaveAlertRuleTemplateInput {
  """
  Template name
  """
  name: String!

  """
  Template description
  """
  description: String!

  """
  Template category
  """
  category: AlertRuleTemplateCategory!

  """
  Alert severity
  """
  severity: AlertSeverity!

  """
  Event type
  """
  eventType: String!

  """
  Alert conditions
  """
  conditions: [AlertConditionInput!]!

  """
  Throttle configuration
  """
  throttle: ThrottleConfigInput

  """
  Notification channels
  """
  channels: [String!]!

  """
  Template variables
  """
  variables: [AlertRuleAlertTemplateVariableInput!]
}

"""
Variable input for alert rule templates
"""
input AlertRuleAlertTemplateVariableInput {
  """
  Variable name
  """
  name: String!

  """
  Display label
  """
  label: String!

  """
  Variable type
  """
  type: AlertRuleTemplateVariableType!

  """
  Whether required
  """
  required: Boolean!

  """
  Default value
  """
  defaultValue: String

  """
  Minimum value
  """
  min: Int

  """
  Maximum value
  """
  max: Int

  """
  Unit label
  """
  unit: String

  """
  Description
  """
  description: String
}

"""
Input for applying an alert template
"""
input ApplyAlertTemplateInput {
  """
  Template ID to apply
  """
  templateId: ID!

  """
  Variables for template substitution
  """
  variables: JSON!

  """
  Alert rule configuration
  """
  ruleConfig: CreateAlertRuleInput!
}

"""
Input for saving a custom alert template
"""
input SaveAlertTemplateInput {
  """
  Template name
  """
  name: String!

  """
  Template description
  """
  description: String!

  """
  Event type
  """
  eventType: String!

  """
  Notification channel
  """
  channel: NotificationChannel!

  """
  Subject template
  """
  subjectTemplate: String

  """
  Body template
  """
  bodyTemplate: String!

  """
  Template variables
  """
  variables: [AlertAlertTemplateVariableInput!]!

  """
  Tags
  """
  tags: [String!]

  """
  Metadata
  """
  metadata: JSON
}

"""
Template variable input
"""
input AlertAlertTemplateVariableInput {
  """
  Variable name
  """
  name: String!

  """
  Display label
  """
  label: String!

  """
  Variable type
  """
  type: AlertTemplateVariableType!

  """
  Whether required
  """
  required: Boolean!

  """
  Default value
  """
  defaultValue: String

  """
  Description
  """
  description: String

  """
  Options for enum types
  """
  options: [String!]
}

"""
Input for previewing a notification template
Simpler input for template customization workflow
"""
input PreviewNotificationTemplateInput {
  """
  Event type for sample data generation
  """
  eventType: String!

  """
  Notification channel
  """
  channel: NotificationChannel!

  """
  Subject template (optional, not all channels use subjects)
  """
  subjectTemplate: String

  """
  Body template with Go template syntax
  """
  bodyTemplate: String!
}

"""
Notification template preview result
Simplified preview output for template customization
"""
type NotificationTemplatePreview {
  """
  Rendered subject line (empty if channel doesn't use subjects)
  """
  subject: String

  """
  Rendered body content
  """
  body: String!

  """
  Validation errors (empty array if valid)
  """
  errors: [String!]!
}

"""
Email notification configuration input
"""
input EmailConfigInput {
  """
  Whether email notifications are enabled
  """
  enabled: Boolean!

  """
  SMTP server hostname
  """
  host: String

  """
  SMTP server port
  """
  port: Int

  """
  SMTP username for authentication
  """
  username: String

  """
  SMTP password for authentication
  """
  password: String

  """
  Email sender address
  """
  fromAddress: String

  """
  Email sender display name
  """
  fromName: String

  """
  Array of recipient email addresses
  """
  toAddresses: [String!]!

  """
  Whether to use TLS/SSL
  """
  useTLS: Boolean

  """
  Skip TLS certificate verification (use with caution)
  """
  skipVerify: Boolean
}

"""
Input for creating an alert rule
"""
input CreateAlertRuleInput {
  """
  Human-readable alert rule name
  """
  name: String!

  """
  Optional description
  """
  description: String

  """
  Event type to match
  """
  eventType: String!

  """
  Array of conditions
  """
  conditions: [AlertConditionInput!]

  """
  Alert severity level
  """
  severity: AlertSeverity!

  """
  Notification channels
  """
  channels: [String!]!

  """
  Throttle configuration
  """
  throttle: ThrottleConfigInput

  """
  Quiet hours configuration
  """
  quietHours: QuietHoursConfigInput

  """
  Escalation configuration (NAS-18.9)
  """
  escalation: EscalationConfigInput

  """
  Optional device ID filter
  """
  deviceId: ID

  """
  Whether rule is enabled (default: true)
  """
  enabled: Boolean = true
}

"""
Input for updating an alert rule
"""
input UpdateAlertRuleInput {
  """
  Human-readable alert rule name
  """
  name: String

  """
  Optional description
  """
  description: String

  """
  Event type to match
  """
  eventType: String

  """
  Array of conditions
  """
  conditions: [AlertConditionInput!]

  """
  Alert severity level
  """
  severity: AlertSeverity

  """
  Notification channels
  """
  channels: [String!]

  """
  Throttle configuration
  """
  throttle: ThrottleConfigInput

  """
  Quiet hours configuration
  """
  quietHours: QuietHoursConfigInput

  """
  Escalation configuration (NAS-18.9)
  """
  escalation: EscalationConfigInput

  """
  Optional device ID filter
  """
  deviceId: ID

  """
  Whether rule is enabled
  """
  enabled: Boolean
}

"""
Alert condition input
"""
input AlertConditionInput {
  """
  Field name to evaluate
  """
  field: String!

  """
  Comparison operator
  """
  operator: ConditionOperator!

  """
  Value to compare against
  """
  value: String!
}

"""
Throttle configuration input
"""
input ThrottleConfigInput {
  """
  Maximum number of alerts allowed
  """
  maxAlerts: Int!

  """
  Time period in seconds
  """
  periodSeconds: Int!

  """
  Optional field to group alerts by
  """
  groupByField: String
}

"""
Quiet hours configuration input
"""
input QuietHoursConfigInput {
  """
  Start time in HH:MM format
  """
  startTime: String!

  """
  End time in HH:MM format
  """
  endTime: String!

  """
  Timezone (default: UTC)
  """
  timezone: String = "UTC"

  """
  Whether critical alerts bypass quiet hours (default: true)
  """
  bypassCritical: Boolean = true

  """
  Days of week when quiet hours apply (0=Sunday, 1=Monday, 2=Tuesday, 3=Wednesday, 4=Thursday, 5=Friday, 6=Saturday). Empty array means all days.
  """
  daysOfWeek: [Int!] = []
}

"""
Escalation configuration input (NAS-18.9)
"""
input EscalationConfigInput {
  """
  Whether escalation is enabled (default: false)
  """
  enabled: Boolean = false

  """
  Whether alert must be acknowledged to stop escalation (default: true)
  """
  requireAck: Boolean = true

  """
  Delay in seconds before first escalation (default: 900 = 15min)
  """
  escalationDelay: Int = 900

  """
  Maximum number of escalation levels (default: 3)
  """
  maxEscalations: Int = 3

  """
  Additional notification channels to add during escalation
  """
  additionalChannels: [String!] = []

  """
  Per-level delay intervals in seconds (default: [900, 1800, 3600])
  """
  repeatIntervals: [Int!] = []
}

# -----------------------------------------------------------------------------
# Connection Types (Relay Pagination)
# -----------------------------------------------------------------------------

"""
Paginated alert connection
"""
type AlertConnection implements Connection {
  """
  Alert edges
  """
  edges: [AlertEdge!]!

  """
  Pagination information
  """
  pageInfo: PageInfo!

  """
  Total count of alerts
  """
  totalCount: Int!
}

"""
Alert edge for pagination
"""
type AlertEdge implements Edge {
  """
  Alert node
  """
  node: Alert!

  """
  Pagination cursor
  """
  cursor: String!
}

# -----------------------------------------------------------------------------
# Payload Types
# -----------------------------------------------------------------------------

"""
Alert rule mutation payload
"""
type AlertRulePayload {
  """
  Created/updated alert rule
  """
  alertRule: AlertRule

  """
  Errors encountered during mutation
  """
  errors: [MutationError!]
}

"""
Alert mutation payload
"""
type AlertPayload {
  """
  Modified alert
  """
  alert: Alert

  """
  Errors encountered during mutation
  """
  errors: [MutationError!]
}

"""
Bulk alert mutation payload
"""
type BulkAlertPayload {
  """
  Number of alerts acknowledged
  """
  acknowledgedCount: Int!

  """
  Errors encountered during mutation
  """
  errors: [MutationError!]
}

"""
Test notification payload
"""
type TestNotificationPayload {
  """
  Whether test was successful
  """
  success: Boolean!

  """
  Test result message
  """
  message: String

  """
  Errors encountered during test
  """
  errors: [MutationError!]
}

"""
Delete operation payload
"""
type DeletePayload {
  """
  Whether deletion was successful
  """
  success: Boolean!

  """
  ID of deleted item
  """
  deletedId: ID

  """
  Errors encountered during deletion
  """
  errors: [MutationError!]
}

"""
Alert rule template mutation payload
"""
type AlertRuleTemplatePayload {
  """
  Created/updated template
  """
  template: AlertRuleTemplate

  """
  Errors encountered during mutation
  """
  errors: [MutationError!]
}

"""
Alert template mutation payload
"""
type AlertTemplatePayload {
  """
  Created/updated template
  """
  template: AlertTemplate

  """
  Errors encountered during mutation
  """
  errors: [MutationError!]
}

"""
Template preview payload
"""
type TemplatePreviewPayload {
  """
  Preview result
  """
  preview: TemplatePreview

  """
  Errors encountered during preview
  """
  errors: [MutationError!]
}

"""
Webhook mutation payload
"""
type WebhookPayload {
  """
  Created/updated webhook
  """
  webhook: Webhook

  """
  Signing secret (only returned on creation, one-time show)
  """
  signingSecret: String

  """
  Errors encountered during mutation
  """
  errors: [MutationError!]
}

"""
Webhook test mutation payload
"""
type WebhookTestPayload {
  """
  Test result
  """
  result: WebhookTestResult

  """
  Errors encountered during test
  """
  errors: [MutationError!]
}

# -----------------------------------------------------------------------------
# Subscription Event Types
# -----------------------------------------------------------------------------

"""
Alert event for real-time subscriptions
"""
type AlertEvent {
  """
  The alert that changed
  """
  alert: Alert!

  """
  Type of action that occurred
  """
  action: AlertAction!
}

# -----------------------------------------------------------------------------
# Notification Channel Types
# -----------------------------------------------------------------------------

"""
Pushover API usage statistics
"""
type PushoverUsage {
  """
  Number of messages used this month
  """
  used: Int!

  """
  Number of messages remaining this month
  """
  remaining: Int!

  """
  Monthly message limit
  """
  limit: Int!

  """
  When the usage counter resets
  """
  resetAt: DateTime!
}

"""
Webhook notification configuration
"""
type Webhook implements Node {
  """
  Globally unique identifier
  """
  id: ID!

  """
  Human-readable webhook name
  """
  name: String!

  """
  Optional description
  """
  description: String

  """
  Webhook URL endpoint
  """
  url: String!

  """
  HTTP method (default: POST)
  """
  method: String!

  """
  Authentication type
  """
  authType: WebhookAuthType!

  """
  Username for Basic auth
  """
  username: String

  """
  Bearer token (masked, only shown on creation)
  """
  bearerToken: String

  """
  Custom HTTP headers (as JSON object)
  """
  headers: JSON

  """
  Template type for webhook payload
  """
  template: WebhookTemplate!

  """
  Custom template body (for CUSTOM template type)
  """
  customTemplate: String

  """
  Signing secret (masked with ******, never returned in plaintext except on creation)
  """
  signingSecretMasked: String

  """
  Timeout in seconds (default: 10)
  """
  timeoutSeconds: Int!

  """
  Whether to retry failed deliveries
  """
  retryEnabled: Boolean!

  """
  Maximum retry attempts (default: 3)
  """
  maxRetries: Int!

  """
  Whether this webhook is enabled
  """
  enabled: Boolean!

  """
  Record creation timestamp
  """
  createdAt: DateTime!

  """
  Last update timestamp
  """
  updatedAt: DateTime!

  """
  Last successful delivery timestamp
  """
  lastDeliveredAt: DateTime

  """
  Delivery statistics
  """
  deliveryStats: WebhookDeliveryStats
}

"""
Webhook delivery statistics
"""
type WebhookDeliveryStats {
  """
  Total deliveries attempted
  """
  totalAttempts: Int!

  """
  Successful deliveries
  """
  successCount: Int!

  """
  Failed deliveries
  """
  failureCount: Int!

  """
  Success rate (0-100)
  """
  successRate: Float!

  """
  Average response time in milliseconds
  """
  avgResponseTimeMs: Int
}

"""
Result of testing a webhook
"""
type WebhookTestResult {
  """
  Whether the test was successful
  """
  success: Boolean!

  """
  HTTP status code received
  """
  statusCode: Int

  """
  Response body from webhook endpoint
  """
  responseBody: String

  """
  Response time in milliseconds
  """
  responseTimeMs: Int

  """
  Error message if test failed
  """
  errorMessage: String
}

"""
Notification delivery log entry
"""
type NotificationLog implements Node {
  """
  Globally unique identifier
  """
  id: ID!

  """
  Alert that triggered this notification
  """
  alertId: ID!

  """
  Notification channel type (email, telegram, pushover, webhook)
  """
  channel: String!

  """
  Webhook ID (if channel is webhook)
  """
  webhookId: ID

  """
  Delivery status
  """
  status: NotificationStatus!

  """
  HTTP status code (for webhooks)
  """
  statusCode: Int

  """
  Response time in milliseconds
  """
  responseTimeMs: Int

  """
  Error message if delivery failed
  """
  errorMessage: String

  """
  Number of retry attempts
  """
  retryCount: Int!

  """
  Request payload sent
  """
  requestPayload: JSON

  """
  Response body received
  """
  responseBody: String

  """
  When delivery was attempted
  """
  attemptedAt: DateTime!

  """
  When delivery was completed (success or final failure)
  """
  completedAt: DateTime
}

"""
Notification delivery status
"""
enum NotificationStatus {
  """
  Delivery pending
  """
  PENDING

  """
  Successfully delivered
  """
  SUCCESS

  """
  Delivery failed
  """
  FAILED

  """
  Retrying after failure
  """
  RETRYING
}

"""
Email digest configuration (NAS-18.11)
"""
type DigestConfig {
  """
  Whether digest mode is enabled
  """
  enabled: Boolean!

  """
  Digest interval in minutes (e.g., 60 for hourly, 1440 for daily)
  """
  intervalMinutes: Int!

  """
  Time of day for daily delivery in HH:MM format (optional, for daily digests)
  """
  time: String

  """
  Whether critical alerts bypass digest mode and send immediately
  """
  bypassCritical: Boolean!

  """
  Whether to send digest even when no alerts occurred during the period
  """
  sendEmptyDigest: Boolean!
}

"""
Email digest configuration input (NAS-18.11)
"""
input DigestConfigInput {
  """
  Whether digest mode is enabled
  """
  enabled: Boolean!

  """
  Digest interval in minutes (e.g., 60 for hourly, 1440 for daily)
  """
  intervalMinutes: Int!

  """
  Time of day for daily delivery in HH:MM format (optional, for daily digests)
  """
  time: String

  """
  Whether critical alerts bypass digest mode and send immediately (default: true)
  """
  bypassCritical: Boolean = true

  """
  Whether to send digest even when no alerts occurred during the period (default: false)
  """
  sendEmptyDigest: Boolean = false
}

"""
Digest summary (NAS-18.11)
"""
type DigestSummary {
  """
  Globally unique identifier
  """
  id: ID!

  """
  Channel ID this digest was sent to
  """
  channelId: String!

  """
  When the digest was delivered
  """
  deliveredAt: DateTime!

  """
  Number of alerts included in the digest
  """
  alertCount: Int!

  """
  Time period covered by the digest (e.g., "Last hour", "Last 24 hours")
  """
  period: String!
}

"""
Input for creating a webhook
"""
input CreateWebhookInput {
  """
  Human-readable webhook name
  """
  name: String!

  """
  Optional description
  """
  description: String

  """
  Webhook URL endpoint
  """
  url: String!

  """
  HTTP method (default: POST)
  """
  method: String = "POST"

  """
  Authentication type (default: NONE)
  """
  authType: WebhookAuthType = NONE

  """
  Username for Basic auth
  """
  username: String

  """
  Password for Basic auth
  """
  password: String

  """
  Bearer token for Bearer auth
  """
  bearerToken: String

  """
  Custom HTTP headers (as JSON object)
  """
  headers: JSON

  """
  Template type for webhook payload (default: GENERIC)
  """
  template: WebhookTemplate = GENERIC

  """
  Custom template body (required if template is CUSTOM)
  """
  customTemplate: String

  """
  Signing secret for HMAC signature (optional)
  """
  signingSecret: String

  """
  Timeout in seconds (default: 10)
  """
  timeoutSeconds: Int = 10

  """
  Whether to retry failed deliveries (default: true)
  """
  retryEnabled: Boolean = true

  """
  Maximum retry attempts (default: 3)
  """
  maxRetries: Int = 3

  """
  Whether webhook is enabled (default: true)
  """
  enabled: Boolean = true
}

"""
Input for updating a webhook
"""
input UpdateWebhookInput {
  """
  Human-readable webhook name
  """
  name: String

  """
  Optional description
  """
  description: String

  """
  Webhook URL endpoint
  """
  url: String

  """
  HTTP method
  """
  method: String

  """
  Authentication type
  """
  authType: WebhookAuthType

  """
  Username for Basic auth
  """
  username: String

  """
  Password for Basic auth (only set if provided)
  """
  password: String

  """
  Bearer token for Bearer auth (only set if provided)
  """
  bearerToken: String

  """
  Custom HTTP headers (as JSON object)
  """
  headers: JSON

  """
  Template type for webhook payload
  """
  template: WebhookTemplate

  """
  Custom template body
  """
  customTemplate: String

  """
  Signing secret for HMAC signature (only set if provided)
  """
  signingSecret: String

  """
  Timeout in seconds
  """
  timeoutSeconds: Int

  """
  Whether to retry failed deliveries
  """
  retryEnabled: Boolean

  """
  Maximum retry attempts
  """
  maxRetries: Int

  """
  Whether webhook is enabled
  """
  enabled: Boolean
}

# -----------------------------------------------------------------------------
# Queries
# -----------------------------------------------------------------------------

extend type Query {
  """
  Get alert rule templates, optionally filtered by category
  """
  alertRuleTemplates(
    """
    Filter by category
    """
    category: AlertRuleTemplateCategory
  ): [AlertRuleTemplate!]!

  """
  Get a single alert rule template by ID
  """
  alertRuleTemplate(
    """
    Template ID
    """
    id: ID!
  ): AlertRuleTemplate

  """
  Preview an alert rule template with variable substitution
  """
  previewAlertRuleTemplate(
    """
    Template ID
    """
    templateId: ID!
    """
    Variables for substitution
    """
    variables: JSON!
  ): AlertRuleTemplatePreview!

  """
  Get all alert templates, optionally filtered by event type or channel
  """
  alertTemplates(
    """
    Filter by event type
    """
    eventType: String
    """
    Filter by notification channel
    """
    channel: NotificationChannel
  ): [AlertTemplate!]!

  """
  Get a single alert template by ID
  """
  alertTemplate(
    """
    Template ID
    """
    id: ID!
  ): AlertTemplate

  """
  Get common event types
  """
  commonEventTypes: [String!]!

  """
  Search alert templates
  """
  searchAlertTemplates(
    """
    Search query
    """
    query: String!
  ): [AlertTemplate!]!

  """
  Preview an alert template with variables
  """
  previewAlertTemplate(
    """
    Template ID
    """
    templateId: ID!
    """
    Variables for substitution
    """
    variables: JSON!
  ): TemplatePreviewPayload!

  """
  Get all alert rules, optionally filtered by device
  """
  alertRules(
    """
    Filter by device ID
    """
    deviceId: ID
  ): [AlertRule!]!

  """
  Get a single alert rule by ID
  """
  alertRule(
    """
    Alert rule ID
    """
    id: ID!
  ): AlertRule

  """
  Get alerts with filtering and pagination
  """
  alerts(
    """
    Filter by device ID
    """
    deviceId: ID
    """
    Filter by severity
    """
    severity: AlertSeverity
    """
    Filter by acknowledged status
    """
    acknowledged: Boolean
    """
    Pagination limit
    """
    limit: Int = 50
    """
    Pagination offset
    """
    offset: Int = 0
  ): AlertConnection!

  """
  Get Pushover API usage statistics
  """
  pushoverUsage: PushoverUsage

  """
  Get all webhooks
  """
  webhooks: [Webhook!]!

  """
  Get a single webhook by ID
  """
  webhook(
    """
    Webhook ID
    """
    id: ID!
  ): Webhook

  """
  Get notification delivery logs
  """
  notificationLogs(
    """
    Filter by alert ID
    """
    alertId: ID
    """
    Filter by channel type
    """
    channel: String
    """
    Filter by webhook ID
    """
    webhookId: ID
    """
    Pagination limit
    """
    limit: Int = 50
    """
    Pagination offset
    """
    offset: Int = 0
  ): [NotificationLog!]!

  """
  Get alert escalations with optional filtering (NAS-18.9)
  """
  alertEscalations(
    """
    Filter by escalation status
    """
    status: EscalationStatus
    """
    Pagination limit
    """
    limit: Int = 50
    """
    Pagination offset
    """
    offset: Int = 0
  ): [AlertEscalation!]!

  """
  Get the number of alerts in the digest queue for a channel (NAS-18.11)
  """
  digestQueueCount(
    """
    Channel ID to check queue for
    """
    channelId: ID!
  ): Int!

  """
  Get digest delivery history for a channel (NAS-18.11)
  """
  digestHistory(
    """
    Channel ID to get history for
    """
    channelId: ID!
    """
    Limit number of results (default: 10)
    """
    limit: Int = 10
  ): [DigestSummary!]!

  """
  Get throttle status for alert rules
  Returns throttle information for all rules or a specific rule
  """
  alertRuleThrottleStatus(
    """
    Optional rule ID to filter by specific rule
    """
    ruleId: ID
  ): [ThrottleStatus!]!

  """
  Get current storm detection status
  Shows if alert storm is detected and which rules are contributing
  """
  alertStormStatus: StormStatus!
}

# -----------------------------------------------------------------------------
# Mutations
# -----------------------------------------------------------------------------

extend type Mutation {
  """
  Apply an alert rule template to create a rule
  """
  applyAlertRuleTemplate(
    """
    Template ID
    """
    templateId: ID!
    """
    Variables for substitution
    """
    variables: JSON!
    """
    Optional customizations
    """
    customizations: CreateAlertRuleInput
  ): AlertRulePayload!

  """
  Save a custom alert rule template
  """
  saveCustomAlertRuleTemplate(
    """
    Template input
    """
    input: SaveAlertRuleTemplateInput!
  ): AlertRuleTemplatePayload!

  """
  Delete a custom alert rule template (built-ins cannot be deleted)
  """
  deleteCustomAlertRuleTemplate(
    """
    Template ID
    """
    id: ID!
  ): DeletePayload!

  """
  Import an alert rule template from JSON
  """
  importAlertRuleTemplate(
    """
    JSON template string
    """
    json: String!
  ): AlertRuleTemplatePayload!

  """
  Export an alert rule template as JSON
  """
  exportAlertRuleTemplate(
    """
    Template ID
    """
    id: ID!
  ): String!

  """
  Apply an alert template to create an alert rule
  """
  applyAlertTemplate(
    """
    Template application input
    """
    input: ApplyAlertTemplateInput!
  ): AlertRulePayload!

  """
  Save a custom alert template
  """
  saveAlertTemplate(
    """
    Template input
    """
    input: SaveAlertTemplateInput!
  ): AlertTemplatePayload!

  """
  Delete a custom alert template
  """
  deleteAlertTemplate(
    """
    Template ID
    """
    id: ID!
  ): DeletePayload!

  """
  Reset alert notification template to system default (deletes custom template)
  Used for notification template customization per channel
  Requires authentication
  """
  resetAlertTemplate(
    """
    Event type to reset template for
    """
    eventType: String!
    """
    Notification channel to reset template for
    """
    channel: NotificationChannel!
  ): DeletePayload! @auth

  """
  Preview how a notification template will render with sample data
  Used for template customization - renders subject and body with validation
  Requires authentication
  """
  previewNotificationTemplate(
    """
    Template preview input
    """
    input: PreviewNotificationTemplateInput!
  ): NotificationTemplatePreview! @auth

  """
  Create a new alert rule
  """
  createAlertRule(
    """
    Alert rule input
    """
    input: CreateAlertRuleInput!
  ): AlertRulePayload!

  """
  Update an existing alert rule
  """
  updateAlertRule(
    """
    Alert rule ID
    """
    id: ID!
    """
    Update input
    """
    input: UpdateAlertRuleInput!
  ): AlertRulePayload!

  """
  Toggle alert rule enabled/disabled status
  """
  toggleAlertRule(
    """
    Alert rule ID
    """
    id: ID!
  ): AlertRulePayload!

  """
  Delete an alert rule
  """
  deleteAlertRule(
    """
    Alert rule ID
    """
    id: ID!
  ): DeletePayload!

  """
  Acknowledge a single alert
  """
  acknowledgeAlert(
    """
    Alert ID
    """
    alertId: ID!
  ): AlertPayload!

  """
  Acknowledge multiple alerts
  """
  acknowledgeAlerts(
    """
    Array of alert IDs
    """
    alertIds: [ID!]!
  ): BulkAlertPayload!

  """
  Test a notification channel
  """
  testNotificationChannel(
    """
    Channel type (email, telegram, pushover, webhook)
    """
    channel: String!
    """
    Channel configuration
    """
    config: JSON!
  ): TestNotificationPayload!

  """
  Create a new webhook
  """
  createWebhook(
    """
    Webhook input
    """
    input: CreateWebhookInput!
  ): WebhookPayload!

  """
  Update an existing webhook
  """
  updateWebhook(
    """
    Webhook ID
    """
    id: ID!
    """
    Update input
    """
    input: UpdateWebhookInput!
  ): WebhookPayload!

  """
  Delete a webhook
  """
  deleteWebhook(
    """
    Webhook ID
    """
    id: ID!
  ): DeletePayload!

  """
  Test a webhook by sending a sample payload
  """
  testWebhook(
    """
    Webhook ID to test
    """
    id: ID!
  ): WebhookTestPayload!

  """
  Trigger digest delivery immediately for a channel (NAS-18.11)
  """
  triggerDigestNow(
    """
    Channel ID to trigger digest for
    """
    channelId: ID!
  ): DigestSummary!
}

# -----------------------------------------------------------------------------
# Subscriptions
# -----------------------------------------------------------------------------

extend type Subscription {
  """
  Subscribe to alert events for real-time updates
  """
  alertEvents(
    """
    Filter by device ID
    """
    deviceId: ID
  ): AlertEvent!
}
# -----------------------------------------------------------------------------
# Notification Channel Configuration (NAS-18.X Persistence Layer)
# -----------------------------------------------------------------------------

"""
Type of notification channel
"""
enum ChannelType {
  PUSHOVER
  EMAIL
  SLACK
  WEBHOOK
  TELEGRAM
}

"""
Notification channel configuration with encrypted credentials
"""
type NotificationChannelConfig {
  """
  Unique configuration ID
  """
  id: ID!
  
  """
  Type of notification channel
  """
  channelType: ChannelType!
  
  """
  Human-readable name for this configuration
  """
  name: String!
  
  """
  Optional description
  """
  description: String
  
  """
  Whether this configuration is enabled
  """
  enabled: Boolean!
  
  """
  Whether this is the default configuration for this channel type
  """
  isDefault: Boolean!
  
  """
  Masked configuration (sensitive fields redacted)
  For Pushover: {"device": "iphone", "baseURL": "...", "userKey": "******", "apiToken": "******"}
  For Email: {"host": "smtp.gmail.com", "port": 587, "from": "...", "password": "******"}
  """
  configMasked: JSON!
  
  """
  When this configuration was created
  """
  createdAt: DateTime!
  
  """
  When this configuration was last updated
  """
  updatedAt: DateTime!
  
  """
  User ID who created this configuration
  """
  createdBy: String
  
  """
  User ID who last updated this configuration
  """
  updatedBy: String
}

"""
Input for creating a new notification channel configuration
"""
input CreateNotificationChannelConfigInput {
  """
  Type of notification channel
  """
  channelType: ChannelType!
  
  """
  Human-readable name
  """
  name: String!
  
  """
  Optional description
  """
  description: String
  
  """
  Whether this should be the default configuration
  """
  isDefault: Boolean
  
  """
  Full configuration including sensitive fields
  For Pushover: {"userKey": "...", "apiToken": "...", "device": "...", "baseURL": "..."}
  For Email: {"host": "...", "port": 587, "from": "...", "username": "...", "password": "...", "tlsMode": "..."}
  """
  config: JSON!
}

"""
Input for updating an existing notification channel configuration
"""
input UpdateNotificationChannelConfigInput {
  """
  New name (optional)
  """
  name: String
  
  """
  New description (optional)
  """
  description: String
  
  """
  Enable/disable configuration (optional)
  """
  enabled: Boolean
  
  """
  Set as default (optional)
  """
  isDefault: Boolean
  
  """
  New configuration (optional, replaces entire config if provided)
  """
  config: JSON
}

"""
Payload for channel configuration mutations
"""
type ChannelConfigPayload {
  """
  The created/updated configuration
  """
  config: NotificationChannelConfig
  
  """
  Validation or mutation errors
  """
  errors: [MutationError!]
}

extend type Query {
  """
  List all notification channel configurations (optionally filtered by type)
  """
  notificationChannelConfigs(
    """
    Filter by channel type
    """
    channelType: ChannelType
  ): [NotificationChannelConfig!]!
  
  """
  Get a specific notification channel configuration by ID
  """
  notificationChannelConfig(
    """
    Configuration ID
    """
    id: ID!
  ): NotificationChannelConfig
  
  """
  Get the default configuration for a specific channel type
  """
  defaultNotificationChannelConfig(
    """
    Channel type
    """
    channelType: ChannelType!
  ): NotificationChannelConfig
}

extend type Mutation {
  """
  Create a new notification channel configuration (validates before saving)
  """
  createNotificationChannelConfig(
    """
    Configuration input
    """
    input: CreateNotificationChannelConfigInput!
  ): ChannelConfigPayload!
  
  """
  Update an existing notification channel configuration
  """
  updateNotificationChannelConfig(
    """
    Configuration ID
    """
    id: ID!
    
    """
    Update input
    """
    input: UpdateNotificationChannelConfigInput!
  ): ChannelConfigPayload!
  
  """
  Delete a notification channel configuration (soft delete)
  """
  deleteNotificationChannelConfig(
    """
    Configuration ID
    """
    id: ID!
  ): DeletePayload!
}
