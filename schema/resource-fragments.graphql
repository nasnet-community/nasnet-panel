# =============================================================================
# Universal State v2 - Resource GraphQL Fragments
# =============================================================================
# These fragments enable selective fetching of resource layers.
# Use minimal fragments for mobile/bandwidth-constrained clients.
# Use full fragments for desktop/power-user scenarios.
#
# Reference: ADR-012 - Universal State v2
# =============================================================================

# -----------------------------------------------------------------------------
# Layer Fragments
# -----------------------------------------------------------------------------

"""
Fragment for resource identification only (minimal)
"""
fragment ResourceId on Resource {
  uuid
  id
  type
  category
}

"""
Fragment for Layer 1: Configuration
"""
fragment ResourceConfiguration on Resource {
  ...ResourceId
  configuration
}

"""
Fragment for Layer 2: Validation
"""
fragment ResourceValidation on Resource {
  ...ResourceId
  validation {
    canApply
    stage
    errors {
      code
      message
      field
      severity
      suggestedFix
    }
    warnings {
      code
      message
      field
      severity
    }
    conflicts {
      type
      conflictingResourceUuid
      description
      resolution
    }
    requiredDependencies {
      resourceUuid
      resourceType
      isActive
      state
      reason
    }
    validatedAt
    validationDurationMs
  }
}

"""
Fragment for Layer 3: Deployment
"""
fragment ResourceDeployment on Resource {
  ...ResourceId
  deployment {
    routerResourceId
    appliedAt
    appliedBy
    routerVersion
    generatedFields
    isInSync
    drift {
      detectedAt
      driftedFields {
        path
        expected
        actual
      }
      suggestedAction
    }
    applyOperationId
  }
}

"""
Fragment for Layer 4: Runtime
"""
fragment ResourceRuntime on Resource {
  ...ResourceId
  runtime {
    isRunning
    health
    errorMessage
    metrics {
      bytesIn
      bytesOut
      packetsIn
      packetsOut
      errors
      drops
      throughputIn
      throughputOut
      custom
    }
    lastUpdated
    lastSuccessfulOperation
    activeConnections
    uptime
  }
}

"""
Fragment for Layer 5: Telemetry (lightweight)
"""
fragment ResourceTelemetryLight on Resource {
  ...ResourceId
  telemetry {
    lastUpdatedAt
    retentionDays
  }
}

"""
Fragment for Layer 5: Telemetry (full)
"""
fragment ResourceTelemetryFull on Resource {
  ...ResourceId
  telemetry {
    bandwidthHistory {
      timestamp
      bytesIn
      bytesOut
      periodSeconds
    }
    uptimeHistory {
      timestamp
      isUp
      periodSeconds
    }
    hourlyStats {
      hour
      totalBytesIn
      totalBytesOut
      uptimePercent
      errorCount
    }
    dailyStats {
      date
      totalBytesIn
      totalBytesOut
      uptimePercent
      errorCount
      peakThroughputIn
      peakThroughputOut
    }
    dataStartedAt
    lastUpdatedAt
    retentionDays
  }
}

"""
Fragment for Layer 6: Metadata
"""
fragment ResourceMetadataFull on Resource {
  ...ResourceId
  metadata {
    createdAt
    createdBy
    updatedAt
    updatedBy
    state
    version
    tags
    description
    isFavorite
    isPinned
    notes
    recentChanges {
      timestamp
      user
      changeType
      changedFields
      summary
    }
  }
}

"""
Fragment for Layer 6: Metadata (minimal)
"""
fragment ResourceMetadataLight on Resource {
  ...ResourceId
  metadata {
    state
    version
    tags
    updatedAt
  }
}

"""
Fragment for Layer 7: Relationships
"""
fragment ResourceRelationshipsFull on Resource {
  ...ResourceId
  relationships {
    dependsOn {
      uuid
      id
      type
      category
      state
    }
    dependents {
      uuid
      id
      type
      category
      state
    }
    routesVia {
      uuid
      id
      type
      category
      state
    }
    routedBy {
      uuid
      id
      type
      category
      state
    }
    parent {
      uuid
      id
      type
      category
      state
    }
    children {
      uuid
      id
      type
      category
      state
    }
    custom
  }
}

"""
Fragment for Layer 8: Platform
"""
fragment ResourcePlatform on Resource {
  ...ResourceId
  platform {
    current
    capabilities {
      isSupported
      level
      minVersion
      requiredPackages
      details
    }
    fieldMappings
    limitations {
      code
      description
      affectedFields
      workaround
    }
    features {
      id
      name
      enabled
      description
    }
  }
}

# -----------------------------------------------------------------------------
# Combined Fragments for Common Use Cases
# -----------------------------------------------------------------------------

"""
Minimal fragment for list views (mobile-optimized)
Contains: id, type, category, state, basic runtime
"""
fragment ResourceListItem on Resource {
  uuid
  id
  type
  category
  metadata {
    state
    tags
    updatedAt
    isFavorite
  }
  runtime {
    isRunning
    health
    lastUpdated
  }
}

"""
Fragment for resource cards in dashboards
Contains: id, config summary, runtime, basic metadata
"""
fragment ResourceCard on Resource {
  ...ResourceId
  configuration
  metadata {
    state
    version
    tags
    description
    isFavorite
    isPinned
  }
  runtime {
    isRunning
    health
    errorMessage
    activeConnections
    uptime
  }
}

"""
Fragment for resource detail view (desktop)
Contains: All layers except full telemetry
"""
fragment ResourceDetail on Resource {
  ...ResourceId
  configuration
  validation {
    canApply
    stage
    errors {
      code
      message
      field
      severity
      suggestedFix
      docsUrl
    }
    warnings {
      code
      message
      field
      severity
    }
    conflicts {
      type
      conflictingResourceUuid
      description
      resolution
    }
    validatedAt
  }
  deployment {
    routerResourceId
    appliedAt
    appliedBy
    isInSync
    drift {
      detectedAt
      suggestedAction
    }
  }
  runtime {
    isRunning
    health
    errorMessage
    metrics {
      bytesIn
      bytesOut
      throughputIn
      throughputOut
      errors
    }
    lastUpdated
    activeConnections
    uptime
  }
  ...ResourceMetadataFull
  ...ResourceRelationshipsFull
  platform {
    current
    capabilities {
      isSupported
      level
    }
    limitations {
      code
      description
    }
  }
}

"""
Full resource fragment with all 8 layers
Use sparingly - prefer selective fragments for bandwidth optimization
"""
fragment ResourceFull on Resource {
  ...ResourceId
  ...ResourceConfiguration
  ...ResourceValidation
  ...ResourceDeployment
  ...ResourceRuntime
  ...ResourceTelemetryFull
  ...ResourceMetadataFull
  ...ResourceRelationshipsFull
  ...ResourcePlatform
}
