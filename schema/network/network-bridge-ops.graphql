# -----------------------------------------------------------------------------
# Bridge Input Types
# -----------------------------------------------------------------------------

input CreateBridgeInput {
  name: String! @validate(minLength: 1, maxLength: 100, pattern: "^[a-zA-Z][a-zA-Z0-9_-]*$")
  comment: String
  protocol: StpProtocol
  priority: Int @validate(min: 0, max: 61440)
  vlanFiltering: Boolean
  pvid: Int @validate(min: 1, max: 4094)
  mtu: Int @validate(min: 68, max: 65535)
}

input UpdateBridgeInput {
  comment: String
  protocol: StpProtocol
  priority: Int @validate(min: 0, max: 61440)
  vlanFiltering: Boolean
  pvid: Int @validate(min: 1, max: 4094)
  mtu: Int @validate(min: 68, max: 65535)
  disabled: Boolean
}

input AddBridgePortInput {
  interfaceId: ID!
  pvid: Int @validate(min: 1, max: 4094)
  frameTypes: FrameTypes
  ingressFiltering: Boolean
}

input UpdateBridgePortInput {
  pvid: Int @validate(min: 1, max: 4094)
  frameTypes: FrameTypes
  ingressFiltering: Boolean
  taggedVlans: [Int!]
  untaggedVlans: [Int!]
  edge: Boolean
  pathCost: Int @validate(min: 1, max: 65535)
}

input CreateBridgeVlanInput {
  vlanId: Int! @validate(min: 1, max: 4094)
  taggedPortIds: [ID!]
  untaggedPortIds: [ID!]
}

# -----------------------------------------------------------------------------
# Mutation Results
# -----------------------------------------------------------------------------

type BridgeMutationResult {
  success: Boolean!
  bridge: Bridge
  errors: [MutationError!]
  "Previous state for undo functionality"
  previousState: JSON
  "Unique operation ID for undo within 10-second window"
  operationId: ID
}

type BridgePortMutationResult {
  success: Boolean!
  port: BridgePort
  errors: [MutationError!]
  previousState: JSON
  operationId: ID
}

type BridgeVlanMutationResult {
  success: Boolean!
  vlan: BridgeVlan
  errors: [MutationError!]
}

# -----------------------------------------------------------------------------
# Queries
# -----------------------------------------------------------------------------

extend type Query {
  "List all bridges on a router"
  bridges(routerId: ID!): [Bridge!]!

  "Get a single bridge by UUID"
  bridge(uuid: ID!): Bridge

  "Get bridge ports"
  bridgePorts(bridgeId: ID!): [BridgePort!]!

  "Get bridge VLANs"
  bridgeVlans(bridgeId: ID!): [BridgeVlan!]!

  "Get interfaces available to add to a bridge (not already in any bridge)"
  availableInterfacesForBridge(routerId: ID!): [Interface!]!
}

# -----------------------------------------------------------------------------
# Mutations
# -----------------------------------------------------------------------------

extend type Mutation {
  "Create a new bridge"
  createBridge(routerId: ID!, input: CreateBridgeInput!): BridgeMutationResult!

  "Update an existing bridge"
  updateBridge(uuid: ID!, input: UpdateBridgeInput!): BridgeMutationResult!

  "Delete a bridge"
  deleteBridge(uuid: ID!): DeleteResult!

  "Undo a bridge operation (within 10-second window)"
  undoBridgeOperation(operationId: ID!): BridgeMutationResult!

  "Add a port to a bridge"
  addBridgePort(bridgeId: ID!, input: AddBridgePortInput!): BridgePortMutationResult!

  "Update bridge port settings"
  updateBridgePort(portId: ID!, input: UpdateBridgePortInput!): BridgePortMutationResult!

  "Remove a port from a bridge"
  removeBridgePort(portId: ID!): DeleteResult!

  "Create a bridge VLAN entry"
  createBridgeVlan(bridgeId: ID!, input: CreateBridgeVlanInput!): BridgeVlanMutationResult!

  "Delete a bridge VLAN entry"
  deleteBridgeVlan(uuid: ID!): DeleteResult!
}

# -----------------------------------------------------------------------------
# Subscriptions
# -----------------------------------------------------------------------------

extend type Subscription {
  "Subscribe to STP status changes for a bridge"
  bridgeStpStatusChanged(bridgeId: ID!): BridgeStpStatus!

  "Subscribe to bridge port changes"
  bridgePortsChanged(bridgeId: ID!): [BridgePort!]!
}
