import { Meta, Primary, Controls, Story } from "@storybook/blocks";
import * as TableStories from "./Table.stories";

<Meta of={TableStories} />

# Table

The Table component is a flexible, accessible, and feature-rich data display solution for presenting tabular data. It supports sorting, custom rendering, responsive design, and various visual styles.

## Features

- **Responsive design** with column hiding at different breakpoints
- **Sortable columns** with clear visual indicators
- **Customizable styling** with various variants and sizes
- **Interactive rows** with click handlers
- **Accessibility** built-in with proper ARIA attributes
- **Custom cell rendering** for rich content display
- **Loading and empty states** with customizable content
- **Flexible composition** with subcomponents for custom layouts

## Usage

### Basic Table

```tsx
import { component$ } from "@builder.io/qwik";
import { Table } from "@nas-net/core-ui-qwik";

export default component$(() => {
  const data = [
    { id: 1, name: "John Doe", email: "john@example.com" },
    { id: 2, name: "Jane Smith", email: "jane@example.com" },
  ];

  const columns = [
    { id: "name", header: "Name", field: "name" },
    { id: "email", header: "Email", field: "email" },
  ];

  return <Table data={data} columns={columns} />;
});
```

### Sortable Table

```tsx
import { component$, useSignal, $ } from "@builder.io/qwik";
import { Table, SortState } from "@nas-net/core-ui-qwik";

export default component$(() => {
  const sortState = useSignal<SortState>({ column: "", direction: "none" });

  const handleSortChange$ = $((newSortState: SortState) => {
    sortState.value = newSortState;
    // Handle sorting logic or API calls here
  });

  return (
    <Table
      data={data}
      columns={[
        { id: "name", header: "Name", field: "name", sortable: true },
        { id: "email", header: "Email", field: "email", sortable: true },
      ]}
      sortState={sortState}
      onSortChange$={handleSortChange$}
    />
  );
});
```

### Custom Cell Rendering

```tsx
import { component$ } from "@builder.io/qwik";
import { Table } from "@nas-net/core-ui-qwik";
import { UserIcon } from "~/components/Icons";

export default component$(() => {
  return (
    <Table
      data={users}
      columns={[
        {
          id: "name",
          header: "User",
          renderCell: (value, row) => (
            <div class="flex items-center gap-2">
              <div class="flex h-8 w-8 items-center justify-center rounded-full bg-primary-100">
                <UserIcon class="h-4 w-4 text-primary-600" />
              </div>
              <div>
                <div class="font-medium">{value as string}</div>
                <div class="text-xs text-gray-500">{row.email}</div>
              </div>
            </div>
          ),
        },
        // Other columns...
      ]}
    />
  );
});
```

### Interactive Rows

```tsx
import { component$, useSignal, $ } from "@builder.io/qwik";
import { Table } from "@nas-net/core-ui-qwik";

export default component$(() => {
  const selectedId = useSignal<string | null>(null);

  const handleRowClick$ = $((row: any) => {
    selectedId.value = row.id === selectedId.value ? null : row.id;
  });

  return (
    <Table
      data={data}
      columns={columns}
      onRowClick$={handleRowClick$}
      rowClass={(row) => (row.id === selectedId.value ? "bg-blue-50" : "")}
    />
  );
});
```

### Responsive Table

```tsx
import { component$ } from "@builder.io/qwik";
import { Table } from "@nas-net/core-ui-qwik";

export default component$(() => {
  return (
    <Table
      data={data}
      columns={[
        { id: "name", header: "Name", field: "name" },
        { id: "email", header: "Email", field: "email", hideOn: { sm: true } },
        { id: "role", header: "Role", field: "role" },
        {
          id: "status",
          header: "Status",
          field: "status",
          hideOn: { md: true },
        },
      ]}
      horizontalScroll={true}
    />
  );
});
```

### Manual Composition

For more complex use cases, you can manually compose the table:

```tsx
import { component$ } from "@builder.io/qwik";
import {
  TableHead,
  TableBody,
  TableRow,
  TableCell,
} from "@nas-net/core-ui-qwik";

export default component$(() => {
  return (
    <div class="overflow-x-auto rounded-lg border border-gray-200">
      <table class="w-full text-left text-sm">
        <TableHead>
          <tr>
            <TableCell isHeader>Name</TableCell>
            <TableCell isHeader>Email</TableCell>
          </tr>
        </TableHead>
        <TableBody>
          {data.map((person) => (
            <TableRow key={person.id}>
              <TableCell>{person.name}</TableCell>
              <TableCell>{person.email}</TableCell>
            </TableRow>
          ))}
        </TableBody>
      </table>
    </div>
  );
});
```

## Examples

<Primary />

## Props

### Table

<Controls />

### TableHead Props

| Prop       | Type          | Default | Description                             |
| ---------- | ------------- | ------- | --------------------------------------- |
| `sticky`   | `boolean`     | `false` | Whether the header is sticky            |
| `class`    | `string`      | `''`    | Additional CSS class                    |
| `children` | `JSXChildren` | -       | Content to render inside the table head |

### TableBody Props

| Prop       | Type          | Default | Description                             |
| ---------- | ------------- | ------- | --------------------------------------- |
| `class`    | `string`      | `''`    | Additional CSS class                    |
| `children` | `JSXChildren` | -       | Content to render inside the table body |

### TableRow Props

| Prop        | Type                               | Default | Description                            |
| ----------- | ---------------------------------- | ------- | -------------------------------------- |
| `selected`  | `boolean`                          | `false` | Whether the row is selected            |
| `clickable` | `boolean`                          | `false` | Whether the row is clickable           |
| `onClick$`  | `QRL<(event: MouseEvent) => void>` | -       | Handler for click events               |
| `class`     | `string`                           | `''`    | Additional CSS class                   |
| `ariaLabel` | `string`                           | -       | ARIA label for the row                 |
| `children`  | `JSXChildren`                      | -       | Content to render inside the table row |

### TableCell Props

| Prop       | Type                                         | Default  | Description                             |
| ---------- | -------------------------------------------- | -------- | --------------------------------------- |
| `isHeader` | `boolean`                                    | `false`  | Whether the cell is a header cell       |
| `align`    | `'left' \| 'center' \| 'right'`              | `'left'` | Alignment of cell content               |
| `truncate` | `boolean`                                    | `false`  | Whether to truncate text that overflows |
| `width`    | `string`                                     | -        | Width of the cell                       |
| `colSpan`  | `number`                                     | -        | Column span of the cell                 |
| `rowSpan`  | `number`                                     | -        | Row span of the cell                    |
| `scope`    | `'col' \| 'row' \| 'colgroup' \| 'rowgroup'` | -        | The scope attribute for header cells    |
| `class`    | `string`                                     | `''`     | Additional CSS class                    |
| `children` | `JSXChildren`                                | -        | Content to render inside the table cell |

### TableFooter Props

| Prop       | Type          | Default | Description                               |
| ---------- | ------------- | ------- | ----------------------------------------- |
| `class`    | `string`      | `''`    | Additional CSS class                      |
| `children` | `JSXChildren` | -       | Content to render inside the table footer |

## Column Definition Props

| Prop           | Type                                                     | Description                                                    |
| -------------- | -------------------------------------------------------- | -------------------------------------------------------------- |
| `id`           | `string`                                                 | Unique identifier for the column                               |
| `header`       | `string`                                                 | The header text to display for the column                      |
| `description`  | `string`                                                 | Optional description or tooltip for the column header          |
| `accessor`     | `(row: T, index: number) => unknown`                     | Function to extract the display value from a row item          |
| `field`        | `string`                                                 | Property path to extract from the row item (e.g., 'user.name') |
| `renderCell`   | `(value: unknown, row: T, index: number) => JSXChildren` | Custom render function for cell content                        |
| `renderHeader` | `(column: TableColumn<T>) => JSXChildren`                | Custom render function for header content                      |
| `width`        | `string`                                                 | Width of the column (e.g., '100px', '20%')                     |
| `minWidth`     | `string`                                                 | Minimum width of the column                                    |
| `maxWidth`     | `string`                                                 | Maximum width of the column                                    |
| `sortable`     | `boolean`                                                | Whether the column can be sorted                               |
| `truncate`     | `boolean`                                                | Whether to truncate text that overflows                        |
| `align`        | `'left' \| 'center' \| 'right'`                          | Alignment of cell content                                      |
| `fixed`        | `'left' \| 'right'`                                      | Fixed column position                                          |
| `hideOn`       | `{ sm?: boolean; md?: boolean; lg?: boolean; }`          | Whether to hide this column at different breakpoints           |
| `headerClass`  | `string`                                                 | Custom CSS class for header cells in this column               |
| `cellClass`    | `string`                                                 | Custom CSS class for data cells in this column                 |

## Accessibility

The Table component implements accessibility best practices:

- Uses semantic HTML `<table>` elements
- Applies appropriate ARIA roles and attributes
- Supports keyboard navigation
- Includes proper labeling for interactive elements
- Maintains color contrast for all states and variants

## Responsive Behavior

- Supports horizontal scrolling on small screens
- Allows selective column hiding at different breakpoints
- Adapts styling appropriately across device sizes
- Maintains readability and usability at all screen sizes

## Styling Variants

The Table component supports several styling variants:

- `default`: Clean, minimal styling with row dividers
- `bordered`: Adds borders around all cells
- `striped`: Alternating row colors for better readability
- `bordered-striped`: Combines borders with alternating row colors

## Design Considerations

- **Performance**: Optimized for rendering large data sets
- **Flexibility**: Supports various data structures and display needs
- **Customization**: Allows extensive visual and behavioral customization
- **Integration**: Works seamlessly with form components and pagination
- **Consistency**: Matches the Connect design system's visual language
