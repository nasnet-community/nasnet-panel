<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-features docs-version-current docs-doc-page docs-doc-id-feature-services" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Feature Services Module (libs/features/services) | NasNet Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://nasnet.dev/docs/features/feature-services"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-features-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-features-current"><meta data-rh="true" property="og:title" content="Feature Services Module (libs/features/services) | NasNet Docs"><meta data-rh="true" name="description" content="Overview"><meta data-rh="true" property="og:description" content="Overview"><link data-rh="true" rel="icon" href="/img/favicon.svg"><link data-rh="true" rel="canonical" href="https://nasnet.dev/docs/features/feature-services"><link data-rh="true" rel="alternate" href="https://nasnet.dev/docs/features/feature-services" hreflang="en"><link data-rh="true" rel="alternate" href="https://nasnet.dev/docs/features/feature-services" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Feature Services Module (libs/features/services)","item":"https://nasnet.dev/docs/features/feature-services"}]}</script><link rel="stylesheet" href="/assets/css/styles.82d9e831.css">
<script src="/assets/js/runtime~main.ca82720f.js" defer="defer"></script>
<script src="/assets/js/main.ffff147f.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_G6ar" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/hero-logo.jpg" alt="NasNet Logo" class="themedComponent_DHUr themedComponent--light_DIHH" style="border-radius:6px"><img src="/img/hero-logo.jpg" alt="NasNet Logo" class="themedComponent_DHUr themedComponent--dark_Bv2M" style="border-radius:6px"></div><b class="navbar__title text--truncate">NasNet Docs</b></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Apps</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/frontend/intro">Frontend (Connect)</a></li><li><a class="dropdown__link" href="/docs/backend/intro">Backend (Go)</a></li><li><a class="dropdown__link" href="/docs/testing/intro">E2E Testing</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Libraries</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/ui/intro">UI Components</a></li><li><a class="dropdown__link" href="/docs/features/intro">Feature Modules</a></li><li><a class="dropdown__link" href="/docs/api-client/intro">API Client</a></li><li><a class="dropdown__link" href="/docs/state/intro">State Management</a></li><li><a class="dropdown__link" href="/docs/core/intro">Core Types</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Components</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/storybook/primitives/">UI Primitives</a></li><li><a class="dropdown__link" href="/storybook/patterns/">UI Patterns</a></li><li><a class="dropdown__link" href="/storybook/connect/">Connect App</a></li></ul></div><a class="navbar__item navbar__link" href="/api">API Reference</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/nasnet-community/nasnet-panel/releases" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Changelog<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_awgD"><use href="#theme-svg-external-link"></use></svg></a><a class="navbar__item navbar__link" href="/nx-graph/">Nx Graph</a><a href="https://github.com/nasnet-community/nasnet-panel" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link" aria-label="GitHub repository">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_awgD"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_OLSw colorModeToggle_Hg9V"><button class="clean-btn toggleButton_wYmb toggleButtonDisabled_vaDU" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_KEbZ lightToggleIcon_Sxwe"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_KEbZ darkToggleIcon_Yem1"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_KEbZ systemToggleIcon_txm5"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_bmvg"><div class="navbar__search searchBarContainer_YZIh" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input searchInput_eCKk" value=""><div class="loadingRing_pJhT searchBarLoadingRing_NsvA"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_UyTV"><div class="docsWrapper_XLvK"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_z1FD" type="button"></button><div class="docRoot_HciC"><aside class="theme-doc-sidebar-container docSidebarContainer_e5ai"><div class="sidebarViewport_N8x0"><div class="sidebar_vJCc"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_qiME"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/features/intro"><span title="Introduction" class="linkLabel_PuAu">Introduction</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/features/api-client-and-graphql"><span title="API Client and GraphQL" class="linkLabel_PuAu">API Client and GraphQL</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/features/architecture-overview"><span title="Architecture Overview" class="linkLabel_PuAu">Architecture Overview</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/features/cross-cutting-flows"><span title="Cross-Cutting Flows" class="linkLabel_PuAu">Cross-Cutting Flows</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/features/error-handling"><span title="Error Handling Architecture" class="linkLabel_PuAu">Error Handling Architecture</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/features/feature-alerts"><span title="Feature Module: Alerts (libs/features/alerts)" class="linkLabel_PuAu">Feature Module: Alerts (libs/features/alerts)</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/features/feature-dashboard"><span title="Feature: Dashboard (libs/features/dashboard)" class="linkLabel_PuAu">Feature: Dashboard (libs/features/dashboard)</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/features/feature-diagnostics"><span title="Feature: Diagnostics (libs/features/diagnostics)" class="linkLabel_PuAu">Feature: Diagnostics (libs/features/diagnostics)</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/features/feature-firewall"><span title="Feature Module: Firewall (libs/features/firewall)" class="linkLabel_PuAu">Feature Module: Firewall (libs/features/firewall)</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/features/feature-logs"><span title="Feature: Logs (libs/features/logs)" class="linkLabel_PuAu">Feature: Logs (libs/features/logs)</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/features/feature-minor"><span title="Feature: Wireless, Router Discovery, and Configuration Import" class="linkLabel_PuAu">Feature: Wireless, Router Discovery, and Configuration Import</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/features/feature-network"><span title="Feature: Network (libs/features/network)" class="linkLabel_PuAu">Feature: Network (libs/features/network)</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/features/feature-services"><span title="Feature Services Module (libs/features/services)" class="linkLabel_PuAu">Feature Services Module (libs/features/services)</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/features/feature-vpn"><span title="VPN Feature Module Documentation" class="linkLabel_PuAu">VPN Feature Module Documentation</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/features/"><span title="Feature Library Documentation" class="linkLabel_PuAu">Feature Library Documentation</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/features/routing-and-navigation"><span title="Routing and Navigation Architecture" class="linkLabel_PuAu">Routing and Navigation Architecture</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/features/state-management"><span title="State Management Guide" class="linkLabel_PuAu">State Management Guide</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/features/testing-and-storybook"><span title="Testing and Storybook" class="linkLabel_PuAu">Testing and Storybook</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/features/xstate-machines"><span title="XState Machines Reference" class="linkLabel_PuAu">XState Machines Reference</span></a></li></ul></nav></div></div></aside><main class="docMainContainer_namt"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_YAwJ"><div class="docItemContainer_Rv5Z"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_zCmv" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_JFrk"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Feature Services Module (libs/features/services)</span></li></ul></nav><div class="tocCollapsible_O_Qc theme-doc-toc-mobile tocMobile_tjDr"><button type="button" class="clean-btn tocCollapsibleButton_htYj">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Feature Services Module (<code>libs/features/services</code>)</h1></header>
<h2 class="anchor anchorTargetStickyNavbar_SAay" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview" translate="no">​</a></h2>
<p>The services module is the Feature Marketplace for NasNetConnect. It enables users to install, configure, monitor, and manage downloadable network service instances that run inside the MikroTik router&#x27;s Docker environment. Each service is an isolated binary managed by the NasNet supervisor.</p>
<h3 class="anchor anchorTargetStickyNavbar_SAay" id="supported-services-feature-ids">Supported Services (Feature IDs)<a href="#supported-services-feature-ids" class="hash-link" aria-label="Direct link to Supported Services (Feature IDs)" title="Direct link to Supported Services (Feature IDs)" translate="no">​</a></h3>
<table><thead><tr><th>Feature ID</th><th>Category</th><th>Description</th></tr></thead><tbody><tr><td><code>tor</code></td><td>privacy</td><td>Tor anonymization proxy</td></tr><tr><td><code>sing-box</code></td><td>proxy</td><td>Universal proxy platform</td></tr><tr><td><code>xray-core</code></td><td>proxy</td><td>Xray protocol suite</td></tr><tr><td><code>mtproxy</code></td><td>proxy</td><td>MTProxy Telegram proxy</td></tr><tr><td><code>psiphon</code></td><td>privacy</td><td>Psiphon censorship circumvention</td></tr><tr><td><code>adguard-home</code></td><td>dns</td><td>Network-wide DNS ad blocker</td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_SAay" id="core-concepts">Core Concepts<a href="#core-concepts" class="hash-link" aria-label="Direct link to Core Concepts" title="Direct link to Core Concepts" translate="no">​</a></h3>
<ul>
<li class=""><strong>Service Instance</strong>: A running (or stopped) instance of a downloaded feature binary. A single feature can have multiple instances (e.g., two Tor instances).</li>
<li class=""><strong>Template</strong>: A pre-packaged configuration bundle that installs one or more related service instances with a single flow. Templates come from the NasNet marketplace or are user-created.</li>
<li class=""><strong>VLAN Isolation</strong>: Each service instance may be assigned its own VLAN for network isolation, managed by the VLAN pool allocator.</li>
<li class=""><strong>Virtual Interface (VIF) Bridge</strong>: The network bridge connecting the service&#x27;s isolated VLAN subnet to the router. Used for policy-based routing (PBR) to route specific devices through specific services.</li>
<li class=""><strong>Device Routing</strong>: The mapping from a client device (identified by MAC address or IP) to a specific service instance&#x27;s VIF for selective traffic routing.</li>
<li class=""><strong>Kill Switch</strong>: A safety mechanism that blocks all traffic for a device if its assigned service goes down, preventing traffic from leaking to the unprotected network.</li>
<li class=""><strong>Traffic Quota</strong>: Configurable data limits per service instance with warning and hard-limit thresholds.</li>
</ul>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_SAay" id="directory-tree">Directory Tree<a href="#directory-tree" class="hash-link" aria-label="Direct link to Directory Tree" title="Direct link to Directory Tree" translate="no">​</a></h2>
<div class="language-text codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_kX1v"><pre tabindex="0" class="prism-code language-text codeBlock_TAPP thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#F8F8F2"><span class="token plain">libs/features/services/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">├── package.json</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">├── tsconfig.json</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">├── tsconfig.lib.json</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">├── tsconfig.spec.json</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">├── tsconfig.storybook.json</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">├── vitest.config.ts</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">├── vitest.setup.js</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">├── vitest.setup.ts</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">└── src/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ├── index.ts                        # Public API barrel export</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ├── components/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   ├── InstallDialog.tsx            # Multi-step service install wizard (dialog)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   ├── InstallDialog.stories.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   ├── ChangelogModal.tsx           # Service changelog viewer</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   ├── ChangelogModal.stories.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   ├── GatewayStatusCard.tsx        # SOCKS-to-TUN gateway status (platform wrapper)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   ├── GatewayStatusCardDesktop.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   ├── GatewayStatusCardMobile.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   ├── GatewayStatusCard.stories.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   ├── PortRegistryView.tsx         # Port allocation registry (platform wrapper)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   ├── PortRegistryViewDesktop.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   ├── PortRegistryViewMobile.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   ├── PortRegistryView.stories.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   ├── ResourceLimitsForm.tsx       # cgroup resource limits form</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   ├── ResourceLimitsForm.stories.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   ├── ServiceAlertsTab.tsx         # Alert tab (platform wrapper)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   ├── ServiceAlertsTabDesktop.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   ├── ServiceAlertsTabMobile.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   ├── ServiceAlertsTab.stories.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   ├── StopDependentsDialog.tsx     # Dependency-aware stop confirmation</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   ├── StopDependentsDialog.stories.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   ├── UpdateAllPanel.tsx           # Bulk update panel with severity grouping</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   ├── UpdateAllPanel.stories.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   ├── VLANPoolConfig.tsx           # VLAN range configuration form</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   ├── VLANPoolConfig.stories.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   ├── ServiceConfigForm/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   │   ├── index.ts</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   │   ├── ServiceConfigForm.tsx    # Platform wrapper</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   │   ├── ServiceConfigFormDesktop.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   │   ├── ServiceConfigFormMobile.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   │   ├── DynamicField.tsx         # Renders a single field by type</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   │   ├── ServiceConfigForm.stories.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   │   └── fields/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   │       ├── index.ts</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   │       ├── TextField.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   │       ├── TextArea.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   │       ├── PasswordField.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   │       ├── NumberField.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   │       ├── Select.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   │       ├── MultiSelect.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   │       └── ArrayField.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   ├── DiagnosticsPanel/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   │   ├── index.ts</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   │   ├── DiagnosticsPanel.tsx     # Platform wrapper</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   │   ├── DiagnosticsPanelDesktop.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   │   ├── DiagnosticsPanelMobile.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   │   ├── useDiagnosticsPanel.ts  # Headless hook</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   │   └── DiagnosticsPanel.stories.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   ├── ServiceLogViewer/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   │   ├── index.ts</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   │   ├── ServiceLogViewer.tsx     # Platform wrapper</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   │   ├── ServiceLogViewerDesktop.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   │   ├── ServiceLogViewerMobile.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   │   ├── useServiceLogViewer.ts  # Headless hook</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   │   └── ServiceLogViewer.stories.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   ├── service-traffic/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   │   ├── index.ts</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   │   ├── service-traffic-panel.types.ts</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   │   ├── ServiceTrafficPanel.tsx  # Platform wrapper</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   │   ├── ServiceTrafficPanelDesktop.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   │   ├── ServiceTrafficPanelMobile.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   │   ├── use-service-traffic-panel.ts  # Headless hook</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   │   ├── QuotaSettingsForm.tsx    # Traffic quota configuration</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   │   └── ServiceTrafficPanel.stories.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   ├── storage/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   │   ├── index.ts</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   │   ├── StorageSettings.tsx      # Platform wrapper</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   │   ├── StorageSettingsDesktop.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   │   ├── StorageSettingsMobile.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   │   ├── StorageDisconnectBanner.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   │   ├── StorageUsageBar.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   │   └── useStorageSettings.ts   # Headless hook</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   └── templates/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │       ├── index.ts</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │       ├── types.ts                 # Shared type definitions</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │       ├── templateInstallMachine.ts  # XState machine (4-step wizard)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │       ├── useTemplatesBrowser.ts   # Headless filter/sort hook</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │       ├── useTemplateInstallWizard.ts  # Headless machine integration hook</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │       ├── TemplatesBrowser.tsx     # Platform wrapper</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │       ├── TemplatesBrowserDesktop.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │       ├── TemplatesBrowserMobile.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │       ├── TemplateFilters.tsx      # Filter sidebar/sheet</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │       ├── TemplateInstallWizard.tsx   # Platform wrapper</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │       ├── TemplateInstallWizardDesktop.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │       ├── TemplateInstallWizardMobile.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │       └── wizard-steps/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │           ├── index.ts</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │           ├── VariablesStep.tsx    # Step 1: Configure template variables</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │           ├── ReviewStep.tsx       # Step 2: Review before install</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │           ├── InstallingStep.tsx   # Step 3: Progress indicator</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │           └── RoutingStep.tsx      # Step 4: Optional routing rules</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ├── hooks/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   ├── useServiceConfigForm.ts      # Dynamic config form state + submit</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   ├── useServiceAlertsTab.ts       # Alert list + filtering + pagination</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   └── useServiceAlertToasts.ts     # Real-time alert toast notifications</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ├── machines/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   └── update-machine.ts            # XState machine for service updates</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ├── pages/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   ├── ServicesPage.tsx             # Main service marketplace page</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   ├── ServiceDetailPage.tsx        # Per-instance detail with tabs</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   ├── DeviceRoutingPage.tsx        # Device-to-service routing matrix</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   └── VLANSettingsPage.tsx         # VLAN pool management page</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ├── schemas/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   ├── index.ts</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    │   └── service-sharing.schema.ts    # Zod schemas for import/export</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    └── utils/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        ├── index.ts</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        └── zodSchemaBuilder.ts          # Dynamic Zod schema from backend ConfigSchema</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_SAay" id="pages">Pages<a href="#pages" class="hash-link" aria-label="Direct link to Pages" title="Direct link to Pages" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_SAay" id="servicespage"><code>ServicesPage</code><a href="#servicespage" class="hash-link" aria-label="Direct link to servicespage" title="Direct link to servicespage" translate="no">​</a></h3>
<p><strong>File:</strong> <code>libs/features/services/src/pages/ServicesPage.tsx</code></p>
<p>The primary landing page for the Feature Marketplace. Combines collapsible sections for system resource overview, available updates, storage management, and port allocations, followed by the main <code>InstanceManager</code> pattern component displaying installed service instances.</p>
<p><strong>Key behaviors:</strong></p>
<ul>
<li class="">Fetches all installed service instances via <code>useServiceInstances(routerId)</code></li>
<li class="">Maps instances to the <code>Service</code> type expected by the <code>InstanceManager</code> pattern</li>
<li class="">Reads UI state (search, filters, view mode, selection) from Zustand <code>useServiceUIStore</code></li>
<li class="">Handles bulk lifecycle operations (start, stop, restart, delete) with toast feedback</li>
<li class="">Opens <code>InstallDialog</code> for new installations</li>
<li class="">Opens <code>ServiceImportDialog</code> for importing shared service configurations</li>
<li class="">Opens <code>StopDependentsDialog</code> when stopping an instance that has dependents</li>
<li class="">Collapsible <code>UpdateAllPanel</code> appears only when <code>useAvailableUpdates</code> returns results</li>
<li class="">Collapsible <code>StorageSettings</code> auto-expands if external storage is configured or disconnected</li>
<li class="">Collapsible <code>PortRegistryView</code> shows all port allocations across services</li>
</ul>
<p><strong>GraphQL queries used:</strong></p>
<ul>
<li class=""><code>useServiceInstances(routerId)</code> - all service instances for this router</li>
<li class=""><code>useStorageConfig()</code> - external storage configuration</li>
<li class=""><code>useSystemResources(routerId)</code> - RAM/CPU totals and per-instance breakdown</li>
<li class=""><code>useAvailableUpdates({ routerId })</code> - update availability check</li>
<li class=""><code>useDependencies(featureId)</code> - dependency chain for stop safety checks</li>
</ul>
<p><strong>Zustand selectors used:</strong></p>
<div class="language-ts codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_kX1v"><pre tabindex="0" class="prism-code language-ts codeBlock_TAPP thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">useServiceSearch</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">         </span><span class="token comment" style="color:rgb(98, 114, 164)">// search query string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">useCategoryFilter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)">// &#x27;all&#x27; | &#x27;privacy&#x27; | &#x27;proxy&#x27; | &#x27;dns&#x27; | ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">useStatusFilter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">          </span><span class="token comment" style="color:rgb(98, 114, 164)">// &#x27;all&#x27; | &#x27;running&#x27; | &#x27;stopped&#x27; | &#x27;failed&#x27; | ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">useServiceViewMode</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">       </span><span class="token comment" style="color:rgb(98, 114, 164)">// &#x27;grid&#x27; | &#x27;list&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">useShowResourceMetrics</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">   </span><span class="token comment" style="color:rgb(98, 114, 164)">// boolean - whether to show CPU/RAM gauges</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">useSelectedServices</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">      </span><span class="token comment" style="color:rgb(98, 114, 164)">// string[] - currently selected instance IDs</span><br></span></code></pre></div></div>
<hr>
<h3 class="anchor anchorTargetStickyNavbar_SAay" id="servicedetailpage"><code>ServiceDetailPage</code><a href="#servicedetailpage" class="hash-link" aria-label="Direct link to servicedetailpage" title="Direct link to servicedetailpage" translate="no">​</a></h3>
<p><strong>File:</strong> <code>libs/features/services/src/pages/ServiceDetailPage.tsx</code></p>
<p>Per-instance detail page organized as a tabbed interface. Automatically switches to the Diagnostics tab when an instance enters FAILED status.</p>
<p><strong>Tabs:</strong></p>
<table><thead><tr><th>Tab</th><th>Contents</th></tr></thead><tbody><tr><td>Overview</td><td><code>ServiceCard</code>, <code>VirtualInterfaceBridge</code>, <code>ResourceLimitsForm</code>, <code>IsolationStatus</code>, <code>GatewayStatusCard</code></td></tr><tr><td>Configuration</td><td><code>ServiceConfigForm</code> using <code>useServiceConfigForm</code> hook</td></tr><tr><td>Traffic</td><td><code>ServiceTrafficPanel</code> (stats) + <code>QuotaSettingsForm</code> (limits)</td></tr><tr><td>Logs</td><td><code>ServiceLogViewer</code> with filter and auto-scroll</td></tr><tr><td>Alerts</td><td><code>ServiceAlertsTab</code> with real-time subscription</td></tr><tr><td>Diagnostics</td><td><code>DiagnosticsPanel</code> with test history and manual run controls</td></tr></tbody></table>
<p><strong>Key behaviors:</strong></p>
<ul>
<li class="">Fetches instance via <code>useServiceInstance(routerId, instanceId)</code></li>
<li class="">Polls gateway status every 5 seconds via <code>useGatewayStatus</code></li>
<li class="">Fetches isolation data via <code>useInstanceIsolation</code></li>
<li class="">Fetches health badge data via <code>useInstanceHealth</code> (polling every 30 seconds for running instances)</li>
<li class="">Fetches binary verification status via <code>useFeatureVerification</code></li>
<li class="">Checks for available updates and renders <code>UpdateIndicator</code> when an update is available</li>
<li class="">Export button opens <code>ServiceExportDialog</code> for sharing the instance configuration</li>
</ul>
<hr>
<h3 class="anchor anchorTargetStickyNavbar_SAay" id="deviceroutingpage"><code>DeviceRoutingPage</code><a href="#deviceroutingpage" class="hash-link" aria-label="Direct link to deviceroutingpage" title="Direct link to deviceroutingpage" translate="no">​</a></h3>
<p><strong>File:</strong> <code>libs/features/services/src/pages/DeviceRoutingPage.tsx</code></p>
<p>Device-to-service routing management page. Allows administrators to assign network devices (discovered via DHCP and ARP) to service virtual interfaces, which routes that device&#x27;s traffic through a specific service (e.g., route all traffic from a laptop through Tor).</p>
<p><strong>Key behaviors:</strong></p>
<ul>
<li class="">Fetches the routing matrix via <code>useDeviceRoutingMatrix(routerId)</code> which returns devices, VIF interfaces, and current routing assignments</li>
<li class="">Subscribes to real-time routing changes via <code>useDeviceRoutingSubscription(routerId)</code></li>
<li class="">Shows a <code>KillSwitchToggle</code> for global kill switch control at the top</li>
<li class="">Renders up to 5 active routing chains using <code>RoutingChainViz</code> with hop-click to open <code>ScheduleEditor</code></li>
<li class="">Renders <code>DeviceRoutingMatrix</code> pattern component with assign/remove/bulk-assign action handlers</li>
<li class="">Shows a bulk assignment progress bar when <code>useBulkAssignRouting</code> is in progress</li>
<li class="">Opens <code>ScheduleEditor</code> modal when a routing hop is clicked (for time-based routing schedules)</li>
</ul>
<p><strong>Routing modes:</strong></p>
<ul>
<li class=""><code>MAC</code> - identifies the device by its MAC address (survives IP changes)</li>
<li class=""><code>IP</code> - identifies the device by its current IP address</li>
</ul>
<hr>
<h3 class="anchor anchorTargetStickyNavbar_SAay" id="vlansettingspage"><code>VLANSettingsPage</code><a href="#vlansettingspage" class="hash-link" aria-label="Direct link to vlansettingspage" title="Direct link to vlansettingspage" translate="no">​</a></h3>
<p><strong>File:</strong> <code>libs/features/services/src/pages/VLANSettingsPage.tsx</code></p>
<p>VLAN pool configuration and allocation management page. Platform-aware layout: desktop shows a sidebar gauge + tabbed content area; mobile stacks the gauge at top followed by tabs.</p>
<p><strong>Three tabs:</strong></p>
<table><thead><tr><th>Tab</th><th>Contents</th></tr></thead><tbody><tr><td>Pool Config</td><td><code>VLANPoolConfig</code> form - configure allocatable VLAN ID range (1-4094)</td></tr><tr><td>Allocations</td><td><code>VLANAllocationTable</code> pattern component with filter controls</td></tr><tr><td>Diagnostics</td><td>Orphan detection and cleanup tools</td></tr></tbody></table>
<p><strong>VLAN allocation model:</strong></p>
<ul>
<li class="">Each installed service instance that uses VLAN isolation is allocated a VLAN ID from the pool</li>
<li class="">Pool range is configurable (e.g., VLANs 100-4000)</li>
<li class="">Each VLAN generates a subnet template: <code>10.{VLAN_ID}.0.0/24</code></li>
<li class="">Orphaned allocations arise when service instances are deleted without proper cleanup</li>
</ul>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_SAay" id="components">Components<a href="#components" class="hash-link" aria-label="Direct link to Components" title="Direct link to Components" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_SAay" id="components-table">Components Table<a href="#components-table" class="hash-link" aria-label="Direct link to Components Table" title="Direct link to Components Table" translate="no">​</a></h3>
<table><thead><tr><th>Component</th><th>File</th><th>Purpose</th><th>Platform</th></tr></thead><tbody><tr><td><code>InstallDialog</code></td><td><code>components/InstallDialog.tsx</code></td><td>4-step install wizard: Select → Configure → Installing → Complete</td><td>Any</td></tr><tr><td><code>ChangelogModal</code></td><td><code>components/ChangelogModal.tsx</code></td><td>Display service version changelog</td><td>Any</td></tr><tr><td><code>GatewayStatusCard</code></td><td><code>components/GatewayStatusCard.tsx</code></td><td>SOCKS-to-TUN gateway health status</td><td>Auto</td></tr><tr><td><code>GatewayStatusCardDesktop</code></td><td><code>components/GatewayStatusCardDesktop.tsx</code></td><td>Desktop presenter for gateway status</td><td>Desktop</td></tr><tr><td><code>GatewayStatusCardMobile</code></td><td><code>components/GatewayStatusCardMobile.tsx</code></td><td>Mobile presenter for gateway status</td><td>Mobile</td></tr><tr><td><code>PortRegistryView</code></td><td><code>components/PortRegistryView.tsx</code></td><td>Port allocation registry viewer</td><td>Auto</td></tr><tr><td><code>PortRegistryViewDesktop</code></td><td><code>components/PortRegistryViewDesktop.tsx</code></td><td>Desktop port registry (dense table)</td><td>Desktop</td></tr><tr><td><code>PortRegistryViewMobile</code></td><td><code>components/PortRegistryViewMobile.tsx</code></td><td>Mobile port registry (card list)</td><td>Mobile</td></tr><tr><td><code>ResourceLimitsForm</code></td><td><code>components/ResourceLimitsForm.tsx</code></td><td>cgroup memory/CPU limit configuration</td><td>Any</td></tr><tr><td><code>ServiceAlertsTab</code></td><td><code>components/ServiceAlertsTab.tsx</code></td><td>Alert list with filtering, pagination, multi-select acknowledge</td><td>Auto</td></tr><tr><td><code>ServiceAlertsTabDesktop</code></td><td><code>components/ServiceAlertsTabDesktop.tsx</code></td><td>Desktop presenter (data table layout)</td><td>Desktop</td></tr><tr><td><code>ServiceAlertsTabMobile</code></td><td><code>components/ServiceAlertsTabMobile.tsx</code></td><td>Mobile presenter (card list layout)</td><td>Mobile</td></tr><tr><td><code>StopDependentsDialog</code></td><td><code>components/StopDependentsDialog.tsx</code></td><td>Warning dialog when stopping a service with dependents</td><td>Any</td></tr><tr><td><code>UpdateAllPanel</code></td><td><code>components/UpdateAllPanel.tsx</code></td><td>Bulk update with severity grouping</td><td>Any</td></tr><tr><td><code>VLANPoolConfig</code></td><td><code>components/VLANPoolConfig.tsx</code></td><td>VLAN range configuration form</td><td>Any</td></tr><tr><td><code>ServiceConfigForm</code></td><td><code>components/ServiceConfigForm/ServiceConfigForm.tsx</code></td><td>Dynamic config form (platform wrapper)</td><td>Auto</td></tr><tr><td><code>ServiceConfigFormDesktop</code></td><td><code>components/ServiceConfigForm/ServiceConfigFormDesktop.tsx</code></td><td>Tabbed + 2-column grid layout</td><td>Desktop</td></tr><tr><td><code>ServiceConfigFormMobile</code></td><td><code>components/ServiceConfigForm/ServiceConfigFormMobile.tsx</code></td><td>Accordion layout, sticky buttons</td><td>Mobile</td></tr><tr><td><code>DynamicField</code></td><td><code>components/ServiceConfigForm/DynamicField.tsx</code></td><td>Renders a single config field by its <code>ConfigFieldType</code></td><td>Any</td></tr><tr><td><code>DiagnosticsPanel</code></td><td><code>components/DiagnosticsPanel/DiagnosticsPanel.tsx</code></td><td>Diagnostic test results with run controls</td><td>Auto</td></tr><tr><td><code>DiagnosticsPanelDesktop</code></td><td><code>components/DiagnosticsPanel/DiagnosticsPanelDesktop.tsx</code></td><td>Dense collapsible layout</td><td>Desktop</td></tr><tr><td><code>DiagnosticsPanelMobile</code></td><td><code>components/DiagnosticsPanel/DiagnosticsPanelMobile.tsx</code></td><td>44px touch-friendly accordion</td><td>Mobile</td></tr><tr><td><code>ServiceLogViewer</code></td><td><code>components/ServiceLogViewer/ServiceLogViewer.tsx</code></td><td>Real-time service log stream</td><td>Auto</td></tr><tr><td><code>ServiceLogViewerDesktop</code></td><td><code>components/ServiceLogViewer/ServiceLogViewerDesktop.tsx</code></td><td>Dense log table with inline filters</td><td>Desktop</td></tr><tr><td><code>ServiceLogViewerMobile</code></td><td><code>components/ServiceLogViewer/ServiceLogViewerMobile.tsx</code></td><td>Scrollable log list, bottom filters</td><td>Mobile</td></tr><tr><td><code>ServiceTrafficPanel</code></td><td><code>components/service-traffic/ServiceTrafficPanel.tsx</code></td><td>Traffic stats + rate display</td><td>Auto</td></tr><tr><td><code>ServiceTrafficPanelDesktop</code></td><td><code>components/service-traffic/ServiceTrafficPanelDesktop.tsx</code></td><td>Grid layout with chart and breakdown</td><td>Desktop</td></tr><tr><td><code>ServiceTrafficPanelMobile</code></td><td><code>components/service-traffic/ServiceTrafficPanelMobile.tsx</code></td><td>Card stacked layout</td><td>Mobile</td></tr><tr><td><code>QuotaSettingsForm</code></td><td><code>components/service-traffic/QuotaSettingsForm.tsx</code></td><td>Configure traffic quota limits</td><td>Any</td></tr><tr><td><code>StorageSettings</code></td><td><code>components/storage/StorageSettings.tsx</code></td><td>External storage configuration</td><td>Auto</td></tr><tr><td><code>StorageSettingsDesktop</code></td><td><code>components/storage/StorageSettingsDesktop.tsx</code></td><td>Two-column layout, dense tables</td><td>Desktop</td></tr><tr><td><code>StorageSettingsMobile</code></td><td><code>components/storage/StorageSettingsMobile.tsx</code></td><td>Stacked vertical layout</td><td>Mobile</td></tr><tr><td><code>StorageDisconnectBanner</code></td><td><code>components/storage/StorageDisconnectBanner.tsx</code></td><td>Warning banner when storage is disconnected</td><td>Any</td></tr><tr><td><code>StorageUsageBar</code></td><td><code>components/storage/StorageUsageBar.tsx</code></td><td>Storage usage progress bar</td><td>Any</td></tr><tr><td><code>TemplatesBrowser</code></td><td><code>components/templates/TemplatesBrowser.tsx</code></td><td>Template catalog (platform wrapper)</td><td>Auto</td></tr><tr><td><code>TemplatesBrowserDesktop</code></td><td><code>components/templates/TemplatesBrowserDesktop.tsx</code></td><td>2-column grid + left sidebar filters</td><td>Desktop</td></tr><tr><td><code>TemplatesBrowserMobile</code></td><td><code>components/templates/TemplatesBrowserMobile.tsx</code></td><td>Vertical list + bottom sheet filters</td><td>Mobile/Tablet</td></tr><tr><td><code>TemplateFilters</code></td><td><code>components/templates/TemplateFilters.tsx</code></td><td>Category/scope/type filter controls</td><td>Any</td></tr><tr><td><code>TemplateInstallWizard</code></td><td><code>components/templates/TemplateInstallWizard.tsx</code></td><td>Install wizard (platform wrapper)</td><td>Auto</td></tr><tr><td><code>TemplateInstallWizardDesktop</code></td><td><code>components/templates/TemplateInstallWizardDesktop.tsx</code></td><td>Centered modal with side step nav</td><td>Desktop</td></tr><tr><td><code>TemplateInstallWizardMobile</code></td><td><code>components/templates/TemplateInstallWizardMobile.tsx</code></td><td>Full-screen modal with bottom nav</td><td>Mobile/Tablet</td></tr><tr><td><code>VariablesStep</code></td><td><code>components/templates/wizard-steps/VariablesStep.tsx</code></td><td>Wizard step 1: configure template variables</td><td>Any</td></tr><tr><td><code>ReviewStep</code></td><td><code>components/templates/wizard-steps/ReviewStep.tsx</code></td><td>Wizard step 2: review before install</td><td>Any</td></tr><tr><td><code>InstallingStep</code></td><td><code>components/templates/wizard-steps/InstallingStep.tsx</code></td><td>Wizard step 3: live installation progress</td><td>Any</td></tr><tr><td><code>RoutingStep</code></td><td><code>components/templates/wizard-steps/RoutingStep.tsx</code></td><td>Wizard step 4: optional routing rule selection</td><td>Any</td></tr></tbody></table>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_SAay" id="service-install-flow">Service Install Flow<a href="#service-install-flow" class="hash-link" aria-label="Direct link to Service Install Flow" title="Direct link to Service Install Flow" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_SAay" id="direct-install-installdialog">Direct Install (<code>InstallDialog</code>)<a href="#direct-install-installdialog" class="hash-link" aria-label="Direct link to direct-install-installdialog" title="Direct link to direct-install-installdialog" translate="no">​</a></h3>
<p>The simplest installation path. Used from <code>ServicesPage</code> via the &quot;Install&quot; button.</p>
<div class="language-text codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_kX1v"><pre tabindex="0" class="prism-code language-text codeBlock_TAPP thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[ServicesPage]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  → Button click → setInstallDialogOpen(true)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  → &lt;InstallDialog open routerId onSuccess&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      Step 1: select    → useAvailableServices() → render service cards</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      Step 2: configure → instance name, VLAN ID, bind IP, ports</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      Step 3: installing → useInstallService() mutation</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                         → useInstallProgressSubscription(routerId) subscription</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                         → Progress bar updates on every subscription event</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                         → progress.status === &#x27;completed&#x27; → step 4</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      Step 4: complete  → success icon, done button → onSuccess() → refetch()</span><br></span></code></pre></div></div>
<p>The install mutation input shape:</p>
<div class="language-ts codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_kX1v"><pre tabindex="0" class="prism-code language-ts codeBlock_TAPP thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">installService</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  variables</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    input</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      routerID</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      featureID</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)">// e.g., &#x27;tor&#x27;, &#x27;sing-box&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      instanceName</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      vlanID</span><span class="token operator">?</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">number</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">          </span><span class="token comment" style="color:rgb(98, 114, 164)">// optional VLAN isolation (1-4094)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      bindIP</span><span class="token operator">?</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">          </span><span class="token comment" style="color:rgb(98, 114, 164)">// optional bind address</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      ports</span><span class="token operator">?</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">number</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">         </span><span class="token comment" style="color:rgb(98, 114, 164)">// optional port list</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      config</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">               </span><span class="token comment" style="color:rgb(98, 114, 164)">// initial config (empty; configured later)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_SAay" id="template-install-flow-templateinstallwizard">Template Install Flow (<code>TemplateInstallWizard</code>)<a href="#template-install-flow-templateinstallwizard" class="hash-link" aria-label="Direct link to template-install-flow-templateinstallwizard" title="Direct link to template-install-flow-templateinstallwizard" translate="no">​</a></h3>
<p>The template install flow is a 4-step guided process powered by <code>templateInstallMachine</code> (XState) and orchestrated by <code>useTemplateInstallWizard</code>.</p>
<div class="language-text codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_kX1v"><pre tabindex="0" class="prism-code language-text codeBlock_TAPP thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[ServicesPage or TemplatesBrowser]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  → User selects template → onInstall(template) callback</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  → &lt;TemplateInstallWizard open routerId template onComplete&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      → useTemplateInstallWizard hook (XState machine integration)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          → createTemplateInstallMachine({ routerId, template, templateId })</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          → [state: variables]  → &lt;VariablesStep&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          → [state: review]     → &lt;ReviewStep&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          → [state: installing] → &lt;InstallingStep&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                  → useInstallTemplate mutation fires</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                  → useTemplateInstallProgress subscription</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                  → PROGRESS_UPDATE events → machine context</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                  → INSTALL_COMPLETE → [state: routing]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          → [state: routing]    → &lt;RoutingStep&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                  → User selects routing rules (optional)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                  → APPLY_ROUTING or SKIP_ROUTING → [final: completed]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          → [final: completed]  → onComplete(instanceIDs)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_SAay" id="xstate-machine-templateinstallmachine">XState Machine: <code>templateInstallMachine</code><a href="#xstate-machine-templateinstallmachine" class="hash-link" aria-label="Direct link to xstate-machine-templateinstallmachine" title="Direct link to xstate-machine-templateinstallmachine" translate="no">​</a></h4>
<p><strong>File:</strong> <code>libs/features/services/src/components/templates/templateInstallMachine.ts</code></p>
<div class="language-ts codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_kX1v"><pre tabindex="0" class="prism-code language-ts codeBlock_TAPP thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// States</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;variables&#x27;</span><span class="token plain">   </span><span class="token comment" style="color:rgb(98, 114, 164)">// Step 1: user fills template config variables</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;review&#x27;</span><span class="token plain">      </span><span class="token comment" style="color:rgb(98, 114, 164)">// Step 2: user reviews the planned installation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;installing&#x27;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// Step 3: mutation in progress, subscription updates context</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;routing&#x27;</span><span class="token plain">     </span><span class="token comment" style="color:rgb(98, 114, 164)">// Step 4: optional routing rule selection</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;completed&#x27;</span><span class="token plain">   </span><span class="token comment" style="color:rgb(98, 114, 164)">// Final: installation done</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;cancelled&#x27;</span><span class="token plain">   </span><span class="token comment" style="color:rgb(98, 114, 164)">// Final: user cancelled</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;failed&#x27;</span><span class="token plain">      </span><span class="token comment" style="color:rgb(98, 114, 164)">// Final: install failed</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// Context</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">interface</span><span class="token plain"> </span><span class="token class-name maybe-class-name">TemplateInstallContext</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  routerId</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  template</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">ServiceTemplate</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword null nil" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  templateId</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  variables</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">Record</span><span class="token operator">&lt;</span><span class="token builtin" style="color:rgb(189, 147, 249)">string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">unknown</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  dryRun</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">boolean</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  installResult</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> success</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">boolean</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> instanceIDs</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> errors</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword null nil" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  progress</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> phase</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> current</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">number</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> total</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">number</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> currentService</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">string</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword null nil" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword null nil" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  selectedRoutingRules</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  currentStep</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">number</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain">         </span><span class="token comment" style="color:rgb(98, 114, 164)">// 1-4, drives step indicator UI</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  errors</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">Record</span><span class="token operator">&lt;</span><span class="token builtin" style="color:rgb(189, 147, 249)">string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">string</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// Key events</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token constant" style="color:rgb(189, 147, 249)">SET_VARIABLES</span><span class="token plain">  → updates context</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">variables</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token constant" style="color:rgb(189, 147, 249)">NEXT</span><span class="token plain">           → advances </span><span class="token function" style="color:rgb(80, 250, 123)">state</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">guarded by canGoNext</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token constant" style="color:rgb(189, 147, 249)">PREV</span><span class="token plain">           → goes </span><span class="token function" style="color:rgb(80, 250, 123)">back</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">blocked during installing</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token constant" style="color:rgb(189, 147, 249)">START_INSTALL</span><span class="token plain">  → transitions </span><span class="token keyword module" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> review → installing</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token constant" style="color:rgb(189, 147, 249)">INSTALL_COMPLETE</span><span class="token plain"> → transitions </span><span class="token keyword module" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> installing → routing</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token constant" style="color:rgb(189, 147, 249)">INSTALL_FAILED</span><span class="token plain">  → transitions </span><span class="token keyword module" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> installing → failed</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token constant" style="color:rgb(189, 147, 249)">PROGRESS_UPDATE</span><span class="token plain"> → updates context</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">progress</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">no state change</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token constant" style="color:rgb(189, 147, 249)">TOGGLE_ROUTING_RULE</span><span class="token plain"> → toggles selected routing rules</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token constant" style="color:rgb(189, 147, 249)">SKIP_ROUTING</span><span class="token plain"> </span><span class="token operator">/</span><span class="token plain"> </span><span class="token constant" style="color:rgb(189, 147, 249)">APPLY_ROUTING</span><span class="token plain"> → </span><span class="token keyword module" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> routing → completed</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token constant" style="color:rgb(189, 147, 249)">CANCEL</span><span class="token plain">         → </span><span class="token keyword module" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">any</span><span class="token plain"> non</span><span class="token operator">-</span><span class="token plain">final state → cancelled</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_SAay" id="usetemplateinstallwizard-hook"><code>useTemplateInstallWizard</code> Hook<a href="#usetemplateinstallwizard-hook" class="hash-link" aria-label="Direct link to usetemplateinstallwizard-hook" title="Direct link to usetemplateinstallwizard-hook" translate="no">​</a></h4>
<p><strong>File:</strong> <code>libs/features/services/src/components/templates/useTemplateInstallWizard.ts</code></p>
<p>Integrates the XState machine with Apollo Client mutations and subscriptions:</p>
<div class="language-ts codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_kX1v"><pre tabindex="0" class="prism-code language-ts codeBlock_TAPP thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">          </span><span class="token comment" style="color:rgb(98, 114, 164)">// XState state object</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  context</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)">// TemplateInstallContext</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  send</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">           </span><span class="token comment" style="color:rgb(98, 114, 164)">// (event: TemplateInstallEvent) =&gt; void</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  currentStep</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// 1 | 2 | 3 | 4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  canGoNext</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">      </span><span class="token comment" style="color:rgb(98, 114, 164)">// boolean</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  canGoPrev</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">      </span><span class="token comment" style="color:rgb(98, 114, 164)">// boolean</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  isInstalling</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">   </span><span class="token comment" style="color:rgb(98, 114, 164)">// boolean (state === &#x27;installing&#x27;)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  isCompleted</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// boolean (state === &#x27;completed&#x27;)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  isCancelled</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// boolean (state === &#x27;cancelled&#x27;)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  isFailed</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">       </span><span class="token comment" style="color:rgb(98, 114, 164)">// boolean (state === &#x27;failed&#x27;)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">useTemplateInstallWizard</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> routerId</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> template</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> onComplete</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> onCancel</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> onError </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre></div></div>
<p>Key integration details:</p>
<ul>
<li class=""><code>useInstallTemplate</code> mutation fires when <code>state.matches(&#x27;installing&#x27;)</code> becomes true</li>
<li class=""><code>useTemplateInstallProgress</code> subscription is enabled only while in the <code>installing</code> state</li>
<li class="">Subscription progress events are forwarded to the machine as <code>PROGRESS_UPDATE</code></li>
<li class="">Mutation completion triggers <code>INSTALL_COMPLETE</code> or <code>INSTALL_FAILED</code></li>
<li class=""><code>onCancel</code> callback is called when the machine reaches the <code>cancelled</code> state</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_SAay" id="variablesstep-wizard-step-1"><code>VariablesStep</code> (Wizard Step 1)<a href="#variablesstep-wizard-step-1" class="hash-link" aria-label="Direct link to variablesstep-wizard-step-1" title="Direct link to variablesstep-wizard-step-1" translate="no">​</a></h4>
<p><strong>File:</strong> <code>libs/features/services/src/components/templates/wizard-steps/VariablesStep.tsx</code></p>
<p>Dynamically generates a React Hook Form from <code>template.configVariables</code>. Builds a Zod schema inline using <code>buildValidationSchema</code> which maps each <code>TemplateVariable.type</code> to a Zod validator:</p>
<table><thead><tr><th>Variable Type</th><th>Input Rendered</th><th>Zod Validator</th></tr></thead><tbody><tr><td><code>STRING</code></td><td><code>&lt;Input type=&quot;text&quot;&gt;</code></td><td><code>z.string()</code> + optional regex</td></tr><tr><td><code>NUMBER</code></td><td><code>&lt;Input type=&quot;number&quot;&gt;</code></td><td><code>z.coerce.number()</code> + min/max</td></tr><tr><td><code>PORT</code></td><td><code>&lt;Input type=&quot;number&quot;&gt;</code></td><td><code>z.coerce.number().min(1).max(65535)</code></td></tr><tr><td><code>IP</code></td><td><code>&lt;Input type=&quot;text&quot;&gt;</code></td><td><code>z.string().ip({ version: &#x27;v4&#x27; })</code></td></tr><tr><td><code>BOOLEAN</code></td><td><code>&lt;Switch&gt;</code></td><td><code>z.boolean()</code></td></tr><tr><td><code>ENUM</code></td><td><code>&lt;Select&gt;</code> with <code>enumValues</code> options</td><td><code>z.enum([...enumValues])</code></td></tr></tbody></table>
<p>Changes are propagated to the parent via <code>form.watch()</code> with debounced emission through <code>onVariablesChange</code>.</p>
<h4 class="anchor anchorTargetStickyNavbar_SAay" id="routingstep-wizard-step-4"><code>RoutingStep</code> (Wizard Step 4)<a href="#routingstep-wizard-step-4" class="hash-link" aria-label="Direct link to routingstep-wizard-step-4" title="Direct link to routingstep-wizard-step-4" translate="no">​</a></h4>
<p><strong>File:</strong> <code>libs/features/services/src/components/templates/wizard-steps/RoutingStep.tsx</code></p>
<p>Displays <code>template.suggestedRouting</code> rules as checkboxes. Each rule shows:</p>
<ul>
<li class=""><code>rule.description</code> - human-readable description</li>
<li class=""><code>rule.devicePattern</code> - which devices this rule applies to</li>
<li class=""><code>rule.targetService</code> - the service this rule routes to</li>
<li class=""><code>rule.protocol</code> - optional protocol filter</li>
<li class=""><code>rule.destinationPort</code> - optional destination port</li>
</ul>
<p>If the template has no suggested routing, a placeholder card is shown and the user can proceed directly to completion.</p>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_SAay" id="templates-browser">Templates Browser<a href="#templates-browser" class="hash-link" aria-label="Direct link to Templates Browser" title="Direct link to Templates Browser" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_SAay" id="templatesbrowser"><code>TemplatesBrowser</code><a href="#templatesbrowser" class="hash-link" aria-label="Direct link to templatesbrowser" title="Direct link to templatesbrowser" translate="no">​</a></h3>
<p><strong>File:</strong> <code>libs/features/services/src/components/templates/TemplatesBrowser.tsx</code></p>
<p>Platform detection: Mobile and Tablet use <code>TemplatesBrowserMobile</code> (vertical list + bottom sheet filters); Desktop uses <code>TemplatesBrowserDesktop</code> (2-column grid with left sidebar).</p>
<div class="language-tsx codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_kX1v"><pre tabindex="0" class="prism-code language-tsx codeBlock_TAPP thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#F8F8F2"><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag class-name" style="color:rgb(255, 121, 198)">TemplatesBrowser</span><span class="token tag" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token tag" style="color:rgb(255, 121, 198)">  </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">routerId</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:rgb(248, 248, 242)">=</span><span class="token tag script language-javascript punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token tag script language-javascript" style="color:rgb(255, 121, 198)">routerId</span><span class="token tag script language-javascript punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token tag" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token tag" style="color:rgb(255, 121, 198)">  </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">onInstall</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:rgb(248, 248, 242)">=</span><span class="token tag script language-javascript punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token tag script language-javascript punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token tag script language-javascript" style="color:rgb(255, 121, 198)">template</span><span class="token tag script language-javascript punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token tag script language-javascript" style="color:rgb(255, 121, 198)"> </span><span class="token tag script language-javascript arrow operator" style="color:rgb(255, 121, 198)">=&gt;</span><span class="token tag script language-javascript" style="color:rgb(255, 121, 198)"> </span><span class="token tag script language-javascript punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token tag script language-javascript" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token tag script language-javascript" style="color:rgb(255, 121, 198)">    </span><span class="token tag script language-javascript function" style="color:rgb(80, 250, 123)">setSelectedTemplate</span><span class="token tag script language-javascript punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token tag script language-javascript" style="color:rgb(255, 121, 198)">template</span><span class="token tag script language-javascript punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token tag script language-javascript punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token tag script language-javascript" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token tag script language-javascript" style="color:rgb(255, 121, 198)">    </span><span class="token tag script language-javascript function" style="color:rgb(80, 250, 123)">setWizardOpen</span><span class="token tag script language-javascript punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token tag script language-javascript boolean" style="color:rgb(255, 121, 198)">true</span><span class="token tag script language-javascript punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token tag script language-javascript punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token tag script language-javascript" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token tag script language-javascript" style="color:rgb(255, 121, 198)">  </span><span class="token tag script language-javascript punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token tag script language-javascript punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token tag" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token tag" style="color:rgb(255, 121, 198)">  </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">onViewDetails</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:rgb(248, 248, 242)">=</span><span class="token tag script language-javascript punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token tag script language-javascript punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token tag script language-javascript" style="color:rgb(255, 121, 198)">template</span><span class="token tag script language-javascript punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token tag script language-javascript" style="color:rgb(255, 121, 198)"> </span><span class="token tag script language-javascript arrow operator" style="color:rgb(255, 121, 198)">=&gt;</span><span class="token tag script language-javascript" style="color:rgb(255, 121, 198)"> </span><span class="token tag script language-javascript punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token tag script language-javascript" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token tag script language-javascript" style="color:rgb(255, 121, 198)">    </span><span class="token tag script language-javascript function" style="color:rgb(80, 250, 123)">navigateToTemplateDetail</span><span class="token tag script language-javascript punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token tag script language-javascript" style="color:rgb(255, 121, 198)">template</span><span class="token tag script language-javascript punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token tag script language-javascript property-access" style="color:rgb(255, 121, 198)">id</span><span class="token tag script language-javascript punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token tag script language-javascript punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token tag script language-javascript" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token tag script language-javascript" style="color:rgb(255, 121, 198)">  </span><span class="token tag script language-javascript punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token tag script language-javascript punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token tag" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token tag" style="color:rgb(255, 121, 198)"></span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">/&gt;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_SAay" id="usetemplatesbrowser-hook"><code>useTemplatesBrowser</code> Hook<a href="#usetemplatesbrowser-hook" class="hash-link" aria-label="Direct link to usetemplatesbrowser-hook" title="Direct link to usetemplatesbrowser-hook" translate="no">​</a></h3>
<p><strong>File:</strong> <code>libs/features/services/src/components/templates/useTemplatesBrowser.ts</code></p>
<p>Headless hook managing filter state and API calls. Applies server-side category/scope/text filtering via <code>useServiceTemplates</code> query and client-side sort.</p>
<div class="language-ts codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_kX1v"><pre tabindex="0" class="prism-code language-ts codeBlock_TAPP thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  templates</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">         </span><span class="token comment" style="color:rgb(98, 114, 164)">// ServiceTemplate[] (filtered + sorted)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  loading</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">           </span><span class="token comment" style="color:rgb(98, 114, 164)">// boolean</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  error</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">             </span><span class="token comment" style="color:rgb(98, 114, 164)">// Error | undefined</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  filters</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">           </span><span class="token comment" style="color:rgb(98, 114, 164)">// TemplateBrowserFilters</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  updateFilters</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">     </span><span class="token comment" style="color:rgb(98, 114, 164)">// (partial: Partial&lt;TemplateBrowserFilters&gt;) =&gt; void</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  resetFilters</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">      </span><span class="token comment" style="color:rgb(98, 114, 164)">// () =&gt; void</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  hasActiveFilters</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// boolean</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  refetch</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">           </span><span class="token comment" style="color:rgb(98, 114, 164)">// () =&gt; void</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">useTemplatesBrowser</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">routerId</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre></div></div>
<p><strong>Filter shape:</strong></p>
<div class="language-ts codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_kX1v"><pre tabindex="0" class="prism-code language-ts codeBlock_TAPP thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">interface</span><span class="token plain"> </span><span class="token class-name maybe-class-name">TemplateBrowserFilters</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  searchQuery</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain">                    </span><span class="token comment" style="color:rgb(98, 114, 164)">// text search</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  category</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">ServiceTemplateCategory</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword null nil" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// &#x27;privacy&#x27; | &#x27;proxy&#x27; | &#x27;dns&#x27; | null</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  scope</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">TemplateScope</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword null nil" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain">            </span><span class="token comment" style="color:rgb(98, 114, 164)">// &#x27;GLOBAL&#x27; | &#x27;PER_DEVICE&#x27; | &#x27;PER_VLAN&#x27; | null</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  showBuiltIn</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">boolean</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain">                   </span><span class="token comment" style="color:rgb(98, 114, 164)">// marketplace templates</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  showCustom</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">boolean</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain">                    </span><span class="token comment" style="color:rgb(98, 114, 164)">// user-created templates</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  sortBy</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">TemplateSortBy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain">                 </span><span class="token comment" style="color:rgb(98, 114, 164)">// &#x27;name&#x27; | &#x27;updated&#x27; | &#x27;category&#x27; | &#x27;services&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_SAay" id="dynamic-configuration-forms">Dynamic Configuration Forms<a href="#dynamic-configuration-forms" class="hash-link" aria-label="Direct link to Dynamic Configuration Forms" title="Direct link to Dynamic Configuration Forms" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_SAay" id="architecture">Architecture<a href="#architecture" class="hash-link" aria-label="Direct link to Architecture" title="Direct link to Architecture" translate="no">​</a></h3>
<p>Every service exposes a <code>ConfigSchema</code> from the backend that describes all configuration fields with their types, constraints, defaults, and conditional visibility rules. The frontend uses this schema to dynamically build:</p>
<ol>
<li class="">A Zod validation schema (via <code>buildZodSchema</code>)</li>
<li class="">A React Hook Form instance</li>
<li class="">A set of rendered field components (via <code>DynamicField</code>)</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_SAay" id="useserviceconfigform-hook"><code>useServiceConfigForm</code> Hook<a href="#useserviceconfigform-hook" class="hash-link" aria-label="Direct link to useserviceconfigform-hook" title="Direct link to useserviceconfigform-hook" translate="no">​</a></h3>
<p><strong>File:</strong> <code>libs/features/services/src/hooks/useServiceConfigForm.ts</code></p>
<p>The master hook for service configuration forms. Fetches schema and current config from the backend, builds a Zod schema, initializes React Hook Form, evaluates <code>showIf</code> conditions for field visibility, and handles two-phase validation (client + server).</p>
<div class="language-ts codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_kX1v"><pre tabindex="0" class="prism-code language-ts codeBlock_TAPP thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> formState </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">useServiceConfigForm</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  serviceType</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;tor&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  routerID</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;router-1&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  instanceID</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;instance-123&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token function-variable function" style="color:rgb(80, 250, 123)">onSuccess</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">configPath</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> toast</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">success</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Configuration applied!&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token function-variable function" style="color:rgb(80, 250, 123)">onError</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> toast</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">error</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// formState.form              - UseFormReturn&lt;any&gt; from react-hook-form</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// formState.schema            - ConfigSchema | undefined</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// formState.visibleFields     - ConfigSchemaField[] (filtered by showIf conditions)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// formState.handleSubmit      - () =&gt; Promise&lt;void&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// formState.isValidating      - boolean (client + server validation in progress)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// formState.isSubmitting      - boolean (applyConfig mutation in progress)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// formState.loading           - { schema: boolean; config: boolean }</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// formState.errors            - { schema: Error | undefined; config: Error | undefined }</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// formState.validate          - () =&gt; Promise&lt;boolean&gt; (manual trigger)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// formState.refetch           - () =&gt; void</span><br></span></code></pre></div></div>
<p><strong>Submit flow:</strong></p>
<div class="language-text codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_kX1v"><pre tabindex="0" class="prism-code language-text codeBlock_TAPP thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#F8F8F2"><span class="token plain">handleSubmit()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  → validate()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      → form.trigger() (Zod client-side)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      → validateConfig({ routerID, instanceID, config }) (server-side)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      → if errors: form.setError() per field → return false</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  → applyConfig({ routerID, instanceID, config })</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  → if result.success: onSuccess(configPath)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  → if !result.success: form.setError() per field + onError(message)</span><br></span></code></pre></div></div>
<p><strong>Conditional field visibility:</strong>
The <code>showIf</code> property on a <code>ConfigSchemaField</code> is a simple expression string:</p>
<div class="language-text codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_kX1v"><pre tabindex="0" class="prism-code language-text codeBlock_TAPP thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;enableProxy === true&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;authMode !== &#x27;none&#x27;&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;enableProxy&quot;   // simple boolean check</span><br></span></code></pre></div></div>
<p>These are evaluated by <code>evaluateCondition(condition, formValues)</code> in <code>utils/zodSchemaBuilder.ts</code>.</p>
<h3 class="anchor anchorTargetStickyNavbar_SAay" id="buildzodschema-utility"><code>buildZodSchema</code> Utility<a href="#buildzodschema-utility" class="hash-link" aria-label="Direct link to buildzodschema-utility" title="Direct link to buildzodschema-utility" translate="no">​</a></h3>
<p><strong>File:</strong> <code>libs/features/services/src/utils/zodSchemaBuilder.ts</code></p>
<p>Converts a <code>ConfigSchema</code> from the backend GraphQL API into a <code>z.ZodObject</code> for use with <code>zodResolver</code>.</p>
<p><strong>Supported field types and their Zod schemas:</strong></p>
<table><thead><tr><th><code>ConfigFieldType</code></th><th>Zod Schema</th><th>Notes</th></tr></thead><tbody><tr><td><code>TEXT</code></td><td><code>z.string()</code></td><td>+ optional regex, min/max length</td></tr><tr><td><code>TEXT_AREA</code></td><td><code>z.string()</code></td><td>Same as TEXT</td></tr><tr><td><code>PASSWORD</code></td><td><code>z.string().min(8)</code></td><td>+ optional regex, max</td></tr><tr><td><code>EMAIL</code></td><td><code>z.string().email()</code></td><td>Standard email format</td></tr><tr><td><code>URL</code></td><td><code>z.string().url()</code></td><td>Standard URL format</td></tr><tr><td><code>NUMBER</code></td><td><code>z.number()</code></td><td>+ optional min/max</td></tr><tr><td><code>TOGGLE</code></td><td><code>z.boolean()</code></td><td></td></tr><tr><td><code>SELECT</code></td><td><code>z.enum([...options])</code></td><td>Options from <code>field.options</code></td></tr><tr><td><code>MULTI_SELECT</code></td><td><code>z.array(z.enum([...options]))</code></td><td>+ optional min/max items</td></tr><tr><td><code>TEXT_ARRAY</code></td><td><code>z.array(z.string())</code></td><td>+ optional regex per item, min/max</td></tr><tr><td><code>IP</code></td><td><code>z.string().regex(ipv4Regex)</code></td><td>IPv4 only</td></tr><tr><td><code>PORT</code></td><td><code>z.number().int().min(1).max(65535)</code></td><td></td></tr><tr><td><code>PATH</code></td><td><code>z.string()</code></td><td>+ optional regex</td></tr></tbody></table>
<p>Fields without <code>required: true</code> are wrapped in <code>.optional()</code>.</p>
<h3 class="anchor anchorTargetStickyNavbar_SAay" id="dynamicfield-component"><code>DynamicField</code> Component<a href="#dynamicfield-component" class="hash-link" aria-label="Direct link to dynamicfield-component" title="Direct link to dynamicfield-component" translate="no">​</a></h3>
<p><strong>File:</strong> <code>libs/features/services/src/components/ServiceConfigForm/DynamicField.tsx</code></p>
<p>Renders the appropriate primitive field component based on <code>field.type</code>, integrating with the React Hook Form <code>control</code> object. Handles <code>showIf</code> visibility gating so hidden fields are not rendered.</p>
<h3 class="anchor anchorTargetStickyNavbar_SAay" id="platform-presenters-for-serviceconfigform">Platform Presenters for <code>ServiceConfigForm</code><a href="#platform-presenters-for-serviceconfigform" class="hash-link" aria-label="Direct link to platform-presenters-for-serviceconfigform" title="Direct link to platform-presenters-for-serviceconfigform" translate="no">​</a></h3>
<ul>
<li class=""><strong>Mobile</strong> (<code>ServiceConfigFormMobile</code>): Fields grouped in an accordion layout. Sections expand/collapse. Submit/cancel buttons are sticky at the bottom.</li>
<li class=""><strong>Desktop</strong> (<code>ServiceConfigFormDesktop</code>): Fields organized in a 2-column grid. Optional tabbed section grouping. Buttons inline at the bottom.</li>
</ul>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_SAay" id="service-updates">Service Updates<a href="#service-updates" class="hash-link" aria-label="Direct link to Service Updates" title="Direct link to Service Updates" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_SAay" id="update-check-flow">Update Check Flow<a href="#update-check-flow" class="hash-link" aria-label="Direct link to Update Check Flow" title="Direct link to Update Check Flow" translate="no">​</a></h3>
<div class="language-text codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_kX1v"><pre tabindex="0" class="prism-code language-text codeBlock_TAPP thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ServicesPage</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  → useAvailableUpdates({ routerId })</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  → If updates.length &gt; 0: show UpdateAllPanel in collapsible section</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  → ServiceDetailPage</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      → useAvailableUpdates + find update for this instanceId</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      → Show UpdateIndicator badge in page header</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_SAay" id="updateallpanel"><code>UpdateAllPanel</code><a href="#updateallpanel" class="hash-link" aria-label="Direct link to updateallpanel" title="Direct link to updateallpanel" translate="no">​</a></h3>
<p><strong>File:</strong> <code>libs/features/services/src/components/UpdateAllPanel.tsx</code></p>
<p>Displays available updates grouped by severity with a confirmation dialog before bulk updating. Updates are sorted by severity priority: <code>SECURITY &gt; MAJOR &gt; MINOR &gt; PATCH</code>.</p>
<div class="language-ts codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_kX1v"><pre tabindex="0" class="prism-code language-ts codeBlock_TAPP thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">interface</span><span class="token plain"> </span><span class="token class-name maybe-class-name">UpdateAllPanelProps</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  updates</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">AvailableUpdate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  onUpdateAll</span><span class="token operator">?</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">void</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain">          </span><span class="token comment" style="color:rgb(98, 114, 164)">// triggers bulk update</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  onUpdate</span><span class="token operator">?</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">instanceId</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">void</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// single update</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  updatingInstances</span><span class="token operator">?</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">Record</span><span class="token operator">&lt;</span><span class="token builtin" style="color:rgb(189, 147, 249)">string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">boolean</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// per-instance loading state</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  updateProgress</span><span class="token operator">?</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">Record</span><span class="token operator">&lt;</span><span class="token builtin" style="color:rgb(189, 147, 249)">string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">number</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// per-instance progress (0-100)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  loading</span><span class="token operator">?</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">boolean</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre></div></div>
<p>The component:</p>
<ol>
<li class="">Renders severity badges (Security/Major/Minor/Patch counts)</li>
<li class="">Shows a security alert if any SECURITY updates are present</li>
<li class="">Lists first 5 updates sorted by severity</li>
<li class="">&quot;Update All&quot; button opens a confirmation dialog before calling <code>onUpdateAll</code></li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_SAay" id="updatemachine-xstate"><code>updateMachine</code> (XState)<a href="#updatemachine-xstate" class="hash-link" aria-label="Direct link to updatemachine-xstate" title="Direct link to updatemachine-xstate" translate="no">​</a></h3>
<p><strong>File:</strong> <code>libs/features/services/src/machines/update-machine.ts</code></p>
<p>Tracks the lifecycle of a single service update operation. Used when updating an individual service instance.</p>
<div class="language-ts codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_kX1v"><pre tabindex="0" class="prism-code language-ts codeBlock_TAPP thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// States</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;idle&#x27;</span><span class="token plain">       </span><span class="token comment" style="color:rgb(98, 114, 164)">// ready to start</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;updating&#x27;</span><span class="token plain">   </span><span class="token comment" style="color:rgb(98, 114, 164)">// update in progress</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;complete&#x27;</span><span class="token plain">   </span><span class="token comment" style="color:rgb(98, 114, 164)">// succeeded</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;rolledBack&#x27;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">// health check failed, auto-rolled back</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;failed&#x27;</span><span class="token plain">     </span><span class="token comment" style="color:rgb(98, 114, 164)">// update failed</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// Context</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">interface</span><span class="token plain"> </span><span class="token class-name maybe-class-name">UpdateContext</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  instanceId</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">string</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword null nil" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  fromVersion</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">string</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword null nil" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  toVersion</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">string</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword null nil" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  stage</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">UpdateStage</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain">          </span><span class="token comment" style="color:rgb(98, 114, 164)">// PENDING | DOWNLOADING | APPLYING | COMPLETE | FAILED | ROLLED_BACK</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  progress</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">number</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain">            </span><span class="token comment" style="color:rgb(98, 114, 164)">// 0-100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  message</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  error</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">string</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword null nil" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  rolledBack</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">boolean</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  startedAt</span><span class="token operator">:</span><span class="token plain"> </span><span class="token known-class-name class-name">Date</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword null nil" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  completedAt</span><span class="token operator">:</span><span class="token plain"> </span><span class="token known-class-name class-name">Date</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword null nil" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// Usage with GraphQL subscription</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> send</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">useMachine</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">updateMachine</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">send</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> type</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;START_UPDATE&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> instanceId</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> fromVersion</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> toVersion </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// In useEffect watching the progress subscription:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">send</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> type</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;PROGRESS&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> stage</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> progress</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> message </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">send</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> type</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;COMPLETE&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> toVersion </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain">           </span><span class="token comment" style="color:rgb(98, 114, 164)">// on stage COMPLETE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">send</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> type</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;ROLLED_BACK&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> error </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain">            </span><span class="token comment" style="color:rgb(98, 114, 164)">// on rolledBack flag</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">send</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> type</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;FAILED&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> error </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain">                 </span><span class="token comment" style="color:rgb(98, 114, 164)">// on stage FAILED</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// Reset after viewing result:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">send</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> type</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;RESET&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre></div></div>
<p>The machine distinguishes between <code>rolledBack</code> (backend health check triggered automatic rollback) and <code>failed</code> (hard failure with no rollback). Both require an explicit <code>RESET</code> event to return to <code>idle</code>.</p>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_SAay" id="vlan-pool">VLAN Pool<a href="#vlan-pool" class="hash-link" aria-label="Direct link to VLAN Pool" title="Direct link to VLAN Pool" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_SAay" id="vlanpoolconfig-component"><code>VLANPoolConfig</code> Component<a href="#vlanpoolconfig-component" class="hash-link" aria-label="Direct link to vlanpoolconfig-component" title="Direct link to vlanpoolconfig-component" translate="no">​</a></h3>
<p><strong>File:</strong> <code>libs/features/services/src/components/VLANPoolConfig.tsx</code></p>
<p>Form for configuring the VLAN pool range used when allocating VLANs to new service instances. Uses React Hook Form + Zod with cross-field validation.</p>
<div class="language-ts codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_kX1v"><pre tabindex="0" class="prism-code language-ts codeBlock_TAPP thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// Validation schema</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> vlanPoolConfigSchema </span><span class="token operator">=</span><span class="token plain"> z</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">object</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  poolStart</span><span class="token operator">:</span><span class="token plain"> z</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">number</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">int</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">min</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">max</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">4094</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  poolEnd</span><span class="token operator">:</span><span class="token plain">   z</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">number</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">int</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">min</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">max</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">4094</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">refine</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">poolStart</span><span class="token plain"> </span><span class="token operator">&lt;=</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">poolEnd</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> message</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Pool start must be &lt;= pool end&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> path</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;poolEnd&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre></div></div>
<p>The form shows warnings when:</p>
<ul>
<li class="">The new pool range is smaller than the current range (<code>isShrinking</code> flag)</li>
<li class="">The new range excludes VLANs that are currently allocated (<code>wouldExcludeCurrent</code> flag)</li>
</ul>
<p>It also renders a live preview of:</p>
<ul>
<li class="">Pool size (current vs. new)</li>
<li class="">Subnet template: <code>10.{VLAN_ID}.0.0/24</code> with an example</li>
</ul>
<p>Shrinking the pool requires an explicit browser <code>window.confirm()</code> acknowledgment due to the risk of disrupting existing allocations.</p>
<h3 class="anchor anchorTargetStickyNavbar_SAay" id="vlansettingspage-vlan-allocation-table"><code>VLANSettingsPage</code> VLAN Allocation Table<a href="#vlansettingspage-vlan-allocation-table" class="hash-link" aria-label="Direct link to vlansettingspage-vlan-allocation-table" title="Direct link to vlansettingspage-vlan-allocation-table" translate="no">​</a></h3>
<p>The Allocations tab in <code>VLANSettingsPage</code> uses the <code>VLANAllocationTable</code> pattern component. Each row maps:</p>
<div class="language-ts codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_kX1v"><pre tabindex="0" class="prism-code language-ts codeBlock_TAPP thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  id</span><span class="token operator">:</span><span class="token plain"> alloc</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  vlanID</span><span class="token operator">:</span><span class="token plain"> alloc</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">vlanID</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  serviceType</span><span class="token operator">:</span><span class="token plain"> alloc</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">serviceType</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  instanceName</span><span class="token operator">:</span><span class="token plain"> alloc</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">serviceInstance</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">instanceName</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  bindIP</span><span class="token operator">:</span><span class="token plain"> alloc</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">subnet</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  interfaceName</span><span class="token operator">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token template-string string" style="color:rgb(255, 121, 198)">vlan</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(248, 248, 242)">${</span><span class="token template-string interpolation">alloc</span><span class="token template-string interpolation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token template-string interpolation property-access">vlanID</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  status</span><span class="token operator">:</span><span class="token plain"> alloc</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">status</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  allocatedAt</span><span class="token operator">:</span><span class="token plain"> alloc</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">allocatedAt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_SAay" id="kill-switch">Kill Switch<a href="#kill-switch" class="hash-link" aria-label="Direct link to Kill Switch" title="Direct link to Kill Switch" translate="no">​</a></h2>
<p>The Kill Switch is a network safety mechanism that blocks all traffic for a device if its assigned service instance goes down. This prevents traffic from leaking onto the unprotected network.</p>
<h3 class="anchor anchorTargetStickyNavbar_SAay" id="integration-points">Integration Points<a href="#integration-points" class="hash-link" aria-label="Direct link to Integration Points" title="Direct link to Integration Points" translate="no">​</a></h3>
<ul>
<li class=""><strong><code>DeviceRoutingPage</code></strong>: Renders a global <code>KillSwitchToggle</code> at the top of the page</li>
<li class=""><strong><code>RoutingChainViz</code></strong>: Each routing chain hop can show kill switch state via <code>showKillSwitch</code> prop</li>
<li class=""><strong><code>RoutingChainData</code></strong> shape includes <code>killSwitchEnabled</code>, <code>killSwitchMode: &#x27;BLOCK_ALL&#x27;</code>, and <code>killSwitchActive</code> per chain</li>
</ul>
<p>The backend enforces the kill switch at the VIF layer via MikroTik firewall rules. The frontend only provides the control UI - it sends mutations to enable/disable per device or globally.</p>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_SAay" id="device-routing">Device Routing<a href="#device-routing" class="hash-link" aria-label="Direct link to Device Routing" title="Direct link to Device Routing" translate="no">​</a></h2>
<p>Device routing implements Policy-Based Routing (PBR) on the MikroTik router. When a device is assigned to a service:</p>
<ol>
<li class="">The backend creates a routing mark tied to the service&#x27;s VIF</li>
<li class="">A mangle rule marks all packets from that device&#x27;s MAC/IP with the routing mark</li>
<li class="">A routing table entry sends marked packets through the service&#x27;s VIF gateway</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_SAay" id="deviceroutingmatrix-pattern"><code>DeviceRoutingMatrix</code> Pattern<a href="#deviceroutingmatrix-pattern" class="hash-link" aria-label="Direct link to deviceroutingmatrix-pattern" title="Direct link to deviceroutingmatrix-pattern" translate="no">​</a></h3>
<p>The <code>DeviceRoutingMatrix</code> pattern component (from <code>@nasnet/ui/patterns</code>) receives the routing matrix and action handlers:</p>
<div class="language-ts codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_kX1v"><pre tabindex="0" class="prism-code language-ts codeBlock_TAPP thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// Matrix data from useDeviceRoutingMatrix(routerId)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  devices</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> deviceID</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> macAddress</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> ipAddress</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> hostname</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token spread operator">...</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  interfaces</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> instanceID</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> instanceName</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> routingMark</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> gatewayType</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token spread operator">...</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  routings</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> deviceID</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> macAddress</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> deviceIP</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> interfaceID</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> routingMark</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> active</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> routingMode</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token spread operator">...</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// Actions</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">interface</span><span class="token plain"> </span><span class="token class-name maybe-class-name">DeviceRoutingActions</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token function-variable function" style="color:rgb(80, 250, 123)">onAssign</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">deviceID</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> interfaceID</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token known-class-name class-name">Promise</span><span class="token operator">&lt;</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">void</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token function-variable function" style="color:rgb(80, 250, 123)">onRemove</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">routingID</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token known-class-name class-name">Promise</span><span class="token operator">&lt;</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">void</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token function-variable function" style="color:rgb(80, 250, 123)">onBulkAssign</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">deviceIDs</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> interfaceID</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token known-class-name class-name">Promise</span><span class="token operator">&lt;</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">void</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_SAay" id="routingchainviz-pattern"><code>RoutingChainViz</code> Pattern<a href="#routingchainviz-pattern" class="hash-link" aria-label="Direct link to routingchainviz-pattern" title="Direct link to routingchainviz-pattern" translate="no">​</a></h3>
<p>The <code>RoutingChainViz</code> pattern (from <code>@nasnet/ui/patterns</code>) visualizes the chain of services a device&#x27;s traffic passes through. In <code>DeviceRoutingPage</code>, chains are derived from <code>matrix.routings</code> by grouping all routing entries by <code>deviceID</code>.</p>
<div class="language-ts codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_kX1v"><pre tabindex="0" class="prism-code language-ts codeBlock_TAPP thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">interface</span><span class="token plain"> </span><span class="token class-name maybe-class-name">RoutingChainData</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  id</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  deviceId</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  deviceName</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">string</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword null nil" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  deviceMac</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">string</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword null nil" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  deviceIp</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">string</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword null nil" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  hops</span><span class="token operator">:</span><span class="token plain"> </span><span class="token known-class-name class-name">Array</span><span class="token operator">&lt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    id</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    order</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">number</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    serviceName</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    serviceType</span><span class="token operator">?</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    routingMark</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    latencyMs</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">number</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword null nil" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    healthy</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">boolean</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    killSwitchActive</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">boolean</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  active</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">boolean</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  routingMode</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;MAC&#x27;</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;IP&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  killSwitchEnabled</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">boolean</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  killSwitchMode</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;BLOCK_ALL&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  killSwitchActive</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">boolean</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  totalLatencyMs</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">number</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword null nil" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_SAay" id="traffic-and-quota">Traffic and Quota<a href="#traffic-and-quota" class="hash-link" aria-label="Direct link to Traffic and Quota" title="Direct link to Traffic and Quota" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_SAay" id="servicetrafficpanel"><code>ServiceTrafficPanel</code><a href="#servicetrafficpanel" class="hash-link" aria-label="Direct link to servicetrafficpanel" title="Direct link to servicetrafficpanel" translate="no">​</a></h3>
<p><strong>File:</strong> <code>libs/features/services/src/components/service-traffic/ServiceTrafficPanel.tsx</code></p>
<p>Platform-aware wrapper that renders <code>ServiceTrafficPanelDesktop</code> or <code>ServiceTrafficPanelMobile</code>. Displays:</p>
<ul>
<li class="">Total upload/download byte counters</li>
<li class="">Real-time upload/download rates (calculated via BigInt arithmetic)</li>
<li class="">Historical traffic chart (last N hours, configurable via <code>historyHours</code> prop)</li>
<li class="">Per-device bandwidth breakdown</li>
<li class="">Traffic quota status with warning/exceeded indicators</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_SAay" id="useservicetrafficpanel-hook"><code>useServiceTrafficPanel</code> Hook<a href="#useservicetrafficpanel-hook" class="hash-link" aria-label="Direct link to useservicetrafficpanel-hook" title="Direct link to useservicetrafficpanel-hook" translate="no">​</a></h3>
<p><strong>File:</strong> <code>libs/features/services/src/components/service-traffic/use-service-traffic-panel.ts</code></p>
<p>Headless hook for traffic data management. Key behaviors:</p>
<ul>
<li class="">Uses <code>useTrafficMonitoring({ routerID, instanceID, historyHours })</code> for combined query + subscription</li>
<li class="">Calculates rates using <code>BigInt</code> arithmetic to handle large byte counts without floating-point errors</li>
<li class="">Detects counter resets (negative delta after service restart) and suppresses invalid rate values</li>
<li class="">1-second delayed <code>previousStats</code> ref prevents same-timestamp rate artifacts</li>
</ul>
<div class="language-ts codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_kX1v"><pre tabindex="0" class="prism-code language-ts codeBlock_TAPP thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> trafficState </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">useServiceTrafficPanel</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  routerID</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;router-1&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  instanceID</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;xray-instance-1&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  historyHours</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">24</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// trafficState.stats             - ServiceTrafficStats | null</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// trafficState.uploadRate        - bigint | null (bytes/sec)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// trafficState.downloadRate      - bigint | null (bytes/sec)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// trafficState.quotaUsagePercent - number (0-100)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// trafficState.quotaWarning      - boolean (warning threshold crossed)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// trafficState.quotaExceeded     - boolean (hard limit reached)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// trafficState.loading           - boolean</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// trafficState.error             - Error | null</span><br></span></code></pre></div></div>
<p>Rate calculation formula:</p>
<div class="language-ts codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_kX1v"><pre tabindex="0" class="prism-code language-ts codeBlock_TAPP thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> intervalMs </span><span class="token operator">=</span><span class="token plain"> currentTime </span><span class="token operator">-</span><span class="token plain"> previousTime</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> uploadRate </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">uploadDiff </span><span class="token operator">*</span><span class="token plain"> </span><span class="token number">1000n</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">/</span><span class="token plain"> </span><span class="token known-class-name class-name">BigInt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">intervalMs</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">// bytes/sec</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_SAay" id="quotasettingsform"><code>QuotaSettingsForm</code><a href="#quotasettingsform" class="hash-link" aria-label="Direct link to quotasettingsform" title="Direct link to quotasettingsform" translate="no">​</a></h3>
<p><strong>File:</strong> <code>libs/features/services/src/components/service-traffic/QuotaSettingsForm.tsx</code></p>
<p>Form for configuring traffic quota limits per service instance. Fields include:</p>
<ul>
<li class="">Quota limit (total bytes allowed per period)</li>
<li class="">Warning threshold (percentage of quota that triggers a warning alert)</li>
<li class="">Period (daily, weekly, monthly)</li>
<li class="">Action on limit reached (block, alert-only)</li>
</ul>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_SAay" id="storage-management">Storage Management<a href="#storage-management" class="hash-link" aria-label="Direct link to Storage Management" title="Direct link to Storage Management" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_SAay" id="storagesettings"><code>StorageSettings</code><a href="#storagesettings" class="hash-link" aria-label="Direct link to storagesettings" title="Direct link to storagesettings" translate="no">​</a></h3>
<p><strong>File:</strong> <code>libs/features/services/src/components/storage/StorageSettings.tsx</code></p>
<p>Platform-aware wrapper selecting <code>StorageSettingsMobile</code> or <code>StorageSettingsDesktop</code>. External storage allows service instances to persist their data (configs, databases, caches) to a USB drive or NFS mount, circumventing the router&#x27;s limited flash storage.</p>
<p><strong>Presenter differences:</strong></p>
<ul>
<li class=""><strong>Desktop</strong>: Two-column layout with service breakdown table, inline mount point input, hover states</li>
<li class=""><strong>Mobile</strong>: Stacked vertical cards, full-width buttons, 44px touch targets, progressive disclosure</li>
</ul>
<p><strong>Key features implemented in both presenters (via <code>useStorageSettings</code> hook):</strong></p>
<ul>
<li class="">Real-time storage status and usage metrics</li>
<li class="">Service-aware disconnect flow: lists which running services will be affected</li>
<li class="">Mount point validation</li>
<li class="">Percentage-based usage bar (<code>StorageUsageBar</code>)</li>
<li class="">Disconnect warning banner (<code>StorageDisconnectBanner</code>)</li>
</ul>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_SAay" id="service-sharing-importexport">Service Sharing (Import/Export)<a href="#service-sharing-importexport" class="hash-link" aria-label="Direct link to Service Sharing (Import/Export)" title="Direct link to Service Sharing (Import/Export)" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_SAay" id="export-flow">Export Flow<a href="#export-flow" class="hash-link" aria-label="Direct link to Export Flow" title="Direct link to Export Flow" translate="no">​</a></h3>
<p>From <code>ServiceDetailPage</code>, the &quot;Export&quot; button opens <code>ServiceExportDialog</code> (from <code>@nasnet/ui/patterns</code>). The export configuration is validated client-side using:</p>
<div class="language-ts codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_kX1v"><pre tabindex="0" class="prism-code language-ts codeBlock_TAPP thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// libs/features/services/src/schemas/service-sharing.schema.ts</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword module" style="color:rgb(189, 147, 249);font-style:italic">export</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> exportServiceSchema </span><span class="token operator">=</span><span class="token plain"> z</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">object</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  routerID</span><span class="token operator">:</span><span class="token plain"> z</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">min</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  instanceID</span><span class="token operator">:</span><span class="token plain"> z</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">min</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  redactSecrets</span><span class="token operator">:</span><span class="token plain"> z</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">boolean</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token keyword module" style="color:rgb(189, 147, 249);font-style:italic">default</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">     </span><span class="token comment" style="color:rgb(98, 114, 164)">// redact passwords/keys</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  includeRoutingRules</span><span class="token operator">:</span><span class="token plain"> z</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">boolean</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token keyword module" style="color:rgb(189, 147, 249);font-style:italic">default</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token boolean">false</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword module" style="color:rgb(189, 147, 249);font-style:italic">export</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> generateQRSchema </span><span class="token operator">=</span><span class="token plain"> z</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">object</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  routerID</span><span class="token operator">:</span><span class="token plain"> z</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">min</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  instanceID</span><span class="token operator">:</span><span class="token plain"> z</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">min</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  redactSecrets</span><span class="token operator">:</span><span class="token plain"> z</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">boolean</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token keyword module" style="color:rgb(189, 147, 249);font-style:italic">default</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  includeRoutingRules</span><span class="token operator">:</span><span class="token plain"> z</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">boolean</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token keyword module" style="color:rgb(189, 147, 249);font-style:italic">default</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token boolean">false</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  imageSize</span><span class="token operator">:</span><span class="token plain"> z</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">number</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">int</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">min</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">128</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">max</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1024</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token keyword module" style="color:rgb(189, 147, 249);font-style:italic">default</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">256</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_SAay" id="import-flow">Import Flow<a href="#import-flow" class="hash-link" aria-label="Direct link to Import Flow" title="Direct link to Import Flow" translate="no">​</a></h3>
<p>From <code>ServicesPage</code>, the &quot;Import&quot; button opens <code>ServiceImportDialog</code> (from <code>@nasnet/ui/patterns</code>). The import package JSON structure is validated before submission:</p>
<div class="language-ts codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_kX1v"><pre tabindex="0" class="prism-code language-ts codeBlock_TAPP thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#F8F8F2"><span class="token keyword module" style="color:rgb(189, 147, 249);font-style:italic">export</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> importPackageSchema </span><span class="token operator">=</span><span class="token plain"> z</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">object</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  version</span><span class="token operator">:</span><span class="token plain"> z</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">literal</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;1.0&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  exportedAt</span><span class="token operator">:</span><span class="token plain"> z</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">datetime</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  exportedBy</span><span class="token operator">:</span><span class="token plain"> z</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">min</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  sourceRouter</span><span class="token operator">:</span><span class="token plain"> z</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">object</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> id</span><span class="token operator">:</span><span class="token plain"> z</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> name</span><span class="token operator">:</span><span class="token plain"> z</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">optional</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  service</span><span class="token operator">:</span><span class="token plain"> z</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">object</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    featureID</span><span class="token operator">:</span><span class="token plain"> z</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">min</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    instanceName</span><span class="token operator">:</span><span class="token plain"> z</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">min</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    config</span><span class="token operator">:</span><span class="token plain"> z</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">record</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">z</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">unknown</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ports</span><span class="token operator">:</span><span class="token plain"> z</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">array</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">z</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">number</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">int</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">optional</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    vlanID</span><span class="token operator">:</span><span class="token plain"> z</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">number</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">int</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">optional</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    bindIP</span><span class="token operator">:</span><span class="token plain"> z</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">optional</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  routingRules</span><span class="token operator">:</span><span class="token plain"> z</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">array</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">z</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">object</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    deviceMAC</span><span class="token operator">:</span><span class="token plain"> z</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    deviceName</span><span class="token operator">:</span><span class="token plain"> z</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">optional</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    mode</span><span class="token operator">:</span><span class="token plain"> z</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">enum</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;direct&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;through_service&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;blocked&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">optional</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  redactedFields</span><span class="token operator">:</span><span class="token plain"> z</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">array</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">z</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">optional</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// field names that were redacted</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword module" style="color:rgb(189, 147, 249);font-style:italic">export</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> importServiceSchema </span><span class="token operator">=</span><span class="token plain"> z</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">object</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  routerID</span><span class="token operator">:</span><span class="token plain"> z</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">min</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">package</span><span class="token operator">:</span><span class="token plain"> importPackageSchema</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  dryRun</span><span class="token operator">:</span><span class="token plain"> z</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">boolean</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token keyword module" style="color:rgb(189, 147, 249);font-style:italic">default</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  conflictResolution</span><span class="token operator">:</span><span class="token plain"> z</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">enum</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;skip&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;rename&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;replace&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">optional</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  deviceFilter</span><span class="token operator">:</span><span class="token plain"> z</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">array</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">z</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">optional</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  redactedFieldValues</span><span class="token operator">:</span><span class="token plain"> z</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">record</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">z</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">optional</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// user-provided values for redacted fields</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre></div></div>
<p><strong>Validation helper:</strong></p>
<div class="language-ts codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_kX1v"><pre tabindex="0" class="prism-code language-ts codeBlock_TAPP thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">validateImportPackageJSON</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">jsonString</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  valid</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">boolean</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  data</span><span class="token operator">?</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">ImportPackageData</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  errors</span><span class="token operator">?</span><span class="token operator">:</span><span class="token plain"> z</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token known-class-name class-name">ZodError</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre></div></div>
<p>If the imported package contains <code>redactedFields</code>, the user is prompted to enter values for those fields before the import is submitted.</p>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_SAay" id="service-dependencies">Service Dependencies<a href="#service-dependencies" class="hash-link" aria-label="Direct link to Service Dependencies" title="Direct link to Service Dependencies" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_SAay" id="stopdependentsdialog"><code>StopDependentsDialog</code><a href="#stopdependentsdialog" class="hash-link" aria-label="Direct link to stopdependentsdialog" title="Direct link to stopdependentsdialog" translate="no">​</a></h3>
<p><strong>File:</strong> <code>libs/features/services/src/components/StopDependentsDialog.tsx</code></p>
<p>Warning dialog displayed before stopping a service instance that other services depend on. Prevents accidental breakage of service chains.</p>
<div class="language-ts codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_kX1v"><pre tabindex="0" class="prism-code language-ts codeBlock_TAPP thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">type</span><span class="token plain"> </span><span class="token class-name maybe-class-name">StopMode</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;stop-dependents-first&#x27;</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;force-stop&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">interface</span><span class="token plain"> </span><span class="token class-name maybe-class-name">StopDependentsDialogProps</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  open</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">boolean</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token function-variable function" style="color:rgb(80, 250, 123)">onOpenChange</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">open</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">boolean</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">void</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  instanceName</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  featureId</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  dependents</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">ServiceDependency</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain">   </span><span class="token comment" style="color:rgb(98, 114, 164)">// from useServiceDependencies()</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token function-variable function" style="color:rgb(80, 250, 123)">onConfirm</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">mode</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">StopMode</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">void</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  isLoading</span><span class="token operator">?</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">boolean</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre></div></div>
<p>The dialog presents two options with RadioGroup:</p>
<ol>
<li class=""><strong>Stop dependents first</strong> (recommended): Gracefully stops dependent services in reverse dependency order before stopping the target instance</li>
<li class=""><strong>Force stop</strong> (dangerous): Immediately stops the instance; dependent services will receive <code>FAILED</code> status</li>
</ol>
<p>Each dependent is shown with:</p>
<ul>
<li class=""><code>StatusBadge</code> for current status</li>
<li class="">Instance name and feature ID (monospace)</li>
<li class="">Dependency type badge: <code>REQUIRES</code> (red) or <code>OPTIONAL</code> (warning/amber)</li>
</ul>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_SAay" id="service-alerts">Service Alerts<a href="#service-alerts" class="hash-link" aria-label="Direct link to Service Alerts" title="Direct link to Service Alerts" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_SAay" id="servicealertstab"><code>ServiceAlertsTab</code><a href="#servicealertstab" class="hash-link" aria-label="Direct link to servicealertstab" title="Direct link to servicealertstab" translate="no">​</a></h3>
<p><strong>File:</strong> <code>libs/features/services/src/components/ServiceAlertsTab.tsx</code></p>
<p>Platform-aware wrapper for service instance alert management. Routes to <code>ServiceAlertsTabDesktop</code> or <code>ServiceAlertsTabMobile</code> based on <code>usePlatform()</code>.</p>
<h3 class="anchor anchorTargetStickyNavbar_SAay" id="useservicealertstab-hook"><code>useServiceAlertsTab</code> Hook<a href="#useservicealertstab-hook" class="hash-link" aria-label="Direct link to useservicealertstab-hook" title="Direct link to useservicealertstab-hook" translate="no">​</a></h3>
<p><strong>File:</strong> <code>libs/features/services/src/hooks/useServiceAlertsTab.ts</code></p>
<p>Complete headless hook for the alerts tab. Manages alert querying, real-time subscription, client-side search filtering, server-side severity/ack filtering, cursor-based pagination, multi-select, and bulk acknowledge.</p>
<div class="language-ts codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_kX1v"><pre tabindex="0" class="prism-code language-ts codeBlock_TAPP thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> tabState </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">useServiceAlertsTab</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  routerId</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;router-1&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  instanceId</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;instance-123&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  initialPageSize</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">25</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  enableSubscription</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// tabState.alerts              - ServiceAlert[] (raw from GraphQL)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// tabState.filteredAlerts      - ServiceAlert[] (after client-side searchTerm filter)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// tabState.loading             - boolean</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// tabState.acknowledging       - boolean</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// tabState.error               - Error | undefined</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// tabState.filters             - { severity?, acknowledged?, searchTerm? }</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// tabState.setFilters          - (partial) =&gt; void</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// tabState.clearFilters        - () =&gt; void</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// tabState.pagination          - { currentPage, pageSize, totalCount, totalPages }</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// tabState.goToPage            - (page) =&gt; void</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// tabState.nextPage / prevPage - () =&gt; void</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// tabState.setPageSize         - (size) =&gt; void</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// tabState.selectedAlertIds    - Set&lt;string&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// tabState.toggleSelect        - (id) =&gt; void</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// tabState.selectAll           - () =&gt; void</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// tabState.clearSelection      - () =&gt; void</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// tabState.hasSelection        - boolean</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// tabState.acknowledgeAlert    - (id) =&gt; Promise&lt;void&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// tabState.acknowledgeBulk     - () =&gt; Promise&lt;void&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// tabState.refetch             - () =&gt; void</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// tabState.stats               - { total, critical, warning, info, unacknowledged }</span><br></span></code></pre></div></div>
<p>The hook layers two levels of filtering:</p>
<ul>
<li class=""><strong>Server-side</strong>: <code>severity</code> and <code>acknowledged</code> are sent as GraphQL query variables, reducing payload size</li>
<li class=""><strong>Client-side</strong>: <code>searchTerm</code> is applied to <code>alert.title</code>, <code>alert.message</code>, and <code>alert.eventType</code> after data arrives</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_SAay" id="useservicealerttoasts-hook"><code>useServiceAlertToasts</code> Hook<a href="#useservicealerttoasts-hook" class="hash-link" aria-label="Direct link to useservicealerttoasts-hook" title="Direct link to useservicealerttoasts-hook" translate="no">​</a></h3>
<p><strong>File:</strong> <code>libs/features/services/src/hooks/useServiceAlertToasts.ts</code></p>
<p>Subscribes to real-time alert events and displays toast notifications for new alerts. Used in the main app shell to provide ambient notifications regardless of which page is active.</p>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_SAay" id="diagnostics">Diagnostics<a href="#diagnostics" class="hash-link" aria-label="Direct link to Diagnostics" title="Direct link to Diagnostics" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_SAay" id="diagnosticspanel"><code>DiagnosticsPanel</code><a href="#diagnosticspanel" class="hash-link" aria-label="Direct link to diagnosticspanel" title="Direct link to diagnosticspanel" translate="no">​</a></h3>
<p><strong>File:</strong> <code>libs/features/services/src/components/DiagnosticsPanel/DiagnosticsPanel.tsx</code></p>
<p>Displays diagnostic test history with pass/fail indicators and a manual &quot;Run Diagnostics&quot; button. Auto-scrolls to the latest result. Features:</p>
<ul>
<li class="">Shows startup failure alerts when an instance enters the <code>FAILED</code> state</li>
<li class="">Displays historical diagnostic runs (limited by <code>maxHistory</code> prop)</li>
<li class="">Real-time progress tracking during a manual diagnostic run</li>
<li class="">Expandable per-test details showing individual check results</li>
<li class="">Tablet/Desktop: dense collapsible layout; Mobile: 44px touch-friendly accordion</li>
</ul>
<div class="language-tsx codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_kX1v"><pre tabindex="0" class="prism-code language-tsx codeBlock_TAPP thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#F8F8F2"><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag class-name" style="color:rgb(255, 121, 198)">DiagnosticsPanel</span><span class="token tag" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token tag" style="color:rgb(255, 121, 198)">  </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">routerId</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:rgb(248, 248, 242)">=</span><span class="token tag script language-javascript punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token tag script language-javascript" style="color:rgb(255, 121, 198)">routerId</span><span class="token tag script language-javascript punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token tag" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token tag" style="color:rgb(255, 121, 198)">  </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">instanceId</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:rgb(248, 248, 242)">=</span><span class="token tag script language-javascript punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token tag script language-javascript" style="color:rgb(255, 121, 198)">instanceId</span><span class="token tag script language-javascript punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token tag" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token tag" style="color:rgb(255, 121, 198)">  </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">serviceName</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">tor</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag" style="color:rgb(255, 121, 198)">     </span><span class="token tag comment" style="color:rgb(98, 114, 164)">// used for display</span><span class="token tag" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token tag" style="color:rgb(255, 121, 198)">  </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">maxHistory</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:rgb(248, 248, 242)">=</span><span class="token tag script language-javascript punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token tag script language-javascript number" style="color:rgb(255, 121, 198)">10</span><span class="token tag script language-javascript punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token tag" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token tag" style="color:rgb(255, 121, 198)">  </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">onDiagnosticsComplete</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:rgb(248, 248, 242)">=</span><span class="token tag script language-javascript punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token tag script language-javascript punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token tag script language-javascript" style="color:rgb(255, 121, 198)">results</span><span class="token tag script language-javascript punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token tag script language-javascript" style="color:rgb(255, 121, 198)"> </span><span class="token tag script language-javascript arrow operator" style="color:rgb(255, 121, 198)">=&gt;</span><span class="token tag script language-javascript" style="color:rgb(255, 121, 198)"> </span><span class="token tag script language-javascript punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token tag script language-javascript" style="color:rgb(255, 121, 198)"> </span><span class="token tag script language-javascript comment" style="color:rgb(98, 114, 164)">/* results */</span><span class="token tag script language-javascript" style="color:rgb(255, 121, 198)"> </span><span class="token tag script language-javascript punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token tag script language-javascript punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token tag" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token tag" style="color:rgb(255, 121, 198)"></span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">/&gt;</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_SAay" id="zustand-store-useserviceuistore">Zustand Store: <code>useServiceUIStore</code><a href="#zustand-store-useserviceuistore" class="hash-link" aria-label="Direct link to zustand-store-useserviceuistore" title="Direct link to zustand-store-useserviceuistore" translate="no">​</a></h2>
<p><strong>File:</strong> <code>libs/state/stores/src/service-ui.store.ts</code></p>
<p>Manages all transient UI state for the services feature. Uses <code>zustand/middleware/persist</code> to selectively persist preferences to <code>localStorage</code>.</p>
<h3 class="anchor anchorTargetStickyNavbar_SAay" id="persisted-state">Persisted State<a href="#persisted-state" class="hash-link" aria-label="Direct link to Persisted State" title="Direct link to Persisted State" translate="no">​</a></h3>
<table><thead><tr><th>Field</th><th>Type</th><th>Purpose</th></tr></thead><tbody><tr><td><code>wizardDraft</code></td><td><code>ServiceInstallWizardDraft | null</code></td><td>Recovers in-progress wizard on page refresh</td></tr><tr><td><code>viewMode</code></td><td><code>&#x27;grid&#x27; | &#x27;list&#x27;</code></td><td>User&#x27;s preferred instance list layout</td></tr><tr><td><code>showResourceMetrics</code></td><td><code>boolean</code></td><td>Whether resource gauges are visible</td></tr><tr><td><code>showAdvancedConfig</code></td><td><code>boolean</code></td><td>Whether advanced config sections are expanded</td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_SAay" id="non-persisted-state">Non-Persisted State<a href="#non-persisted-state" class="hash-link" aria-label="Direct link to Non-Persisted State" title="Direct link to Non-Persisted State" translate="no">​</a></h3>
<table><thead><tr><th>Field</th><th>Type</th><th>Purpose</th></tr></thead><tbody><tr><td><code>serviceSearch</code></td><td><code>string</code></td><td>Current search query in instance list</td></tr><tr><td><code>categoryFilter</code></td><td><code>ServiceCategory</code></td><td>Active category filter</td></tr><tr><td><code>statusFilter</code></td><td><code>ServiceStatusFilter</code></td><td>Active status filter</td></tr><tr><td><code>selectedServices</code></td><td><code>string[]</code></td><td>IDs of currently selected instances for bulk ops</td></tr><tr><td><code>wizardStep</code></td><td><code>number</code></td><td>Current install wizard step</td></tr><tr><td><code>updateInProgress</code></td><td><code>Record&lt;string, boolean&gt;</code></td><td>Per-instance update loading state</td></tr><tr><td><code>updateStage</code></td><td><code>Record&lt;string, UpdateStage&gt;</code></td><td>Per-instance update stage</td></tr><tr><td><code>showUpdateAll</code></td><td><code>boolean</code></td><td>Whether the update-all panel is expanded</td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_SAay" id="selector-hooks-for-optimized-subscription">Selector Hooks (for optimized subscription)<a href="#selector-hooks-for-optimized-subscription" class="hash-link" aria-label="Direct link to Selector Hooks (for optimized subscription)" title="Direct link to Selector Hooks (for optimized subscription)" translate="no">​</a></h3>
<div class="language-ts codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_kX1v"><pre tabindex="0" class="prism-code language-ts codeBlock_TAPP thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#F8F8F2"><span class="token keyword module" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  useServiceSearch</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  useCategoryFilter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  useStatusFilter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  useSelectedServices</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  useServiceWizardDraft</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  useWizardStep</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  useServiceViewMode</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  useShowResourceMetrics</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  useShowAdvancedConfig</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  useUpdateInProgress</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">   </span><span class="token comment" style="color:rgb(98, 114, 164)">// (instanceId: string) =&gt; boolean</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  useUpdateStage</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)">// (instanceId: string) =&gt; UpdateStage | undefined</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  useShowUpdateAll</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token keyword module" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;@nasnet/state/stores&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre></div></div>
<p>Each selector subscribes only to the relevant slice, preventing unnecessary re-renders.</p>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_SAay" id="key-hooks-summary">Key Hooks Summary<a href="#key-hooks-summary" class="hash-link" aria-label="Direct link to Key Hooks Summary" title="Direct link to Key Hooks Summary" translate="no">​</a></h2>
<table><thead><tr><th>Hook</th><th>File</th><th>Purpose</th></tr></thead><tbody><tr><td><code>useServiceConfigForm</code></td><td><code>hooks/useServiceConfigForm.ts</code></td><td>Schema fetch, Zod build, RHF integration, two-phase validation, apply mutation</td></tr><tr><td><code>useServiceAlertsTab</code></td><td><code>hooks/useServiceAlertsTab.ts</code></td><td>Alert list with filtering, pagination, multi-select, acknowledge</td></tr><tr><td><code>useServiceAlertToasts</code></td><td><code>hooks/useServiceAlertToasts.ts</code></td><td>Real-time toast notifications for new alerts</td></tr><tr><td><code>useTemplatesBrowser</code></td><td><code>components/templates/useTemplatesBrowser.ts</code></td><td>Filter/sort state + <code>useServiceTemplates</code> query</td></tr><tr><td><code>useTemplateInstallWizard</code></td><td><code>components/templates/useTemplateInstallWizard.ts</code></td><td>XState machine + install mutation + progress subscription</td></tr><tr><td><code>useServiceTrafficPanel</code></td><td><code>components/service-traffic/use-service-traffic-panel.ts</code></td><td>Traffic stats + BigInt rate calculation + quota metrics</td></tr><tr><td><code>useStorageSettings</code></td><td><code>components/storage/useStorageSettings.ts</code></td><td>External storage config + status query</td></tr><tr><td><code>useServiceLogViewer</code></td><td><code>components/ServiceLogViewer/useServiceLogViewer.ts</code></td><td>Log streaming + filter state + auto-scroll</td></tr><tr><td><code>useDiagnosticsPanel</code></td><td><code>components/DiagnosticsPanel/useDiagnosticsPanel.ts</code></td><td>Diagnostic history + run trigger + progress</td></tr></tbody></table>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_SAay" id="xstate-machines">XState Machines<a href="#xstate-machines" class="hash-link" aria-label="Direct link to XState Machines" title="Direct link to XState Machines" translate="no">​</a></h2>
<p>Cross-reference: see <code>libs/features/docs/xstate-machines.md</code> for full XState documentation.</p>
<table><thead><tr><th>Machine</th><th>File</th><th>States</th><th>Purpose</th></tr></thead><tbody><tr><td><code>templateInstallMachine</code></td><td><code>components/templates/templateInstallMachine.ts</code></td><td>variables, review, installing, routing, completed, cancelled, failed</td><td>Drives the 4-step template installation wizard</td></tr><tr><td><code>updateMachine</code></td><td><code>machines/update-machine.ts</code></td><td>idle, updating, complete, rolledBack, failed</td><td>Tracks a single service update lifecycle with rollback detection</td></tr></tbody></table>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_SAay" id="zod-schemas-summary">Zod Schemas Summary<a href="#zod-schemas-summary" class="hash-link" aria-label="Direct link to Zod Schemas Summary" title="Direct link to Zod Schemas Summary" translate="no">​</a></h2>
<table><thead><tr><th>Schema</th><th>File</th><th>Purpose</th></tr></thead><tbody><tr><td><code>exportServiceSchema</code></td><td><code>schemas/service-sharing.schema.ts</code></td><td>Validates export configuration (redact flags, routing inclusion)</td></tr><tr><td><code>generateQRSchema</code></td><td><code>schemas/service-sharing.schema.ts</code></td><td>Validates QR code generation parameters</td></tr><tr><td><code>importPackageSchema</code></td><td><code>schemas/service-sharing.schema.ts</code></td><td>Validates the structure of an imported service JSON package</td></tr><tr><td><code>importServiceSchema</code></td><td><code>schemas/service-sharing.schema.ts</code></td><td>Full import request including conflict resolution and redacted values</td></tr><tr><td><code>redactedFieldValuesSchema</code></td><td><code>schemas/service-sharing.schema.ts</code></td><td>Validates user-entered values for redacted secrets</td></tr><tr><td><code>vlanPoolConfigSchema</code></td><td><code>components/VLANPoolConfig.tsx</code></td><td>VLAN range validation with cross-field refinement</td></tr><tr><td>Dynamic config schemas</td><td><code>utils/zodSchemaBuilder.ts</code></td><td>Built at runtime from backend <code>ConfigSchema</code> for each service type</td></tr><tr><td>Variable schemas</td><td><code>components/templates/wizard-steps/VariablesStep.tsx</code></td><td>Built at runtime from <code>template.configVariables</code></td></tr></tbody></table>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_SAay" id="public-api-srcindexts">Public API (<code>src/index.ts</code>)<a href="#public-api-srcindexts" class="hash-link" aria-label="Direct link to public-api-srcindexts" title="Direct link to public-api-srcindexts" translate="no">​</a></h2>
<p>The module exports are organized into these groups:</p>
<ul>
<li class=""><strong>Pages</strong>: <code>ServicesPage</code>, <code>ServiceDetailPage</code>, <code>VLANSettingsPage</code>, <code>DeviceRoutingPage</code></li>
<li class=""><strong>Install Components</strong>: <code>InstallDialog</code></li>
<li class=""><strong>Port &amp; Gateway</strong>: <code>PortRegistryView</code>, <code>PortRegistryViewDesktop</code>, <code>PortRegistryViewMobile</code>, <code>GatewayStatusCard</code>, <code>GatewayStatusCardDesktop</code>, <code>GatewayStatusCardMobile</code></li>
<li class=""><strong>Instance Management</strong>: <code>VLANPoolConfig</code>, <code>StopDependentsDialog</code>, <code>UpdateAllPanel</code>, <code>ChangelogModal</code>, <code>ResourceLimitsForm</code></li>
<li class=""><strong>Storage Sub-module</strong>: <code>StorageSettings</code>, <code>StorageSettingsDesktop</code>, <code>StorageSettingsMobile</code>, <code>StorageDisconnectBanner</code>, <code>StorageUsageBar</code></li>
<li class=""><strong>Logs &amp; Diagnostics</strong>: <code>ServiceLogViewer</code>, <code>DiagnosticsPanel</code></li>
<li class=""><strong>Alerts</strong>: <code>ServiceAlertsTab</code>, <code>ServiceAlertsTabDesktop</code>, <code>ServiceAlertsTabMobile</code>, <code>useServiceAlertsTab</code>, <code>useServiceAlertToasts</code></li>
<li class=""><strong>Traffic</strong>: <code>ServiceTrafficPanel</code>, <code>ServiceTrafficPanelDesktop</code>, <code>ServiceTrafficPanelMobile</code>, <code>useServiceTrafficPanel</code>, <code>QuotaSettingsForm</code></li>
<li class=""><strong>Config Utilities</strong>: <code>buildZodSchema</code>, <code>evaluateCondition</code></li>
<li class=""><strong>Config Hooks</strong>: <code>useServiceConfigForm</code></li>
<li class=""><strong>Config Components</strong>: <code>ServiceConfigForm</code>, <code>ServiceConfigFormMobile</code>, <code>ServiceConfigFormDesktop</code>, <code>DynamicField</code></li>
<li class=""><strong>Template Components</strong>: <code>TemplatesBrowser</code>, <code>TemplatesBrowserMobile</code>, <code>TemplatesBrowserDesktop</code>, <code>TemplateFilters</code>, <code>TemplateInstallWizard</code>, <code>TemplateInstallWizardMobile</code>, <code>TemplateInstallWizardDesktop</code>, <code>useTemplatesBrowser</code>, <code>useTemplateInstallWizard</code></li>
<li class=""><strong>Wizard Steps</strong>: <code>VariablesStep</code>, <code>ReviewStep</code>, <code>InstallingStep</code>, <code>RoutingStep</code></li>
</ul>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_SAay" id="design-patterns">Design Patterns<a href="#design-patterns" class="hash-link" aria-label="Direct link to Design Patterns" title="Direct link to Design Patterns" translate="no">​</a></h2>
<p>All components in this module adhere to the project-wide architectural patterns:</p>
<ol>
<li class="">
<p><strong>Headless + Platform Presenters</strong>: Every significant component has a headless hook that owns business logic and separate Mobile/Desktop presenters that own rendering. The platform wrapper uses <code>usePlatform()</code> to select the presenter.</p>
</li>
<li class="">
<p><strong>React.memo</strong>: All presenters are wrapped in <code>React.memo()</code> to prevent unnecessary re-renders. Display names are always set for React DevTools.</p>
</li>
<li class="">
<p><strong>XState for complex flows</strong>: Multi-step workflows (template install, service update) use XState machines to make state transitions explicit, auditable, and testable.</p>
</li>
<li class="">
<p><strong>Apollo Client for server state</strong>: All router data (instances, traffic, alerts, templates) comes from GraphQL queries and subscriptions. No manual cache manipulation; subscription updates flow through Apollo&#x27;s normalized cache automatically.</p>
</li>
<li class="">
<p><strong>Zustand for UI state</strong>: Ephemeral UI preferences (view mode, filters, selections) and wizard drafts live in <code>useServiceUIStore</code>. Only preferences that should survive page refresh are persisted.</p>
</li>
<li class="">
<p><strong>Zod for validation</strong>: Both static (sharing schemas) and dynamic (config forms, template variables) validation uses Zod. Dynamic schemas are built at runtime from backend GraphQL types.</p>
</li>
<li class="">
<p><strong>WCAG AAA Accessibility</strong>: All interactive elements have 44px minimum touch targets, <code>aria-label</code> attributes, and <code>role</code> attributes. Error states use <code>role=&quot;alert&quot;</code> with <code>aria-live=&quot;polite&quot;</code>. Progress indicators use <code>aria-valuenow</code>, <code>aria-valuemin</code>, <code>aria-valuemax</code>.</p>
</li>
</ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_HJkF"><a href="https://github.com/nasnet-community/nasnet-panel/tree/main/../../libs/features/docs/feature-services.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_UohW" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_g62E"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/features/feature-network"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Feature: Network (libs/features/network)</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/features/feature-vpn"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">VPN Feature Module Documentation</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_TN1Q thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a><ul><li><a href="#supported-services-feature-ids" class="table-of-contents__link toc-highlight">Supported Services (Feature IDs)</a></li><li><a href="#core-concepts" class="table-of-contents__link toc-highlight">Core Concepts</a></li></ul></li><li><a href="#directory-tree" class="table-of-contents__link toc-highlight">Directory Tree</a></li><li><a href="#pages" class="table-of-contents__link toc-highlight">Pages</a><ul><li><a href="#servicespage" class="table-of-contents__link toc-highlight"><code>ServicesPage</code></a></li><li><a href="#servicedetailpage" class="table-of-contents__link toc-highlight"><code>ServiceDetailPage</code></a></li><li><a href="#deviceroutingpage" class="table-of-contents__link toc-highlight"><code>DeviceRoutingPage</code></a></li><li><a href="#vlansettingspage" class="table-of-contents__link toc-highlight"><code>VLANSettingsPage</code></a></li></ul></li><li><a href="#components" class="table-of-contents__link toc-highlight">Components</a><ul><li><a href="#components-table" class="table-of-contents__link toc-highlight">Components Table</a></li></ul></li><li><a href="#service-install-flow" class="table-of-contents__link toc-highlight">Service Install Flow</a><ul><li><a href="#direct-install-installdialog" class="table-of-contents__link toc-highlight">Direct Install (<code>InstallDialog</code>)</a></li><li><a href="#template-install-flow-templateinstallwizard" class="table-of-contents__link toc-highlight">Template Install Flow (<code>TemplateInstallWizard</code>)</a></li></ul></li><li><a href="#templates-browser" class="table-of-contents__link toc-highlight">Templates Browser</a><ul><li><a href="#templatesbrowser" class="table-of-contents__link toc-highlight"><code>TemplatesBrowser</code></a></li><li><a href="#usetemplatesbrowser-hook" class="table-of-contents__link toc-highlight"><code>useTemplatesBrowser</code> Hook</a></li></ul></li><li><a href="#dynamic-configuration-forms" class="table-of-contents__link toc-highlight">Dynamic Configuration Forms</a><ul><li><a href="#architecture" class="table-of-contents__link toc-highlight">Architecture</a></li><li><a href="#useserviceconfigform-hook" class="table-of-contents__link toc-highlight"><code>useServiceConfigForm</code> Hook</a></li><li><a href="#buildzodschema-utility" class="table-of-contents__link toc-highlight"><code>buildZodSchema</code> Utility</a></li><li><a href="#dynamicfield-component" class="table-of-contents__link toc-highlight"><code>DynamicField</code> Component</a></li><li><a href="#platform-presenters-for-serviceconfigform" class="table-of-contents__link toc-highlight">Platform Presenters for <code>ServiceConfigForm</code></a></li></ul></li><li><a href="#service-updates" class="table-of-contents__link toc-highlight">Service Updates</a><ul><li><a href="#update-check-flow" class="table-of-contents__link toc-highlight">Update Check Flow</a></li><li><a href="#updateallpanel" class="table-of-contents__link toc-highlight"><code>UpdateAllPanel</code></a></li><li><a href="#updatemachine-xstate" class="table-of-contents__link toc-highlight"><code>updateMachine</code> (XState)</a></li></ul></li><li><a href="#vlan-pool" class="table-of-contents__link toc-highlight">VLAN Pool</a><ul><li><a href="#vlanpoolconfig-component" class="table-of-contents__link toc-highlight"><code>VLANPoolConfig</code> Component</a></li><li><a href="#vlansettingspage-vlan-allocation-table" class="table-of-contents__link toc-highlight"><code>VLANSettingsPage</code> VLAN Allocation Table</a></li></ul></li><li><a href="#kill-switch" class="table-of-contents__link toc-highlight">Kill Switch</a><ul><li><a href="#integration-points" class="table-of-contents__link toc-highlight">Integration Points</a></li></ul></li><li><a href="#device-routing" class="table-of-contents__link toc-highlight">Device Routing</a><ul><li><a href="#deviceroutingmatrix-pattern" class="table-of-contents__link toc-highlight"><code>DeviceRoutingMatrix</code> Pattern</a></li><li><a href="#routingchainviz-pattern" class="table-of-contents__link toc-highlight"><code>RoutingChainViz</code> Pattern</a></li></ul></li><li><a href="#traffic-and-quota" class="table-of-contents__link toc-highlight">Traffic and Quota</a><ul><li><a href="#servicetrafficpanel" class="table-of-contents__link toc-highlight"><code>ServiceTrafficPanel</code></a></li><li><a href="#useservicetrafficpanel-hook" class="table-of-contents__link toc-highlight"><code>useServiceTrafficPanel</code> Hook</a></li><li><a href="#quotasettingsform" class="table-of-contents__link toc-highlight"><code>QuotaSettingsForm</code></a></li></ul></li><li><a href="#storage-management" class="table-of-contents__link toc-highlight">Storage Management</a><ul><li><a href="#storagesettings" class="table-of-contents__link toc-highlight"><code>StorageSettings</code></a></li></ul></li><li><a href="#service-sharing-importexport" class="table-of-contents__link toc-highlight">Service Sharing (Import/Export)</a><ul><li><a href="#export-flow" class="table-of-contents__link toc-highlight">Export Flow</a></li><li><a href="#import-flow" class="table-of-contents__link toc-highlight">Import Flow</a></li></ul></li><li><a href="#service-dependencies" class="table-of-contents__link toc-highlight">Service Dependencies</a><ul><li><a href="#stopdependentsdialog" class="table-of-contents__link toc-highlight"><code>StopDependentsDialog</code></a></li></ul></li><li><a href="#service-alerts" class="table-of-contents__link toc-highlight">Service Alerts</a><ul><li><a href="#servicealertstab" class="table-of-contents__link toc-highlight"><code>ServiceAlertsTab</code></a></li><li><a href="#useservicealertstab-hook" class="table-of-contents__link toc-highlight"><code>useServiceAlertsTab</code> Hook</a></li><li><a href="#useservicealerttoasts-hook" class="table-of-contents__link toc-highlight"><code>useServiceAlertToasts</code> Hook</a></li></ul></li><li><a href="#diagnostics" class="table-of-contents__link toc-highlight">Diagnostics</a><ul><li><a href="#diagnosticspanel" class="table-of-contents__link toc-highlight"><code>DiagnosticsPanel</code></a></li></ul></li><li><a href="#zustand-store-useserviceuistore" class="table-of-contents__link toc-highlight">Zustand Store: <code>useServiceUIStore</code></a><ul><li><a href="#persisted-state" class="table-of-contents__link toc-highlight">Persisted State</a></li><li><a href="#non-persisted-state" class="table-of-contents__link toc-highlight">Non-Persisted State</a></li><li><a href="#selector-hooks-for-optimized-subscription" class="table-of-contents__link toc-highlight">Selector Hooks (for optimized subscription)</a></li></ul></li><li><a href="#key-hooks-summary" class="table-of-contents__link toc-highlight">Key Hooks Summary</a></li><li><a href="#xstate-machines" class="table-of-contents__link toc-highlight">XState Machines</a></li><li><a href="#zod-schemas-summary" class="table-of-contents__link toc-highlight">Zod Schemas Summary</a></li><li><a href="#public-api-srcindexts" class="table-of-contents__link toc-highlight">Public API (<code>src/index.ts</code>)</a></li><li><a href="#design-patterns" class="table-of-contents__link toc-highlight">Design Patterns</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Apps</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/frontend/intro">Frontend</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/backend/intro">Backend</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/testing/intro">E2E Testing</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Libraries</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/ui/intro">UI Components</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/features/intro">Feature Modules</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/api-client/intro">API Client</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/state/intro">State Management</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/core/intro">Core Types</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">API</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/api">Schema Overview</a></li><li class="footer__item"><a class="footer__link-item" href="/category/queries">Queries</a></li><li class="footer__item"><a class="footer__link-item" href="/category/mutations">Mutations</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/nasnet-community/nasnet-panel" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_awgD"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/storybook/primitives/">Storybook (Primitives)</a></li><li class="footer__item"><a class="footer__link-item" href="/storybook/patterns/">Storybook (Patterns)</a></li><li class="footer__item"><a class="footer__link-item" href="/nx-graph/">Nx Graph</a></li><li class="footer__item"><a href="https://github.com/nasnet-community/nasnet-panel/tree/main/Docs/architecture" target="_blank" rel="noopener noreferrer" class="footer__link-item">Architecture<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_awgD"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">© 2026 NasNet · Built with Docusaurus</div></div></div></footer></div>
</body>
</html>