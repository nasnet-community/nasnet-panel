<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-features docs-version-current docs-doc-page docs-doc-id-feature-firewall" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Feature Module: Firewall (libs/features/firewall) | NasNet Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://nasnet.dev/docs/features/feature-firewall"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-features-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-features-current"><meta data-rh="true" property="og:title" content="Feature Module: Firewall (libs/features/firewall) | NasNet Docs"><meta data-rh="true" name="description" content="1. Overview"><meta data-rh="true" property="og:description" content="1. Overview"><link data-rh="true" rel="icon" href="/img/favicon.svg"><link data-rh="true" rel="canonical" href="https://nasnet.dev/docs/features/feature-firewall"><link data-rh="true" rel="alternate" href="https://nasnet.dev/docs/features/feature-firewall" hreflang="en"><link data-rh="true" rel="alternate" href="https://nasnet.dev/docs/features/feature-firewall" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Feature Module: Firewall (libs/features/firewall)","item":"https://nasnet.dev/docs/features/feature-firewall"}]}</script><link rel="stylesheet" href="/assets/css/styles.82d9e831.css">
<script src="/assets/js/runtime~main.ca82720f.js" defer="defer"></script>
<script src="/assets/js/main.ffff147f.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_G6ar" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/hero-logo.jpg" alt="NasNet Logo" class="themedComponent_DHUr themedComponent--light_DIHH" style="border-radius:6px"><img src="/img/hero-logo.jpg" alt="NasNet Logo" class="themedComponent_DHUr themedComponent--dark_Bv2M" style="border-radius:6px"></div><b class="navbar__title text--truncate">NasNet Docs</b></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Apps</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/frontend/intro">Frontend (Connect)</a></li><li><a class="dropdown__link" href="/docs/backend/intro">Backend (Go)</a></li><li><a class="dropdown__link" href="/docs/testing/intro">E2E Testing</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Libraries</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/ui/intro">UI Components</a></li><li><a class="dropdown__link" href="/docs/features/intro">Feature Modules</a></li><li><a class="dropdown__link" href="/docs/api-client/intro">API Client</a></li><li><a class="dropdown__link" href="/docs/state/intro">State Management</a></li><li><a class="dropdown__link" href="/docs/core/intro">Core Types</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Components</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/storybook/primitives/">UI Primitives</a></li><li><a class="dropdown__link" href="/storybook/patterns/">UI Patterns</a></li><li><a class="dropdown__link" href="/storybook/connect/">Connect App</a></li></ul></div><a class="navbar__item navbar__link" href="/api">API Reference</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/nasnet-community/nasnet-panel/releases" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Changelog<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_awgD"><use href="#theme-svg-external-link"></use></svg></a><a class="navbar__item navbar__link" href="/nx-graph/">Nx Graph</a><a href="https://github.com/nasnet-community/nasnet-panel" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link" aria-label="GitHub repository">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_awgD"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_OLSw colorModeToggle_Hg9V"><button class="clean-btn toggleButton_wYmb toggleButtonDisabled_vaDU" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_KEbZ lightToggleIcon_Sxwe"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_KEbZ darkToggleIcon_Yem1"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_KEbZ systemToggleIcon_txm5"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_bmvg"><div class="navbar__search searchBarContainer_YZIh" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input searchInput_eCKk" value=""><div class="loadingRing_pJhT searchBarLoadingRing_NsvA"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_UyTV"><div class="docsWrapper_XLvK"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_z1FD" type="button"></button><div class="docRoot_HciC"><aside class="theme-doc-sidebar-container docSidebarContainer_e5ai"><div class="sidebarViewport_N8x0"><div class="sidebar_vJCc"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_qiME"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/features/intro"><span title="Introduction" class="linkLabel_PuAu">Introduction</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/features/api-client-and-graphql"><span title="API Client and GraphQL" class="linkLabel_PuAu">API Client and GraphQL</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/features/architecture-overview"><span title="Architecture Overview" class="linkLabel_PuAu">Architecture Overview</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/features/cross-cutting-flows"><span title="Cross-Cutting Flows" class="linkLabel_PuAu">Cross-Cutting Flows</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/features/error-handling"><span title="Error Handling Architecture" class="linkLabel_PuAu">Error Handling Architecture</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/features/feature-alerts"><span title="Feature Module: Alerts (libs/features/alerts)" class="linkLabel_PuAu">Feature Module: Alerts (libs/features/alerts)</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/features/feature-dashboard"><span title="Feature: Dashboard (libs/features/dashboard)" class="linkLabel_PuAu">Feature: Dashboard (libs/features/dashboard)</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/features/feature-diagnostics"><span title="Feature: Diagnostics (libs/features/diagnostics)" class="linkLabel_PuAu">Feature: Diagnostics (libs/features/diagnostics)</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/features/feature-firewall"><span title="Feature Module: Firewall (libs/features/firewall)" class="linkLabel_PuAu">Feature Module: Firewall (libs/features/firewall)</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/features/feature-logs"><span title="Feature: Logs (libs/features/logs)" class="linkLabel_PuAu">Feature: Logs (libs/features/logs)</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/features/feature-minor"><span title="Feature: Wireless, Router Discovery, and Configuration Import" class="linkLabel_PuAu">Feature: Wireless, Router Discovery, and Configuration Import</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/features/feature-network"><span title="Feature: Network (libs/features/network)" class="linkLabel_PuAu">Feature: Network (libs/features/network)</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/features/feature-services"><span title="Feature Services Module (libs/features/services)" class="linkLabel_PuAu">Feature Services Module (libs/features/services)</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/features/feature-vpn"><span title="VPN Feature Module Documentation" class="linkLabel_PuAu">VPN Feature Module Documentation</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/features/"><span title="Feature Library Documentation" class="linkLabel_PuAu">Feature Library Documentation</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/features/routing-and-navigation"><span title="Routing and Navigation Architecture" class="linkLabel_PuAu">Routing and Navigation Architecture</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/features/state-management"><span title="State Management Guide" class="linkLabel_PuAu">State Management Guide</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/features/testing-and-storybook"><span title="Testing and Storybook" class="linkLabel_PuAu">Testing and Storybook</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/features/xstate-machines"><span title="XState Machines Reference" class="linkLabel_PuAu">XState Machines Reference</span></a></li></ul></nav></div></div></aside><main class="docMainContainer_namt"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_YAwJ"><div class="docItemContainer_Rv5Z"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_zCmv" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_JFrk"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Feature Module: Firewall (libs/features/firewall)</span></li></ul></nav><div class="tocCollapsible_O_Qc theme-doc-toc-mobile tocMobile_tjDr"><button type="button" class="clean-btn tocCollapsibleButton_htYj">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Feature Module: Firewall (<code>libs/features/firewall</code>)</h1></header>
<h2 class="anchor anchorTargetStickyNavbar_SAay" id="1-overview">1. Overview<a href="#1-overview" class="hash-link" aria-label="Direct link to 1. Overview" title="Direct link to 1. Overview" translate="no">​</a></h2>
<p>The <code>@nasnet/features/firewall</code> library is a Layer 3 domain feature module (Epic 0.6: Firewall &amp; Routing Viewer) that provides the complete UI surface for MikroTik firewall management. It covers viewing and editing filter rules, NAT rules, mangle rules, RAW rules, address lists, port knocking sequences, service ports, rate limiting, firewall templates, connection tracking, and firewall logs.</p>
<p>The module is architected around three concerns:</p>
<ol>
<li class=""><strong>Read-only viewing</strong> of existing firewall rules via live GraphQL queries (Phase 0 behaviour, gated by <code>ReadOnlyNotice</code>).</li>
<li class=""><strong>Interactive editing</strong> introduced progressively through the Safety Pipeline — a multi-step XState machine that enforces preview, conflict detection, optional high-risk acknowledgment, apply, and a 5-minute rollback window before changes are committed.</li>
<li class=""><strong>Template management</strong> — a reusable template gallery that lets admins package, import, export, apply, and roll back firewall rule sets as named templates.</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_SAay" id="key-architectural-traits">Key architectural traits<a href="#key-architectural-traits" class="hash-link" aria-label="Direct link to Key architectural traits" title="Direct link to Key architectural traits" translate="no">​</a></h3>
<ul>
<li class="">All data comes from Apollo Client GraphQL queries/mutations; no REST calls.</li>
<li class="">XState v5 (<code>xstate</code>) governs the template apply workflow.</li>
<li class="">React Hook Form + Zod validate all forms; Zod schemas are exported and reused by the backend codegen pipeline.</li>
<li class="">Platform presenters (Desktop / Mobile) separate rendering logic from business logic throughout; the headless pattern from <code>PLATFORM_PRESENTER_GUIDE.md</code> is applied consistently.</li>
<li class="">Custom templates are persisted to the browser&#x27;s IndexedDB via a <code>useCustomTemplates</code> hook.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_SAay" id="public-import-path">Public import path<a href="#public-import-path" class="hash-link" aria-label="Direct link to Public import path" title="Direct link to Public import path" translate="no">​</a></h3>
<div class="language-ts codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_kX1v"><pre tabindex="0" class="prism-code language-ts codeBlock_TAPP thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#F8F8F2"><span class="token keyword module" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">FilterRulesTableDesktop</span><span class="token imports punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token imports"> </span><span class="token imports maybe-class-name">TemplateApplyFlow</span><span class="token imports punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token imports"> </span><span class="token imports maybe-class-name">AddressListView</span><span class="token imports punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token imports"> </span><span class="token imports spread operator">...</span><span class="token imports"> </span><span class="token imports punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token keyword module" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;@nasnet/features/firewall&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_SAay" id="2-directory-tree">2. Directory Tree<a href="#2-directory-tree" class="hash-link" aria-label="Direct link to 2. Directory Tree" title="Direct link to 2. Directory Tree" translate="no">​</a></h2>
<div class="language-text codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_kX1v"><pre tabindex="0" class="prism-code language-text codeBlock_TAPP thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#F8F8F2"><span class="token plain">libs/features/firewall/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">├── src/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   ├── index.ts                         # Public barrel export</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   ├── components/                      # Layer 3 domain components (~43 exports)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   │   ├── index.ts</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   │   ├── FilterRulesTable.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   │   ├── FilterRulesTableDesktop.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   │   ├── FilterRulesTableMobile.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   │   ├── NATRulesTable.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   │   ├── NATRulesTableMobile.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   │   ├── RoutingTable.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   │   ├── ReadOnlyNotice.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   │   ├── ServicesStatus.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   │   ├── ChainSummaryCards.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   │   ├── TrafficFlowDiagram.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   │   ├── RuleSearchFilters.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   │   ├── MangleRulesTable.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   │   ├── MangleRulesTableDesktop.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   │   ├── MangleRulesTableMobile.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   │   ├── RawRulesTable.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   │   ├── RawRulesTableDesktop.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   │   ├── RawRulesTableMobile.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   │   ├── AddressListEntryForm.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   │   ├── AddressListImportDialog.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   │   ├── AddressListExportDialog.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   │   ├── IPAddressDisplay.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   │   ├── AddToAddressListContextMenu.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   │   ├── FirewallStatusHero.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   │   ├── FirewallQuickStats.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   │   ├── RecentFirewallActivity.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   │   ├── FirewallDetailTabs.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   │   ├── ConnectionsPage.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   │   ├── PortForwardWizardDialog.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   │   ├── MasqueradeQuickDialog.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   │   ├── PortKnockingPage.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   │   ├── PortKnockSequenceManager.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   │   ├── PortKnockSequenceManagerDesktop.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   │   ├── PortKnockSequenceManagerMobile.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   │   ├── PortKnockLogViewer.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   │   ├── ServicePortsTable.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   │   ├── ServicePortsTableDesktop.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   │   ├── ServicePortsTableMobile.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   │   ├── AddServiceDialog.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   │   ├── ServiceGroupDialog.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   │   ├── SaveTemplateDialog.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   │   ├── ImportTemplateDialog.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   │   ├── TemplateApplyFlow.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   │   └── UndoFloatingButton.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   ├── pages/                           # Layer 3 page components (8 pages)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   │   ├── index.ts</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   │   ├── AddressListView.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   │   ├── FirewallLogsPage.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   │   ├── ManglePage.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   │   ├── NATRulesPage.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   │   ├── RateLimitingPage.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   │   ├── RawPage.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   │   ├── ServicePortsPage.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   │   └── TemplatesPage.tsx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   ├── machines/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   │   └── template-apply.machine.ts    # XState v5 machine for Safety Pipeline</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   ├── hooks/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   │   ├── useCustomTemplates.ts        # IndexedDB persistence for custom templates</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   │   └── ...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   ├── schemas/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   │   ├── templateSchemas.ts           # Zod schemas + validation helpers</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   │   └── addressListSchemas.ts</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   ├── services/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   │   └── ...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   └── utils/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│       ├── addressListParsers.ts        # CSV/JSON/TXT parser + batch validator</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│       └── template-export.ts</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">├── __test-utils__/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   └── firewall-templates/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│       └── template-fixtures.ts</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">├── package.json</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">└── project.json</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_SAay" id="3-component-catalogue">3. Component Catalogue<a href="#3-component-catalogue" class="hash-link" aria-label="Direct link to 3. Component Catalogue" title="Direct link to 3. Component Catalogue" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_SAay" id="31-filter-rule-components">3.1 Filter Rule Components<a href="#31-filter-rule-components" class="hash-link" aria-label="Direct link to 3.1 Filter Rule Components" title="Direct link to 3.1 Filter Rule Components" translate="no">​</a></h3>
<table><thead><tr><th>Component</th><th>File</th><th>Platform</th><th>Purpose</th></tr></thead><tbody><tr><td><code>FilterRulesTable</code></td><td><code>components/FilterRulesTable.tsx</code></td><td>Shared (dispatcher)</td><td>Auto-selects Desktop or Mobile presenter via <code>usePlatform()</code></td></tr><tr><td><code>FilterRulesTableDesktop</code></td><td><code>components/FilterRulesTableDesktop.tsx</code></td><td>Desktop</td><td>Dense data table with sortable columns, inline enable/disable toggle, row actions</td></tr><tr><td><code>FilterRulesTableMobile</code></td><td><code>components/FilterRulesTableMobile.tsx</code></td><td>Mobile</td><td>Card-list view with 44px touch targets, swipe-to-reveal actions</td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_SAay" id="32-mangle-rule-components">3.2 Mangle Rule Components<a href="#32-mangle-rule-components" class="hash-link" aria-label="Direct link to 3.2 Mangle Rule Components" title="Direct link to 3.2 Mangle Rule Components" translate="no">​</a></h3>
<table><thead><tr><th>Component</th><th>File</th><th>Platform</th><th>Purpose</th></tr></thead><tbody><tr><td><code>MangleRulesTable</code></td><td><code>components/MangleRulesTable.tsx</code></td><td>Shared</td><td>Dispatcher for mangle table</td></tr><tr><td><code>MangleRulesTableDesktop</code></td><td><code>components/MangleRulesTableDesktop.tsx</code></td><td>Desktop</td><td>Table view with packet/byte counters, DSCP marks</td></tr><tr><td><code>MangleRulesTableMobile</code></td><td><code>components/MangleRulesTableMobile.tsx</code></td><td>Mobile</td><td>Card layout for mangle rules</td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_SAay" id="33-raw-rule-components">3.3 RAW Rule Components<a href="#33-raw-rule-components" class="hash-link" aria-label="Direct link to 3.3 RAW Rule Components" title="Direct link to 3.3 RAW Rule Components" translate="no">​</a></h3>
<table><thead><tr><th>Component</th><th>File</th><th>Platform</th><th>Purpose</th></tr></thead><tbody><tr><td><code>RawRulesTable</code></td><td><code>components/RawRulesTable.tsx</code></td><td>Shared</td><td>Dispatcher for RAW table (NAS-7.X)</td></tr><tr><td><code>RawRulesTableDesktop</code></td><td><code>components/RawRulesTableDesktop.tsx</code></td><td>Desktop</td><td>Dense desktop table for pre-connection-tracking rules</td></tr><tr><td><code>RawRulesTableMobile</code></td><td><code>components/RawRulesTableMobile.tsx</code></td><td>Mobile</td><td>Mobile card view for RAW rules</td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_SAay" id="34-nat-components">3.4 NAT Components<a href="#34-nat-components" class="hash-link" aria-label="Direct link to 3.4 NAT Components" title="Direct link to 3.4 NAT Components" translate="no">​</a></h3>
<table><thead><tr><th>Component</th><th>File</th><th>Platform</th><th>Purpose</th></tr></thead><tbody><tr><td><code>NATRulesTable</code></td><td><code>components/NATRulesTable.tsx</code></td><td>Desktop</td><td>Full NAT table with srcnat/dstnat chain tabs</td></tr><tr><td><code>NATRulesTableMobile</code></td><td><code>components/NATRulesTableMobile.tsx</code></td><td>Mobile</td><td>Mobile NAT card list</td></tr><tr><td><code>PortForwardWizardDialog</code></td><td><code>components/PortForwardWizardDialog.tsx</code></td><td>Shared</td><td>Step-by-step wizard for creating port-forward NAT rules</td></tr><tr><td><code>MasqueradeQuickDialog</code></td><td><code>components/MasqueradeQuickDialog.tsx</code></td><td>Shared</td><td>One-click masquerade rule creation dialog</td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_SAay" id="35-address-list-components">3.5 Address List Components<a href="#35-address-list-components" class="hash-link" aria-label="Direct link to 3.5 Address List Components" title="Direct link to 3.5 Address List Components" translate="no">​</a></h3>
<table><thead><tr><th>Component</th><th>File</th><th>Platform</th><th>Purpose</th></tr></thead><tbody><tr><td><code>AddressListEntryForm</code></td><td><code>components/AddressListEntryForm.tsx</code></td><td>Shared</td><td>RHF+Zod form for single address list entry (IP, comment, timeout)</td></tr><tr><td><code>AddressListImportDialog</code></td><td><code>components/AddressListImportDialog.tsx</code></td><td>Shared</td><td>Multi-step bulk import (CSV/JSON/TXT) with drag-and-drop and batch validation</td></tr><tr><td><code>AddressListExportDialog</code></td><td><code>components/AddressListExportDialog.tsx</code></td><td>Shared</td><td>Export address lists to CSV/JSON/TXT with download</td></tr><tr><td><code>IPAddressDisplay</code></td><td><code>components/IPAddressDisplay.tsx</code></td><td>Shared</td><td>Formatted display of IP/CIDR with copy-to-clipboard</td></tr><tr><td><code>AddToAddressListContextMenu</code></td><td><code>components/AddToAddressListContextMenu.tsx</code></td><td>Shared</td><td>Right-click context menu to add an IP to any address list</td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_SAay" id="36-dashboard--status-components">3.6 Dashboard / Status Components<a href="#36-dashboard--status-components" class="hash-link" aria-label="Direct link to 3.6 Dashboard / Status Components" title="Direct link to 3.6 Dashboard / Status Components" translate="no">​</a></h3>
<table><thead><tr><th>Component</th><th>File</th><th>Platform</th><th>Purpose</th></tr></thead><tbody><tr><td><code>FirewallStatusHero</code></td><td><code>components/FirewallStatusHero.tsx</code></td><td>Shared</td><td>Hero banner showing overall firewall status, rule counts, and last-modified time</td></tr><tr><td><code>FirewallQuickStats</code></td><td><code>components/FirewallQuickStats.tsx</code></td><td>Shared</td><td>KPI cards: total rules, active rules, dropped packets (last 5 min), connections</td></tr><tr><td><code>RecentFirewallActivity</code></td><td><code>components/RecentFirewallActivity.tsx</code></td><td>Shared</td><td>Mini log feed of recent drops, accepts, and security events</td></tr><tr><td><code>FirewallDetailTabs</code></td><td><code>components/FirewallDetailTabs.tsx</code></td><td>Shared</td><td>Tabbed navigation across all firewall sub-pages</td></tr><tr><td><code>ChainSummaryCards</code></td><td><code>components/ChainSummaryCards.tsx</code></td><td>Shared</td><td>Per-chain rule count cards (input / forward / output / prerouting / postrouting)</td></tr><tr><td><code>ServicesStatus</code></td><td><code>components/ServicesStatus.tsx</code></td><td>Shared</td><td>Connection-tracking and firewall service health indicators</td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_SAay" id="37-port-knocking-components-nas-712">3.7 Port Knocking Components (NAS-7.12)<a href="#37-port-knocking-components-nas-712" class="hash-link" aria-label="Direct link to 3.7 Port Knocking Components (NAS-7.12)" title="Direct link to 3.7 Port Knocking Components (NAS-7.12)" translate="no">​</a></h3>
<table><thead><tr><th>Component</th><th>File</th><th>Platform</th><th>Purpose</th></tr></thead><tbody><tr><td><code>PortKnockingPage</code></td><td><code>components/PortKnockingPage.tsx</code></td><td>Shared</td><td>Main port-knocking container; composes sequence manager and log viewer</td></tr><tr><td><code>PortKnockSequenceManager</code></td><td><code>components/PortKnockSequenceManager.tsx</code></td><td>Shared</td><td>Dispatcher that selects Desktop or Mobile presenter</td></tr><tr><td><code>PortKnockSequenceManagerDesktop</code></td><td><code>components/PortKnockSequenceManagerDesktop.tsx</code></td><td>Desktop</td><td>Table view with inline enable/disable switch, knock-port badges, timeout columns, edit/delete actions</td></tr><tr><td><code>PortKnockSequenceManagerMobile</code></td><td><code>components/PortKnockSequenceManagerMobile.tsx</code></td><td>Mobile</td><td>Card list with 44px touch targets, sequence detail accordion</td></tr><tr><td><code>PortKnockLogViewer</code></td><td><code>components/PortKnockLogViewer.tsx</code></td><td>Shared</td><td>Real-time log stream showing knock attempts, successes, and failures</td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_SAay" id="38-service-ports-components-nas-78">3.8 Service Ports Components (NAS-7.8)<a href="#38-service-ports-components-nas-78" class="hash-link" aria-label="Direct link to 3.8 Service Ports Components (NAS-7.8)" title="Direct link to 3.8 Service Ports Components (NAS-7.8)" translate="no">​</a></h3>
<table><thead><tr><th>Component</th><th>File</th><th>Platform</th><th>Purpose</th></tr></thead><tbody><tr><td><code>ServicePortsTable</code></td><td><code>components/ServicePortsTable.tsx</code></td><td>Shared</td><td>Dispatcher for service port table</td></tr><tr><td><code>ServicePortsTableDesktop</code></td><td><code>components/ServicePortsTableDesktop.tsx</code></td><td>Desktop</td><td>Full table of RouterOS service ports (api, ftp, ssh, telnet, winbox, etc.) with enable/disable</td></tr><tr><td><code>ServicePortsTableMobile</code></td><td><code>components/ServicePortsTableMobile.tsx</code></td><td>Mobile</td><td>Compact card list of service ports</td></tr><tr><td><code>AddServiceDialog</code></td><td><code>components/AddServiceDialog.tsx</code></td><td>Shared</td><td>Dialog form to add a custom service port mapping</td></tr><tr><td><code>ServiceGroupDialog</code></td><td><code>components/ServiceGroupDialog.tsx</code></td><td>Shared</td><td>Dialog to manage named service port groups</td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_SAay" id="39-template-management-components-nas-76">3.9 Template Management Components (NAS-7.6)<a href="#39-template-management-components-nas-76" class="hash-link" aria-label="Direct link to 3.9 Template Management Components (NAS-7.6)" title="Direct link to 3.9 Template Management Components (NAS-7.6)" translate="no">​</a></h3>
<table><thead><tr><th>Component</th><th>File</th><th>Platform</th><th>Purpose</th></tr></thead><tbody><tr><td><code>SaveTemplateDialog</code></td><td><code>components/SaveTemplateDialog.tsx</code></td><td>Shared</td><td>Dialog to snapshot current filter rules as a named custom template (persisted to IndexedDB)</td></tr><tr><td><code>ImportTemplateDialog</code></td><td><code>components/ImportTemplateDialog.tsx</code></td><td>Shared</td><td>Dialog to import a template from JSON file or paste; validates against <code>FirewallTemplateSchema</code></td></tr><tr><td><code>TemplateApplyFlow</code></td><td><code>components/TemplateApplyFlow.tsx</code></td><td>Shared</td><td>XState-driven multi-step flow (configure → preview → confirm → apply → success/rollback)</td></tr><tr><td><code>UndoFloatingButton</code></td><td><code>components/UndoFloatingButton.tsx</code></td><td>Shared</td><td>Floating bottom-right button with 5-minute countdown for post-apply rollback</td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_SAay" id="310-utility--filter-components">3.10 Utility / Filter Components<a href="#310-utility--filter-components" class="hash-link" aria-label="Direct link to 3.10 Utility / Filter Components" title="Direct link to 3.10 Utility / Filter Components" translate="no">​</a></h3>
<table><thead><tr><th>Component</th><th>File</th><th>Platform</th><th>Purpose</th></tr></thead><tbody><tr><td><code>RuleSearchFilters</code></td><td><code>components/RuleSearchFilters.tsx</code></td><td>Shared</td><td>Filter panel with 300ms debounced text search, chain/action/protocol/status dropdowns, active-filter badges, mobile collapse</td></tr><tr><td><code>ReadOnlyNotice</code></td><td><code>components/ReadOnlyNotice.tsx</code></td><td>Shared</td><td>Dismissible info banner explaining Phase 0 read-only mode; state persisted to localStorage</td></tr><tr><td><code>RoutingTable</code></td><td><code>components/RoutingTable.tsx</code></td><td>Shared</td><td>Static routing table viewer (destination, gateway, interface, distance)</td></tr><tr><td><code>TrafficFlowDiagram</code></td><td><code>components/TrafficFlowDiagram.tsx</code></td><td>Shared</td><td>Visual diagram of packet traversal through firewall chains</td></tr><tr><td><code>ConnectionsPage</code></td><td><code>components/ConnectionsPage.tsx</code></td><td>Shared</td><td>Connection tracking table showing active TCP/UDP/ICMP state entries</td></tr></tbody></table>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_SAay" id="4-page-catalogue">4. Page Catalogue<a href="#4-page-catalogue" class="hash-link" aria-label="Direct link to 4. Page Catalogue" title="Direct link to 4. Page Catalogue" translate="no">​</a></h2>
<table><thead><tr><th>Page</th><th>File</th><th>Description</th></tr></thead><tbody><tr><td><code>AddressListView</code></td><td><code>pages/AddressListView.tsx</code></td><td>Full CRUD for all firewall address lists. Orchestrates <code>AddressListManager</code> (Layer 2 pattern), <code>AddressListEntryForm</code>, <code>AddressListImportDialog</code>, and <code>AddressListExportDialog</code>. Uses <code>Sheet</code> for add-entry on mobile and <code>Dialog</code> for desktop.</td></tr><tr><td><code>FirewallLogsPage</code></td><td><code>pages/FirewallLogsPage.tsx</code></td><td>Streams live firewall log events. Integrates <code>RuleSearchFilters</code> for chain/action/IP filtering and a virtualized log list with time, source, destination, and action columns.</td></tr><tr><td><code>ManglePage</code></td><td><code>pages/ManglePage.tsx</code></td><td>Displays all mangle rules grouped by chain. Includes <code>MangleRulesTable</code> and <code>RuleSearchFilters</code>.</td></tr><tr><td><code>NATRulesPage</code></td><td><code>pages/NATRulesPage.tsx</code></td><td>NAT management with chain tabs (All / srcnat / dstnat), <code>NATRulesTable</code>, <code>MasqueradeQuickDialog</code>, and <code>PortForwardWizardDialog</code>.</td></tr><tr><td><code>RateLimitingPage</code></td><td><code>pages/RateLimitingPage.tsx</code></td><td>View and configure connection-rate and burst limits via queue trees and simple queues.</td></tr><tr><td><code>RawPage</code></td><td><code>pages/RawPage.tsx</code></td><td>Displays RAW chain rules (pre-connection-tracking) with <code>RawRulesTable</code> and <code>RuleSearchFilters</code>.</td></tr><tr><td><code>ServicePortsPage</code></td><td><code>pages/ServicePortsPage.tsx</code></td><td>Service port table with enable/disable toggles for all RouterOS services (api, ftp, ssh, telnet, www, winbox, api-ssl).</td></tr><tr><td><code>TemplatesPage</code></td><td><code>pages/TemplatesPage.tsx</code></td><td>Template gallery with Browse and Apply tabs. Composes <code>TemplateGallery</code> (Layer 2), <code>TemplateApplyFlow</code>, <code>SaveTemplateDialog</code>, and <code>ImportTemplateDialog</code>.</td></tr></tbody></table>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_SAay" id="5-firewall-template-safety-pipeline">5. Firewall Template Safety Pipeline<a href="#5-firewall-template-safety-pipeline" class="hash-link" aria-label="Direct link to 5. Firewall Template Safety Pipeline" title="Direct link to 5. Firewall Template Safety Pipeline" translate="no">​</a></h2>
<p>The template application flow is the canonical example of NasNetConnect&#x27;s <strong>Safety Pipeline</strong> architectural pattern. The entry point is <code>TemplatesPage</code>, which mounts <code>TemplateApplyFlow</code> after the user selects a template from the gallery. <code>TemplateApplyFlow</code> instantiates the XState machine via <code>createTemplateApplyMachine</code> and renders different UI for each state.</p>
<h3 class="anchor anchorTargetStickyNavbar_SAay" id="51-state-machine">5.1 State Machine<a href="#51-state-machine" class="hash-link" aria-label="Direct link to 5.1 State Machine" title="Direct link to 5.1 State Machine" translate="no">​</a></h3>
<p>File: <code>libs/features/firewall/src/machines/template-apply.machine.ts</code></p>
<div class="language-text codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_kX1v"><pre tabindex="0" class="prism-code language-text codeBlock_TAPP thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#F8F8F2"><span class="token plain">idle → configuring → previewing → reviewing → [confirming] → applying → success</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                                ↓                           ↓</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                            error ←────────────────────────→ error</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                                                        ↓</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                                              rollingBack → rolledBack</span><br></span></code></pre></div></div>
<table><thead><tr><th>State</th><th>Description</th></tr></thead><tbody><tr><td><code>idle</code></td><td>Waiting for <code>SELECT_TEMPLATE</code> event</td></tr><tr><td><code>configuring</code></td><td>User fills in template variables via <code>TemplatePreview</code> form</td></tr><tr><td><code>previewing</code></td><td>Async: calls <code>previewTemplate</code> service; shows spinner</td></tr><tr><td><code>reviewing</code></td><td>User reviews impact analysis (rule count, chains, conflicts, warnings)</td></tr><tr><td><code>confirming</code></td><td>High-risk gate: shown when rules &gt; 10, chains &gt; 3, or conflicts exist</td></tr><tr><td><code>applying</code></td><td>Async: calls <code>applyTemplate</code> service; shows spinner with rule count</td></tr><tr><td><code>success</code></td><td>Apply completed; rollback ID captured; <code>UndoFloatingButton</code> rendered</td></tr><tr><td><code>rollingBack</code></td><td>Async: calls <code>executeRollback</code> service</td></tr><tr><td><code>rolledBack</code></td><td>Rollback confirmed; <code>notifyRolledBack</code> callback fired</td></tr><tr><td><code>error</code></td><td>Caught error; offers Retry, Rollback (if rollback ID exists), and Reset</td></tr></tbody></table>
<p><strong>High-risk thresholds</strong> (constants in the machine file):</p>
<div class="language-ts codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_kX1v"><pre tabindex="0" class="prism-code language-ts codeBlock_TAPP thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> </span><span class="token constant" style="color:rgb(189, 147, 249)">HIGH_RISK_THRESHOLDS</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token constant" style="color:rgb(189, 147, 249)">MAX_LOW_RISK_RULES</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">10</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">   </span><span class="token comment" style="color:rgb(98, 114, 164)">// &gt;10 new rules → confirming state</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token constant" style="color:rgb(189, 147, 249)">MAX_LOW_RISK_CHAINS</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">   </span><span class="token comment" style="color:rgb(98, 114, 164)">// &gt;3 affected chains → confirming state</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token keyword module" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// Plus: any conflicts or any warnings also trigger confirming</span><br></span></code></pre></div></div>
<p><strong>Events accepted:</strong></p>
<div class="language-ts codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_kX1v"><pre tabindex="0" class="prism-code language-ts codeBlock_TAPP thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">type</span><span class="token plain"> </span><span class="token class-name maybe-class-name">TemplateApplyEvent</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> type</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;SELECT_TEMPLATE&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> template</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">FirewallTemplate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> routerId</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">string</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> type</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;UPDATE_VARIABLES&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> variables</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">Record</span><span class="token operator">&lt;</span><span class="token builtin" style="color:rgb(189, 147, 249)">string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">string</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> type</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;PREVIEW&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> type</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;CONFIRM&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> type</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;APPLY&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> type</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;ACKNOWLEDGED&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain">   </span><span class="token comment" style="color:rgb(98, 114, 164)">// user checked the acknowledgment checkbox</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> type</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;ROLLBACK&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> type</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;RETRY&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> type</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;CANCEL&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token operator">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> type</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;RESET&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre></div></div>
<p><strong>Context shape:</strong></p>
<div class="language-ts codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_kX1v"><pre tabindex="0" class="prism-code language-ts codeBlock_TAPP thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">interface</span><span class="token plain"> </span><span class="token class-name maybe-class-name">TemplateApplyContext</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  routerId</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">string</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword null nil" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  template</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">FirewallTemplate</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword null nil" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  variables</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">Record</span><span class="token operator">&lt;</span><span class="token builtin" style="color:rgb(189, 147, 249)">string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">string</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  validationErrors</span><span class="token operator">:</span><span class="token plain"> </span><span class="token known-class-name class-name">Array</span><span class="token operator">&lt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> field</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> message</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">string</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  previewResult</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">TemplatePreviewResult</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword null nil" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  applyResult</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">FirewallTemplateResult</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword null nil" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  applyStartedAt</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">number</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword null nil" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain">   </span><span class="token comment" style="color:rgb(98, 114, 164)">// timestamp for rollback timer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  errorMessage</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">string</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword null nil" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_SAay" id="52-undofloatingbutton">5.2 UndoFloatingButton<a href="#52-undofloatingbutton" class="hash-link" aria-label="Direct link to 5.2 UndoFloatingButton" title="Direct link to 5.2 UndoFloatingButton" translate="no">​</a></h3>
<p>After a successful apply, <code>TemplateApplyFlow</code> renders <code>UndoFloatingButton</code> fixed to the bottom-right corner. This component:</p>
<ul>
<li class="">Starts a <strong>5-minute (300-second) countdown</strong> on mount.</li>
<li class="">Displays time remaining with <code>formatTime()</code> in MM<!-- -->:SS<!-- -->.</li>
<li class="">Changes urgency styling: <code>normal</code> (&gt; 60s), <code>warning</code> (31-60s), <code>critical</code> (≤ 30s).</li>
<li class="">Shows a confirmation dialog before executing rollback.</li>
<li class="">Calls <code>onRollback()</code> then hides on success, or auto-hides via <code>onExpire()</code> when the countdown reaches zero.</li>
</ul>
<div class="language-ts codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_kX1v"><pre tabindex="0" class="prism-code language-ts codeBlock_TAPP thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> </span><span class="token constant" style="color:rgb(189, 147, 249)">TOTAL_SECONDS</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">300</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// 5 minutes</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_SAay" id="53-full-pipeline-flow-templatespage--api">5.3 Full Pipeline Flow (TemplatesPage → API)<a href="#53-full-pipeline-flow-templatespage--api" class="hash-link" aria-label="Direct link to 5.3 Full Pipeline Flow (TemplatesPage → API)" title="Direct link to 5.3 Full Pipeline Flow (TemplatesPage → API)" translate="no">​</a></h3>
<div class="language-text codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_kX1v"><pre tabindex="0" class="prism-code language-text codeBlock_TAPP thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#F8F8F2"><span class="token plain">User clicks &quot;Apply Template&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  └─&gt; TemplatesPage.handleApplyTemplate()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        └─&gt; setSelectedTemplate(template)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              └─&gt; setActiveTab(&#x27;apply&#x27;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    └─&gt; &lt;TemplateApplyFlow</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                              routerId={routerId}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                              template={selectedTemplate}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                              onPreview={handlePreviewTemplate}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                              onApply={handleApply}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                              onRollback={handleRollback} /&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                          └─&gt; createTemplateApplyMachine({ previewTemplate, applyTemplate, executeRollback })</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                └─&gt; useMachine(machine)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                      │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                      ├─&gt; configuring state (user configures variables)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                      │     └─&gt; PREVIEW event</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                      │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                      ├─&gt; previewing state (async)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                      │     └─&gt; previewTemplate(routerId, template, variables)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                      │           └─&gt; usePreviewTemplate() Apollo mutation</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                      │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                      ├─&gt; reviewing state (impact analysis shown)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                      │     └─&gt; CONFIRM event</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                      │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                      ├─&gt; confirming state [only if high-risk]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                      │     └─&gt; user checks acknowledgment checkbox</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                      │           └─&gt; ACKNOWLEDGED event</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                      │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                      ├─&gt; applying state (async)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                      │     └─&gt; applyTemplate(routerId, template, variables)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                      │           └─&gt; useApplyTemplate() Apollo mutation</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                      │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                      └─&gt; success state</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                            └─&gt; &lt;UndoFloatingButton countdown=5min /&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                                  └─&gt; ROLLBACK event → rollingBack → rolledBack</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_SAay" id="6-address-list-importexport-flow">6. Address List Import/Export Flow<a href="#6-address-list-importexport-flow" class="hash-link" aria-label="Direct link to 6. Address List Import/Export Flow" title="Direct link to 6. Address List Import/Export Flow" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_SAay" id="import">Import<a href="#import" class="hash-link" aria-label="Direct link to Import" title="Direct link to Import" translate="no">​</a></h3>
<p><code>AddressListImportDialog</code> implements a 4-step wizard:</p>
<ol>
<li class=""><strong>select</strong> — User selects target list name, format (auto-detect / CSV / JSON / TXT), and provides content via drag-and-drop file upload or text paste.</li>
<li class=""><strong>preview</strong> — <code>parseAddressList()</code> and <code>validateInBatches()</code> are called. For &gt;100 entries, validation runs in batches with a progress indicator. Valid entries and errors are shown in a scrollable preview. The user can import only the valid entries.</li>
<li class=""><strong>importing</strong> — Progress bar updated as entries are written to the GraphQL mutation <code>useBulkCreateAddressListEntries</code>.</li>
<li class=""><strong>complete</strong> — Success confirmation with &quot;Import More&quot; or &quot;Close&quot; options.</li>
</ol>
<p>Supported input formats:</p>
<ul>
<li class=""><strong>CSV</strong>: <code>IP, comment, timeout</code> per line</li>
<li class=""><strong>JSON</strong>: Array of <code>{ address, comment?, timeout? }</code> objects</li>
<li class=""><strong>TXT</strong>: One IP per line</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_SAay" id="export">Export<a href="#export" class="hash-link" aria-label="Direct link to Export" title="Direct link to Export" translate="no">​</a></h3>
<p><code>AddressListExportDialog</code> downloads the current address list in the user&#x27;s chosen format (CSV / JSON / TXT) via the browser&#x27;s download API.</p>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_SAay" id="7-port-knocking-sequence-management">7. Port Knocking Sequence Management<a href="#7-port-knocking-sequence-management" class="hash-link" aria-label="Direct link to 7. Port Knocking Sequence Management" title="Direct link to 7. Port Knocking Sequence Management" translate="no">​</a></h2>
<p>Port knocking is managed by <code>PortKnockSequenceManagerDesktop</code> (and its mobile counterpart). Each sequence stores:</p>
<ul>
<li class=""><strong>Name</strong> — human label</li>
<li class=""><strong>Protected service</strong> — <code>protectedProtocol:protectedPort</code> (e.g., <code>tcp:22</code> for SSH)</li>
<li class=""><strong>Knock ports</strong> — ordered list of ports that must be sequentially knocked; displayed as <code>Badge</code> chips in the table</li>
<li class=""><strong>Status</strong> — <code>isEnabled</code> boolean with an inline <code>Switch</code> toggle; changing it calls <code>useTogglePortKnockSequence</code></li>
<li class=""><strong>Recent access count</strong> — live counter of successful knock-and-opens</li>
<li class=""><strong>Timeouts</strong> — knock timeout (K) and access timeout (A) in seconds; displayed side by side with a Clock icon</li>
</ul>
<p>The delete flow uses a confirmation <code>Dialog</code> that includes an SSH-specific warning when <code>protectedPort === 22</code>.</p>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_SAay" id="8-zustand-stores-used">8. Zustand Stores Used<a href="#8-zustand-stores-used" class="hash-link" aria-label="Direct link to 8. Zustand Stores Used" title="Direct link to 8. Zustand Stores Used" translate="no">​</a></h2>
<table><thead><tr><th>Store</th><th>Import</th><th>Usage in Firewall</th></tr></thead><tbody><tr><td><code>useConnectionStore</code></td><td><code>@nasnet/state/stores</code></td><td>Read <code>activeRouterId</code> and <code>currentRouterIp</code> for query scoping</td></tr><tr><td><code>useNATUIStore</code></td><td><code>@nasnet/state/stores</code></td><td>Track active NAT chain tab selection in <code>NATRulesPage</code></td></tr></tbody></table>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_SAay" id="9-schemas-and-validation">9. Schemas and Validation<a href="#9-schemas-and-validation" class="hash-link" aria-label="Direct link to 9. Schemas and Validation" title="Direct link to 9. Schemas and Validation" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_SAay" id="91-template-schemas-schemastemplateschemasts">9.1 Template Schemas (<code>schemas/templateSchemas.ts</code>)<a href="#91-template-schemas-schemastemplateschemasts" class="hash-link" aria-label="Direct link to 91-template-schemas-schemastemplateschemasts" title="Direct link to 91-template-schemas-schemastemplateschemasts" translate="no">​</a></h3>
<p>Re-exports the canonical types from <code>@nasnet/core/types</code> and adds application-level validation utilities:</p>
<table><thead><tr><th>Export</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>FirewallTemplateSchema</code></td><td>Zod</td><td>Full template object (id, name, description, category, complexity, variables, rules)</td></tr><tr><td><code>TemplateVariableSchema</code></td><td>Zod</td><td>Variable definition (name, type, label, options, isRequired, defaultValue)</td></tr><tr><td><code>TemplateRuleSchema</code></td><td>Zod</td><td>Individual rule within a template</td></tr><tr><td><code>TemplatePreviewResultSchema</code></td><td>Zod</td><td>Preview response (resolvedRules, conflicts, impactAnalysis)</td></tr><tr><td><code>FirewallTemplateResultSchema</code></td><td>Zod</td><td>Apply response (isSuccessful, appliedRulesCount, rollbackId)</td></tr><tr><td><code>createVariableValueSchema(variable)</code></td><td>Function</td><td>Generates a Zod schema for a variable value based on its <code>VariableType</code></td></tr><tr><td><code>createTemplateVariablesSchema(template)</code></td><td>Function</td><td>Builds a <code>z.object({...})</code> for all variables in a template</td></tr><tr><td><code>validateTemplateVariables(template, values)</code></td><td>Function</td><td>Returns <code>{ success, errors }</code> without throwing</td></tr></tbody></table>
<p><strong>Variable type to Zod mapping:</strong></p>
<table><thead><tr><th><code>VariableType</code></th><th>Zod Rule</th></tr></thead><tbody><tr><td><code>INTERFACE</code></td><td><code>z.string().refine(validateInterface)</code> or <code>z.enum(options)</code></td></tr><tr><td><code>SUBNET</code></td><td><code>z.string().refine(validateCIDR)</code> — expects <code>x.x.x.x/n</code></td></tr><tr><td><code>IP</code></td><td><code>z.string().refine(validateIPv4)</code></td></tr><tr><td><code>PORT</code></td><td><code>z.string().refine(validatePort)</code> — 1–65535</td></tr><tr><td><code>PORT_RANGE</code></td><td><code>z.string().refine(validatePortRange)</code> — <code>start-end</code></td></tr><tr><td><code>VLAN_ID</code></td><td><code>z.string().refine(validateVlanId)</code> — 1–4094</td></tr><tr><td><code>STRING</code></td><td><code>z.string().min(1).max(255)</code></td></tr><tr><td><code>NUMBER</code></td><td><code>z.number().int()</code></td></tr><tr><td><code>BOOLEAN</code></td><td><code>z.boolean()</code></td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_SAay" id="92-core-type-definitions-libscoretypessrcfirewall">9.2 Core Type Definitions (<code>libs/core/types/src/firewall/</code>)<a href="#92-core-type-definitions-libscoretypessrcfirewall" class="hash-link" aria-label="Direct link to 92-core-type-definitions-libscoretypessrcfirewall" title="Direct link to 92-core-type-definitions-libscoretypessrcfirewall" translate="no">​</a></h3>
<p>These <code>.d.ts</code> files are generated (do not edit manually) and provide the TypeScript types consumed throughout the feature:</p>
<table><thead><tr><th>File</th><th>Key Types</th></tr></thead><tbody><tr><td><code>filter-rule.types.d.ts</code></td><td><code>FilterRule</code>, <code>FilterChain</code> (`input</td></tr><tr><td><code>nat-rule.types.d.ts</code></td><td><code>NATRule</code>, <code>NatChain</code> (`srcnat</td></tr><tr><td><code>mangle-rule.types.d.ts</code></td><td><code>MangleRule</code>, <code>MangleChain</code>, <code>MangleAction</code></td></tr><tr><td><code>raw-rule.types.d.ts</code></td><td><code>RawRule</code>, <code>RawChain</code></td></tr><tr><td><code>firewall-log.types.d.ts</code></td><td><code>FirewallLogEntry</code>, <code>LogAction</code>, <code>LogChain</code></td></tr><tr><td><code>port-knock.types.d.ts</code></td><td><code>PortKnockSequence</code>, <code>KnockPort</code></td></tr><tr><td><code>service-port.types.d.ts</code></td><td><code>ServicePort</code>, <code>ServiceName</code></td></tr><tr><td><code>rate-limit.types.d.ts</code></td><td><code>RateLimit</code>, <code>QueueType</code></td></tr><tr><td><code>template.types.d.ts</code></td><td><code>FirewallTemplate</code>, <code>TemplateVariable</code>, <code>TemplateRule</code>, <code>ImpactAnalysis</code>, <code>TemplateConflict</code></td></tr></tbody></table>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_SAay" id="10-key-pattern-details">10. Key Pattern Details<a href="#10-key-pattern-details" class="hash-link" aria-label="Direct link to 10. Key Pattern Details" title="Direct link to 10. Key Pattern Details" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_SAay" id="readonlynotice"><code>ReadOnlyNotice</code><a href="#readonlynotice" class="hash-link" aria-label="Direct link to readonlynotice" title="Direct link to readonlynotice" translate="no">​</a></h3>
<p>Displayed at the top of the firewall tab in Phase 0. Explains that editing is disabled and previews the Safety Pipeline coming in Phase 1. Dismissed state is persisted to <code>localStorage</code> under the key <code>nasnet:firewall:notice-dismissed</code>. The component renders <code>null</code> once dismissed.</p>
<div class="language-tsx codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_kX1v"><pre tabindex="0" class="prism-code language-tsx codeBlock_TAPP thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#F8F8F2"><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag class-name" style="color:rgb(255, 121, 198)">ReadOnlyNotice</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">className</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">mb-4</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">/&gt;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_SAay" id="rulesearchfilters"><code>RuleSearchFilters</code><a href="#rulesearchfilters" class="hash-link" aria-label="Direct link to rulesearchfilters" title="Direct link to rulesearchfilters" translate="no">​</a></h3>
<p>Universal filter panel used on Filter, Mangle, RAW, and Logs pages. Features:</p>
<ul>
<li class=""><strong>Debounced text search</strong> (300ms) across comment, IPs, and ports</li>
<li class=""><strong>Dropdown filters</strong>: chain, action, protocol, status — each with an <code>&#x27;all&#x27;</code> option</li>
<li class=""><strong>Active filter badges</strong> with individual <code>×</code> remove buttons</li>
<li class=""><strong>Clear all</strong> button</li>
<li class=""><strong>Mobile collapse</strong>: hidden by default on <code>&lt;md</code> breakpoints; toggled via a &quot;Show Filters&quot; button</li>
</ul>
<div class="language-tsx codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_kX1v"><pre tabindex="0" class="prism-code language-tsx codeBlock_TAPP thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#F8F8F2"><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag class-name" style="color:rgb(255, 121, 198)">RuleSearchFilters</span><span class="token tag" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token tag" style="color:rgb(255, 121, 198)">  </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">filters</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:rgb(248, 248, 242)">=</span><span class="token tag script language-javascript punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token tag script language-javascript" style="color:rgb(255, 121, 198)">filters</span><span class="token tag script language-javascript punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token tag" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token tag" style="color:rgb(255, 121, 198)">  </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">onChange</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:rgb(248, 248, 242)">=</span><span class="token tag script language-javascript punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token tag script language-javascript" style="color:rgb(255, 121, 198)">handleFilterChange</span><span class="token tag script language-javascript punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token tag" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token tag" style="color:rgb(255, 121, 198)">  </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">onClearAll</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:rgb(248, 248, 242)">=</span><span class="token tag script language-javascript punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token tag script language-javascript" style="color:rgb(255, 121, 198)">handleClearAll</span><span class="token tag script language-javascript punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token tag" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token tag" style="color:rgb(255, 121, 198)">  </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">activeFilterCount</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:rgb(248, 248, 242)">=</span><span class="token tag script language-javascript punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token tag script language-javascript number" style="color:rgb(255, 121, 198)">2</span><span class="token tag script language-javascript punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token tag" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token tag" style="color:rgb(255, 121, 198)"></span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">/&gt;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_SAay" id="undofloatingbutton"><code>UndoFloatingButton</code><a href="#undofloatingbutton" class="hash-link" aria-label="Direct link to undofloatingbutton" title="Direct link to undofloatingbutton" translate="no">​</a></h3>
<p>The UndoFloatingButton uses urgency-based styling driven by remaining seconds:</p>
<div class="language-ts codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_kX1v"><pre tabindex="0" class="prism-code language-ts codeBlock_TAPP thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">getUrgencyLevel</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">seconds</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">number</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;normal&#x27;</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;warning&#x27;</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;critical&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">seconds </span><span class="token operator">&lt;=</span><span class="token plain"> </span><span class="token number">30</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;critical&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// bg-error</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">seconds </span><span class="token operator">&lt;=</span><span class="token plain"> </span><span class="token number">60</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;warning&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain">   </span><span class="token comment" style="color:rgb(98, 114, 164)">// bg-warning</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;normal&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain">                       </span><span class="token comment" style="color:rgb(98, 114, 164)">// bg-card border</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_SAay" id="11-hooks">11. Hooks<a href="#11-hooks" class="hash-link" aria-label="Direct link to 11. Hooks" title="Direct link to 11. Hooks" translate="no">​</a></h2>
<table><thead><tr><th>Hook</th><th>File</th><th>Description</th></tr></thead><tbody><tr><td><code>useCustomTemplates</code></td><td><code>hooks/useCustomTemplates.ts</code></td><td>Provides CRUD (save, remove, exportTemplates, importTemplates) against IndexedDB for user-created firewall templates</td></tr></tbody></table>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_SAay" id="12-cross-references">12. Cross-References<a href="#12-cross-references" class="hash-link" aria-label="Direct link to 12. Cross-References" title="Direct link to 12. Cross-References" translate="no">​</a></h2>
<ul>
<li class=""><strong>XState machine</strong> — <code>createTemplateApplyMachine</code> is the canonical Safety Pipeline implementation. See <code>Docs/architecture/novel-pattern-designs.md</code> for the general pattern. The machine file is also referenced in <code>xstate-machines.md</code>.</li>
<li class=""><strong>Headless + Platform Presenters</strong> — <code>FilterRulesTable</code>, <code>MangleRulesTable</code>, <code>RawRulesTable</code>, <code>PortKnockSequenceManager</code>, and <code>ServicePortsTable</code> all follow the dispatcher + presenter pattern described in <code>Docs/design/PLATFORM_PRESENTER_GUIDE.md</code>.</li>
<li class=""><strong>TemplateGallery (Layer 2 pattern)</strong> — <code>TemplatesPage</code> composes the <code>TemplateGallery</code> component from <code>@nasnet/ui/patterns/template-gallery</code>. The firewall feature only provides the data and handlers.</li>
<li class=""><strong>AddressListManager (Layer 2 pattern)</strong> — <code>AddressListView</code> composes <code>AddressListManager</code> from <code>@nasnet/ui/patterns/address-list-manager</code>.</li>
<li class=""><strong>GraphQL queries</strong> — All data-fetching hooks (<code>useAddressLists</code>, <code>useNATRules</code>, <code>usePortKnockSequences</code>, <code>useApplyTemplate</code>, <code>useRollbackTemplate</code>, etc.) live in <code>@nasnet/api-client/queries/firewall</code>.</li>
<li class=""><strong>Design tokens</strong> — Semantic tokens are used throughout (<code>bg-error</code>, <code>bg-warning</code>, <code>bg-success</code>, <code>text-info</code>, <code>border-border</code>). See <code>Docs/design/DESIGN_TOKENS.md</code>.</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_HJkF"><a href="https://github.com/nasnet-community/nasnet-panel/tree/main/../../libs/features/docs/feature-firewall.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_UohW" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_g62E"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/features/feature-diagnostics"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Feature: Diagnostics (libs/features/diagnostics)</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/features/feature-logs"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Feature: Logs (libs/features/logs)</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_TN1Q thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-overview" class="table-of-contents__link toc-highlight">1. Overview</a><ul><li><a href="#key-architectural-traits" class="table-of-contents__link toc-highlight">Key architectural traits</a></li><li><a href="#public-import-path" class="table-of-contents__link toc-highlight">Public import path</a></li></ul></li><li><a href="#2-directory-tree" class="table-of-contents__link toc-highlight">2. Directory Tree</a></li><li><a href="#3-component-catalogue" class="table-of-contents__link toc-highlight">3. Component Catalogue</a><ul><li><a href="#31-filter-rule-components" class="table-of-contents__link toc-highlight">3.1 Filter Rule Components</a></li><li><a href="#32-mangle-rule-components" class="table-of-contents__link toc-highlight">3.2 Mangle Rule Components</a></li><li><a href="#33-raw-rule-components" class="table-of-contents__link toc-highlight">3.3 RAW Rule Components</a></li><li><a href="#34-nat-components" class="table-of-contents__link toc-highlight">3.4 NAT Components</a></li><li><a href="#35-address-list-components" class="table-of-contents__link toc-highlight">3.5 Address List Components</a></li><li><a href="#36-dashboard--status-components" class="table-of-contents__link toc-highlight">3.6 Dashboard / Status Components</a></li><li><a href="#37-port-knocking-components-nas-712" class="table-of-contents__link toc-highlight">3.7 Port Knocking Components (NAS-7.12)</a></li><li><a href="#38-service-ports-components-nas-78" class="table-of-contents__link toc-highlight">3.8 Service Ports Components (NAS-7.8)</a></li><li><a href="#39-template-management-components-nas-76" class="table-of-contents__link toc-highlight">3.9 Template Management Components (NAS-7.6)</a></li><li><a href="#310-utility--filter-components" class="table-of-contents__link toc-highlight">3.10 Utility / Filter Components</a></li></ul></li><li><a href="#4-page-catalogue" class="table-of-contents__link toc-highlight">4. Page Catalogue</a></li><li><a href="#5-firewall-template-safety-pipeline" class="table-of-contents__link toc-highlight">5. Firewall Template Safety Pipeline</a><ul><li><a href="#51-state-machine" class="table-of-contents__link toc-highlight">5.1 State Machine</a></li><li><a href="#52-undofloatingbutton" class="table-of-contents__link toc-highlight">5.2 UndoFloatingButton</a></li><li><a href="#53-full-pipeline-flow-templatespage--api" class="table-of-contents__link toc-highlight">5.3 Full Pipeline Flow (TemplatesPage → API)</a></li></ul></li><li><a href="#6-address-list-importexport-flow" class="table-of-contents__link toc-highlight">6. Address List Import/Export Flow</a><ul><li><a href="#import" class="table-of-contents__link toc-highlight">Import</a></li><li><a href="#export" class="table-of-contents__link toc-highlight">Export</a></li></ul></li><li><a href="#7-port-knocking-sequence-management" class="table-of-contents__link toc-highlight">7. Port Knocking Sequence Management</a></li><li><a href="#8-zustand-stores-used" class="table-of-contents__link toc-highlight">8. Zustand Stores Used</a></li><li><a href="#9-schemas-and-validation" class="table-of-contents__link toc-highlight">9. Schemas and Validation</a><ul><li><a href="#91-template-schemas-schemastemplateschemasts" class="table-of-contents__link toc-highlight">9.1 Template Schemas (<code>schemas/templateSchemas.ts</code>)</a></li><li><a href="#92-core-type-definitions-libscoretypessrcfirewall" class="table-of-contents__link toc-highlight">9.2 Core Type Definitions (<code>libs/core/types/src/firewall/</code>)</a></li></ul></li><li><a href="#10-key-pattern-details" class="table-of-contents__link toc-highlight">10. Key Pattern Details</a><ul><li><a href="#readonlynotice" class="table-of-contents__link toc-highlight"><code>ReadOnlyNotice</code></a></li><li><a href="#rulesearchfilters" class="table-of-contents__link toc-highlight"><code>RuleSearchFilters</code></a></li><li><a href="#undofloatingbutton" class="table-of-contents__link toc-highlight"><code>UndoFloatingButton</code></a></li></ul></li><li><a href="#11-hooks" class="table-of-contents__link toc-highlight">11. Hooks</a></li><li><a href="#12-cross-references" class="table-of-contents__link toc-highlight">12. Cross-References</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Apps</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/frontend/intro">Frontend</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/backend/intro">Backend</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/testing/intro">E2E Testing</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Libraries</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/ui/intro">UI Components</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/features/intro">Feature Modules</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/api-client/intro">API Client</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/state/intro">State Management</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/core/intro">Core Types</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">API</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/api">Schema Overview</a></li><li class="footer__item"><a class="footer__link-item" href="/category/queries">Queries</a></li><li class="footer__item"><a class="footer__link-item" href="/category/mutations">Mutations</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/nasnet-community/nasnet-panel" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_awgD"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/storybook/primitives/">Storybook (Primitives)</a></li><li class="footer__item"><a class="footer__link-item" href="/storybook/patterns/">Storybook (Patterns)</a></li><li class="footer__item"><a class="footer__link-item" href="/nx-graph/">Nx Graph</a></li><li class="footer__item"><a href="https://github.com/nasnet-community/nasnet-panel/tree/main/Docs/architecture" target="_blank" rel="noopener noreferrer" class="footer__link-item">Architecture<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_awgD"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">© 2026 NasNet · Built with Docusaurus</div></div></div></footer></div>
</body>
</html>