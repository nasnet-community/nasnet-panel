"use strict";(globalThis.webpackChunk_nas_net_docs=globalThis.webpackChunk_nas_net_docs||[]).push([[7684],{13088:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>d,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"getting-started","title":"Getting Started","description":"Everything you need to set up a local development environment, understand the project layout, and run the NasNet backend.","source":"@site/../backend/docs/getting-started.md","sourceDirName":".","slug":"/getting-started","permalink":"/docs/backend/getting-started","draft":false,"unlisted":false,"editUrl":"https://github.com/nasnet-community/nasnet-panel/tree/main/../backend/docs/getting-started.md","tags":[],"version":"current","frontMatter":{},"sidebar":"sidebar","previous":{"title":"Flow: Service Update","permalink":"/docs/backend/flows/service-update-flow"},"next":{"title":"GraphQL API Layer","permalink":"/docs/backend/graphql-api"}}');var i=r(31085),s=r(71184);const d={},l="Getting Started",a={},o=[{value:"Overview",id:"overview",level:2},{value:"Development Environment Setup",id:"development-environment-setup",level:2},{value:"Prerequisites",id:"prerequisites",level:3},{value:"Install Go",id:"install-go",level:3},{value:"Install air (hot-reload)",id:"install-air-hot-reload",level:3},{value:"Install Node.js dependencies",id:"install-nodejs-dependencies",level:3},{value:"Set up environment variables",id:"set-up-environment-variables",level:3},{value:"Build Tags",id:"build-tags",level:2},{value:"Project Layout",id:"project-layout",level:2},{value:"Common Development Commands",id:"common-development-commands",level:2},{value:"Run the backend (with hot reload)",id:"run-the-backend-with-hot-reload",level:3},{value:"Run the frontend + backend together",id:"run-the-frontend--backend-together",level:3},{value:"Build for production",id:"build-for-production",level:3},{value:"Run Go tests",id:"run-go-tests",level:3},{value:"Linting (use small scopes to avoid parallel lint errors)",id:"linting-use-small-scopes-to-avoid-parallel-lint-errors",level:3},{value:"GraphQL code generation",id:"graphql-code-generation",level:3},{value:"Health check",id:"health-check",level:3},{value:"Step-by-Step Startup Sequence",id:"step-by-step-startup-sequence",level:2},{value:"Environment Variables Reference",id:"environment-variables-reference",level:2},{value:"Running Tests",id:"running-tests",level:2},{value:"Unit tests",id:"unit-tests",level:3},{value:"Tests with CHR (RouterOS simulator)",id:"tests-with-chr-routeros-simulator",level:3},{value:"Test coverage",id:"test-coverage",level:3},{value:"Debugging Tips",id:"debugging-tips",level:2},{value:"Enable debug logging",id:"enable-debug-logging",level:3},{value:"Inspect the GraphQL schema",id:"inspect-the-graphql-schema",level:3},{value:"SQLite inspection",id:"sqlite-inspection",level:3},{value:"Check goroutine leaks",id:"check-goroutine-leaks",level:3},{value:"Common startup failures",id:"common-startup-failures",level:3},{value:"Cross-References",id:"cross-references",level:2}];function c(e){const n={blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"getting-started",children:"Getting Started"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Everything you need to set up a local development environment, understand the project layout, and run the NasNet backend."}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Packages:"})," ",(0,i.jsx)(n.code,{children:"cmd/nnc/"}),", ",(0,i.jsx)(n.code,{children:"internal/server/"}),", ",(0,i.jsx)(n.code,{children:"internal/bootstrap/"}),"\n",(0,i.jsx)(n.strong,{children:"Key Files:"})," ",(0,i.jsx)(n.code,{children:"cmd/nnc/main.go"}),", ",(0,i.jsx)(n.code,{children:"cmd/nnc/main_dev.go"}),", ",(0,i.jsx)(n.code,{children:"cmd/nnc/main_prod.go"}),", ",(0,i.jsx)(n.code,{children:"go.mod"}),"\n",(0,i.jsx)(n.strong,{children:"Prerequisites:"})," None \u2014 this is the starting point."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsx)(n.p,{children:"The NasNet backend is a single Go binary that:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Serves a GraphQL API (via gqlgen + Echo v4)"}),"\n",(0,i.jsx)(n.li,{children:"Embeds the compiled React frontend (production builds only)"}),"\n",(0,i.jsx)(n.li,{children:"Manages MikroTik router connections via SSH/REST/RouterOS API"}),"\n",(0,i.jsx)(n.li,{children:"Orchestrates downloadable network features (Tor, Xray, sing-box, etc.)"}),"\n",(0,i.jsx)(n.li,{children:"Runs inside a Docker container on the MikroTik router itself"}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"development-environment-setup",children:"Development Environment Setup"}),"\n",(0,i.jsx)(n.h3,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Tool"}),(0,i.jsx)(n.th,{children:"Version"}),(0,i.jsx)(n.th,{children:"Purpose"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Go"}),(0,i.jsx)(n.td,{children:"1.26+"}),(0,i.jsx)(n.td,{children:"Backend language"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Node.js"}),(0,i.jsx)(n.td,{children:"20+"}),(0,i.jsx)(n.td,{children:"Frontend tooling, Nx"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"npm"}),(0,i.jsx)(n.td,{children:"10+"}),(0,i.jsx)(n.td,{children:"Package manager"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"air"}),(0,i.jsx)(n.td,{children:"latest"}),(0,i.jsx)(n.td,{children:"Hot-reload dev server"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"golangci-lint"}),(0,i.jsx)(n.td,{children:"1.60+"}),(0,i.jsx)(n.td,{children:"Linter (optional for CI)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"SQLite libs"}),(0,i.jsx)(n.td,{children:"system"}),(0,i.jsx)(n.td,{children:"CGo SQLite driver"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"install-go",children:"Install Go"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Download from https://go.dev/dl/\n# Verify installation\ngo version  # should show go1.26.x\n"})}),"\n",(0,i.jsx)(n.h3,{id:"install-air-hot-reload",children:"Install air (hot-reload)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"go install github.com/cosmtrek/air@latest\n"})}),"\n",(0,i.jsx)(n.h3,{id:"install-nodejs-dependencies",children:"Install Node.js dependencies"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd /path/to/NasNet\nnpm install\n"})}),"\n",(0,i.jsx)(n.h3,{id:"set-up-environment-variables",children:"Set up environment variables"}),"\n",(0,i.jsxs)(n.p,{children:["Create ",(0,i.jsx)(n.code,{children:"apps/backend/.env.development"})," (optional, values shown are defaults):"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-env",children:"# Data directory for SQLite databases\nNASNET_DATA_DIR=./data\n\n# Server port (dev: 8080, prod: 80)\nPORT=8080\n\n# Encryption key for credential storage (32 bytes, base64)\n# Leave unset in dev \u2014 a dummy key is used automatically\nDB_ENCRYPTION_KEY=\n\n# GitHub token for binary downloads (optional, avoids rate limits)\nGITHUB_TOKEN=\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"build-tags",children:"Build Tags"}),"\n",(0,i.jsx)(n.p,{children:"The backend uses Go build tags to separate development and production builds:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Tag"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"dev"})}),(0,i.jsx)(n.td,{children:"Development mode: CORS enabled, GraphQL Playground, larger buffers, debug logging, Vite dev server for frontend"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"!dev"})," (default)"]}),(0,i.jsxs)(n.td,{children:["Production mode: frontend embedded via ",(0,i.jsx)(n.code,{children:"//go:embed dist/**"}),", tighter resource limits, info-level logging"]})]})]})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:"// main_dev.go \u2014 only compiled with: go build -tags=dev\n//go:build dev\n\n// main_prod.go \u2014 compiled by default (no tags)\n//go:build !dev\n"})}),"\n",(0,i.jsx)(n.p,{children:"Key differences between modes:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Aspect"}),(0,i.jsx)(n.th,{children:"Development"}),(0,i.jsx)(n.th,{children:"Production"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Port"}),(0,i.jsx)(n.td,{children:"8080"}),(0,i.jsx)(n.td,{children:"80"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Frontend"}),(0,i.jsx)(n.td,{children:"Served by Vite (separate)"}),(0,i.jsx)(n.td,{children:"Embedded in binary"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"CORS"}),(0,i.jsx)(n.td,{children:"All origins allowed"}),(0,i.jsx)(n.td,{children:"Restricted"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"GraphQL Playground"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"/playground"})," enabled"]}),(0,i.jsx)(n.td,{children:"Disabled"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Logger"}),(0,i.jsx)(n.td,{children:"Debug level, development format"}),(0,i.jsx)(n.td,{children:"Info level, JSON"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"GC Percent"}),(0,i.jsx)(n.td,{children:"100 (default)"}),(0,i.jsx)(n.td,{children:"10 (aggressive)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Memory Limit"}),(0,i.jsx)(n.td,{children:"128 MB"}),(0,i.jsx)(n.td,{children:"32 MB"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"GOMAXPROCS"}),(0,i.jsx)(n.td,{children:"2"}),(0,i.jsx)(n.td,{children:"1"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"EventBus buffer"}),(0,i.jsx)(n.td,{children:"1024"}),(0,i.jsx)(n.td,{children:"256"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Scanner workers"}),(0,i.jsx)(n.td,{children:"4"}),(0,i.jsx)(n.td,{children:"2"})]})]})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"project-layout",children:"Project Layout"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"apps/backend/\n\u251c\u2500\u2500 cmd/\n\u2502   \u2514\u2500\u2500 nnc/                    # Application entry point\n\u2502       \u251c\u2500\u2500 main.go             # Entry point: flag parsing \u2192 run()\n\u2502       \u251c\u2500\u2500 main_dev.go         # Development run() function (build tag: dev)\n\u2502       \u251c\u2500\u2500 main_prod.go        # Production run() function (build tag: !dev)\n\u2502       \u251c\u2500\u2500 routes_prod.go      # Production route registration\n\u2502       \u251c\u2500\u2500 handlers.go         # HTTP handlers (health, scan, proxy, OUI)\n\u2502       \u251c\u2500\u2500 services_prod.go    # Top-level service initialization\n\u2502       \u251c\u2500\u2500 services_core.go    # Core services (auth, scanner, capability)\n\u2502       \u251c\u2500\u2500 services_network.go # Network services (IP, WAN, bridge, VLAN)\n\u2502       \u251c\u2500\u2500 services_storage.go # Storage + VIF initialization\n\u2502       \u251c\u2500\u2500 services_orchestrator.go  # Orchestrator initialization\n\u2502       \u251c\u2500\u2500 services_templates.go    # Template + update initialization\n\u2502       \u251c\u2500\u2500 services_monitoring.go   # Monitoring + traffic + scheduling\n\u2502       \u251c\u2500\u2500 services_integration.go  # Integration services (webhook, config, sharing)\n\u2502       \u2514\u2500\u2500 dist/               # Embedded frontend (production only)\n\u2502\n\u251c\u2500\u2500 graph/\n\u2502   \u251c\u2500\u2500 generated.go            # gqlgen-generated GraphQL server (DO NOT EDIT)\n\u2502   \u251c\u2500\u2500 model/models_gen.go     # gqlgen-generated Go types (DO NOT EDIT)\n\u2502   \u2514\u2500\u2500 resolver/               # Hand-written GraphQL resolver functions\n\u2502       \u251c\u2500\u2500 resolver.go         # Resolver struct + Config\n\u2502       \u251c\u2500\u2500 auth.resolvers.go\n\u2502       \u251c\u2500\u2500 core-queries.resolvers.go\n\u2502       \u251c\u2500\u2500 alerts-*.resolvers.go\n\u2502       \u2514\u2500\u2500 ...                 # One file per domain\n\u2502\n\u251c\u2500\u2500 generated/\n\u2502   \u2514\u2500\u2500 ent/                    # ent ORM generated code (DO NOT EDIT)\n\u2502       \u251c\u2500\u2500 client.go           # ent.Client (main entry point)\n\u2502       \u251c\u2500\u2500 schema.go           # Schema definitions\n\u2502       \u2514\u2500\u2500 ...\n\u2502\n\u251c\u2500\u2500 internal/                   # Core domain logic\n\u2502   \u251c\u2500\u2500 bootstrap/              # Service wiring and initialization\n\u2502   \u251c\u2500\u2500 server/                 # HTTP server (Echo v4)\n\u2502   \u251c\u2500\u2500 database/               # SQLite manager (system.db + router-{id}.db)\n\u2502   \u251c\u2500\u2500 events/                 # Watermill event bus\n\u2502   \u251c\u2500\u2500 auth/                   # JWT authentication\n\u2502   \u251c\u2500\u2500 alerts/                 # Alert engine, escalation, digest\n\u2502   \u251c\u2500\u2500 vif/                    # Virtual Interface Factory\n\u2502   \u251c\u2500\u2500 orchestrator/           # Feature lifecycle management\n\u2502   \u2502   \u251c\u2500\u2500 boot/               # Boot sequence manager\n\u2502   \u2502   \u251c\u2500\u2500 dependencies/       # Dependency graph\n\u2502   \u2502   \u251c\u2500\u2500 isolation/          # Config validation, isolation verification\n\u2502   \u2502   \u251c\u2500\u2500 lifecycle/          # Instance manager\n\u2502   \u2502   \u251c\u2500\u2500 resources/          # Resource limiter + poller\n\u2502   \u2502   \u251c\u2500\u2500 scheduling/         # Schedule evaluator\n\u2502   \u2502   \u2514\u2500\u2500 supervisor/         # Process supervisor\n\u2502   \u251c\u2500\u2500 router/                 # MikroTik adapters (SSH, REST, API, Telnet)\n\u2502   \u251c\u2500\u2500 provisioning/           # Network provisioning engine\n\u2502   \u251c\u2500\u2500 features/               # Feature registry, download, verification\n\u2502   \u251c\u2500\u2500 notifications/          # Notification channels (email, telegram, etc.)\n\u2502   \u251c\u2500\u2500 services/               # Domain service layer (alert, router, VPN, etc.)\n\u2502   \u251c\u2500\u2500 firewall/               # Firewall rules (address lists, NAT)\n\u2502   \u251c\u2500\u2500 network/                # Port registry, VLAN allocator\n\u2502   \u251c\u2500\u2500 dns/                    # DNS lookup and resolver\n\u2502   \u251c\u2500\u2500 scanner/                # Network scanner (ARP/subnet discovery)\n\u2502   \u251c\u2500\u2500 storage/                # Storage detector, path resolver\n\u2502   \u251c\u2500\u2500 encryption/             # AES-256-GCM credential encryption\n\u2502   \u251c\u2500\u2500 credentials/            # Router credential management\n\u2502   \u251c\u2500\u2500 capability/             # Router capability detection + caching\n\u2502   \u251c\u2500\u2500 templates/              # Service template management\n\u2502   \u251c\u2500\u2500 traceroute/             # Traceroute implementation\n\u2502   \u251c\u2500\u2500 troubleshoot/           # Troubleshooting wizard\n\u2502   \u251c\u2500\u2500 graphql/                # DataLoaders, directives\n\u2502   \u251c\u2500\u2500 middleware/             # Auth middleware, request ID\n\u2502   \u2514\u2500\u2500 ...\n\u2502\n\u251c\u2500\u2500 internal/ent-schema/\n\u2502   \u2514\u2500\u2500 schema/                 # ent schema definitions (source of truth)\n\u2502\n\u251c\u2500\u2500 go.mod                      # Module: backend (Go 1.26)\n\u251c\u2500\u2500 go.sum\n\u251c\u2500\u2500 Dockerfile                  # Multi-stage build (<10MB)\n\u2514\u2500\u2500 project.json                # Nx project config\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"common-development-commands",children:"Common Development Commands"}),"\n",(0,i.jsx)(n.h3,{id:"run-the-backend-with-hot-reload",children:"Run the backend (with hot reload)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Hot-reload via air (recommended)\nnpm run dev:backend\n\n# Or directly with go run\ncd apps/backend\ngo run -tags=dev ./cmd/nnc/\n"})}),"\n",(0,i.jsx)(n.h3,{id:"run-the-frontend--backend-together",children:"Run the frontend + backend together"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"npm run dev:all\n"})}),"\n",(0,i.jsx)(n.h3,{id:"build-for-production",children:"Build for production"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Build frontend first (required \u2014 gets embedded)\nnpm run build:frontend\n\n# Then build Go binary with embedded frontend\nnpx nx build backend\n"})}),"\n",(0,i.jsx)(n.h3,{id:"run-go-tests",children:"Run Go tests"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# All backend tests\nnpx nx run backend:test\n\n# Or directly\ncd apps/backend\ngo test -tags=dev ./...\n\n# Specific package\ngo test -tags=dev ./internal/alerts/...\n\n# With verbose output\ngo test -tags=dev -v ./internal/vif/...\n"})}),"\n",(0,i.jsx)(n.h3,{id:"linting-use-small-scopes-to-avoid-parallel-lint-errors",children:"Linting (use small scopes to avoid parallel lint errors)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Single package\ncd apps/backend\ngolangci-lint run ./internal/specific_package/\n\n# Build + vet check (faster than full lint)\ngo build ./...\ngo vet ./...\n"})}),"\n",(0,i.jsx)(n.h3,{id:"graphql-code-generation",children:"GraphQL code generation"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# After changing schema/*.graphql files\nnpm run codegen:gqlgen    # Regenerates graph/generated.go and models_gen.go\nnpm run codegen:ent       # Regenerates generated/ent/\nnpm run codegen           # Both TypeScript + Go\n"})}),"\n",(0,i.jsx)(n.h3,{id:"health-check",children:"Health check"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# While server is running on port 8080 (dev)\ncurl http://localhost:8080/health\n\n# Using the built-in health check flag\n./nnc --healthcheck\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"step-by-step-startup-sequence",children:"Step-by-Step Startup Sequence"}),"\n",(0,i.jsxs)(n.p,{children:["When the application starts in ",(0,i.jsx)(n.strong,{children:"production"})," (",(0,i.jsx)(n.code,{children:"main_prod.go"}),"), it follows this sequence:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"1. init() \u2014 Apply runtime config (GOMAXPROCS=1, GC=10%, MEM=32MB)\n           \u2014 Initialize scanner pool\n\n2. run()  \u2014 Load server config (Port from $PORT, default :80)\n           \u2014 Load runtime config (from DefaultProdRuntimeConfig)\n           \u2014 Initialize EventBus (Watermill, buffer=256)\n           \u2014 Initialize Database (SQLite, $NASNET_DATA_DIR or /var/nasnet)\n           \u2014 Initialize Logger (zap production config)\n           \u2014 Initialize MockRouterAdapter (placeholder)\n           \u2014 Initialize core services (troubleshoot, interface)\n           \u2014 Initialize Alert System (engine, dispatcher, escalation, digest)\n           \u2014 Initialize All Production Services (13 service groups)\n           \u2014 Create HTTP server (Echo v4)\n           \u2014 Apply production middleware\n           \u2014 Serve embedded frontend (from dist/)\n           \u2014 Create ShutdownCoordinator\n           \u2014 Register all routes (/graphql, /api/*, /*)\n           \u2014 Start Boot Sequence (goroutine: auto-start services)\n           \u2014 Print startup banner\n           \u2014 Start HTTP server (blocking)\n           \u2014 On SIGINT/SIGTERM: graceful shutdown via ShutdownCoordinator\n"})}),"\n",(0,i.jsxs)(n.p,{children:["In ",(0,i.jsx)(n.strong,{children:"development"})," (",(0,i.jsx)(n.code,{children:"main_dev.go"}),"), the sequence is simpler (no bootstrap abstraction, fewer services)."]}),"\n",(0,i.jsx)(n.p,{children:"[See: application-bootstrap.md \xa7Service Initialization Order]"}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"environment-variables-reference",children:"Environment Variables Reference"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Variable"}),(0,i.jsx)(n.th,{children:"Default"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"PORT"})}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"80"})," (prod) / ",(0,i.jsx)(n.code,{children:"8080"})," (dev)"]}),(0,i.jsx)(n.td,{children:"HTTP listen port"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"NASNET_DATA_DIR"})}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"/var/nasnet"})," (prod) / ",(0,i.jsx)(n.code,{children:"./data"})," (dev)"]}),(0,i.jsx)(n.td,{children:"SQLite database directory"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DB_ENCRYPTION_KEY"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.em,{children:"(auto-generated dummy)"})}),(0,i.jsx)(n.td,{children:"AES-256 key for credential encryption (base64, 32 bytes)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"GITHUB_TOKEN"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.em,{children:"(empty)"})}),(0,i.jsx)(n.td,{children:"GitHub token for feature binary downloads"})]})]})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"running-tests",children:"Running Tests"}),"\n",(0,i.jsx)(n.h3,{id:"unit-tests",children:"Unit tests"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd apps/backend\ngo test -tags=dev ./...\n"})}),"\n",(0,i.jsx)(n.h3,{id:"tests-with-chr-routeros-simulator",children:"Tests with CHR (RouterOS simulator)"}),"\n",(0,i.jsxs)(n.p,{children:["For integration tests that require a real RouterOS instance, the project uses CHR (Cloud Hosted Router) in Docker. See ",(0,i.jsx)(n.code,{children:"Docs/architecture/implementation-patterns/testing-strategy-patterns.md"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"test-coverage",children:"Test coverage"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"go test -tags=dev -coverprofile=coverage.out ./...\ngo tool cover -html=coverage.out\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"debugging-tips",children:"Debugging Tips"}),"\n",(0,i.jsx)(n.h3,{id:"enable-debug-logging",children:"Enable debug logging"}),"\n",(0,i.jsxs)(n.p,{children:["Set ",(0,i.jsx)(n.code,{children:"loggerConfig.Level = zap.NewAtomicLevelAt(zap.DebugLevel)"})," in ",(0,i.jsx)(n.code,{children:"main_dev.go"})," (already done in dev mode)."]}),"\n",(0,i.jsx)(n.h3,{id:"inspect-the-graphql-schema",children:"Inspect the GraphQL schema"}),"\n",(0,i.jsxs)(n.p,{children:["Navigate to ",(0,i.jsx)(n.code,{children:"http://localhost:8080/playground"})," in dev mode for the interactive GraphQL playground (GraphiQL)."]}),"\n",(0,i.jsx)(n.h3,{id:"sqlite-inspection",children:"SQLite inspection"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Open the system database\nsqlite3 ./data/system.db\n\n# List tables\n.tables\n\n# Query service instances\nSELECT id, name, status FROM service_instances;\n"})}),"\n",(0,i.jsx)(n.h3,{id:"check-goroutine-leaks",children:"Check goroutine leaks"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"curl http://localhost:8080/debug/pprof/goroutine?debug=2\n"})}),"\n",(0,i.jsx)(n.p,{children:"(Only if pprof is enabled in dev mode)"}),"\n",(0,i.jsx)(n.h3,{id:"common-startup-failures",children:"Common startup failures"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Error"}),(0,i.jsx)(n.th,{children:"Cause"}),(0,i.jsx)(n.th,{children:"Fix"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"failed to create data directory"})}),(0,i.jsx)(n.td,{children:"Insufficient permissions"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"mkdir -p ./data && chmod 755 ./data"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"integrity check failed"})}),(0,i.jsx)(n.td,{children:"Corrupted SQLite DB"}),(0,i.jsxs)(n.td,{children:["Delete ",(0,i.jsx)(n.code,{children:"./data/system.db"})," and restart"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"failed to create event bus"})}),(0,i.jsx)(n.td,{children:"Invalid buffer size"}),(0,i.jsxs)(n.td,{children:["Check ",(0,i.jsx)(n.code,{children:"RuntimeConfig.EventBusBufferSize > 0"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"dist/**"})," embed fails"]}),(0,i.jsx)(n.td,{children:"Frontend not built"}),(0,i.jsxs)(n.td,{children:["Run ",(0,i.jsx)(n.code,{children:"npm run build:frontend"})," first"]})]})]})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"cross-references",children:"Cross-References"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"[See: index.md \xa7Package Dependency Diagram] \u2014 How packages relate to each other"}),"\n",(0,i.jsx)(n.li,{children:"[See: application-bootstrap.md \xa7Service Initialization Order] \u2014 Detailed bootstrap sequence"}),"\n",(0,i.jsx)(n.li,{children:"[See: graphql-api.md \xa7Overview] \u2014 GraphQL schema and resolver patterns"}),"\n",(0,i.jsx)(n.li,{children:"[See: data-layer.md \xa7Database Manager] \u2014 SQLite and ent ORM details"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},71184:(e,n,r)=>{r.d(n,{R:()=>d,x:()=>l});var t=r(14041);const i={},s=t.createContext(i);function d(e){const n=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);