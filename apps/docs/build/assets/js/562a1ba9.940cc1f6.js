"use strict";(globalThis.webpackChunk_nas_net_docs=globalThis.webpackChunk_nas_net_docs||[]).push([[28110],{5843:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>t,metadata:()=>o,toc:()=>d});const o=JSON.parse('{"id":"feature-logs","title":"Feature: Logs (libs/features/logs)","description":"Overview","source":"@site/../../libs/features/docs/feature-logs.md","sourceDirName":".","slug":"/feature-logs","permalink":"/docs/features/feature-logs","draft":false,"unlisted":false,"editUrl":"https://github.com/nasnet-community/nasnet-panel/tree/main/../../libs/features/docs/feature-logs.md","tags":[],"version":"current","frontMatter":{},"sidebar":"sidebar","previous":{"title":"Feature Module: Firewall (libs/features/firewall)","permalink":"/docs/features/feature-firewall"},"next":{"title":"Feature: Wireless, Router Discovery, and Configuration Import","permalink":"/docs/features/feature-minor"}}');var i=s(31085),r=s(71184);const t={},c="Feature: Logs (libs/features/logs)",l={},d=[{value:"Overview",id:"overview",level:2},{value:"Directory Tree",id:"directory-tree",level:2},{value:"Public API",id:"public-api",level:2},{value:"Component Table",id:"component-table",level:2},{value:"IndexedDB Caching",id:"indexeddb-caching",level:2},{value:"LogCache Class",id:"logcache-class",level:3},{value:"Singleton Pattern",id:"singleton-pattern",level:3},{value:"useLogCache Hook",id:"uselogcache-hook",level:3},{value:"Log Correlation and Grouping",id:"log-correlation-and-grouping",level:2},{value:"LogGroup Type",id:"loggroup-type",level:3},{value:"Hook Signature",id:"hook-signature",level:3},{value:"Grouping Algorithms",id:"grouping-algorithms",level:3},{value:"Usage in LogViewer",id:"usage-in-logviewer",level:3},{value:"Log Action Registry",id:"log-action-registry",level:2},{value:"LogAction Type",id:"logaction-type",level:3},{value:"Topic-Specific Actions",id:"topic-specific-actions",level:3},{value:"Common Actions (All Topics)",id:"common-actions-all-topics",level:3},{value:"getActionsForTopic Function",id:"getactionsfortopic-function",level:3},{value:"extractDataFromMessage Function",id:"extractdatafrommessage-function",level:3},{value:"LogActionMenu Component",id:"logactionmenu-component",level:3},{value:"Bookmark System",id:"bookmark-system",level:2},{value:"useLogBookmarks Hook",id:"uselogbookmarks-hook",level:3},{value:"Alert System",id:"alert-system",level:2},{value:"AlertRule Type",id:"alertrule-type",level:3},{value:"LogAlertService",id:"logalertservice",level:3},{value:"useLogAlerts Hook",id:"uselogalerts-hook",level:3},{value:"AlertSettingsDialog Component",id:"alertsettingsdialog-component",level:3},{value:"Log Settings Dialog",id:"log-settings-dialog",level:2},{value:"Two-Tab Layout",id:"two-tab-layout",level:3},{value:"Integration with LogViewer",id:"integration-with-logviewer",level:2},{value:"Testing",id:"testing",level:2},{value:"Storybook",id:"storybook",level:2},{value:"Design Decisions",id:"design-decisions",level:2},{value:"Cross-References",id:"cross-references",level:2}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsxs)(n.h1,{id:"feature-logs-libsfeatureslogs",children:["Feature: Logs (",(0,i.jsx)(n.code,{children:"libs/features/logs"}),")"]})}),"\n",(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsxs)(n.p,{children:["The logs feature module provides advanced log management for the NasNetConnect platform. It extends the base log viewing capability (provided by ",(0,i.jsx)(n.code,{children:"@nasnet/ui/patterns"}),") with five enhanced subsystems: IndexedDB offline caching, log correlation and grouping, a topic-specific action registry, a bookmark system, and real-time alert rules. These capabilities are consumed by the ",(0,i.jsx)(n.code,{children:"LogViewer"})," component in ",(0,i.jsx)(n.code,{children:"@nasnet/features/dashboard"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Epic reference:"})," Epic 0.8 \u2014 System Logs (Enhanced Features)"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Public import path:"})," ",(0,i.jsx)(n.code,{children:"@nasnet/features/logs"})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"directory-tree",children:"Directory Tree"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"libs/features/logs/src/\n\u251c\u2500\u2500 index.ts                          # Barrel export (public API)\n\u251c\u2500\u2500 actions/\n\u2502   \u251c\u2500\u2500 LogActionMenu.tsx             # Context menu dropdown for log entries\n\u2502   \u251c\u2500\u2500 logActionRegistry.ts          # Topic \u2192 LogAction[] mapping\n\u2502   \u2514\u2500\u2500 index.ts\n\u251c\u2500\u2500 alerts/\n\u2502   \u251c\u2500\u2500 AlertSettingsDialog.tsx       # Dialog: configure alert rules + notifications\n\u2502   \u251c\u2500\u2500 LogAlertService.ts            # Singleton: alert matching and notification dispatch\n\u2502   \u251c\u2500\u2500 useLogAlerts.ts               # Hook: alert settings management\n\u2502   \u2514\u2500\u2500 index.ts\n\u251c\u2500\u2500 bookmarks/\n\u2502   \u251c\u2500\u2500 useLogBookmarks.ts            # Hook: sessionStorage bookmark persistence\n\u2502   \u2514\u2500\u2500 index.ts\n\u251c\u2500\u2500 cache/\n\u2502   \u251c\u2500\u2500 logCache.ts                   # LogCache class + getLogCache() singleton\n\u2502   \u251c\u2500\u2500 useLogCache.ts                # Hook: cache lifecycle management\n\u2502   \u2514\u2500\u2500 index.ts\n\u251c\u2500\u2500 correlation/\n\u2502   \u251c\u2500\u2500 useLogCorrelation.ts          # Hook: time-window and topic-based grouping\n\u2502   \u2514\u2500\u2500 index.ts\n\u2514\u2500\u2500 settings/\n    \u251c\u2500\u2500 LogSettingsDialog.tsx         # Dialog: RouterOS logging rules + destinations\n    \u2514\u2500\u2500 index.ts\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"public-api",children:"Public API"}),"\n",(0,i.jsxs)(n.p,{children:["Exported from ",(0,i.jsx)(n.code,{children:"libs/features/logs/src/index.ts"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// Cache\nexport { LogCache, getLogCache } from './cache/logCache';\nexport type { CachedLogEntry, LogCacheConfig } from './cache/logCache';\nexport { useLogCache } from './cache/useLogCache';\nexport type { UseLogCacheOptions, UseLogCacheReturn } from './cache/useLogCache';\n\n// Correlation\nexport { useLogCorrelation } from './correlation/useLogCorrelation';\nexport type {\n  LogGroup, UseLogCorrelationOptions, UseLogCorrelationReturn\n} from './correlation/useLogCorrelation';\n\n// Actions\nexport { LogActionMenu } from './actions/LogActionMenu';\nexport type { LogActionMenuProps } from './actions/LogActionMenu';\nexport {\n  logActionsByTopic, commonLogActions,\n  getActionsForTopic, extractDataFromMessage,\n} from './actions/logActionRegistry';\nexport type { LogAction } from './actions/logActionRegistry';\n\n// Bookmarks\nexport { useLogBookmarks } from './bookmarks/useLogBookmarks';\nexport type { UseLogBookmarksReturn } from './bookmarks/useLogBookmarks';\n\n// Alerts\nexport { AlertSettingsDialog } from './alerts/AlertSettingsDialog';\nexport type { AlertSettingsDialogProps } from './alerts/AlertSettingsDialog';\nexport { useLogAlerts } from './alerts/useLogAlerts';\nexport { LogAlertService } from './alerts/LogAlertService';\nexport type { AlertRule, NotificationPreference } from './alerts/LogAlertService';\n\n// Settings\nexport { LogSettingsDialog } from './settings/LogSettingsDialog';\nexport type { LogSettingsDialogProps } from './settings/LogSettingsDialog';\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"component-table",children:"Component Table"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Component / Export"}),(0,i.jsx)(n.th,{children:"File"}),(0,i.jsx)(n.th,{children:"Purpose"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"LogActionMenu"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"actions/LogActionMenu.tsx"})}),(0,i.jsx)(n.td,{children:"Dropdown context menu for a log entry"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"logActionsByTopic"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"actions/logActionRegistry.ts"})}),(0,i.jsx)(n.td,{children:"Topic-keyed action registry record"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"commonLogActions"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"actions/logActionRegistry.ts"})}),(0,i.jsx)(n.td,{children:"Copy / Bookmark / View Details actions"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"getActionsForTopic"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"actions/logActionRegistry.ts"})}),(0,i.jsx)(n.td,{children:"Returns topic + common actions for a topic"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"extractDataFromMessage"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"actions/logActionRegistry.ts"})}),(0,i.jsx)(n.td,{children:"Regex extraction from log message"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"AlertSettingsDialog"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"alerts/AlertSettingsDialog.tsx"})}),(0,i.jsx)(n.td,{children:"Alert rules configuration dialog"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"LogAlertService"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"alerts/LogAlertService.ts"})}),(0,i.jsx)(n.td,{children:"Singleton: alert dispatch service"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"useLogAlerts"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"alerts/useLogAlerts.ts"})}),(0,i.jsx)(n.td,{children:"Alert settings state management hook"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"useLogBookmarks"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"bookmarks/useLogBookmarks.ts"})}),(0,i.jsx)(n.td,{children:"sessionStorage bookmark hook"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"LogCache"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"cache/logCache.ts"})}),(0,i.jsx)(n.td,{children:"IndexedDB log cache class"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"getLogCache"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"cache/logCache.ts"})}),(0,i.jsx)(n.td,{children:"Singleton accessor for LogCache"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"useLogCache"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"cache/useLogCache.ts"})}),(0,i.jsx)(n.td,{children:"Cache lifecycle React hook"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"useLogCorrelation"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"correlation/useLogCorrelation.ts"})}),(0,i.jsx)(n.td,{children:"Log grouping by time or topic"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"LogSettingsDialog"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"settings/LogSettingsDialog.tsx"})}),(0,i.jsx)(n.td,{children:"RouterOS logging rules dialog"})]})]})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"indexeddb-caching",children:"IndexedDB Caching"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Files:"})," ",(0,i.jsx)(n.code,{children:"cache/logCache.ts"}),", ",(0,i.jsx)(n.code,{children:"cache/useLogCache.ts"})]}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"LogCache"})," class provides persistent log storage using IndexedDB. This enables offline access to previously fetched logs when the router connection is lost or unavailable."]}),"\n",(0,i.jsx)(n.h3,{id:"logcache-class",children:"LogCache Class"}),"\n",(0,i.jsx)(n.p,{children:"Database configuration:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Database name:"})," ",(0,i.jsx)(n.code,{children:"nasnet-logs"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Version:"})," 1"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Object store:"})," ",(0,i.jsx)(n.code,{children:"logs"})," (keyPath: ",(0,i.jsx)(n.code,{children:"id"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Indexes:"})," ",(0,i.jsx)(n.code,{children:"routerIp"}),", ",(0,i.jsx)(n.code,{children:"timestamp"}),", ",(0,i.jsx)(n.code,{children:"topic"}),", ",(0,i.jsx)(n.code,{children:"severity"}),", ",(0,i.jsx)(n.code,{children:"expiresAt"})]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Default configuration:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["TTL: 7 days (",(0,i.jsx)(n.code,{children:"DEFAULT_TTL_DAYS = 7"}),")"]}),"\n",(0,i.jsx)(n.li,{children:"Max entries: 10,000"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"export class LogCache {\n  constructor(config?: Partial<LogCacheConfig>)\n\n  // Open database (idempotent, safe to call multiple times)\n  async init(): Promise<void>\n\n  // Store log entries for a router\n  async storeLogs(routerIp: string, logs: LogEntry[]): Promise<void>\n\n  // Retrieve non-expired entries (sorted newest first)\n  async getLogs(routerIp: string, limit?: number): Promise<CachedLogEntry[]>\n\n  // Delete all entries with expiresAt < now\n  async cleanupExpired(): Promise<number>\n\n  // Delete all entries from the store\n  async clearAll(): Promise<void>\n\n  // Get entry count and timestamp bounds\n  async getStats(): Promise<{\n    totalEntries: number;\n    oldestEntry: Date | null;\n    newestEntry: Date | null;\n  }>\n\n  // Close the IDBDatabase connection\n  close(): void\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Each stored entry is a ",(0,i.jsx)(n.code,{children:"CachedLogEntry"})," extending ",(0,i.jsx)(n.code,{children:"LogEntry"})," with three cache metadata fields:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"export interface CachedLogEntry extends LogEntry {\n  routerIp:  string;   // Router this log belongs to\n  cachedAt:  number;   // Unix timestamp when cached\n  expiresAt: number;   // Unix timestamp when TTL expires\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"getLogs()"})," method filters entries against ",(0,i.jsx)(n.code,{children:"now > expiresAt"})," at read time so callers always receive valid entries without needing an explicit cleanup step."]}),"\n",(0,i.jsx)(n.h3,{id:"singleton-pattern",children:"Singleton Pattern"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"let cacheInstance: LogCache | null = null;\n\nexport function getLogCache(config?: Partial<LogCacheConfig>): LogCache {\n  if (!cacheInstance) {\n    cacheInstance = new LogCache(config);\n  }\n  return cacheInstance;\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["All React hooks and components use ",(0,i.jsx)(n.code,{children:"getLogCache()"})," rather than constructing ",(0,i.jsx)(n.code,{children:"LogCache"})," directly. This ensures a single IDBDatabase connection is shared across the application. The configuration passed to the first call wins; subsequent calls with different config are ignored."]}),"\n",(0,i.jsx)(n.h3,{id:"uselogcache-hook",children:"useLogCache Hook"}),"\n",(0,i.jsxs)(n.p,{children:["React hook wrapping the singleton ",(0,i.jsx)(n.code,{children:"LogCache"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const {\n  cachedLogs,    // CachedLogEntry[] (from IndexedDB)\n  isLoading,     // true during initial fetch\n  isOffline,     // true when navigator.onLine === false\n  cacheStats,    // { totalEntries, oldestEntry, newestEntry } | null\n  storeLogs,     // (logs: LogEntry[]) => Promise<void>\n  clearCache,    // () => Promise<void>\n  refreshCache,  // () => Promise<void>\n} = useLogCache({ routerIp, config?, enabled? });\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Offline detection:"})," The hook subscribes to ",(0,i.jsx)(n.code,{children:"window.addEventListener('online' | 'offline')"})," events. When ",(0,i.jsx)(n.code,{children:"isOffline"})," is true, the ",(0,i.jsx)(n.code,{children:"LogViewer"})," automatically switches to displaying ",(0,i.jsx)(n.code,{children:"cachedLogs"})," instead of live data, with a banner informing the user they are viewing cached content."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Lifecycle:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["On mount: calls ",(0,i.jsx)(n.code,{children:"refreshCache()"})," to load existing entries from IndexedDB"]}),"\n",(0,i.jsxs)(n.li,{children:["On mount: calls ",(0,i.jsx)(n.code,{children:"cache.cleanupExpired()"})," to evict stale entries"]}),"\n",(0,i.jsxs)(n.li,{children:["When ",(0,i.jsx)(n.code,{children:"storeLogs()"})," is called: stores new entries and updates ",(0,i.jsx)(n.code,{children:"cacheStats"})]}),"\n",(0,i.jsx)(n.li,{children:"On unmount: no explicit cleanup needed (IDB connection persists for app lifetime)"}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"log-correlation-and-grouping",children:"Log Correlation and Grouping"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"File:"})," ",(0,i.jsx)(n.code,{children:"correlation/useLogCorrelation.ts"})]}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"useLogCorrelation"})," hook provides intelligent log grouping. It can group entries either by time proximity or by topic, making it easier to identify patterns in bursts of related log activity."]}),"\n",(0,i.jsx)(n.h3,{id:"loggroup-type",children:"LogGroup Type"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"export interface LogGroup {\n  id:             string;     // \"group-{startTimestamp}\" or \"single-{entryId}\"\n  startTime:      Date;\n  endTime:        Date;\n  entries:        LogEntry[];\n  primaryTopic:   string;     // Most frequent topic in the group\n  severityLevel:  'debug' | 'info' | 'warning' | 'error' | 'critical'; // Highest severity\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"hook-signature",children:"Hook Signature"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const {\n  groups,           // LogGroup[] (each group contains 1+ entries)\n  flatLogs,         // LogEntry[] (original, ungrouped)\n  isGrouped,        // boolean - current grouping state\n  toggleGrouping,   // () => void\n  setGroupByTopic,  // (value: boolean) => void\n} = useLogCorrelation(logs, {\n  windowMs:      1000,   // Group entries within 1-second windows\n  groupByTopic:  false,  // false = time-window, true = topic\n  minGroupSize:  2,      // Groups smaller than this become individual entries\n});\n"})}),"\n",(0,i.jsx)(n.h3,{id:"grouping-algorithms",children:"Grouping Algorithms"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsxs)(n.strong,{children:["Time-window grouping (",(0,i.jsx)(n.code,{children:"groupByTimeWindow"}),"):"]})}),"\n",(0,i.jsxs)(n.p,{children:["Sorts logs by timestamp, then groups consecutive entries where the gap between the first entry in the current group and the next entry is less than ",(0,i.jsx)(n.code,{children:"windowMs"}),". Groups with fewer entries than ",(0,i.jsx)(n.code,{children:"minGroupSize"})," are split into individual single-entry groups."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Log stream: [11:00:00.100, 11:00:00.300, 11:00:00.500, 11:00:05.000, 11:00:05.200]\nwindowMs = 1000ms, minGroupSize = 2\n\n\u2192 Group 1: [11:00:00.100, 11:00:00.300, 11:00:00.500]  (all within 1 second)\n\u2192 Group 2: [11:00:05.000, 11:00:05.200]                 (within 1 second)\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsxs)(n.strong,{children:["Topic grouping (",(0,i.jsx)(n.code,{children:"groupByTopicFn"}),"):"]})}),"\n",(0,i.jsxs)(n.p,{children:["Groups all entries sharing the same ",(0,i.jsx)(n.code,{children:"topic"})," value. Useful for analyzing a burst of firewall events across a longer time window regardless of timing. Groups are sorted by ",(0,i.jsx)(n.code,{children:"startTime"})," (earliest entry in the group)."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Severity escalation:"})," Each group records the highest ",(0,i.jsx)(n.code,{children:"severityLevel"})," found among its entries, computed by ",(0,i.jsx)(n.code,{children:"getHighestSeverity()"}),". Order: ",(0,i.jsx)(n.code,{children:"debug < info < warning < error < critical"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Primary topic:"})," Each group records the most frequent ",(0,i.jsx)(n.code,{children:"topic"})," found among its entries, computed by frequency counting in ",(0,i.jsx)(n.code,{children:"getPrimaryTopic()"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"usage-in-logviewer",children:"Usage in LogViewer"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"LogViewer"})," component uses ",(0,i.jsx)(n.code,{children:"useLogCorrelation"})," and passes the resulting ",(0,i.jsx)(n.code,{children:"groups"})," to the ",(0,i.jsx)(n.code,{children:"LogGroupList"})," pattern component:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const { groups, isGrouped, toggleGrouping } = useLogCorrelation(logs, {\n  windowMs: 1000,\n  groupByTopic: false,\n  minGroupSize: 2,\n});\n\nreturn (\n  <>\n    <Button onClick={toggleGrouping}>\n      {isGrouped ? 'Ungroup' : 'Group related'}\n    </Button>\n    <LogGroupList groups={groups} />\n  </>\n);\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"log-action-registry",children:"Log Action Registry"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Files:"})," ",(0,i.jsx)(n.code,{children:"actions/logActionRegistry.ts"}),", ",(0,i.jsx)(n.code,{children:"actions/LogActionMenu.tsx"})]}),"\n",(0,i.jsxs)(n.p,{children:["The action registry maps each ",(0,i.jsx)(n.code,{children:"LogTopic"})," to a set of contextual actions. When a user right-clicks or taps the action button on a log entry, the ",(0,i.jsx)(n.code,{children:"LogActionMenu"})," component fetches the relevant actions and renders them as a dropdown."]}),"\n",(0,i.jsx)(n.h3,{id:"logaction-type",children:"LogAction Type"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"export interface LogAction {\n  id:               string;              // Unique identifier\n  label:            string;              // Display label in menu\n  icon:             string;              // Lucide icon name\n  description?:     string;             // Tooltip text\n  handler:          'navigate' | 'dialog' | 'api';\n  target?:          string;             // Route path or dialog ID\n  extractPattern?:  RegExp;            // Regex to extract data from log message\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"Handler types:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"navigate"})}),": Router pushes to ",(0,i.jsx)(n.code,{children:"target"})," path (with ",(0,i.jsx)(n.code,{children:":id"})," replaced by current router ID)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"dialog"})}),": Opens a dialog identified by ",(0,i.jsx)(n.code,{children:"target"})," string"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"api"})}),": Calls an API endpoint (behavior implemented by the consumer)"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"topic-specific-actions",children:"Topic-Specific Actions"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Topic"}),(0,i.jsx)(n.th,{children:"Actions"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"firewall"})}),(0,i.jsx)(n.td,{children:"View Firewall Rule, Add IP to Whitelist (extracts source IP), Block IP Address (extracts source IP)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"dhcp"})}),(0,i.jsx)(n.td,{children:"View DHCP Lease, Make Lease Static (extracts assigned IP)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"wireless"})}),(0,i.jsx)(n.td,{children:"View Wireless Client, Disconnect Client (extracts MAC address)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"interface"})}),(0,i.jsx)(n.td,{children:"View Interface"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"vpn"})}),(0,i.jsx)(n.td,{children:"View VPN Connection"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"dns"})}),(0,i.jsx)(n.td,{children:"View DNS Settings"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"route"})}),(0,i.jsx)(n.td,{children:"View Routing Table"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ppp"})}),(0,i.jsx)(n.td,{children:"View PPP Connection"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"script"})}),(0,i.jsx)(n.td,{children:"View Scripts"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"system"}),", ",(0,i.jsx)(n.code,{children:"critical"}),", ",(0,i.jsx)(n.code,{children:"info"}),", ",(0,i.jsx)(n.code,{children:"warning"}),", ",(0,i.jsx)(n.code,{children:"error"})]}),(0,i.jsx)(n.td,{children:"(common actions only)"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"common-actions-all-topics",children:"Common Actions (All Topics)"}),"\n",(0,i.jsx)(n.p,{children:"Available on every log entry regardless of topic:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"ID"}),(0,i.jsx)(n.th,{children:"Label"}),(0,i.jsx)(n.th,{children:"Handler"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"copy"})}),(0,i.jsx)(n.td,{children:"Copy Log Entry"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"dialog"})," (target: ",(0,i.jsx)(n.code,{children:"copy"}),")"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"bookmark"})}),(0,i.jsx)(n.td,{children:"Bookmark"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"dialog"})," (target: ",(0,i.jsx)(n.code,{children:"bookmark"}),")"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"view-details"})}),(0,i.jsx)(n.td,{children:"View Details"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"dialog"})," (target: ",(0,i.jsx)(n.code,{children:"details"}),")"]})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"getactionsfortopic-function",children:"getActionsForTopic Function"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"export function getActionsForTopic(topic: LogTopic): LogAction[] {\n  const topicActions = logActionsByTopic[topic] || [];\n  return [...topicActions, ...commonLogActions];\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"extractdatafrommessage-function",children:"extractDataFromMessage Function"}),"\n",(0,i.jsxs)(n.p,{children:["Uses the action's ",(0,i.jsx)(n.code,{children:"extractPattern"})," regex to extract contextual data from a log message. Returns the first capture group:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"export function extractDataFromMessage(message: string, action: LogAction): string | null {\n  if (!action.extractPattern) return null;\n  const match = message.match(action.extractPattern);\n  return match ? match[1] : null;\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"Example:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'// Firewall "add-to-whitelist" action:\n// extractPattern: /from\\s+([\\d.]+)/i\n// message: "forward: in:ether1 out:bridge-local, src-mac ... blocked from 192.168.2.55"\n// Returns: "192.168.2.55"\n'})}),"\n",(0,i.jsx)(n.h3,{id:"logactionmenu-component",children:"LogActionMenu Component"}),"\n",(0,i.jsxs)(n.p,{children:["Dropdown context menu rendered for each log entry in ",(0,i.jsx)(n.code,{children:"LogViewer"})," and ",(0,i.jsx)(n.code,{children:"LogEntryItem"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"interface LogActionMenuProps {\n  entry:          LogEntry;\n  onAction:       (action: LogAction, extractedData: string | null) => void;\n  isBookmarked?:  boolean;       // Controls Pin icon fill state\n  trigger?:       React.ReactNode; // Custom trigger element\n  className?:     string;\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"The component splits actions into two groups:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Topic-specific actions (shown first, above a separator)"}),"\n",(0,i.jsx)(n.li,{children:"Common actions (shown last: copy, bookmark, view-details)"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"bookmark"})," action renders ",(0,i.jsx)(n.code,{children:"Pin"})," icon filled when ",(0,i.jsx)(n.code,{children:"isBookmarked = true"}),". The trigger defaults to a ",(0,i.jsx)(n.code,{children:"MoreVertical"})," icon button with 44px touch target for WCAG AAA compliance."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",children:"<LogActionMenu\n  entry={logEntry}\n  isBookmarked={isBookmarked(logEntry.id)}\n  onAction={(action, extractedData) => {\n    if (action.id === 'bookmark') {\n      toggleBookmark(logEntry);\n    } else if (action.handler === 'navigate') {\n      navigate(action.target!.replace(':id', routerId));\n    }\n  }}\n/>\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"bookmark-system",children:"Bookmark System"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"File:"})," ",(0,i.jsx)(n.code,{children:"bookmarks/useLogBookmarks.ts"})]}),"\n",(0,i.jsxs)(n.p,{children:["Session-scoped bookmark system using ",(0,i.jsx)(n.code,{children:"sessionStorage"})," for persistence. Bookmarks are cleared when the browser tab is closed, which is appropriate for the transient nature of log investigation sessions."]}),"\n",(0,i.jsx)(n.h3,{id:"uselogbookmarks-hook",children:"useLogBookmarks Hook"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const {\n  bookmarkedIds,    // Set<string> \u2014 O(1) lookup\n  bookmarkedLogs,   // LogEntry[] \u2014 full objects for rendering\n  isBookmarked,     // (logId: string) => boolean\n  toggleBookmark,   // (log: LogEntry) => void\n  addBookmark,      // (log: LogEntry) => void\n  removeBookmark,   // (logId: string) => void\n  clearBookmarks,   // () => void\n  count,            // number\n  isMaxReached,     // boolean \u2014 true when count === 50\n} = useLogBookmarks();\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Storage key:"})," ",(0,i.jsx)(n.code,{children:"nasnet-log-bookmarks"})," (sessionStorage)"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Maximum bookmarks:"})," 50 (",(0,i.jsx)(n.code,{children:"MAX_BOOKMARKS = 50"}),"). When the limit is reached, ",(0,i.jsx)(n.code,{children:"addBookmark"})," is a no-op and logs a console warning."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Persistence:"})," Bookmarked log entries are serialized to JSON on every change via ",(0,i.jsx)(n.code,{children:"React.useEffect"}),". On load, ",(0,i.jsx)(n.code,{children:"Date"})," timestamp fields are re-hydrated from ISO strings to ",(0,i.jsx)(n.code,{children:"Date"})," objects."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"O(1) lookup:"})," ",(0,i.jsx)(n.code,{children:"bookmarkedIds"})," is a ",(0,i.jsx)(n.code,{children:"Set<string>"})," computed from ",(0,i.jsx)(n.code,{children:"bookmarkedLogs"})," via ",(0,i.jsx)(n.code,{children:"useMemo"}),". The ",(0,i.jsx)(n.code,{children:"isBookmarked(id)"})," function calls ",(0,i.jsx)(n.code,{children:"bookmarkedIds.has(id)"}),"."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Usage in LogViewer:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'const { bookmarkedLogs, toggleBookmark, isBookmarked } = useLogBookmarks();\n\n// Show bookmarks tab\n<Tabs>\n  <TabsTrigger value="all">All Logs</TabsTrigger>\n  <TabsTrigger value="bookmarked">\n    Pinned <Badge>{bookmarkedLogs.length}</Badge>\n  </TabsTrigger>\n</Tabs>\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"alert-system",children:"Alert System"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Files:"})," ",(0,i.jsx)(n.code,{children:"alerts/AlertSettingsDialog.tsx"}),", ",(0,i.jsx)(n.code,{children:"alerts/LogAlertService.ts"}),", ",(0,i.jsx)(n.code,{children:"alerts/useLogAlerts.ts"})]}),"\n",(0,i.jsx)(n.p,{children:"The alert system watches incoming log entries against user-defined rules and dispatches browser notifications or in-app toast notifications when a rule matches."}),"\n",(0,i.jsx)(n.h3,{id:"alertrule-type",children:"AlertRule Type"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"export interface AlertRule {\n  id:               string;\n  name:             string;\n  enabled:          boolean;\n  topics:           LogTopic[];       // Empty = match all topics\n  severities:       LogSeverity[];    // Empty = match all severities\n  notificationType: NotificationPreference;  // 'browser' | 'toast' | 'both' | 'none'\n  soundEnabled:     boolean;\n  messagePattern?:  string;           // Optional regex pattern for message text\n}\n\nexport type NotificationPreference = 'browser' | 'toast' | 'both' | 'none';\n"})}),"\n",(0,i.jsx)(n.h3,{id:"logalertservice",children:"LogAlertService"}),"\n",(0,i.jsx)(n.p,{children:"Singleton service that:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Maintains the configured alert rules in memory (sourced from ",(0,i.jsx)(n.code,{children:"useLogAlerts"})," settings)"]}),"\n",(0,i.jsx)(n.li,{children:"Processes incoming log entries against all enabled rules"}),"\n",(0,i.jsxs)(n.li,{children:["Dispatches notifications via the Web Notifications API (",(0,i.jsx)(n.code,{children:"Notification.requestPermission()"}),") or in-app toast system"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"uselogalerts-hook",children:"useLogAlerts Hook"}),"\n",(0,i.jsx)(n.p,{children:"Manages alert settings state:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const {\n  settings,                    // { rules, notificationPreference, soundEnabled, isEnabled }\n  isEnabled,                   // boolean\n  setEnabled,                  // (v: boolean) => void\n  setNotificationPreference,   // (v: NotificationPreference) => void\n  setSoundEnabled,             // (v: boolean) => void\n  upsertRule,                  // (rule: AlertRule) => void  (create or update)\n  removeRule,                  // (id: string) => void\n  toggleRule,                  // (id: string) => void\n  requestPermission,           // () => Promise<NotificationPermission>\n  notificationPermission,      // 'default' | 'granted' | 'denied'\n  isBrowserNotificationSupported, // boolean\n} = useLogAlerts();\n"})}),"\n",(0,i.jsx)(n.h3,{id:"alertsettingsdialog-component",children:"AlertSettingsDialog Component"}),"\n",(0,i.jsx)(n.p,{children:"Full-featured dialog for configuring the alert system:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"interface AlertSettingsDialogProps {\n  trigger?:    React.ReactNode;   // Custom trigger (defaults to Bell icon button)\n  className?:  string;\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"Dialog sections:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Global Enable toggle"}),": Single switch to turn all alerts on/off"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Browser Notification Permission"}),": Displays current permission state (",(0,i.jsx)(n.code,{children:"default"})," / ",(0,i.jsx)(n.code,{children:"granted"})," / ",(0,i.jsx)(n.code,{children:"denied"}),'). Shows "Request Permission" button when not yet granted.']}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Notification Type selector"}),": ",(0,i.jsx)(n.code,{children:"Browser + In-App Toast"})," / ",(0,i.jsx)(n.code,{children:"Browser Only"})," / ",(0,i.jsx)(n.code,{children:"In-App Toast Only"})," / ",(0,i.jsx)(n.code,{children:"None (Logging Only)"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Alert Sound toggle"}),": Enable/disable audio alert sound"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Alert Rules list"}),": Each rule displayed as a card with enable toggle, Edit, and Delete buttons"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Add Rule button"}),": Opens ",(0,i.jsx)(n.code,{children:"RuleEditorDialog"})," (inline sub-component) for new rule creation"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"RuleEditorDialog"})," (inline sub-component in ",(0,i.jsx)(n.code,{children:"AlertSettingsDialog.tsx"}),"):"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Rule name text input"}),"\n",(0,i.jsx)(n.li,{children:"Topics multi-select: toggle-button pills for all 10 log topics (empty = all)"}),"\n",(0,i.jsx)(n.li,{children:"Severities multi-select: toggle-button pills for debug/info/warning/error/critical (empty = all)"}),"\n",(0,i.jsx)(n.li,{children:"Notification type selector"}),"\n",(0,i.jsx)(n.li,{children:"Play Sound toggle"}),"\n",(0,i.jsx)(n.li,{children:"Message Pattern input: optional regex for message text matching"}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"log-settings-dialog",children:"Log Settings Dialog"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"File:"})," ",(0,i.jsx)(n.code,{children:"settings/LogSettingsDialog.tsx"})]}),"\n",(0,i.jsxs)(n.p,{children:["Configures RouterOS logging rules and log storage destinations on the connected router. This dialog modifies the router's ",(0,i.jsx)(n.code,{children:"/system/logging"})," configuration via GraphQL mutations."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"interface LogSettingsDialogProps {\n  trigger?:    React.ReactNode;  // Custom trigger (defaults to Settings icon button)\n  className?:  string;\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"two-tab-layout",children:"Two-Tab Layout"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Rules tab"})," \u2014 Manages ",(0,i.jsx)(n.code,{children:"/system/logging"})," rules:"]}),"\n",(0,i.jsx)(n.p,{children:"Each rule maps one or more topics to a log action (destination). The tab displays:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Topic(s) the rule captures (e.g., ",(0,i.jsx)(n.code,{children:"firewall"}),", ",(0,i.jsx)(n.code,{children:"dhcp,wireless"}),")"]}),"\n",(0,i.jsx)(n.li,{children:"Destination action (Memory / Disk / Echo / Remote Syslog)"}),"\n",(0,i.jsx)(n.li,{children:"Optional prefix string"}),"\n",(0,i.jsx)(n.li,{children:"Enable/disable toggle"}),"\n",(0,i.jsx)(n.li,{children:"Delete button with confirmation"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:['"Add Rule" button opens an inline ',(0,i.jsx)(n.code,{children:"AddRuleForm"})," with:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Multi-select topic picker (21 available topics including all RouterOS topics)"}),"\n",(0,i.jsxs)(n.li,{children:["Action dropdown: ",(0,i.jsx)(n.code,{children:"memory"})," / ",(0,i.jsx)(n.code,{children:"disk"})," / ",(0,i.jsx)(n.code,{children:"echo"})," / ",(0,i.jsx)(n.code,{children:"remote"})]}),"\n",(0,i.jsx)(n.li,{children:"Optional prefix input"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Uses GraphQL hooks from ",(0,i.jsx)(n.code,{children:"@nasnet/api-client/queries"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"useLoggingRules(routerIp)"})," \u2014 fetch existing rules"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"useCreateLoggingRule(routerIp)"})," \u2014 create new rule"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"useUpdateLoggingRule(routerIp)"})," \u2014 update existing rule"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"useDeleteLoggingRule(routerIp)"})," \u2014 delete rule"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"useToggleLoggingRule(routerIp)"})," \u2014 enable/disable rule"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Destinations tab"})," \u2014 Manages ",(0,i.jsx)(n.code,{children:"/system/logging/action"}),":"]}),"\n",(0,i.jsx)(n.p,{children:"Displays log action configurations. Each action type has configurable parameters:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Action Type"}),(0,i.jsx)(n.th,{children:"Configurable Parameters"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"memory"})}),(0,i.jsx)(n.td,{children:"Memory Lines (1\u201365535, default 1000)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"disk"})}),(0,i.jsx)(n.td,{children:"File Count (1\u201365535), Lines Per File (1\u201365535)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"remote"})}),(0,i.jsx)(n.td,{children:"Remote Server IP, Port (1\u201365535, default 514)"})]})]})]}),"\n",(0,i.jsxs)(n.p,{children:["Uses ",(0,i.jsx)(n.code,{children:"useLoggingActions(routerIp)"})," and ",(0,i.jsx)(n.code,{children:"useUpdateLoggingAction(routerIp)"})," from the API client."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"integration-with-logviewer",children:"Integration with LogViewer"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"LogViewer"})," component (in ",(0,i.jsx)(n.code,{children:"@nasnet/features/dashboard/src/logs/LogViewer.tsx"}),") imports and integrates all five subsystems:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import {\n  useLogBookmarks,         // Bookmark management\n  useLogCorrelation,       // Group-by-time grouping\n  useLogAlerts,            // Alert rule matching\n  useLogCache,             // Offline caching\n  LogSettingsDialog,       // RouterOS settings dialog\n  AlertSettingsDialog,     // Alert configuration dialog\n} from '@nasnet/features/logs';\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Integration pattern:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// 1. Fetch live logs\nconst { data: logs } = useSystemLogs(routerIp, { limit });\n\n// 2. Cache live logs for offline access\nconst { storeLogs, cachedLogs, isOffline } = useLogCache({ routerIp });\nuseEffect(() => { if (logs.length > 0) storeLogs(logs); }, [logs]);\n\n// 3. Display cached logs when offline\nconst displayLogs = isOffline ? cachedLogs : logs;\n\n// 4. Group display logs\nconst { groups, isGrouped, toggleGrouping } = useLogCorrelation(displayLogs);\n\n// 5. Bookmark management\nconst { isBookmarked, toggleBookmark } = useLogBookmarks();\n\n// 6. Alert processing (runs in background)\nconst { settings: alertSettings } = useLogAlerts();\n\n// 7. Action menu on each entry\n<LogActionMenu\n  entry={entry}\n  isBookmarked={isBookmarked(entry.id)}\n  onAction={handleAction}\n/>\n\n// 8. Settings controls in toolbar\n<AlertSettingsDialog />\n<LogSettingsDialog />\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Display modes:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"All logs"})," tab: Shows grouped or flat entries"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Bookmarked"})," tab: Shows only ",(0,i.jsx)(n.code,{children:"bookmarkedLogs"})," from ",(0,i.jsx)(n.code,{children:"useLogBookmarks"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Offline mode"}),": Shows ",(0,i.jsx)(n.code,{children:"cachedLogs"}),' with amber "Viewing cached data" banner']}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"testing",children:"Testing"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# All logs tests\nnpx nx test logs\n\n# Specific subsystem tests\nnpx nx test logs --testPathPattern=logCache\nnpx nx test logs --testPathPattern=useLogCache\nnpx nx test logs --testPathPattern=useLogBookmarks\nnpx nx test logs --testPathPattern=useLogCorrelation\nnpx nx test logs --testPathPattern=logActionRegistry\n"})}),"\n",(0,i.jsx)(n.p,{children:"Test files:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"cache/logCache.test.ts"})," \u2014 IndexedDB CRUD operations, TTL filtering, stats"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"cache/useLogCache.test.ts"})," \u2014 Hook lifecycle, offline detection, cleanup"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"bookmarks/useLogBookmarks.test.ts"})," \u2014 Add/remove/toggle, max limit, sessionStorage"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"correlation/useLogCorrelation.test.ts"})," \u2014 Time window grouping, topic grouping, severity escalation"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"actions/logActionRegistry.test.ts"})," \u2014 ",(0,i.jsx)(n.code,{children:"getActionsForTopic"}),", ",(0,i.jsx)(n.code,{children:"extractDataFromMessage"})," with patterns"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"storybook",children:"Storybook"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"npx nx run logs:storybook\n"})}),"\n",(0,i.jsx)(n.p,{children:"Available story files:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"actions/LogActionMenu.stories.tsx"})," \u2014 Menu with firewall/dhcp/wireless entries, bookmarked state"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"settings/LogSettingsDialog.stories.tsx"})," \u2014 Rules tab, destinations tab, empty state"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"design-decisions",children:"Design Decisions"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"sessionStorage for bookmarks (not localStorage or IndexedDB):"})," Bookmarks are for the current investigation session. Using sessionStorage provides automatic cleanup when the tab closes, preventing bookmark accumulation from past sessions that would clutter the UI."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"IndexedDB for log cache (not localStorage):"})," Log entries can number in the thousands and contain variable-length message strings. localStorage has a 5MB quota limit and is synchronous, making it unsuitable. IndexedDB handles up to several GB of structured data with async API."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Singleton LogCache instance:"})," IndexedDB supports multiple concurrent connections, but a single instance avoids redundant ",(0,i.jsx)(n.code,{children:"openDatabase()"})," calls and ensures consistent configuration across all consumers. The singleton is application-scoped (module-level ",(0,i.jsx)(n.code,{children:"let cacheInstance"}),"), not React-context-scoped."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Action registry as static data (not GraphQL):"})," Log actions are determined by topic and are the same for all routers and users. Making them static avoids a network round-trip on every log entry render. The ",(0,i.jsx)(n.code,{children:"extractPattern"})," regex values are also static and compile once at module load time."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsxs)(n.strong,{children:[(0,i.jsx)(n.code,{children:"minGroupSize = 2"})," for correlation:"]})," A group of one entry is visually indistinguishable from an ungrouped entry. The minimum of 2 ensures grouping only creates visual affordances when there is actually a pattern worth highlighting."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"cross-references",children:"Cross-References"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Dashboard LogViewer:"})," ",(0,i.jsx)(n.a,{href:"/docs/features/feature-dashboard",children:"feature-dashboard.md"})," \u2014 ",(0,i.jsx)(n.code,{children:"LogViewer"})," integration details"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Log Pattern Components:"})," ",(0,i.jsx)(n.code,{children:"libs/ui/patterns/src/logs/"})," \u2014 ",(0,i.jsx)(n.code,{children:"LogEntry"}),", ",(0,i.jsx)(n.code,{children:"LogGroupList"}),", ",(0,i.jsx)(n.code,{children:"LogDetailPanel"}),", ",(0,i.jsx)(n.code,{children:"LogSearch"}),", ",(0,i.jsx)(n.code,{children:"LogFilters"}),", ",(0,i.jsx)(n.code,{children:"LogControls"}),", ",(0,i.jsx)(n.code,{children:"LogStats"}),", ",(0,i.jsx)(n.code,{children:"NewEntriesIndicator"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"GraphQL Schema:"})," ",(0,i.jsx)(n.code,{children:"schema/services/logs.graphql"})," \u2014 ",(0,i.jsx)(n.code,{children:"SystemLog"})," type and queries"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"API Client Hooks:"})," ",(0,i.jsx)(n.code,{children:"libs/api-client/queries/src/logs/"})," \u2014 ",(0,i.jsx)(n.code,{children:"useSystemLogs"}),", ",(0,i.jsx)(n.code,{children:"useLoggingRules"}),", ",(0,i.jsx)(n.code,{children:"useLoggingActions"}),", mutation hooks"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Core Types:"})," ",(0,i.jsx)(n.code,{children:"libs/core/types/src/logs/"})," \u2014 ",(0,i.jsx)(n.code,{children:"LogEntry"}),", ",(0,i.jsx)(n.code,{children:"LogTopic"}),", ",(0,i.jsx)(n.code,{children:"LogSeverity"})," type definitions"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},71184:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>c});var o=s(14041);const i={},r=o.createContext(i);function t(e){const n=o.useContext(r);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),o.createElement(r.Provider,{value:n},e.children)}}}]);