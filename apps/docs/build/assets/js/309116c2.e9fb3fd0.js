"use strict";(globalThis.webpackChunk_nas_net_docs=globalThis.webpackChunk_nas_net_docs||[]).push([[51226],{13312:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>p,frontMatter:()=>o,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"guides/graphql-integration-guide","title":"GraphQL Integration Guide","description":"Reference: schema/, libs/api-client/, libs/core/types/ | Universal State v2 Layer 1-3 (API, Cache, Types)","source":"@site/../../libs/core/docs/guides/graphql-integration-guide.md","sourceDirName":"guides","slug":"/guides/graphql-integration-guide","permalink":"/docs/core/guides/graphql-integration-guide","draft":false,"unlisted":false,"editUrl":"https://github.com/nasnet-community/nasnet-panel/tree/main/../../libs/core/docs/guides/graphql-integration-guide.md","tags":[],"version":"current","sidebarPosition":9,"frontMatter":{"sidebar_position":9,"title":"GraphQL Integration Guide"},"sidebar":"sidebar","previous":{"title":"Error Handling Patterns","permalink":"/docs/core/guides/error-handling-patterns"},"next":{"title":"Testing Patterns","permalink":"/docs/core/guides/testing-patterns"}}');var i=r(31085),s=r(71184);const o={sidebar_position:9,title:"GraphQL Integration Guide"},a="GraphQL Integration Guide",l={},c=[{value:"Table of Contents",id:"table-of-contents",level:2},{value:"Type Flow Diagram",id:"type-flow-diagram",level:2},{value:"Code Generation Flow",id:"code-generation-flow",level:2},{value:"Main Codegen Command",id:"main-codegen-command",level:3},{value:"Step 1: TypeScript Codegen",id:"step-1-typescript-codegen",level:3},{value:"Step 2: ent ORM Codegen",id:"step-2-ent-orm-codegen",level:3},{value:"Step 3: gqlgen Codegen",id:"step-3-gqlgen-codegen",level:3},{value:"When to Run Codegen",id:"when-to-run-codegen",level:3},{value:"Core Types vs Generated Types",id:"core-types-vs-generated-types",level:2},{value:"Generated Types",id:"generated-types",level:3},{value:"Core Types",id:"core-types",level:3},{value:"Mapping Generated \u2192 Core",id:"mapping-generated--core",level:3},{value:"Apollo Client Integration",id:"apollo-client-integration",level:2},{value:"Apollo Client Setup",id:"apollo-client-setup",level:3},{value:"Auth Link",id:"auth-link",level:3},{value:"Error Link",id:"error-link",level:3},{value:"Retry Link",id:"retry-link",level:3},{value:"WebSocket Link for Subscriptions",id:"websocket-link-for-subscriptions",level:3},{value:"Using Apollo Hooks",id:"using-apollo-hooks",level:3},{value:"Writing Custom Queries and Mutations",id:"writing-custom-queries-and-mutations",level:2},{value:"Step 1: Update GraphQL Schema",id:"step-1-update-graphql-schema",level:3},{value:"Step 2: Run Codegen",id:"step-2-run-codegen",level:3},{value:"Step 3: Create Query/Mutation File",id:"step-3-create-querymutation-file",level:3},{value:"Step 4: Export from Index",id:"step-4-export-from-index",level:3},{value:"Step 5: Use in Components",id:"step-5-use-in-components",level:3},{value:"Real-Time Updates with Subscriptions",id:"real-time-updates-with-subscriptions",level:2},{value:"Define Subscription in Schema",id:"define-subscription-in-schema",level:3},{value:"Create Subscription Hook",id:"create-subscription-hook",level:3},{value:"Use in Component",id:"use-in-component",level:3},{value:"libs/api-client Directory Structure",id:"libsapi-client-directory-structure",level:2},{value:"Import Paths",id:"import-paths",level:3},{value:"Common Patterns",id:"common-patterns",level:2},{value:"Pattern 1: Query with Polling",id:"pattern-1-query-with-polling",level:3},{value:"Pattern 2: Mutation with Optimistic Response",id:"pattern-2-mutation-with-optimistic-response",level:3},{value:"Pattern 3: Pagination",id:"pattern-3-pagination",level:3},{value:"Pattern 4: Dependent Queries",id:"pattern-4-dependent-queries",level:3},{value:"Pattern 5: Error Mapping",id:"pattern-5-error-mapping",level:3},{value:"Error Handling in GraphQL",id:"error-handling-in-graphql",level:2},{value:"GraphQL Error Structure",id:"graphql-error-structure",level:3},{value:"Handling Validation Errors",id:"handling-validation-errors",level:3},{value:"Handling Network Errors",id:"handling-network-errors",level:3},{value:"Global Error Handling",id:"global-error-handling",level:3},{value:"Testing GraphQL Integrations",id:"testing-graphql-integrations",level:2},{value:"Unit Testing Queries",id:"unit-testing-queries",level:3},{value:"Component Integration Testing",id:"component-integration-testing",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Related Documentation",id:"related-documentation",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"graphql-integration-guide",children:"GraphQL Integration Guide"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Reference:"})," ",(0,i.jsx)(n.code,{children:"schema/"}),", ",(0,i.jsx)(n.code,{children:"libs/api-client/"}),", ",(0,i.jsx)(n.code,{children:"libs/core/types/"})," | Universal State v2 Layer 1-3 (API, Cache, Types)"]}),"\n",(0,i.jsx)(n.p,{children:"This guide documents how NasNetConnect uses GraphQL to connect frontend components with backend services. It covers the complete flow from schema definition through code generation to actual component usage."}),"\n",(0,i.jsx)(n.h2,{id:"table-of-contents",children:"Table of Contents"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#type-flow-diagram",children:"Type Flow Diagram"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#code-generation-flow",children:"Code Generation Flow"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#core-types-vs-generated-types",children:"Core Types vs Generated Types"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#apollo-client-integration",children:"Apollo Client Integration"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#writing-custom-queries-and-mutations",children:"Writing Custom Queries and Mutations"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#real-time-updates-with-subscriptions",children:"Real-Time Updates with Subscriptions"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#libsapi-client-directory-structure",children:"libs/api-client Directory Structure"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#common-patterns",children:"Common Patterns"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#error-handling-in-graphql",children:"Error Handling in GraphQL"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#testing-graphql-integrations",children:"Testing GraphQL Integrations"})}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"type-flow-diagram",children:"Type Flow Diagram"}),"\n",(0,i.jsx)(n.p,{children:"NasNetConnect uses a multi-layered type system where types flow from backend to frontend through GraphQL:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    BACKEND (Go)                                  \u2502\n\u2502                  apps/backend/                                   \u2502\n\u2502  \u251c\u2500 ent/schema/*.go (Entity definitions)                        \u2502\n\u2502  \u2514\u2500 graph/model/*.go (GraphQL models)                           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                       \u2502\n                       \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502           GraphQL Schema (Single Source of Truth)                \u2502\n\u2502                    schema/                                       \u2502\n\u2502  \u251c\u2500 scalars.graphql (IPv4, MAC, Duration)                       \u2502\n\u2502  \u251c\u2500 auth.graphql (Authentication types)                         \u2502\n\u2502  \u251c\u2500 core/*.graphql (Router, interfaces, queries)                \u2502\n\u2502  \u251c\u2500 services/*.graphql (VPN, feature marketplace)               \u2502\n\u2502  \u251c\u2500 network/*.graphql (VLAN, IP, bridges)                       \u2502\n\u2502  \u2514\u2500 ... 25+ schema files                                        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                       \u2502\n        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n        \u2502              \u2502              \u2502\n        \u2193              \u2193              \u2193\n    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n    \u2502  Ent   \u2502   \u2502 gqlgen   \u2502   \u2502 TypeGen \u2502\n    \u2502Generate\u2502   \u2502 Generate \u2502   \u2502         \u2502\n    \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518\n         \u2502             \u2502             \u2502\n         \u2193             \u2193             \u2193\n    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n    \u2502 Generated Code (libs/api-client/)         \u2502\n    \u2502 \u251c\u2500 TypeScript types                       \u2502\n    \u2502 \u251c\u2500 Apollo Client hooks                    \u2502\n    \u2502 \u251c\u2500 Zod schemas                            \u2502\n    \u2502 \u2514\u2500 Go resolvers                           \u2502\n    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                   \u2502\n                   \u2193\n    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n    \u2502 Core Types (libs/core/types/)             \u2502\n    \u2502 \u251c\u2500 Firewall types                         \u2502\n    \u2502 \u251c\u2500 Network types                          \u2502\n    \u2502 \u251c\u2500 Resource types                         \u2502\n    \u2502 \u2514\u2500 Service types                          \u2502\n    \u2502 (Manually maintained, stable API)        \u2502\n    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                   \u2502\n                   \u2193\n    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n    \u2502 Feature Components (libs/features/)       \u2502\n    \u2502 \u251c\u2500 Alerts components                      \u2502\n    \u2502 \u251c\u2500 Firewall components                    \u2502\n    \u2502 \u251c\u2500 Network components                     \u2502\n    \u2502 \u2514\u2500 Dashboard components                   \u2502\n    \u2502 (Use core types for props)                \u2502\n    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Key Flow Points:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Backend defines entities (ent) and GraphQL models (gqlgen)"}),"\n",(0,i.jsx)(n.li,{children:"GraphQL schema is the single source of truth"}),"\n",(0,i.jsx)(n.li,{children:"Multiple generators create different outputs from the schema"}),"\n",(0,i.jsx)(n.li,{children:"Generated code is implementation details (don't import directly)"}),"\n",(0,i.jsx)(n.li,{children:"Core types provide stable API surface for features"}),"\n",(0,i.jsx)(n.li,{children:"Components import from core types, not generated code"}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"code-generation-flow",children:"Code Generation Flow"}),"\n",(0,i.jsx)(n.p,{children:"Code generation in NasNetConnect is a multi-step process with separate generators for different outputs."}),"\n",(0,i.jsx)(n.h3,{id:"main-codegen-command",children:"Main Codegen Command"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"npm run codegen                 # Full codegen (all steps below)\nnpm run codegen:ts              # TypeScript only\nnpm run codegen:ent             # ent ORM only\nnpm run codegen:gqlgen          # gqlgen resolvers only\nnpm run codegen:go              # Both ent + gqlgen\nnpm run codegen:check           # Verify generated code is in sync\n"})}),"\n",(0,i.jsx)(n.h3,{id:"step-1-typescript-codegen",children:"Step 1: TypeScript Codegen"}),"\n",(0,i.jsx)(n.p,{children:"Generates TypeScript types, Apollo Client hooks, and Zod schemas from the GraphQL schema."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"npm run codegen:ts\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Outputs:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"TypeScript Types"})," \u2192 ",(0,i.jsx)(n.code,{children:"libs/api-client/generated/schemas/index.d.ts"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"All GraphQL types as TypeScript interfaces"}),"\n",(0,i.jsx)(n.li,{children:"Query/mutation/subscription variables and responses"}),"\n",(0,i.jsx)(n.li,{children:"Type-safe for all operations"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Apollo Client Hooks"})," \u2192 ",(0,i.jsx)(n.code,{children:"libs/api-client/generated/hooks/"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"useQuery()"}),", ",(0,i.jsx)(n.code,{children:"useMutation()"}),", ",(0,i.jsx)(n.code,{children:"useSubscription()"})," hooks"]}),"\n",(0,i.jsx)(n.li,{children:"Pre-typed with operation variables and responses"}),"\n",(0,i.jsx)(n.li,{children:"One hook per query/mutation/subscription"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Zod Schemas"})," \u2192 ",(0,i.jsx)(n.code,{children:"libs/api-client/generated/schemas/zod/"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Runtime validation schemas for GraphQL responses"}),"\n",(0,i.jsx)(n.li,{children:"Validate data at runtime before using in components"}),"\n",(0,i.jsx)(n.li,{children:"Support for custom scalars (IPv4, MAC, etc.)"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example Generated Hook:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// Generated in libs/api-client/generated/hooks/\nexport const useGetDHCPLeases = (\n  baseOptions?: Apollo.QueryHookOptions<\n    GetDhcpLeasesQuery,\n    GetDhcpLeasesQueryVariables\n  >\n) => {\n  const options = { ...defaultOptions, ...baseOptions };\n  return Apollo.useQuery<GetDhcpLeasesQuery, GetDhcpLeasesQueryVariables>(\n    GetDhcpLeasesDocument,\n    options\n  );\n};\n"})}),"\n",(0,i.jsx)(n.h3,{id:"step-2-ent-orm-codegen",children:"Step 2: ent ORM Codegen"}),"\n",(0,i.jsx)(n.p,{children:"Generates type-safe Go code for database access."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"npm run codegen:ent\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Location:"})," ",(0,i.jsx)(n.code,{children:"libs/data/ent/"})," (separate Go module)"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Outputs:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Entity types and builders"}),"\n",(0,i.jsx)(n.li,{children:"CRUD operation code"}),"\n",(0,i.jsx)(n.li,{children:"Schema migrations"}),"\n",(0,i.jsx)(n.li,{children:"Query and mutation helpers"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example ent Schema:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:'// libs/data/ent/schema/vpnservice.go\ntype VPNService struct {\n    ent.Schema\n}\n\nfunc (VPNService) Fields() []ent.Field {\n    return []ent.Field{\n        field.String("id").Unique(),\n        field.String("name"),\n        field.String("protocol"),\n        field.Bool("enabled"),\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"step-3-gqlgen-codegen",children:"Step 3: gqlgen Codegen"}),"\n",(0,i.jsx)(n.p,{children:"Generates resolver function signatures from the GraphQL schema."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"npm run codegen:gqlgen\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Location:"})," ",(0,i.jsx)(n.code,{children:"apps/backend/graph/generated.go"})," and resolver files"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Outputs:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Resolver interfaces and method signatures"}),"\n",(0,i.jsx)(n.li,{children:"Type definitions for all GraphQL types"}),"\n",(0,i.jsx)(n.li,{children:"Query, mutation, and subscription entry points"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example Generated Resolver Signature:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:"// Generated in apps/backend/graph/generated.go\ntype QueryResolver interface {\n    GetDhcpLeases(ctx context.Context, routerID string) ([]*model.DhcpLease, error)\n    GetVpnServices(ctx context.Context) ([]*model.VpnService, error)\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"when-to-run-codegen",children:"When to Run Codegen"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Always run after:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Modifying any ",(0,i.jsx)(n.code,{children:".graphql"})," schema file in ",(0,i.jsx)(n.code,{children:"schema/"})]}),"\n",(0,i.jsxs)(n.li,{children:["Changing ent entity definitions in ",(0,i.jsx)(n.code,{children:"libs/data/ent/schema/"})]}),"\n",(0,i.jsx)(n.li,{children:"Adding new queries, mutations, or subscriptions"}),"\n",(0,i.jsx)(n.li,{children:"Changing custom scalar definitions"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"The process:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# 1. Update schema file\nvim schema/vpn.graphql\n\n# 2. Run full codegen\nnpm run codegen\n\n# 3. Verify build\nnpm run build\n\n# 4. Commit generated files\ngit add libs/api-client/generated/ apps/backend/graph/generated.go\ngit commit -m "chore: codegen after VPN schema update"\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"core-types-vs-generated-types",children:"Core Types vs Generated Types"}),"\n",(0,i.jsxs)(n.p,{children:["NasNetConnect maintains two separate type hierarchies: ",(0,i.jsx)(n.strong,{children:"generated types"})," (implementation details) and ",(0,i.jsx)(n.strong,{children:"core types"})," (stable API)."]}),"\n",(0,i.jsx)(n.h3,{id:"generated-types",children:"Generated Types"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Location:"})," ",(0,i.jsx)(n.code,{children:"libs/api-client/generated/"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Purpose:"})," Implementation details from GraphQL codegen. Not meant for direct use in components."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Why separate:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Regenerated on every schema change"}),"\n",(0,i.jsx)(n.li,{children:"Include verbose query/mutation variable types"}),"\n",(0,i.jsx)(n.li,{children:"Not optimized for component props"}),"\n",(0,i.jsx)(n.li,{children:"May have naming that doesn't match feature domain language"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example Generated Type:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// Generated: libs/api-client/generated/schemas/index.d.ts\nexport interface GetVpnServicesQuery {\n  getVpnServices: {\n    __typename?: 'VpnService';\n    id: string;\n    name: string;\n    protocol: string;\n    enabled: boolean;\n    createdAt: string;\n    updatedAt: string;\n    // ... 20 more fields\n  }[];\n}\n\nexport interface GetVpnServicesQueryVariables {\n  routerId: string;\n  limit?: number | null;\n  offset?: number | null;\n  filter?: VpnServiceFilter | null;\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"core-types",children:"Core Types"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Location:"})," ",(0,i.jsx)(n.code,{children:"libs/core/types/src/"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Purpose:"})," Manually maintained stable API surface for feature code."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Why separate:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Don't change when schema changes"}),"\n",(0,i.jsx)(n.li,{children:"Optimized for component props"}),"\n",(0,i.jsx)(n.li,{children:"Use domain-specific naming"}),"\n",(0,i.jsx)(n.li,{children:"Include only essential fields"}),"\n",(0,i.jsx)(n.li,{children:"Provide higher-level abstractions"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example Core Type:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// Manual: libs/core/types/src/vpn/service.types.ts\nexport interface VPNService {\n  id: string;\n  name: string;\n  protocol: 'wireguard' | 'openvpn' | 'ikev2';\n  enabled: boolean;\n  status: 'running' | 'stopped' | 'error';\n}\n\nexport interface VPNServiceCreateInput {\n  name: string;\n  protocol: VPNService['protocol'];\n  config: Record<string, any>;\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"mapping-generated--core",children:"Mapping Generated \u2192 Core"}),"\n",(0,i.jsx)(n.p,{children:"Feature code receives generated types from hooks and maps them to core types:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// libs/api-client/queries/vpn/useVpnServices.ts\nimport type { GetVpnServicesQuery } from '@nasnet/api-client/generated';\nimport type { VPNService } from '@nasnet/core/types';\n\nexport function useVpnServices(routerId: string) {\n  const { data, loading, error } = useQuery(GET_VPN_SERVICES, {\n    variables: { routerId }\n  });\n\n  // Map generated type to core type\n  const services: VPNService[] | undefined = data?.getVpnServices?.map(raw => ({\n    id: raw.id,\n    name: raw.name,\n    protocol: raw.protocol as VPNService['protocol'],\n    enabled: raw.enabled,\n    status: raw.enabled ? 'running' : 'stopped'\n  }));\n\n  return { services, loading, error };\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Import Rules:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// \u2705 DO: Import core types in features\nimport type { VPNService } from '@nasnet/core/types';\n\n// \u274c DON'T: Import generated types in feature components\nimport type { GetVpnServicesQuery } from '@nasnet/api-client/generated';\n\n// \u2705 DO: Use generated types in custom hooks (as bridge layer)\nexport function useVpnServices(): VPNService[] { ... }\n\n// \u2705 DO: Import hooks that return core types\nimport { useVpnServices } from '@nasnet/api-client/queries';\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"apollo-client-integration",children:"Apollo Client Integration"}),"\n",(0,i.jsx)(n.p,{children:"NasNetConnect uses Apollo Client for GraphQL operations with a custom link chain for authentication, error handling, and offline support."}),"\n",(0,i.jsx)(n.h3,{id:"apollo-client-setup",children:"Apollo Client Setup"}),"\n",(0,i.jsxs)(n.p,{children:["Located in ",(0,i.jsx)(n.code,{children:"libs/api-client/core/src/apollo/"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// libs/api-client/core/src/apollo/apollo-client.ts\nimport { ApolloClient, InMemoryCache, ApolloLink } from '@apollo/client';\nimport { authLink } from './apollo-auth-link';\nimport { errorLink } from './apollo-error-link';\nimport { retryLink } from './apollo-retry-link';\nimport { wsClient } from './apollo-ws-client';\n\nexport const apolloClient = new ApolloClient({\n  link: ApolloLink.from([\n    errorLink,\n    retryLink,\n    authLink,\n    httpLink,\n    wsLink\n  ]),\n  cache: new InMemoryCache()\n});\n"})}),"\n",(0,i.jsx)(n.h3,{id:"auth-link",children:"Auth Link"}),"\n",(0,i.jsx)(n.p,{children:"Adds authentication headers to all requests:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// libs/api-client/core/src/apollo/apollo-auth-link.ts\nimport { setContext } from '@apollo/client/link/context';\nimport { getAuthToken } from '@nasnet/core/auth';\n\nexport const authLink = setContext((_operation, { headers }) => {\n  const token = getAuthToken();\n\n  return {\n    headers: {\n      ...headers,\n      authorization: token ? `Bearer ${token}` : ''\n    }\n  };\n});\n"})}),"\n",(0,i.jsx)(n.h3,{id:"error-link",children:"Error Link"}),"\n",(0,i.jsx)(n.p,{children:"Handles GraphQL errors and network errors:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// libs/api-client/core/src/apollo/apollo-error-link.ts\nimport { onError } from '@apollo/client/link/error';\nimport { mapBackendErrorsToForm } from '@nasnet/core/forms';\n\nexport const errorLink = onError(({ graphQLErrors, networkError, operation, forward }) => {\n  if (graphQLErrors) {\n    graphQLErrors.forEach(error => {\n      // Map backend errors to form errors\n      if (error.extensions?.code === 'VALIDATION_ERROR') {\n        const errors = error.extensions.errors as ValidationError[];\n        // Handle validation errors\n      }\n\n      // Handle auth errors\n      if (error.extensions?.code === 'UNAUTHENTICATED') {\n        // Redirect to login\n      }\n    });\n  }\n\n  if (networkError) {\n    console.error(`Network error: ${networkError}`);\n  }\n});\n"})}),"\n",(0,i.jsx)(n.h3,{id:"retry-link",children:"Retry Link"}),"\n",(0,i.jsx)(n.p,{children:"Automatically retries failed requests:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// libs/api-client/core/src/apollo/apollo-retry-link.ts\nimport { RetryLink } from '@apollo/client/link/retry';\n\nexport const retryLink = new RetryLink({\n  delay: {\n    initial: 300,\n    max: 3000,\n    jitter: true\n  },\n  attempts: {\n    max: 5,\n    retryIf: (error, _operation) => {\n      // Don't retry auth errors\n      if (error?.graphQLErrors?.[0]?.extensions?.code === 'UNAUTHENTICATED') {\n        return false;\n      }\n      return !!error;\n    }\n  }\n});\n"})}),"\n",(0,i.jsx)(n.h3,{id:"websocket-link-for-subscriptions",children:"WebSocket Link for Subscriptions"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// libs/api-client/core/src/apollo/apollo-ws-client.ts\nimport { GraphQLWsLink } from '@apollo/client/link/subscriptions';\nimport { createClient } from 'graphql-ws';\n\nconst wsClient = createClient({\n  url: `${WS_URL}/graphql`,\n  connectionParams: () => ({\n    authorization: `Bearer ${getAuthToken()}`\n  })\n});\n\nexport const wsLink = new GraphQLWsLink(wsClient);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"using-apollo-hooks",children:"Using Apollo Hooks"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import { useQuery, useMutation, useSubscription } from '@apollo/client';\nimport { GET_DHCP_LEASES, CREATE_VPN_SERVICE } from '@nasnet/api-client/queries';\nimport type { VPNService } from '@nasnet/core/types';\n\nfunction DHCPLeases() {\n  const { data, loading, error } = useQuery(GET_DHCP_LEASES, {\n    variables: { routerId: 'router-1' },\n    context: {\n      headers: { 'X-Router-Id': 'router-1' }\n    }\n  });\n\n  if (loading) return <Skeleton />;\n  if (error) return <ErrorAlert error={error} />;\n\n  return <DHCPLeasesList leases={data.getDhcpLeases} />;\n}\n\nfunction CreateVPN() {\n  const [create, { loading }] = useMutation(CREATE_VPN_SERVICE);\n\n  async function handleSubmit(input: VPNServiceCreateInput) {\n    const result = await create({\n      variables: { input },\n      refetchQueries: ['GetVpnServices']\n    });\n\n    return result.data?.createVpnService;\n  }\n\n  return <VPNForm onSubmit={handleSubmit} isLoading={loading} />;\n}\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"writing-custom-queries-and-mutations",children:"Writing Custom Queries and Mutations"}),"\n",(0,i.jsx)(n.p,{children:"Follow this step-by-step process to add new GraphQL operations."}),"\n",(0,i.jsx)(n.h3,{id:"step-1-update-graphql-schema",children:"Step 1: Update GraphQL Schema"}),"\n",(0,i.jsx)(n.p,{children:"Add the query or mutation to the appropriate schema file:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",children:'# schema/vpn/vpn-queries.graphql\nextend type Query {\n  "List all VPN services"\n  listVpnServices(\n    routerId: String!\n    limit: Int = 20\n    offset: Int = 0\n  ): [VpnService!]!\n\n  "Get single VPN service details"\n  getVpnService(id: String!): VpnService\n}\n\n# schema/vpn/vpn-mutations.graphql\nextend type Mutation {\n  "Create a new VPN service"\n  createVpnService(input: CreateVpnServiceInput!): VpnService!\n\n  "Update VPN service configuration"\n  updateVpnService(id: String!, input: UpdateVpnServiceInput!): VpnService!\n\n  "Delete VPN service"\n  deleteVpnService(id: String!): Boolean!\n}\n\n# Define input types\ninput CreateVpnServiceInput {\n  name: String!\n  protocol: VpnProtocol!\n  config: JSON!\n}\n\ninput UpdateVpnServiceInput {\n  name: String\n  config: JSON\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"step-2-run-codegen",children:"Step 2: Run Codegen"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"npm run codegen\n"})}),"\n",(0,i.jsx)(n.p,{children:"This generates:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"TypeScript types for the new operations"}),"\n",(0,i.jsx)(n.li,{children:"Apollo hooks"}),"\n",(0,i.jsx)(n.li,{children:"Go resolver signatures"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"step-3-create-querymutation-file",children:"Step 3: Create Query/Mutation File"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// libs/api-client/queries/vpn/use-vpn-services.ts\nimport { gql } from '@apollo/client';\nimport { useQuery, useMutation } from '@apollo/client';\nimport type {\n  ListVpnServicesQuery,\n  ListVpnServicesQueryVariables,\n  CreateVpnServiceMutation,\n  CreateVpnServiceMutationVariables\n} from '@nasnet/api-client/generated';\nimport type { VPNService } from '@nasnet/core/types';\n\n// Define the GraphQL document\nconst LIST_VPN_SERVICES = gql`\n  query ListVpnServices($routerId: String!, $limit: Int, $offset: Int) {\n    listVpnServices(routerId: $routerId, limit: $limit, offset: $offset) {\n      id\n      name\n      protocol\n      enabled\n      createdAt\n    }\n  }\n`;\n\nconst CREATE_VPN_SERVICE = gql`\n  mutation CreateVpnService($input: CreateVpnServiceInput!) {\n    createVpnService(input: $input) {\n      id\n      name\n      protocol\n      enabled\n    }\n  }\n`;\n\n// Create wrapper hooks that return core types\nexport function useVpnServices(routerId: string, limit = 20) {\n  const { data, loading, error } = useQuery<\n    ListVpnServicesQuery,\n    ListVpnServicesQueryVariables\n  >(LIST_VPN_SERVICES, {\n    variables: { routerId, limit },\n    context: { headers: { 'X-Router-Id': routerId } }\n  });\n\n  // Map generated type to core type\n  const services: VPNService[] | undefined = data?.listVpnServices?.map(raw => ({\n    id: raw.id,\n    name: raw.name,\n    protocol: raw.protocol as VPNService['protocol'],\n    enabled: raw.enabled\n  }));\n\n  return { services, loading, error };\n}\n\nexport function useCreateVpnService() {\n  const [create, { loading }] = useMutation<\n    CreateVpnServiceMutation,\n    CreateVpnServiceMutationVariables\n  >(CREATE_VPN_SERVICE);\n\n  return async (input: VPNServiceCreateInput) => {\n    const result = await create({\n      variables: { input },\n      refetchQueries: ['ListVpnServices']\n    });\n\n    if (result.data?.createVpnService) {\n      return {\n        id: result.data.createVpnService.id,\n        name: result.data.createVpnService.name,\n        protocol: result.data.createVpnService.protocol as VPNService['protocol'],\n        enabled: result.data.createVpnService.enabled\n      } as VPNService;\n    }\n\n    throw new Error('Failed to create VPN service');\n  };\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"step-4-export-from-index",children:"Step 4: Export from Index"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// libs/api-client/queries/vpn/index.ts\nexport { useVpnServices, useCreateVpnService } from './use-vpn-services';\n"})}),"\n",(0,i.jsx)(n.h3,{id:"step-5-use-in-components",children:"Step 5: Use in Components"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// libs/features/vpn/components/VPNList.tsx\nimport { useVpnServices } from '@nasnet/api-client/queries';\nimport type { VPNService } from '@nasnet/core/types';\n\nfunction VPNList({ routerId }: { routerId: string }) {\n  const { services, loading, error } = useVpnServices(routerId);\n\n  if (loading) return <LoadingSkeleton />;\n  if (error) return <ErrorAlert error={error} />;\n\n  return (\n    <ul>\n      {services?.map(service => (\n        <VPNListItem key={service.id} service={service} />\n      ))}\n    </ul>\n  );\n}\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"real-time-updates-with-subscriptions",children:"Real-Time Updates with Subscriptions"}),"\n",(0,i.jsx)(n.p,{children:"GraphQL subscriptions enable real-time updates via WebSocket connections."}),"\n",(0,i.jsx)(n.h3,{id:"define-subscription-in-schema",children:"Define Subscription in Schema"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",children:'# schema/vpn/vpn-subscriptions.graphql\nextend type Subscription {\n  "Subscribe to VPN service status changes"\n  vpnServiceUpdated(serviceId: String!): VpnServiceEvent!\n}\n\ntype VpnServiceEvent {\n  type: EventType!\n  service: VpnService!\n  timestamp: DateTime!\n}\n\nenum EventType {\n  STARTED\n  STOPPED\n  UPDATED\n  ERROR\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"create-subscription-hook",children:"Create Subscription Hook"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// libs/api-client/queries/vpn/use-vpn-subscription.ts\nimport { gql } from '@apollo/client';\nimport { useSubscription } from '@apollo/client';\nimport type {\n  VpnServiceUpdatedSubscription,\n  VpnServiceUpdatedSubscriptionVariables\n} from '@nasnet/api-client/generated';\n\nconst VPN_SERVICE_UPDATED = gql`\n  subscription VpnServiceUpdated($serviceId: String!) {\n    vpnServiceUpdated(serviceId: $serviceId) {\n      type\n      service {\n        id\n        name\n        enabled\n        status\n      }\n      timestamp\n    }\n  }\n`;\n\nexport function useVpnServiceUpdates(serviceId: string) {\n  const { data, loading, error } = useSubscription<\n    VpnServiceUpdatedSubscription,\n    VpnServiceUpdatedSubscriptionVariables\n  >(VPN_SERVICE_UPDATED, {\n    variables: { serviceId }\n  });\n\n  return {\n    event: data?.vpnServiceUpdated,\n    loading,\n    error\n  };\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"use-in-component",children:"Use in Component"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"function VPNServiceDetail({ serviceId }: { serviceId: string }) {\n  const { event } = useVpnServiceUpdates(serviceId);\n\n  useEffect(() => {\n    if (event) {\n      // Handle real-time update\n      console.log(`Service ${event.type}:`, event.service);\n      // Refetch or update local cache\n    }\n  }, [event]);\n\n  return <VPNServicePanel serviceId={serviceId} />;\n}\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"libsapi-client-directory-structure",children:"libs/api-client Directory Structure"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"libs/api-client/\n\u251c\u2500\u2500 core/                         # Apollo Client setup and configuration\n\u2502   \u251c\u2500\u2500 src/\n\u2502   \u2502   \u251c\u2500\u2500 apollo/\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 apollo-client.ts          # Main Apollo Client instance\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 apollo-auth-link.ts       # Authentication headers\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 apollo-error-link.ts      # Error handling\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 apollo-retry-link.ts      # Auto-retry logic\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 apollo-ws-client.ts       # WebSocket setup\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 index.ts\n\u2502   \u2502   \u251c\u2500\u2500 hooks/\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 useGraphQLError.ts        # Parse GraphQL errors\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 useMutationWithLoading.ts # Mutation with loading state\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 useQueryWithLoading.ts    # Query with loading state\n\u2502   \u2502   \u251c\u2500\u2500 interceptors/\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 auth.ts                   # Auth interceptor\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 error.ts                  # Error interceptor\n\u2502   \u2502   \u251c\u2500\u2500 client.ts                     # Apollo Client export\n\u2502   \u2502   \u2514\u2500\u2500 index.ts\n\u2502   \u2514\u2500\u2500 package.json\n\u2502\n\u251c\u2500\u2500 queries/                      # Domain-organized GraphQL hooks\n\u2502   \u251c\u2500\u2500 alerts/\n\u2502   \u2502   \u251c\u2500\u2500 index.ts\n\u2502   \u2502   \u251c\u2500\u2500 useAlertRules.ts\n\u2502   \u2502   \u2514\u2500\u2500 useAlertNotifications.ts\n\u2502   \u251c\u2500\u2500 vpn/\n\u2502   \u2502   \u251c\u2500\u2500 index.ts\n\u2502   \u2502   \u251c\u2500\u2500 useVpnServices.ts\n\u2502   \u2502   \u2514\u2500\u2500 useVpnConnections.ts\n\u2502   \u251c\u2500\u2500 network/\n\u2502   \u2502   \u251c\u2500\u2500 index.ts\n\u2502   \u2502   \u251c\u2500\u2500 useDHCPLeases.ts\n\u2502   \u2502   \u2514\u2500\u2500 useInterfaceStatus.ts\n\u2502   \u251c\u2500\u2500 firewall/\n\u2502   \u2502   \u2514\u2500\u2500 ...\n\u2502   \u251c\u2500\u2500 services/\n\u2502   \u2502   \u2514\u2500\u2500 ...\n\u2502   \u251c\u2500\u2500 index.ts                  # Main barrel export\n\u2502   \u2514\u2500\u2500 package.json\n\u2502\n\u2514\u2500\u2500 generated/                    # Codegen output (DON'T EDIT)\n    \u251c\u2500\u2500 schemas/\n    \u2502   \u251c\u2500\u2500 index.d.ts            # All generated TypeScript types\n    \u2502   \u2514\u2500\u2500 zod/\n    \u2502       \u2514\u2500\u2500 *.ts              # Zod schemas for validation\n    \u251c\u2500\u2500 hooks/\n    \u2502   \u2514\u2500\u2500 *.ts                  # Apollo hooks (one per operation)\n    \u2514\u2500\u2500 models/\n        \u2514\u2500\u2500 *.ts                  # GraphQL model types\n"})}),"\n",(0,i.jsx)(n.h3,{id:"import-paths",children:"Import Paths"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// \u2705 Import from main exports\nimport { useVpnServices } from '@nasnet/api-client/queries';\nimport { useQuery, useMutation } from '@nasnet/api-client/core';\n\n// \u2705 Import core types\nimport type { VPNService } from '@nasnet/core/types';\n\n// \u274c Don't import from generated subdirectories\nimport { useGetVpnServicesQuery } from '@nasnet/api-client/generated/hooks';\n\n// \u274c Don't import generated types directly\nimport type { GetVpnServicesQuery } from '@nasnet/api-client/generated/schemas';\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"common-patterns",children:"Common Patterns"}),"\n",(0,i.jsx)(n.h3,{id:"pattern-1-query-with-polling",children:"Pattern 1: Query with Polling"}),"\n",(0,i.jsx)(n.p,{children:"Automatically refetch data at intervals:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"function RouterStatus({ routerId }: { routerId: string }) {\n  const { data, loading } = useQuery(GET_ROUTER_STATUS, {\n    variables: { routerId },\n    pollInterval: 5000 // Refetch every 5 seconds\n  });\n\n  return <StatusDisplay status={data?.routerStatus} isLoading={loading} />;\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"pattern-2-mutation-with-optimistic-response",children:"Pattern 2: Mutation with Optimistic Response"}),"\n",(0,i.jsx)(n.p,{children:"Update UI immediately while mutation is in flight:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const [update] = useMutation(UPDATE_VPN_SERVICE, {\n  update(cache, { data }) {\n    cache.modify({\n      fields: {\n        listVpnServices(existing = []) {\n          return existing.map(service =>\n            service.id === data.updateVpnService.id\n              ? data.updateVpnService\n              : service\n          );\n        }\n      }\n    });\n  },\n  optimisticResponse: {\n    updateVpnService: {\n      __typename: 'VpnService',\n      id: serviceId,\n      name: newName,\n      ...\n    }\n  }\n});\n"})}),"\n",(0,i.jsx)(n.h3,{id:"pattern-3-pagination",children:"Pattern 3: Pagination"}),"\n",(0,i.jsx)(n.p,{children:"Fetch data in pages:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"function VPNServicesPaginated() {\n  const [page, setPage] = useState(1);\n  const pageSize = 20;\n\n  const { data, loading } = useQuery(LIST_VPN_SERVICES, {\n    variables: {\n      limit: pageSize,\n      offset: (page - 1) * pageSize\n    }\n  });\n\n  return (\n    <>\n      <VPNList services={data?.listVpnServices} />\n      <Pagination\n        page={page}\n        pageSize={pageSize}\n        total={data?.vpnServicesTotal}\n        onPageChange={setPage}\n      />\n    </>\n  );\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"pattern-4-dependent-queries",children:"Pattern 4: Dependent Queries"}),"\n",(0,i.jsx)(n.p,{children:"Fetch second query only after first completes:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"function VPNDetail({ serviceId }: { serviceId: string }) {\n  const { data: service } = useQuery(GET_VPN_SERVICE, {\n    variables: { id: serviceId }\n  });\n\n  const { data: config } = useQuery(GET_VPN_CONFIG, {\n    variables: { serviceId },\n    skip: !service // Only run when service is loaded\n  });\n\n  return <VPNDetailPanel service={service} config={config} />;\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"pattern-5-error-mapping",children:"Pattern 5: Error Mapping"}),"\n",(0,i.jsx)(n.p,{children:"Map GraphQL errors to form errors:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const [create] = useMutation(CREATE_VPN_SERVICE);\n\nasync function handleSubmit(input: VPNServiceCreateInput) {\n  try {\n    const result = await create({ variables: { input } });\n    return result.data?.createVpnService;\n  } catch (error) {\n    if (error instanceof ApolloError) {\n      const validationErrors = error.graphQLErrors[0]?.extensions?.errors;\n      if (validationErrors) {\n        mapBackendErrorsToForm(validationErrors, form.setError);\n      }\n    }\n    throw error;\n  }\n}\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"error-handling-in-graphql",children:"Error Handling in GraphQL"}),"\n",(0,i.jsx)(n.p,{children:"GraphQL errors flow through multiple layers and require careful handling."}),"\n",(0,i.jsx)(n.h3,{id:"graphql-error-structure",children:"GraphQL Error Structure"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"{\n  message: string;                    // Human-readable message\n  extensions?: {\n    code: string;                     // Error code (e.g., 'VALIDATION_ERROR')\n    errors?: ValidationError[];       // Backend validation errors\n    timestamp?: string;               // When error occurred\n    traceId?: string;                 // For server-side debugging\n  };\n  path?: string[];                    // Where in response error occurred\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"handling-validation-errors",children:"Handling Validation Errors"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const [create] = useMutation(CREATE_VPN_SERVICE, {\n  onError(error) {\n    if (error instanceof ApolloError) {\n      const gqlError = error.graphQLErrors[0];\n\n      if (gqlError?.extensions?.code === 'VALIDATION_ERROR') {\n        const backendErrors = gqlError.extensions.errors as ValidationError[];\n        mapBackendErrorsToForm(backendErrors, form.setError);\n      }\n    }\n  }\n});\n"})}),"\n",(0,i.jsx)(n.h3,{id:"handling-network-errors",children:"Handling Network Errors"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const [create] = useMutation(CREATE_VPN_SERVICE, {\n  onError(error) {\n    if (error instanceof ApolloError) {\n      if (error.networkError) {\n        console.error('Network error:', error.networkError);\n        // Show offline message\n      }\n    }\n  }\n});\n"})}),"\n",(0,i.jsx)(n.h3,{id:"global-error-handling",children:"Global Error Handling"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// libs/api-client/core/src/apollo/apollo-error-link.ts\nexport const errorLink = onError(({ graphQLErrors, networkError, operation }) => {\n  if (graphQLErrors) {\n    graphQLErrors.forEach(error => {\n      switch (error.extensions?.code) {\n        case 'UNAUTHENTICATED':\n          // Redirect to login\n          redirectToLogin();\n          break;\n        case 'FORBIDDEN':\n          // Show permission error\n          showErrorNotification('You do not have permission');\n          break;\n        case 'VALIDATION_ERROR':\n          // Component will handle field mapping\n          break;\n      }\n    });\n  }\n\n  if (networkError) {\n    if ('statusCode' in networkError && networkError.statusCode === 401) {\n      redirectToLogin();\n    }\n  }\n});\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"testing-graphql-integrations",children:"Testing GraphQL Integrations"}),"\n",(0,i.jsx)(n.h3,{id:"unit-testing-queries",children:"Unit Testing Queries"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import { gql } from '@apollo/client';\nimport { MockedProvider } from '@apollo/client/testing';\nimport { renderHook, waitFor } from '@testing-library/react';\nimport { useVpnServices } from './use-vpn-services';\n\ndescribe('useVpnServices', () => {\n  it('should fetch VPN services', async () => {\n    const mock = {\n      request: {\n        query: LIST_VPN_SERVICES,\n        variables: { routerId: 'router-1' }\n      },\n      result: {\n        data: {\n          listVpnServices: [\n            { id: '1', name: 'VPN-1', protocol: 'wireguard', enabled: true }\n          ]\n        }\n      }\n    };\n\n    const wrapper = ({ children }: { children: React.ReactNode }) => (\n      <MockedProvider mocks={[mock]}>{children}</MockedProvider>\n    );\n\n    const { result } = renderHook(() => useVpnServices('router-1'), { wrapper });\n\n    // Initially loading\n    expect(result.current.loading).toBe(true);\n\n    // Wait for data\n    await waitFor(() => {\n      expect(result.current.loading).toBe(false);\n    });\n\n    expect(result.current.services).toEqual([\n      { id: '1', name: 'VPN-1', protocol: 'wireguard', enabled: true }\n    ]);\n  });\n\n  it('should handle errors', async () => {\n    const mock = {\n      request: {\n        query: LIST_VPN_SERVICES,\n        variables: { routerId: 'router-1' }\n      },\n      error: new Error('Network error')\n    };\n\n    const wrapper = ({ children }: { children: React.ReactNode }) => (\n      <MockedProvider mocks={[mock]}>{children}</MockedProvider>\n    );\n\n    const { result } = renderHook(() => useVpnServices('router-1'), { wrapper });\n\n    await waitFor(() => {\n      expect(result.current.error).toBeDefined();\n    });\n  });\n});\n"})}),"\n",(0,i.jsx)(n.h3,{id:"component-integration-testing",children:"Component Integration Testing"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import { render, screen, waitFor } from '@testing-library/react';\nimport userEvent from '@testing-library/user-event';\nimport { MockedProvider } from '@apollo/client/testing';\nimport { VPNList } from './VPNList';\n\ndescribe('VPNList', () => {\n  it('should display VPN services', async () => {\n    const mocks = [\n      {\n        request: {\n          query: LIST_VPN_SERVICES,\n          variables: { routerId: 'router-1' }\n        },\n        result: {\n          data: {\n            listVpnServices: [\n              { id: '1', name: 'Production VPN', protocol: 'wireguard', enabled: true }\n            ]\n          }\n        }\n      }\n    ];\n\n    render(\n      <MockedProvider mocks={mocks}>\n        <VPNList routerId=\"router-1\" />\n      </MockedProvider>\n    );\n\n    // Loading state\n    expect(screen.getByRole('status')).toHaveTextContent('Loading');\n\n    // Data loaded\n    await waitFor(() => {\n      expect(screen.getByText('Production VPN')).toBeInTheDocument();\n    });\n  });\n});\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Keep Generated Code Out of Imports"})," - Always use wrapper hooks from ",(0,i.jsx)(n.code,{children:"libs/api-client/queries/"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Map to Core Types Early"})," - Convert generated types to core types in hooks, not in components"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Use Proper Cache Updates"})," - Refetch or manually update Apollo cache after mutations"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Handle All Error Cases"})," - Test network errors, validation errors, and auth errors"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Use Subscriptions Sparingly"})," - Only for truly real-time data that requires sub-second updates"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Validate GraphQL Responses"})," - Use Zod schemas from codegen to validate at runtime"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Document Query Requirements"})," - Add comments to GraphQL queries explaining what data is needed"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Test with Mocked Providers"})," - Always use MockedProvider in tests, never hit real API"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Follow Naming Conventions"})," - Use verb prefixes (use/get/list) for hooks consistently"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Run Codegen After Schema Changes"})," - Never manually edit generated files"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/core/guides/error-handling-patterns",children:"Error Handling Patterns"})," - Comprehensive error handling guide"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/core/guides/validation-pipeline",children:"Validation Pipeline"})," - 7-stage validation flow"]}),"\n",(0,i.jsx)(n.li,{children:"API Contracts (see Docs/architecture/api-contracts.md) - GraphQL schema design patterns"}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/core/sub-libraries/forms",children:"Form Architecture"})," - Forms with GraphQL integration"]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},71184:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>a});var t=r(14041);const i={},s=t.createContext(i);function o(e){const n=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);