"use strict";(globalThis.webpackChunk_nas_net_docs=globalThis.webpackChunk_nas_net_docs||[]).push([[55824],{61584:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>o,contentTitle:()=>d,default:()=>u,frontMatter:()=>c,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"universal-state-resource-model","title":"Universal State v2 Resource Model","description":"The Universal State v2 model is the core abstraction for every managed object in NasNetConnect.","source":"@site/../../libs/api-client/docs/universal-state-resource-model.md","sourceDirName":".","slug":"/universal-state-resource-model","permalink":"/docs/api-client/universal-state-resource-model","draft":false,"unlisted":false,"editUrl":"https://github.com/nasnet-community/nasnet-panel/tree/main/../../libs/api-client/docs/universal-state-resource-model.md","tags":[],"version":"current","sidebarPosition":7,"frontMatter":{"sidebar_position":7,"title":"Universal State v2 Resource Model"},"sidebar":"sidebar","previous":{"title":"Offline-First Architecture","permalink":"/docs/api-client/offline-first"},"next":{"title":"Change Set Pattern","permalink":"/docs/api-client/change-set-pattern"}}');var i=n(31085),t=n(71184);const c={sidebar_position:7,title:"Universal State v2 Resource Model"},d="Universal State v2 Resource Model",o={},l=[{value:"Table of Contents",id:"table-of-contents",level:2},{value:"The 8-Layer Model",id:"the-8-layer-model",level:2},{value:"Layer Descriptions",id:"layer-descriptions",level:3},{value:"GraphQL Fragments",id:"graphql-fragments",level:2},{value:"Identity Fragment",id:"identity-fragment",level:3},{value:"Layer-Specific Fragments",id:"layer-specific-fragments",level:3},{value:"Composite Fragments (Presets)",id:"composite-fragments-presets",level:3},{value:"LAYER_PRESETS and Composite Fragments",id:"layer_presets-and-composite-fragments",level:2},{value:"Query Keys and Cache Invalidation",id:"query-keys-and-cache-invalidation",level:2},{value:"useResource \u2014 Dynamic Query Builder",id:"useresource--dynamic-query-builder",level:2},{value:"Signature",id:"signature",level:3},{value:"<code>UseResourceOptions</code>",id:"useresourceoptions",level:3},{value:"<code>UseResourceResult&lt;TConfig&gt;</code>",id:"useresourceresulttconfig",level:3},{value:"Runtime Subscription Merge",id:"runtime-subscription-merge",level:3},{value:"Usage Examples",id:"usage-examples",level:3},{value:"Convenience Wrappers",id:"convenience-wrappers",level:3},{value:"useResourceList \u2014 Relay Pagination",id:"useresourcelist--relay-pagination",level:2},{value:"Signature",id:"signature-1",level:3},{value:"<code>UseResourceListOptions</code>",id:"useresourcelistoptions",level:3},{value:"<code>ResourceListFilter</code>",id:"resourcelistfilter",level:3},{value:"<code>ResourceListSort</code>",id:"resourcelistsort",level:3},{value:"<code>ResourceListPagination</code> (Relay-style)",id:"resourcelistpagination-relay-style",level:3},{value:"<code>UseResourceListResult&lt;TConfig&gt;</code>",id:"useresourcelistresulttconfig",level:3},{value:"Infinite Scroll Pattern",id:"infinite-scroll-pattern",level:3},{value:"Stable Variable Keys",id:"stable-variable-keys",level:3},{value:"Convenience Wrappers",id:"convenience-wrappers-1",level:3},{value:"useResourceLayers \u2014 Per-Layer Hooks",id:"useresourcelayers--per-layer-hooks",level:2},{value:"<code>LayerHookOptions</code>",id:"layerhookoptions",level:3},{value:"<code>LayerHookResult&lt;T&gt;</code>",id:"layerhookresultt",level:3},{value:"Available Layer Hooks",id:"available-layer-hooks",level:3},{value:"Usage Examples",id:"usage-examples-1",level:3},{value:"useCompositeResource",id:"usecompositeresource",level:2},{value:"Signature",id:"signature-2",level:3},{value:"<code>UseCompositeResourceOptions</code>",id:"usecompositeresourceoptions",level:3},{value:"<code>UseCompositeResourceResult</code>",id:"usecompositeresourceresult",level:3},{value:"<code>CompositeStatus</code>",id:"compositestatus",level:3},{value:"GraphQL Queries",id:"graphql-queries",level:3},{value:"Domain-Specific Composite Hooks",id:"domain-specific-composite-hooks",level:3},{value:"useResourceSubscription",id:"useresourcesubscription",level:2},{value:"<code>SubscriptionResult&lt;T&gt;</code> Type",id:"subscriptionresultt-type",level:3},{value:"Runtime Updates \u2014 <code>useResourceRuntimeSubscription</code>",id:"runtime-updates--useresourceruntimesubscription",level:3},{value:"State Changes \u2014 <code>useResourceStateSubscription</code>",id:"state-changes--useresourcestatesubscription",level:3},{value:"Validation Progress \u2014 <code>useResourceValidationSubscription</code>",id:"validation-progress--useresourcevalidationsubscription",level:3},{value:"Batch Runtime \u2014 <code>useResourcesRuntimeSubscription</code>",id:"batch-runtime--useresourcesruntimesubscription",level:3},{value:"Combined \u2014 <code>useResourceSubscriptions</code>",id:"combined--useresourcesubscriptions",level:3},{value:"useResourceMutations",id:"useresourcemutations",level:2},{value:"Mutation Summary",id:"mutation-summary",level:3},{value:"Input Types",id:"input-types",level:3},{value:"Cache Behaviour on Mutations",id:"cache-behaviour-on-mutations",level:3},{value:"Apply-Confirm-Merge Flow",id:"apply-confirm-merge-flow",level:3},{value:"Apollo Cache Type Policies",id:"apollo-cache-type-policies",level:2},{value:"Resource Key",id:"resource-key",level:3},{value:"Layer-Level Merge Policies",id:"layer-level-merge-policies",level:3},{value:"Supporting Type Policies",id:"supporting-type-policies",level:3},{value:"Resources Query Field Policy",id:"resources-query-field-policy",level:3},{value:"Cross-References",id:"cross-references",level:2}];function a(e){const s={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.header,{children:(0,i.jsx)(s.h1,{id:"universal-state-v2-resource-model",children:"Universal State v2 Resource Model"})}),"\n",(0,i.jsxs)(s.p,{children:["The Universal State v2 model is the core abstraction for every managed object in NasNetConnect.\nEvery router configuration entity \u2014 VPN clients, LAN networks, firewall rules, WAN links \u2014 is\nrepresented as a ",(0,i.jsx)(s.code,{children:"Resource"})," with a fixed set of eight orthogonal layers. The\n",(0,i.jsx)(s.code,{children:"libs/api-client/queries/src/resources/"})," module provides GraphQL fragments, query hooks, mutation\nhooks, and subscription hooks that let UI components fetch exactly the layers they need, subscribe\nto live changes, and write mutations that follow the Apply-Confirm-Merge lifecycle."]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"table-of-contents",children:"Table of Contents"}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"#the-8-layer-model",children:"The 8-Layer Model"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"#graphql-fragments",children:"GraphQL Fragments"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"#layer_presets-and-composite-fragments",children:"LAYER_PRESETS and Composite Fragments"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"#query-keys-and-cache-invalidation",children:"Query Keys and Cache Invalidation"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"#useresource--dynamic-query-builder",children:"useResource \u2014 Dynamic Query Builder"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"#useresourcelist--relay-pagination",children:"useResourceList \u2014 Relay Pagination"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"#useresourcelayers--per-layer-hooks",children:"useResourceLayers \u2014 Per-Layer Hooks"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"#usecompositeresource",children:"useCompositeResource"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"#useresourcesubscription",children:"useResourceSubscription"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"#useresourcemutations",children:"useResourceMutations"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"#apollo-cache-type-policies",children:"Apollo Cache Type Policies"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"#cross-references",children:"Cross-References"})}),"\n"]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"the-8-layer-model",children:"The 8-Layer Model"}),"\n",(0,i.jsxs)(s.p,{children:["Every ",(0,i.jsx)(s.code,{children:"Resource"})," object exposes the same eight optional layers. Each layer is independently\nfetchable; the query builder in ",(0,i.jsx)(s.code,{children:"useResource"})," assembles a query document containing only the\nrequested layers."]}),"\n",(0,i.jsx)(s.mermaid,{value:'flowchart TD\n    R["Resource (keyed by uuid / ULID)"]\n    L1["Layer 1 \u2014 Identity<br/>uuid, id, type, category"]\n    L2["Layer 2 \u2014 Configuration<br/>JSON blob of resource\'s desired-state config"]\n    L3["Layer 3 \u2014 Validation<br/>errors, warnings, conflicts, dependency checks"]\n    L4["Layer 4 \u2014 Deployment<br/>routerResourceId, appliedAt, drift detection"]\n    L5["Layer 5 \u2014 Runtime<br/>isRunning, health, live metrics, uptime"]\n    L6["Layer 6 \u2014 Telemetry<br/>bandwidth history, hourly/daily stats"]\n    L7["Layer 7 \u2014 Metadata<br/>state, version, tags, notes, changelog"]\n    L8["Layer 8 \u2014 Relationships<br/>dependsOn, dependents, routesVia, parent/children"]\n    L9["Layer 9 \u2014 Platform<br/>capability level, feature flags, field mappings"]\n\n    R --\x3e L1\n    R --\x3e L2\n    R --\x3e L3\n    R --\x3e L4\n    R --\x3e L5\n    R --\x3e L6\n    R --\x3e L7\n    R --\x3e L8\n    R --\x3e L9\n\n    style R fill:#1a7f80,color:#fff\n    style L1 fill:#2a9d9e,color:#fff\n    style L2 fill:#2a9d9e,color:#fff\n    style L3 fill:#2a9d9e,color:#fff\n    style L4 fill:#2a9d9e,color:#fff\n    style L5 fill:#2a9d9e,color:#fff\n    style L6 fill:#2a9d9e,color:#fff\n    style L7 fill:#2a9d9e,color:#fff\n    style L8 fill:#2a9d9e,color:#fff\n    style L9 fill:#2a9d9e,color:#fff'}),"\n",(0,i.jsxs)(s.blockquote,{children:["\n",(0,i.jsx)(s.p,{children:'Note: "Platform" is sometimes referred to as Layer 9 in documentation; the fragment system treats\nit as a full peer of the other layers.'}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"layer-descriptions",children:"Layer Descriptions"}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Layer"}),(0,i.jsx)(s.th,{children:"GraphQL Field"}),(0,i.jsx)(s.th,{children:"Purpose"}),(0,i.jsx)(s.th,{children:"Update Frequency"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Identity"}),(0,i.jsxs)(s.td,{children:[(0,i.jsx)(s.code,{children:"uuid"}),", ",(0,i.jsx)(s.code,{children:"id"}),", ",(0,i.jsx)(s.code,{children:"type"}),", ",(0,i.jsx)(s.code,{children:"category"})]}),(0,i.jsx)(s.td,{children:"Stable key fields"}),(0,i.jsx)(s.td,{children:"Never changes"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Configuration"}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"configuration"})}),(0,i.jsx)(s.td,{children:"Desired-state JSON"}),(0,i.jsx)(s.td,{children:"On every edit"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Validation"}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"validation { canApply, errors, warnings, conflicts }"})}),(0,i.jsx)(s.td,{children:"Pre-apply checks"}),(0,i.jsx)(s.td,{children:"On save / explicit validate"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Deployment"}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"deployment { routerResourceId, appliedAt, drift }"})}),(0,i.jsx)(s.td,{children:"Live \u2192 desired sync"}),(0,i.jsx)(s.td,{children:"On apply / drift check"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Runtime"}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"runtime { isRunning, health, metrics }"})}),(0,i.jsx)(s.td,{children:"Live operational state"}),(0,i.jsx)(s.td,{children:"Every 5\u201330 seconds"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Telemetry"}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"telemetry { bandwidthHistory, hourlyStats }"})}),(0,i.jsx)(s.td,{children:"Historical series"}),(0,i.jsx)(s.td,{children:"Every 5 minutes"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Metadata"}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"metadata { state, version, tags, notes }"})}),(0,i.jsx)(s.td,{children:"Lifecycle + annotations"}),(0,i.jsx)(s.td,{children:"On edit, apply, tag"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Relationships"}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"relationships { dependsOn, dependents, parent }"})}),(0,i.jsx)(s.td,{children:"Dependency graph"}),(0,i.jsx)(s.td,{children:"On topology change"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Platform"}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"platform { capabilities, limitations, features }"})}),(0,i.jsx)(s.td,{children:"RouterOS capabilities"}),(0,i.jsx)(s.td,{children:"On router version change"})]})]})]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"graphql-fragments",children:"GraphQL Fragments"}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Source file:"})," ",(0,i.jsx)(s.code,{children:"libs/api-client/queries/src/resources/fragments.ts"})]}),"\n",(0,i.jsxs)(s.p,{children:["All fragments are named and exported as ",(0,i.jsx)(s.code,{children:"DocumentNode"})," constants. They spread ",(0,i.jsx)(s.code,{children:"ResourceId"})," as their\nbase so every fragment independently satisfies Apollo's normalized cache key requirements."]}),"\n",(0,i.jsx)(s.h3,{id:"identity-fragment",children:"Identity Fragment"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-ts",children:"// fragments.ts:13\nexport const RESOURCE_ID_FRAGMENT = gql`\n  fragment ResourceId on Resource {\n    uuid\n    id\n    type\n    category\n  }\n`;\n"})}),"\n",(0,i.jsxs)(s.p,{children:["This is the base fragment spread by all other fragments. Apollo uses ",(0,i.jsx)(s.code,{children:"uuid"})," as the cache key (see\n",(0,i.jsx)(s.a,{href:"#apollo-cache-type-policies",children:"Cache Type Policies"}),")."]}),"\n",(0,i.jsx)(s.h3,{id:"layer-specific-fragments",children:"Layer-Specific Fragments"}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Exported Constant"}),(0,i.jsx)(s.th,{children:"Fragment Name"}),(0,i.jsx)(s.th,{children:"Fields"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"RESOURCE_CONFIGURATION_FRAGMENT"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"ResourceConfiguration"})}),(0,i.jsxs)(s.td,{children:[(0,i.jsx)(s.code,{children:"...ResourceId"}),", ",(0,i.jsx)(s.code,{children:"configuration"})]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"RESOURCE_VALIDATION_FRAGMENT"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"ResourceValidation"})}),(0,i.jsxs)(s.td,{children:[(0,i.jsx)(s.code,{children:"...ResourceId"}),", ",(0,i.jsx)(s.code,{children:"validation { canApply, stage, errors, warnings, conflicts, requiredDependencies, validatedAt, validationDurationMs }"})]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"RESOURCE_DEPLOYMENT_FRAGMENT"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"ResourceDeployment"})}),(0,i.jsxs)(s.td,{children:[(0,i.jsx)(s.code,{children:"...ResourceId"}),", ",(0,i.jsx)(s.code,{children:"deployment { routerResourceId, appliedAt, appliedBy, routerVersion, generatedFields, isInSync, drift, applyOperationId }"})]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"RESOURCE_RUNTIME_FRAGMENT"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"ResourceRuntime"})}),(0,i.jsxs)(s.td,{children:[(0,i.jsx)(s.code,{children:"...ResourceId"}),", ",(0,i.jsx)(s.code,{children:"runtime { isRunning, health, errorMessage, metrics, lastUpdated, lastSuccessfulOperation, activeConnections, uptime }"})]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"RESOURCE_TELEMETRY_LIGHT_FRAGMENT"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"ResourceTelemetryLight"})}),(0,i.jsxs)(s.td,{children:[(0,i.jsx)(s.code,{children:"...ResourceId"}),", ",(0,i.jsx)(s.code,{children:"telemetry { lastUpdatedAt, retentionDays }"})]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"RESOURCE_TELEMETRY_FULL_FRAGMENT"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"ResourceTelemetryFull"})}),(0,i.jsxs)(s.td,{children:[(0,i.jsx)(s.code,{children:"...ResourceId"}),", ",(0,i.jsx)(s.code,{children:"telemetry { bandwidthHistory, uptimeHistory, hourlyStats, dailyStats, dataStartedAt, lastUpdatedAt, retentionDays }"})]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"RESOURCE_METADATA_LIGHT_FRAGMENT"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"ResourceMetadataLight"})}),(0,i.jsxs)(s.td,{children:[(0,i.jsx)(s.code,{children:"...ResourceId"}),", ",(0,i.jsx)(s.code,{children:"metadata { state, version, tags, updatedAt }"})]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"RESOURCE_METADATA_FULL_FRAGMENT"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"ResourceMetadataFull"})}),(0,i.jsxs)(s.td,{children:[(0,i.jsx)(s.code,{children:"...ResourceId"}),", ",(0,i.jsx)(s.code,{children:"metadata { createdAt, createdBy, updatedAt, updatedBy, state, version, tags, description, isFavorite, isPinned, notes, recentChanges }"})]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"RESOURCE_RELATIONSHIPS_FRAGMENT"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"ResourceRelationships"})}),(0,i.jsxs)(s.td,{children:[(0,i.jsx)(s.code,{children:"...ResourceId"}),", ",(0,i.jsx)(s.code,{children:"relationships { dependsOn, dependents, routesVia, routedBy, parent, children, custom }"})]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"RESOURCE_PLATFORM_FRAGMENT"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"ResourcePlatform"})}),(0,i.jsxs)(s.td,{children:[(0,i.jsx)(s.code,{children:"...ResourceId"}),", ",(0,i.jsx)(s.code,{children:"platform { current, capabilities, fieldMappings, limitations, features }"})]})]})]})]}),"\n",(0,i.jsxs)(s.p,{children:["Each relationship stub includes ",(0,i.jsx)(s.code,{children:"{ uuid, id, type, category, state }"})," so the UI can render\ndependency summaries without loading the full dependency objects."]}),"\n",(0,i.jsx)(s.h3,{id:"composite-fragments-presets",children:"Composite Fragments (Presets)"}),"\n",(0,i.jsx)(s.p,{children:"Two composite fragments are provided for common display patterns:"}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:(0,i.jsx)(s.code,{children:"RESOURCE_LIST_ITEM_FRAGMENT"})})," (",(0,i.jsx)(s.code,{children:"ResourceListItem"}),") \u2014 optimized for mobile list rows:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-ts",children:"// fragments.ts:326\nexport const RESOURCE_LIST_ITEM_FRAGMENT = gql`\n  fragment ResourceListItem on Resource {\n    uuid\n    id\n    type\n    category\n    metadata {\n      state\n      tags\n      updatedAt\n      isFavorite\n    }\n    runtime {\n      isRunning\n      health\n      lastUpdated\n    }\n  }\n`;\n"})}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:(0,i.jsx)(s.code,{children:"RESOURCE_CARD_FRAGMENT"})})," (",(0,i.jsx)(s.code,{children:"ResourceCard"}),") \u2014 for dashboard cards:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-ts",children:"// fragments.ts:349\nexport const RESOURCE_CARD_FRAGMENT = gql`\n  fragment ResourceCard on Resource {\n    ...ResourceId\n    configuration\n    metadata {\n      state\n      version\n      tags\n      description\n      isFavorite\n      isPinned\n    }\n    runtime {\n      isRunning\n      health\n      errorMessage\n      activeConnections\n      uptime\n    }\n  }\n  ${RESOURCE_ID_FRAGMENT}\n`;\n"})}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:(0,i.jsx)(s.code,{children:"RESOURCE_DETAIL_FRAGMENT"})})," (",(0,i.jsx)(s.code,{children:"ResourceDetail"}),") \u2014 all layers except full telemetry:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-ts",children:"// fragments.ts:375\n// Includes: configuration, validation (with docsUrl), deployment (drift summary),\n//           runtime (with key metrics), ...ResourceMetadataFull, ...ResourceRelationships,\n//           platform (capabilities + limitations summary)\n"})}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:(0,i.jsx)(s.code,{children:"RESOURCE_FULL_FRAGMENT"})})," (",(0,i.jsx)(s.code,{children:"ResourceFull"}),") \u2014 all 8 layers including full telemetry:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-ts",children:"// fragments.ts:451\nexport const RESOURCE_FULL_FRAGMENT = gql`\n  fragment ResourceFull on Resource {\n    ...ResourceConfiguration\n    ...ResourceValidation\n    ...ResourceDeployment\n    ...ResourceRuntime\n    ...ResourceTelemetryFull\n    ...ResourceMetadataFull\n    ...ResourceRelationships\n    ...ResourcePlatform\n  }\n  // + all spread fragment definitions\n`;\n"})}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"layer_presets-and-composite-fragments",children:"LAYER_PRESETS and Composite Fragments"}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Source file:"})," ",(0,i.jsx)(s.code,{children:"libs/api-client/queries/src/resources/useResource.ts:62"})]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"LAYER_PRESETS"})," provides named configurations for the most common use cases. Pass a preset name to\n",(0,i.jsx)(s.code,{children:"useResource"})," instead of enumerating layers individually."]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-ts",children:"export const LAYER_PRESETS = {\n  /** Just uuid, id, type, category */\n  minimal: {},\n\n  /** metadata (light) + runtime \u2014 for list rows */\n  list: {\n    metadata: 'light',\n    runtime: true,\n  },\n\n  /** configuration + metadata (light) + runtime \u2014 for dashboard cards */\n  card: {\n    configuration: true,\n    metadata: 'light',\n    runtime: true,\n  },\n\n  /** All layers except full telemetry \u2014 for detail panels */\n  detail: {\n    configuration: true,\n    validation: true,\n    deployment: true,\n    runtime: true,\n    telemetry: 'light', // only retentionDays + lastUpdatedAt\n    metadata: 'full',\n    relationships: true,\n    platform: true,\n  },\n\n  /** All layers including full bandwidth/uptime history */\n  full: {\n    configuration: true,\n    validation: true,\n    deployment: true,\n    runtime: true,\n    telemetry: 'full',\n    metadata: 'full',\n    relationships: true,\n    platform: true,\n  },\n} as const;\n\nexport type LayerPreset = keyof typeof LAYER_PRESETS;\n// 'minimal' | 'list' | 'card' | 'detail' | 'full'\n"})}),"\n",(0,i.jsxs)(s.p,{children:["The ",(0,i.jsx)(s.code,{children:"telemetry"})," and ",(0,i.jsx)(s.code,{children:"metadata"})," fields accept ",(0,i.jsx)(s.code,{children:"'light'"})," or ",(0,i.jsx)(s.code,{children:"'full'"})," in addition to ",(0,i.jsx)(s.code,{children:"true"})," to select\nthe appropriate fragment variant. ",(0,i.jsx)(s.code,{children:"true"})," is an alias for ",(0,i.jsx)(s.code,{children:"'light'"}),"."]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Selection flow:"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"layers: 'detail'\n    \u2193\nLAYER_PRESETS['detail']   \u2192  ResourceLayerSelection object\n    \u2193\nbuildResourceQuery(layerSelection)\n    \u2193\ngql`query GetResource($uuid: ULID!) {\n  resource(uuid: $uuid) {\n    ...ResourceId\n    ...ResourceConfiguration\n    ...ResourceValidation\n    ...ResourceDeployment\n    ...ResourceRuntime\n    ...ResourceTelemetryLight\n    ...ResourceMetadataFull\n    ...ResourceRelationships\n    ...ResourcePlatform\n  }\n  [all spread fragment definitions]\n}`\n"})}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"query-keys-and-cache-invalidation",children:"Query Keys and Cache Invalidation"}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Source file:"})," ",(0,i.jsx)(s.code,{children:"libs/api-client/queries/src/resources/queryKeys.ts"})]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"resourceKeys"})," is a hierarchical key factory modeled after TanStack Query conventions. These keys\nare used both for Apollo cache eviction and for identifying query groups to refetch."]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-ts",children:"resourceKeys.all; // ['resources']\nresourceKeys.byRouter('r-abc'); // ['resources', 'router', 'r-abc']\nresourceKeys.byUuid('r-abc', 'uuid-123'); // ['resources', 'router', 'r-abc', 'uuid', 'uuid-123']\nresourceKeys.byCategory('r-abc', 'VPN'); // ['resources', 'router', 'r-abc', 'category', 'VPN']\nresourceKeys.byType('r-abc', 'wireguard-client'); // ['resources', 'router', 'r-abc', 'type', 'wireguard-client']\nresourceKeys.byState('r-abc', 'ERROR'); // ['resources', 'router', 'r-abc', 'state', 'ERROR']\nresourceKeys.layers('r-abc', 'uuid-123', ['runtime']); // [...byUuid, 'layers', 'runtime']\nresourceKeys.composite('r-abc', 'uuid-123'); // [...byUuid, 'composite']\nresourceKeys.relationships('r-abc', 'uuid-123'); // [...byUuid, 'relationships']\nresourceKeys.list('r-abc', { category: 'VPN', first: 20 }); // [...byRouter, 'list', ...]\n"})}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsxs)(s.strong,{children:[(0,i.jsx)(s.code,{children:"ResourceListFilters"})," interface"]})," (used by ",(0,i.jsx)(s.code,{children:"resourceKeys.list"}),"):"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-ts",children:"interface ResourceListFilters {\n  category?: ResourceCategory;\n  type?: string;\n  state?: ResourceLifecycleState;\n  first?: number;\n  after?: string;\n}\n"})}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Invalidation helpers:"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-ts",children:"resourceInvalidations.router('r-abc'); // key for all resources on that router\nresourceInvalidations.resource('r-abc', 'uuid-123'); // key for one resource\nresourceInvalidations.category('r-abc', 'VPN'); // key for one category\n"})}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"useresource--dynamic-query-builder",children:"useResource \u2014 Dynamic Query Builder"}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Source file:"})," ",(0,i.jsx)(s.code,{children:"libs/api-client/queries/src/resources/useResource.ts"})]}),"\n",(0,i.jsx)(s.p,{children:"The primary hook for fetching a single resource. It dynamically assembles a GraphQL query document\nat hook call time based on the requested layer selection, so the network request transfers only the\ndata the component actually needs."}),"\n",(0,i.jsx)(s.h3,{id:"signature",children:"Signature"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-ts",children:"function useResource<TConfig = unknown>(\n  uuid: string | undefined,\n  options?: UseResourceOptions\n): UseResourceResult<TConfig>;\n"})}),"\n",(0,i.jsx)(s.h3,{id:"useresourceoptions",children:(0,i.jsx)(s.code,{children:"UseResourceOptions"})}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Option"}),(0,i.jsx)(s.th,{children:"Type"}),(0,i.jsx)(s.th,{children:"Default"}),(0,i.jsx)(s.th,{children:"Description"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"layers"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"ResourceLayerSelection | LayerPreset"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"'detail'"})}),(0,i.jsx)(s.td,{children:"Which layers to fetch"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"subscribeToRuntime"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"boolean"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"false"})}),(0,i.jsx)(s.td,{children:"Enable live runtime subscription"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"skip"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"boolean"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"false"})}),(0,i.jsx)(s.td,{children:"Skip query execution"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"pollInterval"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"number"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"0"})}),(0,i.jsx)(s.td,{children:"Polling interval in ms (0 = off)"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"fetchPolicy"})}),(0,i.jsx)(s.td,{children:"Apollo fetch policy"}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"'cache-and-network'"})}),(0,i.jsx)(s.td,{children:"Cache behaviour"})]})]})]}),"\n",(0,i.jsx)(s.h3,{id:"useresourceresulttconfig",children:(0,i.jsx)(s.code,{children:"UseResourceResult<TConfig>"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-ts",children:"interface UseResourceResult<TConfig> {\n  resource: Resource<TConfig> | undefined;\n  loading: boolean;\n  error: ApolloError | undefined;\n  networkStatus: number;\n  refetch: () => Promise<void>;\n  subscribed: boolean;\n  layers: {\n    validation: ValidationResult | undefined;\n    deployment: DeploymentState | undefined;\n    runtime: RuntimeState | undefined;\n    telemetry: TelemetryData | undefined;\n    metadata: ResourceMetadata | undefined;\n    relationships: ResourceRelationships | undefined;\n    platform: PlatformInfo | undefined;\n  };\n}\n"})}),"\n",(0,i.jsxs)(s.p,{children:["The ",(0,i.jsx)(s.code,{children:"layers"})," property is a pre-destructured convenience object \u2014 it mirrors ",(0,i.jsx)(s.code,{children:"resource.validation"}),",\n",(0,i.jsx)(s.code,{children:"resource.deployment"}),", etc., but is stable and can be destructured without optional chaining."]}),"\n",(0,i.jsx)(s.h3,{id:"runtime-subscription-merge",children:"Runtime Subscription Merge"}),"\n",(0,i.jsxs)(s.p,{children:["When ",(0,i.jsx)(s.code,{children:"subscribeToRuntime: true"}),", a second ",(0,i.jsx)(s.code,{children:"useSubscription"})," call is issued for ",(0,i.jsx)(s.code,{children:"ResourceRuntime"}),". On\nevery incoming subscription event the hook merges the live runtime fields on top of the query data\nusing a ",(0,i.jsx)(s.code,{children:"useMemo"}),":"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-ts",children:"// useResource.ts:310\nconst resource = useMemo(() => {\n  const baseResource = data?.resource;\n  if (!baseResource) return undefined;\n\n  if (subscriptionData?.resourceRuntime) {\n    return {\n      ...baseResource,\n      runtime: {\n        ...baseResource.runtime,\n        ...subscriptionData.resourceRuntime.runtime,\n      },\n    };\n  }\n  return baseResource;\n}, [data?.resource, subscriptionData?.resourceRuntime]);\n"})}),"\n",(0,i.jsx)(s.h3,{id:"usage-examples",children:"Usage Examples"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-tsx",children:"// Preset \u2014 detail panel\nconst { resource, loading, error } = useResource(uuid, { layers: 'detail' });\n\n// Custom layers \u2014 just config + runtime\nconst { resource } = useResource(uuid, {\n  layers: { configuration: true, runtime: true },\n});\n\n// With live runtime streaming\nconst { resource, subscribed } = useResource(uuid, {\n  layers: 'card',\n  subscribeToRuntime: true,\n});\n\n// Access individual layers directly\nconst {\n  layers: { validation, deployment },\n} = useResource(uuid, { layers: 'full' });\nif (validation?.errors.length) {\n  return <ValidationErrors errors={validation.errors} />;\n}\n"})}),"\n",(0,i.jsx)(s.h3,{id:"convenience-wrappers",children:"Convenience Wrappers"}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Hook"}),(0,i.jsx)(s.th,{children:"Preset"}),(0,i.jsx)(s.th,{children:"Purpose"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"useResourceDetail(uuid, opts?)"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"'detail'"})}),(0,i.jsx)(s.td,{children:"Detail panels"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"useResourceFull(uuid, opts?)"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"'full'"})}),(0,i.jsx)(s.td,{children:"Full data with telemetry history"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"useResourceCard(uuid, opts?)"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"'card'"})}),(0,i.jsx)(s.td,{children:"Dashboard cards"})]})]})]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"useresourcelist--relay-pagination",children:"useResourceList \u2014 Relay Pagination"}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Source file:"})," ",(0,i.jsx)(s.code,{children:"libs/api-client/queries/src/resources/useResourceList.ts"})]}),"\n",(0,i.jsxs)(s.p,{children:["Fetches a paginated connection of resources for a given router. Internally selects between\n",(0,i.jsx)(s.code,{children:"RESOURCES_LIST_QUERY"})," (uses ",(0,i.jsx)(s.code,{children:"ResourceListItem"})," fragment) and ",(0,i.jsx)(s.code,{children:"RESOURCES_CARD_QUERY"})," (uses\n",(0,i.jsx)(s.code,{children:"ResourceCard"})," fragment) based on the ",(0,i.jsx)(s.code,{children:"mode"})," option."]}),"\n",(0,i.jsx)(s.h3,{id:"signature-1",children:"Signature"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-ts",children:"function useResourceList<TConfig = unknown>(\n  options?: UseResourceListOptions\n): UseResourceListResult<TConfig>;\n"})}),"\n",(0,i.jsx)(s.h3,{id:"useresourcelistoptions",children:(0,i.jsx)(s.code,{children:"UseResourceListOptions"})}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Option"}),(0,i.jsx)(s.th,{children:"Type"}),(0,i.jsx)(s.th,{children:"Default"}),(0,i.jsx)(s.th,{children:"Description"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"filter"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"ResourceListFilter"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"{}"})}),(0,i.jsx)(s.td,{children:"Filter criteria"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"sort"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"ResourceListSort"})}),(0,i.jsx)(s.td,{children:"\u2014"}),(0,i.jsx)(s.td,{children:"Sort field and direction"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"pagination"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"ResourceListPagination"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"{ first: 20 }"})}),(0,i.jsx)(s.td,{children:"Relay cursor pagination"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"mode"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"'list' | 'card' | 'table'"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"'list'"})}),(0,i.jsx)(s.td,{children:"Fragment selection"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"skip"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"boolean"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"false"})}),(0,i.jsx)(s.td,{children:"Skip if routerId not yet known"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"pollInterval"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"number"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"0"})}),(0,i.jsx)(s.td,{children:"Background polling"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"fetchPolicy"})}),(0,i.jsx)(s.td,{children:"Apollo fetch policy"}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"'cache-and-network'"})}),(0,i.jsx)(s.td,{children:"Cache behaviour"})]})]})]}),"\n",(0,i.jsx)(s.h3,{id:"resourcelistfilter",children:(0,i.jsx)(s.code,{children:"ResourceListFilter"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-ts",children:"interface ResourceListFilter {\n  routerId?: string;\n  category?: ResourceCategory;\n  type?: string; // e.g. 'wireguard-client', 'lan-network'\n  state?: ResourceLifecycleState;\n  tags?: string[];\n  health?: 'HEALTHY' | 'DEGRADED' | 'CRITICAL' | 'UNKNOWN';\n  isRunning?: boolean;\n  isFavorite?: boolean;\n  isPinned?: boolean;\n  search?: string; // Free-text search; min 2 chars enforced by useResourceSearch\n}\n"})}),"\n",(0,i.jsx)(s.h3,{id:"resourcelistsort",children:(0,i.jsx)(s.code,{children:"ResourceListSort"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-ts",children:"interface ResourceListSort {\n  field: 'id' | 'type' | 'state' | 'updatedAt' | 'createdAt' | 'health';\n  direction: 'ASC' | 'DESC';\n}\n"})}),"\n",(0,i.jsxs)(s.h3,{id:"resourcelistpagination-relay-style",children:[(0,i.jsx)(s.code,{children:"ResourceListPagination"})," (Relay-style)"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-ts",children:"interface ResourceListPagination {\n  first?: number; // Forward pagination: items per page\n  after?: string; // Forward pagination: end cursor from previous page\n  last?: number; // Backward pagination: items per page\n  before?: string; // Backward pagination: start cursor\n}\n"})}),"\n",(0,i.jsx)(s.h3,{id:"useresourcelistresulttconfig",children:(0,i.jsx)(s.code,{children:"UseResourceListResult<TConfig>"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-ts",children:"interface UseResourceListResult<TConfig> {\n  resources: Resource<TConfig>[];\n  totalCount: number;\n  pageInfo: PageInfo; // { hasNextPage, hasPreviousPage, startCursor, endCursor }\n  loading: boolean;\n  error: ApolloError | undefined;\n  refetch: () => Promise<void>;\n  fetchMore: () => Promise<void>; // Appends next page to resources array\n  hasMore: boolean;\n  filter: ResourceListFilter | undefined;\n}\n"})}),"\n",(0,i.jsx)(s.h3,{id:"infinite-scroll-pattern",children:"Infinite Scroll Pattern"}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"fetchMore"})," is wired for infinite scroll. It appends the next page's edges to the existing edges\nusing ",(0,i.jsx)(s.code,{children:"updateQuery"}),":"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-ts",children:"// useResourceList.ts:325\nawait apolloFetchMore({\n  variables: { after: pageInfo.endCursor },\n  updateQuery: (prev, { fetchMoreResult }) => ({\n    resources: {\n      ...fetchMoreResult.resources,\n      edges: [...(prev.resources?.edges ?? []), ...fetchMoreResult.resources.edges],\n    },\n  }),\n});\n"})}),"\n",(0,i.jsx)(s.h3,{id:"stable-variable-keys",children:"Stable Variable Keys"}),"\n",(0,i.jsxs)(s.p,{children:["Object references for ",(0,i.jsx)(s.code,{children:"filter"}),", ",(0,i.jsx)(s.code,{children:"sort"}),", and ",(0,i.jsx)(s.code,{children:"pagination"})," change on every render. The hook serialises\neach to a JSON string key and uses that as the ",(0,i.jsx)(s.code,{children:"useMemo"})," dependency to prevent spurious query\nre-executions:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-ts",children:"// useResourceList.ts:266\nconst filterKey = JSON.stringify(filter);\nconst sortKey = JSON.stringify(sort);\nconst paginationKey = JSON.stringify(pagination);\nconst variables = useMemo(() => ({ ... }), [filterKey, sortKey, paginationKey]);\n"})}),"\n",(0,i.jsx)(s.h3,{id:"convenience-wrappers-1",children:"Convenience Wrappers"}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Hook"}),(0,i.jsx)(s.th,{children:"Filter Preset"}),(0,i.jsx)(s.th,{children:"Use Case"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"useResourcesByCategory(routerId, category, opts?)"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"{ routerId, category }"})}),(0,i.jsx)(s.td,{children:"Category-scoped lists"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"useResourcesByType(routerId, type, opts?)"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"{ routerId, type }"})}),(0,i.jsx)(s.td,{children:"Type-scoped lists"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"useFavoriteResources(routerId, opts?)"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"{ routerId, isFavorite: true }"})}),(0,i.jsx)(s.td,{children:"Favourites panel"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"useResourcesWithErrors(routerId, opts?)"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"{ routerId, state: 'ERROR' }"})}),(0,i.jsx)(s.td,{children:"Error dashboard"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"useResourceSearch(routerId, query, opts?)"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"{ routerId, search: query }"})}),(0,i.jsx)(s.td,{children:"Live search (skips if query < 2 chars)"})]})]})]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"useresourcelayers--per-layer-hooks",children:"useResourceLayers \u2014 Per-Layer Hooks"}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Source file:"})," ",(0,i.jsx)(s.code,{children:"libs/api-client/queries/src/resources/useResourceLayers.ts"})]}),"\n",(0,i.jsxs)(s.p,{children:["When a component only needs one layer and should not be re-rendered by changes to other layers, use\na dedicated layer hook. Each hook issues an independent query and returns a ",(0,i.jsx)(s.code,{children:"LayerHookResult<T>"}),"."]}),"\n",(0,i.jsx)(s.h3,{id:"layerhookoptions",children:(0,i.jsx)(s.code,{children:"LayerHookOptions"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-ts",children:"interface LayerHookOptions {\n  skip?: boolean;\n  pollInterval?: number;\n  fetchPolicy?: 'cache-first' | 'cache-and-network' | 'network-only';\n}\n"})}),"\n",(0,i.jsx)(s.h3,{id:"layerhookresultt",children:(0,i.jsx)(s.code,{children:"LayerHookResult<T>"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-ts",children:"interface LayerHookResult<T> {\n  data: T | undefined;\n  loading: boolean;\n  error: ApolloError | undefined;\n  refetch: () => Promise<void>;\n}\n"})}),"\n",(0,i.jsx)(s.h3,{id:"available-layer-hooks",children:"Available Layer Hooks"}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Hook"}),(0,i.jsxs)(s.th,{children:["Return ",(0,i.jsx)(s.code,{children:"data"})," Type"]}),(0,i.jsx)(s.th,{children:"GraphQL Query"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"useResourceValidation(uuid, opts?)"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"ValidationResult"})}),(0,i.jsxs)(s.td,{children:[(0,i.jsx)(s.code,{children:"GetResourceValidation"})," with ",(0,i.jsx)(s.code,{children:"ResourceValidation"})]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"useResourceDeployment(uuid, opts?)"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"DeploymentState"})}),(0,i.jsxs)(s.td,{children:[(0,i.jsx)(s.code,{children:"GetResourceDeployment"})," with ",(0,i.jsx)(s.code,{children:"ResourceDeployment"})]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"useResourceRuntime(uuid, opts?)"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"RuntimeState"})}),(0,i.jsxs)(s.td,{children:[(0,i.jsx)(s.code,{children:"GetResourceRuntime"})," with ",(0,i.jsx)(s.code,{children:"ResourceRuntime"})]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"useResourceTelemetry(uuid, opts?)"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"TelemetryData"})}),(0,i.jsxs)(s.td,{children:[(0,i.jsx)(s.code,{children:"GetResourceTelemetry"})," with ",(0,i.jsx)(s.code,{children:"ResourceTelemetryFull"})]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"useResourceMetadata(uuid, opts?)"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"ResourceMetadata"})}),(0,i.jsxs)(s.td,{children:[(0,i.jsx)(s.code,{children:"GetResourceMetadata"})," with ",(0,i.jsx)(s.code,{children:"ResourceMetadataFull"})]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"useResourceRelationships(uuid, opts?)"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"ResourceRelationships"})}),(0,i.jsxs)(s.td,{children:[(0,i.jsx)(s.code,{children:"GetResourceRelationships"})," with ",(0,i.jsx)(s.code,{children:"ResourceRelationships"})]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"useResourcePlatform(uuid, opts?)"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"PlatformInfo"})}),(0,i.jsxs)(s.td,{children:[(0,i.jsx)(s.code,{children:"GetResourcePlatform"})," with ",(0,i.jsx)(s.code,{children:"ResourcePlatform"})]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"useResourceConfiguration<TConfig>(uuid, opts?)"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"{ uuid, id, type, category, configuration: TConfig }"})}),(0,i.jsxs)(s.td,{children:[(0,i.jsx)(s.code,{children:"GetResourceConfiguration"})," with ",(0,i.jsx)(s.code,{children:"ResourceId"})," + ",(0,i.jsx)(s.code,{children:"configuration"})]})]})]})]}),"\n",(0,i.jsx)(s.h3,{id:"usage-examples-1",children:"Usage Examples"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-tsx",children:"// Poll runtime every 5 seconds without loading the full resource\nconst { data: runtime } = useResourceRuntime(uuid, { pollInterval: 5000 });\nreturn <StatusBadge status={runtime?.isRunning ? 'online' : 'offline'} />;\n\n// Check drift without re-rendering on runtime changes\nconst { data: deployment } = useResourceDeployment(uuid);\nif (deployment?.drift) {\n  return <DriftWarning drift={deployment.drift} />;\n}\n\n// Strongly-typed configuration access\nconst { data } = useResourceConfiguration<WireGuardConfig>(uuid);\nreturn <WireGuardConfigForm defaultValues={data?.configuration} />;\n\n// Render bandwidth chart from telemetry only\nconst { data: telemetry } = useResourceTelemetry(uuid);\nreturn <BandwidthChart data={telemetry?.bandwidthHistory} />;\n"})}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"usecompositeresource",children:"useCompositeResource"}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Source file:"})," ",(0,i.jsx)(s.code,{children:"libs/api-client/queries/src/resources/useCompositeResource.ts"})]}),"\n",(0,i.jsx)(s.p,{children:"Composite resources are parent resources that own one or more sub-resources. Examples: a WireGuard\nserver owns its peer clients; a LAN network owns its DHCP server and DHCP leases; a bridge owns its\nport members."}),"\n",(0,i.jsxs)(s.p,{children:["The hook queries the ",(0,i.jsx)(s.code,{children:"compositeResource"})," GraphQL field (distinct from ",(0,i.jsx)(s.code,{children:"resource"}),") and populates a\nflattened lookup map of all sub-resources for efficient access."]}),"\n",(0,i.jsx)(s.h3,{id:"signature-2",children:"Signature"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-ts",children:"function useCompositeResource(\n  uuid: string | undefined,\n  options?: UseCompositeResourceOptions\n): UseCompositeResourceResult;\n"})}),"\n",(0,i.jsx)(s.h3,{id:"usecompositeresourceoptions",children:(0,i.jsx)(s.code,{children:"UseCompositeResourceOptions"})}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Option"}),(0,i.jsx)(s.th,{children:"Type"}),(0,i.jsx)(s.th,{children:"Default"}),(0,i.jsx)(s.th,{children:"Description"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"depth"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"1 | 2 | 3"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"2"})}),(0,i.jsx)(s.td,{children:"Nesting depth for sub-resource fetching"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"includeRuntime"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"boolean"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"true"})}),(0,i.jsxs)(s.td,{children:["Use ",(0,i.jsx)(s.code,{children:"ResourceDetail"})," for sub-resources (vs ",(0,i.jsx)(s.code,{children:"ResourceCard"}),")"]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"skip"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"boolean"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"false"})}),(0,i.jsx)(s.td,{children:"Skip execution"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"fetchPolicy"})}),(0,i.jsx)(s.td,{children:"Apollo fetch policy"}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"'cache-and-network'"})}),(0,i.jsx)(s.td,{children:"Cache behaviour"})]})]})]}),"\n",(0,i.jsx)(s.h3,{id:"usecompositeresourceresult",children:(0,i.jsx)(s.code,{children:"UseCompositeResourceResult"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-ts",children:"interface UseCompositeResourceResult {\n  resource: CompositeResource | undefined;\n  status: CompositeStatus;\n  loading: boolean;\n  error: ApolloError | undefined;\n  refetch: () => Promise<void>;\n  getSubResource: (uuid: string) => Resource | undefined;\n  getSubResourcesByType: (type: string) => Resource[];\n}\n"})}),"\n",(0,i.jsx)(s.h3,{id:"compositestatus",children:(0,i.jsx)(s.code,{children:"CompositeStatus"})}),"\n",(0,i.jsx)(s.p,{children:"Automatically calculated from all sub-resources:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-ts",children:"interface CompositeStatus {\n  activeCount: number;\n  errorCount: number;\n  degradedCount: number;\n  overallHealth: 'HEALTHY' | 'DEGRADED' | 'CRITICAL' | 'UNKNOWN';\n  allRunning: boolean;\n  hasDrift: boolean;\n}\n"})}),"\n",(0,i.jsxs)(s.p,{children:["Health rollup rules (from ",(0,i.jsx)(s.code,{children:"calculateCompositeStatus"}),"):"]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Any sub-resource with ",(0,i.jsx)(s.code,{children:"state === 'ERROR'"})," or ",(0,i.jsx)(s.code,{children:"runtime.health === 'FAILED'"})," \u2192 ",(0,i.jsx)(s.code,{children:"CRITICAL"})]}),"\n",(0,i.jsxs)(s.li,{children:["Any ",(0,i.jsx)(s.code,{children:"state === 'DEGRADED'"}),", ",(0,i.jsx)(s.code,{children:"runtime.health === 'DEGRADED'"}),", or ",(0,i.jsx)(s.code,{children:"deployment.drift"})," \u2192 ",(0,i.jsx)(s.code,{children:"DEGRADED"})]}),"\n",(0,i.jsxs)(s.li,{children:["All ",(0,i.jsx)(s.code,{children:"state === 'ACTIVE'"})," \u2192 ",(0,i.jsx)(s.code,{children:"HEALTHY"})]}),"\n",(0,i.jsxs)(s.li,{children:["Otherwise \u2192 ",(0,i.jsx)(s.code,{children:"UNKNOWN"})]}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"graphql-queries",children:"GraphQL Queries"}),"\n",(0,i.jsxs)(s.p,{children:["Two queries are available depending on ",(0,i.jsx)(s.code,{children:"includeRuntime"}),":"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-graphql",children:"# includeRuntime: false (depth 1-2)\nquery GetCompositeResource($uuid: ULID!, $depth: Int) {\n  compositeResource(uuid: $uuid, depth: $depth) {\n    ...ResourceDetail\n    subResources {\n      ...ResourceCard\n      subResources {\n        ...ResourceCard\n      }\n    }\n  }\n}\n\n# includeRuntime: true (default, depth 1-2)\nquery GetCompositeResourceFull($uuid: ULID!, $depth: Int) {\n  compositeResource(uuid: $uuid, depth: $depth) {\n    ...ResourceDetail\n    subResources {\n      ...ResourceDetail\n      subResources {\n        ...ResourceCard\n      }\n    }\n  }\n}\n"})}),"\n",(0,i.jsx)(s.h3,{id:"domain-specific-composite-hooks",children:"Domain-Specific Composite Hooks"}),"\n",(0,i.jsx)(s.p,{children:"Pre-built hooks for the most common composite patterns:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-ts",children:"// WireGuard server + all peer clients\nconst { resource, clients, clientCount, activeClients } = useWireGuardServerWithClients(serverUuid);\n\n// LAN network + DHCP server + DHCP leases\nconst { resource, dhcpServer, dhcpLeases, leaseCount, activeLeases } =\n  useLANNetworkWithDHCP(networkUuid);\n\n// Bridge + all port members\nconst { resource, members, memberCount } = useBridgeWithMembers(bridgeUuid);\n\n// Feature + all its managed resources (depth 3)\nconst { resource, resourceCount } = useFeatureWithResources(featureUuid);\n"})}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"useresourcesubscription",children:"useResourceSubscription"}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Source file:"})," ",(0,i.jsx)(s.code,{children:"libs/api-client/queries/src/resources/useResourceSubscription.ts"})]}),"\n",(0,i.jsxs)(s.p,{children:["Real-time event hooks for resource state changes. All hooks return a ",(0,i.jsx)(s.code,{children:"SubscriptionResult<T>"})," that\nincludes an ",(0,i.jsx)(s.code,{children:"isConnected"})," flag for connection-status UI."]}),"\n",(0,i.jsxs)(s.h3,{id:"subscriptionresultt-type",children:[(0,i.jsx)(s.code,{children:"SubscriptionResult<T>"})," Type"]}),"\n",(0,i.jsx)(s.p,{children:"All subscription hooks return this unified result type:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-ts",children:"interface SubscriptionResult<T> {\n  data: T | undefined;\n  loading: boolean;\n  error: ApolloError | undefined;\n  isConnected: boolean;\n}\n"})}),"\n",(0,i.jsxs)(s.p,{children:["The ",(0,i.jsx)(s.code,{children:"isConnected"})," flag becomes ",(0,i.jsx)(s.code,{children:"false"})," if the subscription is skipped or no UUID is provided,\nhelping UI components render appropriate connection-status indicators."]}),"\n",(0,i.jsxs)(s.h3,{id:"runtime-updates--useresourceruntimesubscription",children:["Runtime Updates \u2014 ",(0,i.jsx)(s.code,{children:"useResourceRuntimeSubscription"})]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Source:"})," ",(0,i.jsx)(s.code,{children:"libs/api-client/queries/src/resources/useResourceSubscription.ts:208"})]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-ts",children:"function useResourceRuntimeSubscription(\n  uuid: string | undefined,\n  options?: UseResourceRuntimeSubscriptionOptions\n): SubscriptionResult<RuntimeUpdateEvent>;\n"})}),"\n",(0,i.jsx)(s.p,{children:"Subscribes to live runtime metrics updates. Supports optional throttling to reduce re-render\nfrequency when events arrive rapidly (e.g., streaming metrics from polling probes)."}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Options:"})}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Option"}),(0,i.jsx)(s.th,{children:"Type"}),(0,i.jsx)(s.th,{children:"Default"}),(0,i.jsx)(s.th,{children:"Description"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"skip"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"boolean"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"false"})}),(0,i.jsx)(s.td,{children:"Pause subscription"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"onUpdate"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"(event: RuntimeUpdateEvent) => void"})}),(0,i.jsx)(s.td,{children:"\u2014"}),(0,i.jsx)(s.td,{children:"Callback invoked per event (after throttle)"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"onError"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"(error: ApolloError) => void"})}),(0,i.jsx)(s.td,{children:"\u2014"}),(0,i.jsx)(s.td,{children:"Subscription error callback"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"throttleMs"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"number"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"0"})}),(0,i.jsxs)(s.td,{children:["Minimum milliseconds between ",(0,i.jsx)(s.code,{children:"onUpdate"})," calls; pending updates are flushed after throttle expires"]})]})]})]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Event Type:"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-ts",children:"interface RuntimeUpdateEvent {\n  uuid: string;\n  runtime: RuntimeState; // { isRunning, health, metrics, lastUpdated, activeConnections, uptime, ... }\n  timestamp: string;\n}\n"})}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Throttling Implementation:"})," When ",(0,i.jsx)(s.code,{children:"throttleMs > 0"}),", incoming events that arrive within the\nthrottle window are held in ",(0,i.jsx)(s.code,{children:"pendingUpdateRef"}),". After the throttle duration expires, the most recent\npending event is flushed via ",(0,i.jsx)(s.code,{children:"onUpdate"}),". This prevents re-renders from event storms while preserving\nthe latest metrics."]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Usage example:"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-tsx",children:"const { data, isConnected } = useResourceRuntimeSubscription(uuid, {\n  throttleMs: 1000, // max 1 update per second\n  onUpdate: (event) => console.log('Metrics:', event.runtime.metrics),\n});\n\nif (isConnected && data?.runtime) {\n  return <MetricsBadge health={data.runtime.health} />;\n}\n"})}),"\n",(0,i.jsxs)(s.h3,{id:"state-changes--useresourcestatesubscription",children:["State Changes \u2014 ",(0,i.jsx)(s.code,{children:"useResourceStateSubscription"})]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Source:"})," ",(0,i.jsx)(s.code,{children:"libs/api-client/queries/src/resources/useResourceSubscription.ts:290"})]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-ts",children:"function useResourceStateSubscription(\n  uuid: string | undefined,\n  options?: UseResourceStateSubscriptionOptions\n): SubscriptionResult<StateChangeEvent>;\n"})}),"\n",(0,i.jsxs)(s.p,{children:["Subscribes to resource lifecycle state transitions (e.g., ",(0,i.jsx)(s.code,{children:"DRAFT"})," \u2192 ",(0,i.jsx)(s.code,{children:"ACTIVE"})," \u2192 ",(0,i.jsx)(s.code,{children:"DELETED"}),"). Fires\nimmediately when state changes occur on the backend."]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Options:"})}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Option"}),(0,i.jsx)(s.th,{children:"Type"}),(0,i.jsx)(s.th,{children:"Default"}),(0,i.jsx)(s.th,{children:"Description"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"skip"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"boolean"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"false"})}),(0,i.jsx)(s.td,{children:"Pause subscription"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"onStateChange"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"(event: StateChangeEvent) => void"})}),(0,i.jsx)(s.td,{children:"\u2014"}),(0,i.jsx)(s.td,{children:"Callback when state changes"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"onError"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"(error: ApolloError) => void"})}),(0,i.jsx)(s.td,{children:"\u2014"}),(0,i.jsx)(s.td,{children:"Subscription error callback"})]})]})]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Event Type:"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-ts",children:"interface StateChangeEvent {\n  uuid: string;\n  previousState: ResourceLifecycleState; // e.g., 'DRAFT'\n  newState: ResourceLifecycleState; // e.g., 'ACTIVE'\n  triggeredBy: string; // Username or system process\n  timestamp: string; // ISO 8601\n  message?: string; // Optional reason\n}\n"})}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Usage example:"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-tsx",children:"useResourceStateSubscription(uuid, {\n  onStateChange: (event) => {\n    toast.info(`Resource moved from ${event.previousState} to ${event.newState}`);\n  },\n});\n"})}),"\n",(0,i.jsxs)(s.h3,{id:"validation-progress--useresourcevalidationsubscription",children:["Validation Progress \u2014 ",(0,i.jsx)(s.code,{children:"useResourceValidationSubscription"})]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Source:"})," ",(0,i.jsx)(s.code,{children:"libs/api-client/queries/src/resources/useResourceSubscription.ts:335"})]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-ts",children:"function useResourceValidationSubscription(\n  uuid: string | undefined,\n  options?: { skip?: boolean; onProgress?: (event: ValidationEvent) => void }\n): SubscriptionResult<ValidationEvent>;\n"})}),"\n",(0,i.jsx)(s.p,{children:"Subscribes to validation stage completion events. Fires once per stage as the resource moves through\nthe 7-stage validation pipeline."}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Validation Stages (in order):"})}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"SYNTAX"})," \u2014 GraphQL/JSON syntax checking"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"SEMANTIC"})," \u2014 Field type and enum value validation"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"DEPENDENCY"})," \u2014 Cross-resource dependency checking"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"PLATFORM"})," \u2014 RouterOS capability verification (e.g., WireGuard availability on OS version)"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"CONFLICT"})," \u2014 Address/port conflict detection"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"SECURITY"})," \u2014 Security policy checks"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"FINAL"})," \u2014 Aggregate result"]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Event Type:"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-ts",children:"interface ValidationEvent {\n  uuid: string;\n  stage: 'SYNTAX' | 'SEMANTIC' | 'DEPENDENCY' | 'PLATFORM' | 'CONFLICT' | 'SECURITY' | 'FINAL';\n  isComplete: boolean; // true when this stage finishes\n  hasErrors: boolean; // any stage-level errors\n  hasWarnings: boolean; // any stage-level warnings\n  timestamp: string; // ISO 8601\n}\n"})}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Usage example:"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-tsx",children:"const { data } = useResourceValidationSubscription(uuid, {\n  onProgress: (event) => {\n    if (event.stage === 'PLATFORM' && event.hasErrors) {\n      toast.error(`Router cannot support this config: ${event.message}`);\n    }\n  },\n});\n\nif (data?.stage === 'FINAL' && data?.isComplete) {\n  console.log('All validation stages complete');\n}\n"})}),"\n",(0,i.jsxs)(s.h3,{id:"batch-runtime--useresourcesruntimesubscription",children:["Batch Runtime \u2014 ",(0,i.jsx)(s.code,{children:"useResourcesRuntimeSubscription"})]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Source:"})," ",(0,i.jsx)(s.code,{children:"libs/api-client/queries/src/resources/useResourceSubscription.ts:374"})]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-ts",children:"function useResourcesRuntimeSubscription(\n  uuids: string[],\n  options?: { skip?: boolean; onUpdate?: (uuid: string, runtime: RuntimeState) => void }\n): {\n  data: Map<string, RuntimeState>;\n  loading: boolean;\n  error: ApolloError | undefined;\n  isConnected: boolean;\n};\n"})}),"\n",(0,i.jsxs)(s.p,{children:["Subscribes to runtime updates for multiple resources simultaneously (typically a list view showing\n10-100 items). Returns a ",(0,i.jsx)(s.code,{children:"Map<uuid, RuntimeState>"})," that is mutated in-place with each incoming\nevent."]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Key Implementation Detail:"})," The returned ",(0,i.jsx)(s.code,{children:"data"})," Map is a stable reference across renders \u2014 new\nevents mutate the existing Map via ",(0,i.jsx)(s.code,{children:"runtimeMapRef.current.set()"}),". This prevents re-renders from\nobject reference changes; only actual metric changes trigger downstream updates via the ",(0,i.jsx)(s.code,{children:"onUpdate"}),"\ncallback."]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Usage example:"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-tsx",children:"const uuids = resources.map((r) => r.uuid);\nconst { data: runtimeMap, isConnected } = useResourcesRuntimeSubscription(uuids);\n\n// In a list row component:\nfunction ResourceRow({ resource }: { resource: Resource }) {\n  const runtime = runtimeMap.get(resource.uuid);\n  return <StatusBadge status={runtime?.health ?? 'UNKNOWN'} />;\n}\n"})}),"\n",(0,i.jsxs)(s.h3,{id:"combined--useresourcesubscriptions",children:["Combined \u2014 ",(0,i.jsx)(s.code,{children:"useResourceSubscriptions"})]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Source:"})," ",(0,i.jsx)(s.code,{children:"libs/api-client/queries/src/resources/useResourceSubscription.ts:450"})]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-ts",children:"function useResourceSubscriptions(\n  uuid: string | undefined,\n  options?: UseResourceSubscriptionsOptions\n): {\n  runtime: SubscriptionResult<RuntimeUpdateEvent>;\n  stateChange: SubscriptionResult<StateChangeEvent>;\n  validation: SubscriptionResult<ValidationEvent>;\n  isConnected: boolean;\n};\n"})}),"\n",(0,i.jsxs)(s.p,{children:["Composes all three individual subscriptions (",(0,i.jsx)(s.code,{children:"useResourceRuntimeSubscription"}),",\n",(0,i.jsx)(s.code,{children:"useResourceStateSubscription"}),", ",(0,i.jsx)(s.code,{children:"useResourceValidationSubscription"}),") with per-subscription enable\nflags. Returns separate ",(0,i.jsx)(s.code,{children:"SubscriptionResult"})," for each, plus a unified ",(0,i.jsx)(s.code,{children:"isConnected"})," that is ",(0,i.jsx)(s.code,{children:"true"}),"\nif any subscription is active and connected."]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Options:"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-ts",children:"interface UseResourceSubscriptionsOptions {\n  runtime?: boolean; // default: true\n  stateChanges?: boolean; // default: false\n  validation?: boolean; // default: false\n  skip?: boolean;\n  onRuntimeUpdate?: (event: RuntimeUpdateEvent) => void;\n  onStateChange?: (event: StateChangeEvent) => void;\n  onValidationProgress?: (event: ValidationEvent) => void;\n}\n"})}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Combined Connection Status Logic:"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-ts",children:"const isConnected =\n  runtimeResult.isConnected || stateResult.isConnected || validationResult.isConnected;\n"})}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Usage example:"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-tsx",children:"const { runtime, stateChange, validation, isConnected } = useResourceSubscriptions(uuid, {\n  runtime: true,\n  stateChanges: true,\n  validation: false,\n  onRuntimeUpdate: (e) => updateMetrics(e.runtime.metrics),\n  onStateChange: (e) => {\n    if (e.newState === 'ACTIVE') {\n      toast.success('Resource is now active');\n    }\n  },\n});\n\nreturn (\n  <div>\n    <ConnectionStatus connected={isConnected} />\n    {runtime.data && <MetricsBadge metrics={runtime.data.runtime.metrics} />}\n    {stateChange.data && <StateTransitionLog event={stateChange.data} />}\n  </div>\n);\n"})}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"useresourcemutations",children:"useResourceMutations"}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Source file:"})," ",(0,i.jsx)(s.code,{children:"libs/api-client/queries/src/resources/useResourceMutations.ts"})]}),"\n",(0,i.jsxs)(s.p,{children:["All resource mutations return ",(0,i.jsx)(s.code,{children:"MutationResult<TData, TVariables>"}),":"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-ts",children:"interface MutationResult<TData, TVariables> {\n  mutate: (variables: TVariables) => Promise<TData>;\n  loading: boolean;\n  error: ApolloError | undefined;\n  reset: () => void;\n}\n"})}),"\n",(0,i.jsx)(s.h3,{id:"mutation-summary",children:"Mutation Summary"}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Hook"}),(0,i.jsx)(s.th,{children:"GraphQL Mutation"}),(0,i.jsx)(s.th,{children:"Input"}),(0,i.jsx)(s.th,{children:"Return"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"useCreateResource<TConfig>()"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"CreateResource"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"CreateResourceInput"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"Resource<TConfig>"})})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"useUpdateResource<TConfig>()"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"UpdateResource"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"UpdateResourceInput"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"Resource<TConfig>"})})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"useDeleteResource()"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"DeleteResource"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"uuid: string"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"boolean"})})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"useValidateResource()"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"ValidateResource"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"uuid: string"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"Resource & { validation }"})})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"useApplyResource<TConfig>()"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"ApplyResource"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"uuid, ApplyResourceOptions?"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"Resource<TConfig>"})})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"useSyncResource<TConfig>()"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"SyncResource"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"uuid: string"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"Resource<TConfig>"})})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"useRevertResource<TConfig>()"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"RevertResource"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"uuid: string"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"Resource<TConfig>"})})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"useArchiveResource()"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"ArchiveResource"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"uuid: string"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"{ uuid, state }"})})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"useRestoreResource<TConfig>()"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"RestoreResource"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"uuid: string"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"Resource<TConfig>"})})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"useCloneResource<TConfig>()"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"CloneResource"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"uuid, newId?"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"Resource<TConfig>"})})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"useBatchApplyResources()"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"BatchApplyResources"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"uuids[], force?"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"{ successful[], failed[] }"})})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"useUpdateResourceMetadata()"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"UpdateResourceMetadata"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"uuid, metadata input"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"{ uuid }"})})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"useToggleFavorite()"})}),(0,i.jsxs)(s.td,{children:["(via ",(0,i.jsx)(s.code,{children:"useUpdateResourceMetadata"}),")"]}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"uuid, currentFavorite"})}),(0,i.jsx)(s.td,{children:"\u2014"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"useTogglePinned()"})}),(0,i.jsxs)(s.td,{children:["(via ",(0,i.jsx)(s.code,{children:"useUpdateResourceMetadata"}),")"]}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"uuid, currentPinned"})}),(0,i.jsx)(s.td,{children:"\u2014"})]})]})]}),"\n",(0,i.jsx)(s.h3,{id:"input-types",children:"Input Types"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-ts",children:"interface CreateResourceInput {\n  routerId: string;\n  type: string;\n  category: ResourceCategory;\n  configuration: Record<string, unknown>;\n  metadata?: { tags?: string[]; description?: string; notes?: string };\n}\n\ninterface UpdateResourceInput {\n  uuid: string;\n  configuration?: Record<string, unknown>;\n  metadata?: {\n    tags?: string[];\n    description?: string;\n    notes?: string;\n    isFavorite?: boolean;\n    isPinned?: boolean;\n  };\n}\n\ninterface ApplyResourceOptions {\n  force?: boolean; // Apply despite validation warnings\n  skipValidation?: boolean; // Skip pre-apply validation entirely\n  onSuccess?: () => void;\n  onError?: (error: ApolloError) => void;\n}\n"})}),"\n",(0,i.jsx)(s.h3,{id:"cache-behaviour-on-mutations",children:"Cache Behaviour on Mutations"}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:(0,i.jsx)(s.code,{children:"useUpdateResource"})})," uses an optimistic response to immediately update the cache before the\nserver confirms:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-ts",children:"// useResourceMutations.ts:271\noptimisticResponse: ({ input }) => ({\n  updateResource: {\n    __typename: 'Resource',\n    uuid: input.uuid,\n    ...input.configuration && { configuration: input.configuration },\n    ...input.metadata && { metadata: input.metadata },\n  },\n}),\n"})}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:(0,i.jsx)(s.code,{children:"useDeleteResource"})})," evicts the resource from the Apollo cache immediately on success:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-ts",children:"// useResourceMutations.ts:308\nupdate(cache, { data }, { variables }) {\n  cache.evict({\n    id: cache.identify({ __typename: 'Resource', uuid: variables?.uuid })\n  });\n  cache.gc();\n},\n"})}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:(0,i.jsx)(s.code,{children:"useUpdateResourceMetadata"})})," uses an optimistic response with\n",(0,i.jsx)(s.code,{children:"updatedAt: new Date().toISOString()"})," so tag/favourite toggles feel instant."]}),"\n",(0,i.jsx)(s.h3,{id:"apply-confirm-merge-flow",children:"Apply-Confirm-Merge Flow"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"useUpdateResource()   \u2192  sets configuration (DRAFT state)\nuseValidateResource() \u2192  checks all 6 validation stages\nuseApplyResource()    \u2192  pushes config to router; Resource moves to ACTIVE\nuseSyncResource()     \u2192  pulls current router state back (resolves drift)\nuseRevertResource()   \u2192  discards DRAFT, returns to last applied config\n"})}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"apollo-cache-type-policies",children:"Apollo Cache Type Policies"}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Source file:"})," ",(0,i.jsx)(s.code,{children:"libs/api-client/core/src/apollo/apollo-client.ts:82"})]}),"\n",(0,i.jsxs)(s.p,{children:["The ",(0,i.jsx)(s.code,{children:"InMemoryCache"})," configuration defines precise merge strategies for each resource layer."]}),"\n",(0,i.jsx)(s.h3,{id:"resource-key",children:"Resource Key"}),"\n",(0,i.jsxs)(s.p,{children:["All resource types use ",(0,i.jsx)(s.code,{children:"uuid"})," (ULID) as their cache key:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-ts",children:"Resource: {\n  keyFields: ['uuid'];\n}\n// Also: WireGuardClient, LANNetwork, WANLink, FirewallRuleResource,\n//       DHCPServerResource, BridgeResource, RouteResource, FeatureResource\n"})}),"\n",(0,i.jsx)(s.h3,{id:"layer-level-merge-policies",children:"Layer-Level Merge Policies"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-ts",children:"Resource: {\n  keyFields: ['uuid'],\n  fields: {\n    // Runtime: MERGE \u2014 preserve continuity between subscription updates\n    runtime: {\n      merge(existing, incoming) {\n        return { ...existing, ...incoming };\n      },\n    },\n\n    // Telemetry: MERGE with history append and 24h window cap\n    telemetry: {\n      merge(existing, incoming) {\n        return {\n          ...existing, ...incoming,\n          bandwidthHistory: [\n            ...(existing?.bandwidthHistory ?? []),\n            ...(incoming?.bandwidthHistory ?? []),\n          ].slice(-288), // last 24h at 5-min intervals\n          hourlyStats: incoming?.hourlyStats ?? existing?.hourlyStats,\n          dailyStats: incoming?.dailyStats ?? existing?.dailyStats,\n        };\n      },\n    },\n\n    // Deployment: REPLACE \u2014 always take latest full state\n    deployment: { merge: false },\n\n    // Validation: REPLACE \u2014 stale validation is dangerous\n    validation: { merge: false },\n  },\n},\n"})}),"\n",(0,i.jsx)(s.h3,{id:"supporting-type-policies",children:"Supporting Type Policies"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-ts",children:"ValidationResult: {\n  merge: false;\n} // Never mix old and new validation results\nDeploymentState: {\n  merge: false;\n} // Full replacement on every apply\nRuntimeState: {\n  merge: true;\n} // Shallow merge for metric updates\nResourceMetadata: {\n  merge: true;\n} // Preserve local UI state (isFavorite, etc.)\n"})}),"\n",(0,i.jsx)(s.h3,{id:"resources-query-field-policy",children:"Resources Query Field Policy"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-ts",children:"Query: {\n  fields: {\n    resources: {\n      keyArgs: ['routerId', 'category', 'type', 'state'],\n      merge(existing, incoming) { return incoming; },\n    },\n  },\n}\n"})}),"\n",(0,i.jsxs)(s.p,{children:["Pagination cursors (",(0,i.jsx)(s.code,{children:"first"}),", ",(0,i.jsx)(s.code,{children:"after"}),") are not part of ",(0,i.jsx)(s.code,{children:"keyArgs"}),", so fetching page 2 uses the same\ncache entry and the hook's ",(0,i.jsx)(s.code,{children:"updateQuery"})," is responsible for appending edges."]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"cross-references",children:"Cross-References"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:(0,i.jsx)(s.code,{children:"./intro.md"})})," \u2014 Library overview, codegen commands, import aliases"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:(0,i.jsx)(s.code,{children:"./apollo-client.md"})})," \u2014 Full Apollo Client setup, link chain, WebSocket client"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:(0,i.jsx)(s.code,{children:"./offline-first.md"})})," \u2014 Cache persistence and offline behaviour"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:(0,i.jsx)(s.code,{children:"./websocket-subscriptions.md"})})," \u2014 WebSocket transport details; subscription hooks\narchitecture"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:(0,i.jsx)(s.code,{children:"./change-set-pattern.md"})})," \u2014 Apply-Confirm-Merge for atomic multi-resource operations"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:(0,i.jsx)(s.code,{children:"./domain-query-hooks.md"})})," \u2014 Domain hooks (VPN, DHCP, firewall, etc.) that compose resource\nmodel hooks"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:(0,i.jsx)(s.code,{children:"./service-lifecycle.md"})})," \u2014 Feature lifecycle hooks that use composite resource patterns"]}),"\n"]})]})}function u(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},71184:(e,s,n)=>{n.d(s,{R:()=>c,x:()=>d});var r=n(14041);const i={},t=r.createContext(i);function c(e){const s=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function d(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),r.createElement(t.Provider,{value:s},e.children)}}}]);