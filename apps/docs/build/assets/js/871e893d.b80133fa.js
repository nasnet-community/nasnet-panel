"use strict";(globalThis.webpackChunk_nas_net_docs=globalThis.webpackChunk_nas_net_docs||[]).push([[41654],{71184:(n,e,i)=>{i.d(e,{R:()=>a,x:()=>s});var r=i(14041);const t={},o=r.createContext(t);function a(n){const e=r.useContext(o);return r.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function s(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:a(n.components),r.createElement(o.Provider,{value:e},n.children)}},92300:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>l,contentTitle:()=>s,default:()=>h,frontMatter:()=>a,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"machines/config-pipeline","title":"Configuration Pipeline Machine (Safety Flow)","description":"The Config Pipeline Machine implements the Apply-Confirm-Merge pattern for safe configuration changes. It prevents accidental network lockouts through explicit state modeling, guards, and automatic rollback on failure.","source":"@site/../../libs/state/docs/machines/config-pipeline.md","sourceDirName":"machines","slug":"/machines/config-pipeline","permalink":"/docs/state/machines/config-pipeline","draft":false,"unlisted":false,"editUrl":"https://github.com/nasnet-community/nasnet-panel/tree/main/../../libs/state/docs/machines/config-pipeline.md","tags":[],"version":"current","frontMatter":{},"sidebar":"sidebar","previous":{"title":"Change Set Machine (Atomic Multi-Resource Operations)","permalink":"/docs/state/machines/change-set-machine"},"next":{"title":"XState Machines Overview","permalink":"/docs/state/machines/overview"}}');var t=i(31085),o=i(71184);const a={},s="Configuration Pipeline Machine (Safety Flow)",l={},d=[{value:"Complete State Chart",id:"complete-state-chart",level:2},{value:"States Reference",id:"states-reference",level:2},{value:"Events",id:"events",level:2},{value:"External Events (sent by user/UI)",id:"external-events-sent-by-userui",level:3},{value:"Context",id:"context",level:2},{value:"ValidationError",id:"validationerror",level:3},{value:"ConfigDiff",id:"configdiff",level:3},{value:"Guards (Transition Conditions)",id:"guards-transition-conditions",level:2},{value:"Actions (Side Effects)",id:"actions-side-effects",level:2},{value:"Actors (Async Operations)",id:"actors-async-operations",level:2},{value:"Integration with Apply-Confirm-Merge Flow",id:"integration-with-apply-confirm-merge-flow",level:2},{value:"Error Handling and Auto-Rollback",id:"error-handling-and-auto-rollback",level:2},{value:"Usage with <code>useConfigPipeline</code> Hook",id:"usage-with-useconfigpipeline-hook",level:2},{value:"Code Examples",id:"code-examples",level:2},{value:"Creating a Simple Pipeline Machine",id:"creating-a-simple-pipeline-machine",level:3},{value:"High-Risk Operation Detection",id:"high-risk-operation-detection",level:3},{value:"Quick Apply (Non-High-Risk)",id:"quick-apply-non-high-risk",level:3},{value:"Safety Features",id:"safety-features",level:2},{value:"Related Documentation",id:"related-documentation",level:2}];function c(n){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.header,{children:(0,t.jsx)(e.h1,{id:"configuration-pipeline-machine-safety-flow",children:"Configuration Pipeline Machine (Safety Flow)"})}),"\n",(0,t.jsxs)(e.p,{children:["The ",(0,t.jsx)(e.strong,{children:"Config Pipeline Machine"})," implements the ",(0,t.jsx)(e.strong,{children:"Apply-Confirm-Merge pattern"})," for safe configuration changes. It prevents accidental network lockouts through explicit state modeling, guards, and automatic rollback on failure."]}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Source:"})," ",(0,t.jsx)(e.code,{children:"libs/state/machines/src/configPipelineMachine.ts"}),"\n",(0,t.jsx)(e.strong,{children:"Hook:"})," ",(0,t.jsx)(e.code,{children:"libs/state/machines/src/hooks/useConfigPipeline.ts"})]}),"\n",(0,t.jsx)(e.h2,{id:"complete-state-chart",children:"Complete State Chart"}),"\n",(0,t.jsx)(e.mermaid,{value:"stateDiagram-v2\n    [*] --\x3e idle\n\n    idle --\x3e draft: EDIT\n\n    draft --\x3e idle: CANCEL\n    draft --\x3e validating: VALIDATE\n\n    validating --\x3e invalid: hasErrors\n    validating --\x3e previewing: noErrors\n\n    invalid --\x3e draft: EDIT\n    invalid --\x3e idle: CANCEL\n\n    previewing --\x3e confirming: CONFIRM (high-risk)\n    previewing --\x3e applying: CONFIRM (low-risk)\n    previewing --\x3e draft: EDIT\n    previewing --\x3e idle: CANCEL\n\n    confirming --\x3e applying: ACKNOWLEDGED\n\n    applying --\x3e verifying: onDone\n    applying --\x3e error: onError\n\n    verifying --\x3e active: onDone\n    verifying --\x3e rollback: onError\n\n    rollback --\x3e rolled_back: onDone\n    rollback --\x3e error: onError\n\n    error --\x3e validating: RETRY\n    error --\x3e rollback: FORCE_ROLLBACK\n    error --\x3e idle: RESET\n\n    active --\x3e [*]\n    rolled_back --\x3e [*]\n\n    note right of idle\n        User ready to edit\n        configuration\n    end note\n\n    note right of draft\n        User editing\n        Can EDIT multiple times\n    end note\n\n    note right of validating\n        Running 7-stage validation\n        Cannot skip validation\n        Async operation in progress\n    end note\n\n    note right of invalid\n        Validation failed\n        Show errors\n        Can EDIT or CANCEL\n    end note\n\n    note right of previewing\n        Display config diff\n        Show added/removed/modified\n        Indicate if high-risk\n    end note\n\n    note right of confirming\n        User acknowledging\n        high-risk operation\n    end note\n\n    note right of applying\n        Sending config to router\n        Getting rollback data\n        Async operation in progress\n    end note\n\n    note right of verifying\n        Confirming router accepted\n        Async verification\n    end note\n\n    note right of active\n        Configuration applied \u2713\n        Success callback triggered\n        Terminal state\n    end note\n\n    note right of rollback\n        Auto-rolling back\n        Async operation in progress\n    end note\n\n    note right of rolled_back\n        Back to previous state\n        Rollback callback triggered\n        Terminal state\n    end note\n\n    note right of error\n        Unrecoverable error\n        Can RETRY, FORCE_ROLLBACK, or RESET\n        Error callback triggered\n    end note"}),"\n",(0,t.jsx)(e.h2,{id:"states-reference",children:"States Reference"}),"\n",(0,t.jsxs)(e.table,{children:[(0,t.jsx)(e.thead,{children:(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.th,{children:"State"}),(0,t.jsx)(e.th,{children:"Duration"}),(0,t.jsx)(e.th,{children:"Purpose"}),(0,t.jsx)(e.th,{children:"Entry Actions"}),(0,t.jsx)(e.th,{children:"On Events"})]})}),(0,t.jsxs)(e.tbody,{children:[(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:(0,t.jsx)(e.strong,{children:"idle"})}),(0,t.jsx)(e.td,{children:"Indefinite"}),(0,t.jsx)(e.td,{children:"Initial state, waiting for user to start editing"}),(0,t.jsx)(e.td,{children:"None"}),(0,t.jsxs)(e.td,{children:[(0,t.jsx)(e.code,{children:"EDIT"})," \u2192 draft"]})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:(0,t.jsx)(e.strong,{children:"draft"})}),(0,t.jsx)(e.td,{children:"Indefinite"}),(0,t.jsx)(e.td,{children:"User editing configuration"}),(0,t.jsx)(e.td,{children:"None"}),(0,t.jsxs)(e.td,{children:[(0,t.jsx)(e.code,{children:"EDIT"})," (stay), ",(0,t.jsx)(e.code,{children:"VALIDATE"})," \u2192 validating, ",(0,t.jsx)(e.code,{children:"CANCEL"})," \u2192 idle (reset)"]})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:(0,t.jsx)(e.strong,{children:"validating"})}),(0,t.jsx)(e.td,{children:"5-30s"}),(0,t.jsx)(e.td,{children:"Running 7-stage validation pipeline"}),(0,t.jsx)(e.td,{children:"None"}),(0,t.jsx)(e.td,{children:"onDone \u2192 invalid|previewing, onError \u2192 error"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:(0,t.jsx)(e.strong,{children:"invalid"})}),(0,t.jsx)(e.td,{children:"Indefinite"}),(0,t.jsx)(e.td,{children:"Validation failed, showing errors"}),(0,t.jsx)(e.td,{children:"None"}),(0,t.jsxs)(e.td,{children:[(0,t.jsx)(e.code,{children:"EDIT"})," \u2192 draft (reset), ",(0,t.jsx)(e.code,{children:"CANCEL"})," \u2192 idle (reset)"]})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:(0,t.jsx)(e.strong,{children:"previewing"})}),(0,t.jsx)(e.td,{children:"Indefinite"}),(0,t.jsx)(e.td,{children:"Showing configuration diff"}),(0,t.jsx)(e.td,{children:"None"}),(0,t.jsxs)(e.td,{children:[(0,t.jsx)(e.code,{children:"CONFIRM"})," \u2192 applying|confirming, ",(0,t.jsx)(e.code,{children:"EDIT"})," \u2192 draft, ",(0,t.jsx)(e.code,{children:"CANCEL"})," \u2192 idle"]})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:(0,t.jsx)(e.strong,{children:"confirming"})}),(0,t.jsx)(e.td,{children:"Indefinite"}),(0,t.jsx)(e.td,{children:"User acknowledging high-risk operation"}),(0,t.jsx)(e.td,{children:"None"}),(0,t.jsxs)(e.td,{children:[(0,t.jsx)(e.code,{children:"ACKNOWLEDGED"})," \u2192 applying, ",(0,t.jsx)(e.code,{children:"CANCEL"})," \u2192 previewing"]})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:(0,t.jsx)(e.strong,{children:"applying"})}),(0,t.jsx)(e.td,{children:"5-60s"}),(0,t.jsx)(e.td,{children:"Sending config to router, getting rollback data"}),(0,t.jsx)(e.td,{children:"None"}),(0,t.jsx)(e.td,{children:"onDone \u2192 verifying, onError \u2192 error"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:(0,t.jsx)(e.strong,{children:"verifying"})}),(0,t.jsx)(e.td,{children:"5-30s"}),(0,t.jsx)(e.td,{children:"Confirming router accepted changes"}),(0,t.jsx)(e.td,{children:"None"}),(0,t.jsx)(e.td,{children:"onDone \u2192 active, onError \u2192 rollback"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:(0,t.jsx)(e.strong,{children:"active"})}),(0,t.jsx)(e.td,{children:"N/A"}),(0,t.jsx)(e.td,{children:"Configuration successfully applied"}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"notifySuccess()"})}),(0,t.jsx)(e.td,{children:"(Terminal - no transitions)"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:(0,t.jsx)(e.strong,{children:"rollback"})}),(0,t.jsx)(e.td,{children:"5-30s"}),(0,t.jsx)(e.td,{children:"Auto-rolling back due to verification failure"}),(0,t.jsx)(e.td,{children:"None"}),(0,t.jsx)(e.td,{children:"onDone \u2192 rolled_back, onError \u2192 error"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:(0,t.jsx)(e.strong,{children:"rolled_back"})}),(0,t.jsx)(e.td,{children:"N/A"}),(0,t.jsx)(e.td,{children:"Rollback completed, back to safe state"}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"notifyRolledBack()"})}),(0,t.jsx)(e.td,{children:"(Terminal - no transitions)"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:(0,t.jsx)(e.strong,{children:"error"})}),(0,t.jsx)(e.td,{children:"Indefinite"}),(0,t.jsx)(e.td,{children:"Unrecoverable error"}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"notifyError()"})}),(0,t.jsxs)(e.td,{children:[(0,t.jsx)(e.code,{children:"RETRY"})," \u2192 validating, ",(0,t.jsx)(e.code,{children:"FORCE_ROLLBACK"})," \u2192 rollback, ",(0,t.jsx)(e.code,{children:"RESET"})," \u2192 idle"]})]})]})]}),"\n",(0,t.jsx)(e.h2,{id:"events",children:"Events"}),"\n",(0,t.jsx)(e.h3,{id:"external-events-sent-by-userui",children:"External Events (sent by user/UI)"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-typescript",children:"type ConfigPipelineEvent<TConfig> =\n  | { type: 'EDIT'; config: TConfig }           // Start/update editing\n  | { type: 'VALIDATE' }                         // Trigger validation\n  | { type: 'CONFIRM' }                          // Confirm preview\n  | { type: 'ACKNOWLEDGED' }                     // Acknowledge high-risk\n  | { type: 'CANCEL' }                           // Cancel pipeline\n  | { type: 'RETRY' }                            // Retry after error\n  | { type: 'RESET' }                            // Reset to idle\n  | { type: 'FORCE_ROLLBACK' };                  // Force rollback from error\n"})}),"\n",(0,t.jsx)(e.h2,{id:"context",children:"Context"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-typescript",children:"interface ConfigPipelineContext<TConfig = unknown> {\n  /** Resource ID being configured */\n  resourceId: string | null;\n\n  /** Original configuration (before user changes) */\n  originalConfig: TConfig | null;\n\n  /** Pending configuration (being edited) */\n  pendingConfig: TConfig | null;\n\n  /** Validation errors from validation stage */\n  validationErrors: ValidationError[];\n\n  /** Configuration diff (added/removed/modified) */\n  diff: ConfigDiff | null;\n\n  /** Data needed for rollback if apply fails */\n  rollbackData: TConfig | null;\n\n  /** Timestamp when apply started (for timeout) */\n  applyStartedAt: number | null;\n\n  /** Error message if in error state */\n  errorMessage: string | null;\n}\n"})}),"\n",(0,t.jsx)(e.h3,{id:"validationerror",children:"ValidationError"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-typescript",children:"interface ValidationError {\n  field: string;                                 // Field that failed\n  message: string;                               // Human-readable message\n  severity: 'error' | 'warning';                 // Error severity\n  code?: string;                                 // Programmatic error code\n}\n"})}),"\n",(0,t.jsx)(e.h3,{id:"configdiff",children:"ConfigDiff"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-typescript",children:"interface ConfigDiff {\n  added: Array<{ path: string; value: unknown }>;         // New entries\n  removed: Array<{ path: string; value: unknown }>;       // Deleted entries\n  modified: Array<{                                       // Changed entries\n    path: string;\n    oldValue: unknown;\n    newValue: unknown;\n  }>;\n  isHighRisk: boolean;                                    // Requires confirmation\n  riskExplanation?: string;                               // Why it's high-risk\n}\n"})}),"\n",(0,t.jsx)(e.h2,{id:"guards-transition-conditions",children:"Guards (Transition Conditions)"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-typescript",children:"{\n  hasValidationErrors: boolean;    // Validation produced errors\n  noValidationErrors: boolean;     // Validation passed (no errors)\n  isHighRisk: boolean;             // diff.isHighRisk === true\n  isNotHighRisk: boolean;          // diff.isHighRisk === false\n  hasResourceId: boolean;          // resourceId !== null\n  hasRollbackData: boolean;        // rollbackData !== null\n}\n"})}),"\n",(0,t.jsx)(e.h2,{id:"actions-side-effects",children:"Actions (Side Effects)"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-typescript",children:"{\n  updatePendingConfig();           // Set pending config from EDIT event\n  setValidationResults();          // Store validation errors & diff\n  setRollbackData();               // Store rollback data from apply\n  setErrorMessage();               // Store error from failure\n  clearErrors();                   // Reset validation errors\n  resetPipeline();                 // Clear all data (idle on cancel)\n  notifySuccess();                 // Callback: apply succeeded\n  notifyRolledBack();              // Callback: rollback completed\n  notifyError();                   // Callback: error occurred\n}\n"})}),"\n",(0,t.jsx)(e.h2,{id:"actors-async-operations",children:"Actors (Async Operations)"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-typescript",children:"actors: {\n  runValidationPipeline(config: TConfig): Promise<{\n    errors: ValidationError[];\n    diff: ConfigDiff;\n  }>;\n\n  applyConfig(params: {\n    resourceId: string;\n    config: TConfig;\n  }): Promise<{\n    rollbackData: TConfig;\n  }>;\n\n  verifyApplied(resourceId: string): Promise<void>;\n\n  executeRollback(rollbackData: TConfig): Promise<void>;\n}\n"})}),"\n",(0,t.jsx)(e.h2,{id:"integration-with-apply-confirm-merge-flow",children:"Integration with Apply-Confirm-Merge Flow"}),"\n",(0,t.jsxs)(e.p,{children:["The config pipeline implements the ",(0,t.jsx)(e.strong,{children:"Apply-Confirm-Merge"})," pattern:"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"1. DRAFT          - User edits configuration\n2. VALIDATE       - 7-stage validation pipeline checks:\n                    - Schema validation\n                    - Dependency validation\n                    - Security checks\n                    - Compatibility checks\n                    - Resource constraints\n                    - Network impact\n                    - Rollback feasibility\n3. PREVIEW        - Show diff of changes (added/modified/removed)\n4. CONFIRM        - User confirms (or acknowledges high-risk)\n5. APPLY          - Apply config to router, capture rollback\n6. VERIFY         - Confirm router accepted changes\n7. SUCCESS/FAIL   - Final state or auto-rollback on verification fail\n"})}),"\n",(0,t.jsx)(e.h2,{id:"error-handling-and-auto-rollback",children:"Error Handling and Auto-Rollback"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"Verification Failure (during VERIFYING)\n\u251c\u2500 Router rejected changes\n\u2514\u2500 Transition to ROLLBACK:\n   \u251c\u2500 Execute rollback in reverse order\n   \u251c\u2500 Router returns to previous state\n   \u2514\u2500 Transition to ROLLED_BACK (final)\n\nFailed Rollback\n\u251c\u2500 Rollback actor throws error\n\u2514\u2500 Transition to ERROR:\n   \u251c\u2500 User can FORCE_ROLLBACK (manual retry)\n   \u251c\u2500 User can RETRY validation\n   \u2514\u2500 User can RESET to idle\n"})}),"\n",(0,t.jsxs)(e.h2,{id:"usage-with-useconfigpipeline-hook",children:["Usage with ",(0,t.jsx)(e.code,{children:"useConfigPipeline"})," Hook"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-tsx",children:"import { useConfigPipeline } from '@nasnet/state/machines';\n\nfunction WireGuardEditor({ resourceId, initialConfig }) {\n  const pipeline = useConfigPipeline<WireGuardConfig>(\n    {\n      runValidationPipeline: async (config) => {\n        const response = await api.validateWireGuard(config);\n        return {\n          errors: response.validationErrors,\n          diff: response.diff,\n        };\n      },\n      applyConfig: async ({ resourceId, config }) => {\n        // Capture rollback data (previous config)\n        const backup = await api.getBackup(resourceId);\n        // Apply new config\n        await api.applyWireGuard(resourceId, config);\n        return { rollbackData: backup };\n      },\n      verifyApplied: async (resourceId) => {\n        const status = await api.getWireGuardStatus(resourceId);\n        if (!status.running) {\n          throw new Error('WireGuard failed to start');\n        }\n      },\n      executeRollback: async (rollbackData) => {\n        await api.restoreWireGuard(rollbackData);\n      },\n    },\n    {\n      resourceId,\n      onSuccess: () => toast.success('Configuration applied!'),\n      onRollback: () => toast.warning('Configuration rolled back'),\n      onError: (error) => toast.error(error),\n    }\n  );\n\n  // Handle validation phase\n  if (pipeline.state === 'validating') {\n    return <LoadingSpinner message=\"Validating configuration...\" />;\n  }\n\n  // Handle validation errors\n  if (pipeline.state === 'invalid') {\n    return (\n      <ValidationErrorDisplay\n        errors={pipeline.validationErrors}\n        onEdit={() => pipeline.edit(formData)}\n        onCancel={pipeline.cancel}\n      />\n    );\n  }\n\n  // Handle preview\n  if (pipeline.state === 'previewing') {\n    return (\n      <ConfigPreview\n        diff={pipeline.diff}\n        isHighRisk={pipeline.isHighRisk}\n        onConfirm={pipeline.confirm}\n        onEdit={() => pipeline.edit(formData)}\n        onCancel={pipeline.cancel}\n      />\n    );\n  }\n\n  // Handle high-risk confirmation\n  if (pipeline.state === 'confirming') {\n    return (\n      <HighRiskWarning\n        explanation={pipeline.diff?.riskExplanation}\n        onAcknowledge={pipeline.acknowledge}\n        onCancel={pipeline.cancel}\n      />\n    );\n  }\n\n  // Handle applying/verifying\n  if (pipeline.isProcessing) {\n    return <LoadingSpinner message={pipeline.stateDescription} />;\n  }\n\n  // Handle error\n  if (pipeline.state === 'error') {\n    return (\n      <ErrorPanel\n        error={pipeline.errorMessage}\n        onRetry={pipeline.retry}\n        onForceRollback={pipeline.forceRollback}\n        onReset={pipeline.reset}\n      />\n    );\n  }\n\n  // Handle success\n  if (pipeline.state === 'active') {\n    return <SuccessPanel message=\"Configuration applied successfully\" />;\n  }\n\n  // Handle rollback\n  if (pipeline.state === 'rolled_back') {\n    return <RolledBackPanel message=\"Configuration rolled back\" />;\n  }\n\n  // Edit form\n  return (\n    <ConfigForm\n      config={initialConfig}\n      errors={pipeline.validationErrors}\n      disabled={pipeline.isProcessing}\n      onSave={(config) => pipeline.editAndValidate(config)}\n      onCancel={pipeline.cancel}\n    />\n  );\n}\n"})}),"\n",(0,t.jsx)(e.h2,{id:"code-examples",children:"Code Examples"}),"\n",(0,t.jsx)(e.h3,{id:"creating-a-simple-pipeline-machine",children:"Creating a Simple Pipeline Machine"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-typescript",children:"import { createConfigPipelineMachine } from '@nasnet/state/machines';\n\ninterface DHCPConfig {\n  enabled: boolean;\n  startAddress: string;\n  endAddress: string;\n  leaseTime: number;\n}\n\nconst dhcpPipeline = createConfigPipelineMachine<DHCPConfig>({\n  id: 'dhcp-pipeline',\n  runValidationPipeline: async (config) => {\n    // Validate DHCP config\n    const errors: ValidationError[] = [];\n\n    if (!config.startAddress.match(/^\\d+\\.\\d+\\.\\d+\\.\\d+$/)) {\n      errors.push({\n        field: 'startAddress',\n        message: 'Invalid IP address format',\n        severity: 'error',\n      });\n    }\n\n    // Compute diff\n    const diff: ConfigDiff = {\n      added: config.enabled ? [{ path: 'dhcp', value: config }] : [],\n      removed: [],\n      modified: [],\n      isHighRisk: false,\n    };\n\n    return { errors, diff };\n  },\n  applyConfig: async ({ resourceId, config }) => {\n    const currentConfig = await api.getDHCPConfig(resourceId);\n    await api.applyDHCPConfig(resourceId, config);\n    return { rollbackData: currentConfig };\n  },\n  verifyApplied: async (resourceId) => {\n    const result = await api.checkDHCPStatus(resourceId);\n    if (!result.running) {\n      throw new Error('DHCP service failed to start');\n    }\n  },\n  executeRollback: async (rollbackData) => {\n    await api.restoreDHCPConfig(rollbackData);\n  },\n});\n"})}),"\n",(0,t.jsx)(e.h3,{id:"high-risk-operation-detection",children:"High-Risk Operation Detection"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-typescript",children:"// In validation pipeline:\nconst isHighRisk =\n  JSON.stringify(config) !== JSON.stringify(originalConfig);\n\nconst diff: ConfigDiff = {\n  // ... computed additions/deletions/modifications\n  isHighRisk,\n  riskExplanation: isHighRisk\n    ? 'This change will restart all services on the router'\n    : undefined,\n};\n"})}),"\n",(0,t.jsx)(e.h3,{id:"quick-apply-non-high-risk",children:"Quick Apply (Non-High-Risk)"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-tsx",children:"const pipeline = useQuickConfigPipeline(config, options);\n\n// Auto-confirms non-high-risk changes, skips preview\npipeline.quickApply(newConfig); // Automatically proceeds to apply\n"})}),"\n",(0,t.jsx)(e.h2,{id:"safety-features",children:"Safety Features"}),"\n",(0,t.jsxs)(e.ol,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Cannot Skip Validation:"})," VALIDATE is mandatory before CONFIRM"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"High-Risk Acknowledgment:"})," High-risk operations require explicit ACKNOWLEDGED event"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Automatic Rollback:"})," Verification failure triggers automatic rollback to previous state"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Manual Rollback Available:"})," User can force rollback from error state"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Error Recovery:"})," Multiple retry paths from error state"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Reset Available:"})," Can reset to idle from any cancellable state"]}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Overview:"})," See ",(0,t.jsx)(e.code,{children:"overview.md"})," for machine catalog and factory pattern"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"State Management:"})," See ",(0,t.jsx)(e.code,{children:"overview.md"})," for decision tree (when to use XState)"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Persistence:"})," See ",(0,t.jsx)(e.code,{children:"persistence.md"})," for session recovery"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Resource Lifecycle:"})," See ",(0,t.jsx)(e.code,{children:"resource-lifecycle.md"})," for individual resource management"]}),"\n"]})]})}function h(n={}){const{wrapper:e}={...(0,o.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(c,{...n})}):c(n)}}}]);