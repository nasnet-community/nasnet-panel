"use strict";(globalThis.webpackChunk_nas_net_docs=globalThis.webpackChunk_nas_net_docs||[]).push([[56692],{39542:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"feature-diagnostics","title":"Feature: Diagnostics (libs/features/diagnostics)","description":"Overview","source":"@site/../../libs/features/docs/feature-diagnostics.md","sourceDirName":".","slug":"/feature-diagnostics","permalink":"/docs/features/feature-diagnostics","draft":false,"unlisted":false,"editUrl":"https://github.com/nasnet-community/nasnet-panel/tree/main/../../libs/features/docs/feature-diagnostics.md","tags":[],"version":"current","frontMatter":{},"sidebar":"sidebar","previous":{"title":"Feature: Dashboard (libs/features/dashboard)","permalink":"/docs/features/feature-dashboard"},"next":{"title":"Feature Module: Firewall (libs/features/firewall)","permalink":"/docs/features/feature-firewall"}}');var i=s(31085),r=s(71184);const o={},c="Feature: Diagnostics (libs/features/diagnostics)",l={},d=[{value:"Overview",id:"overview",level:2},{value:"Directory Tree",id:"directory-tree",level:2},{value:"Public API",id:"public-api",level:2},{value:"Component Table",id:"component-table",level:2},{value:"Device Scan Tool",id:"device-scan-tool",level:2},{value:"Architecture",id:"architecture",level:3},{value:"Desktop Presenter",id:"desktop-presenter",level:3},{value:"Mobile Presenter",id:"mobile-presenter",level:3},{value:"DeviceDetailPanel",id:"devicedetailpanel",level:3},{value:"ScanSummary",id:"scansummary",level:3},{value:"Storybook Stories",id:"storybook-stories",level:3},{value:"DNS Lookup Tool",id:"dns-lookup-tool",level:2},{value:"Zod Schema",id:"zod-schema",level:3},{value:"Platform Presenters",id:"platform-presenters",level:3},{value:"DnsResults Component",id:"dnsresults-component",level:3},{value:"DnsError Component",id:"dnserror-component",level:3},{value:"DnsServerComparison Component",id:"dnsservercomparison-component",level:3},{value:"useDnsLookup Hook",id:"usednslookup-hook",level:3},{value:"Ping Tool",id:"ping-tool",level:2},{value:"Zod Schema",id:"zod-schema-1",level:3},{value:"Platform Presenters",id:"platform-presenters-1",level:3},{value:"LatencyGraph Component",id:"latencygraph-component",level:3},{value:"PingStatistics Component",id:"pingstatistics-component",level:3},{value:"PingResults Component",id:"pingresults-component",level:3},{value:"usePing Hook",id:"useping-hook",level:3},{value:"Traceroute Tool",id:"traceroute-tool",level:2},{value:"Zod Schema",id:"zod-schema-2",level:3},{value:"Platform Presenters",id:"platform-presenters-2",level:3},{value:"TracerouteHopsList Component",id:"traceroutehopslist-component",level:3},{value:"useTraceroute Hook",id:"usetraceroute-hook",level:3},{value:"Troubleshoot Wizard",id:"troubleshoot-wizard",level:2},{value:"Diagnostic Steps",id:"diagnostic-steps",level:3},{value:"XState Machine",id:"xstate-machine",level:3},{value:"Fix Registry",id:"fix-registry",level:3},{value:"Wizard Components",id:"wizard-components",level:3},{value:"Platform Presenters",id:"platform-presenters-3",level:3},{value:"useTroubleshootWizard Hook",id:"usetroubleshootwizard-hook",level:3},{value:"Ping Machine (<code>machines/ping-machine.ts</code>)",id:"ping-machine-machinesping-machinets",level:2},{value:"Services",id:"services",level:2},{value:"diagnostic-executor (<code>services/diagnostic-executor.ts</code>)",id:"diagnostic-executor-servicesdiagnostic-executorts",level:3},{value:"fix-applicator (<code>services/fix-applicator.ts</code>)",id:"fix-applicator-servicesfix-applicatorts",level:3},{value:"Utilities",id:"utilities",level:2},{value:"network-detection (<code>utils/network-detection.ts</code>)",id:"network-detection-utilsnetwork-detectionts",level:3},{value:"isp-detection (<code>utils/isp-detection.ts</code>)",id:"isp-detection-utilsisp-detectionts",level:3},{value:"Testing",id:"testing",level:2},{value:"Storybook",id:"storybook",level:2},{value:"Cross-References",id:"cross-references",level:2}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsxs)(n.h1,{id:"feature-diagnostics-libsfeaturesdiagnostics",children:["Feature: Diagnostics (",(0,i.jsx)(n.code,{children:"libs/features/diagnostics"}),")"]})}),"\n",(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsx)(n.p,{children:"The diagnostics feature module provides five complete network diagnostic tools for MikroTik router\nadministrators. Each tool has platform-specific presenters (Mobile/Desktop), Zod validation schemas,\nheadless hooks for business logic, and XState machines for complex multi-step workflows. The module\nships with a fix registry mapping known issues to automated RouterOS remediation commands."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Epic reference:"})," NAS-5.9 (DNS Lookup Tool), NAS-5.x (Traceroute, Ping, Device Scan, Troubleshoot\nWizard)"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Public import path:"})," ",(0,i.jsx)(n.code,{children:"@nasnet/features/diagnostics"})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"directory-tree",children:"Directory Tree"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"libs/features/diagnostics/src/\n\u251c\u2500\u2500 index.ts                          # Barrel export (public API)\n\u251c\u2500\u2500 components/\n\u2502   \u251c\u2500\u2500 DeviceScan/\n\u2502   \u2502   \u251c\u2500\u2500 DeviceScanTool.tsx        # Headless coordinator (platform auto-detect)\n\u2502   \u2502   \u251c\u2500\u2500 DeviceScanDesktop.tsx     # Desktop: full table with sort/filter\n\u2502   \u2502   \u251c\u2500\u2500 DeviceScanMobile.tsx      # Mobile: card list with swipe actions\n\u2502   \u2502   \u251c\u2500\u2500 DeviceDiscoveryTable.tsx  # Shared table component\n\u2502   \u2502   \u251c\u2500\u2500 DeviceDetailPanel.tsx     # Slide-over detail panel\n\u2502   \u2502   \u251c\u2500\u2500 ScanSummary.tsx           # Scan statistics and status header\n\u2502   \u2502   \u251c\u2500\u2500 useDeviceScan.ts          # Headless hook (scan state, progress)\n\u2502   \u2502   \u251c\u2500\u2500 types.ts                  # DeviceScan type definitions\n\u2502   \u2502   \u2514\u2500\u2500 index.ts                  # Sub-barrel export\n\u2502   \u251c\u2500\u2500 DnsLookupTool/\n\u2502   \u2502   \u251c\u2500\u2500 DnsLookupTool.tsx         # Auto-detect platform wrapper\n\u2502   \u2502   \u251c\u2500\u2500 DnsLookupToolDesktop.tsx  # Desktop: side-by-side form + results\n\u2502   \u2502   \u251c\u2500\u2500 DnsLookupToolMobile.tsx   # Mobile: stacked form then results\n\u2502   \u2502   \u251c\u2500\u2500 DnsResults.tsx            # DNS answer records display\n\u2502   \u2502   \u251c\u2500\u2500 DnsError.tsx              # Error state with actionable messages\n\u2502   \u2502   \u251c\u2500\u2500 DnsServerComparison.tsx   # Multi-server result comparison table\n\u2502   \u2502   \u251c\u2500\u2500 dnsLookup.schema.ts       # Zod form validation schema\n\u2502   \u2502   \u251c\u2500\u2500 dnsLookup.utils.ts        # Formatting utilities\n\u2502   \u2502   \u251c\u2500\u2500 dnsLookup.graphql.ts      # GraphQL query document\n\u2502   \u2502   \u251c\u2500\u2500 DnsLookupTool.types.ts    # Types and DNS_RECORD_TYPES constant\n\u2502   \u2502   \u251c\u2500\u2500 useDnsLookup.ts           # Headless hook (query, history, comparison)\n\u2502   \u2502   \u2514\u2500\u2500 index.ts\n\u2502   \u251c\u2500\u2500 PingTool/\n\u2502   \u2502   \u251c\u2500\u2500 PingTool.tsx              # Auto-detect platform wrapper\n\u2502   \u2502   \u251c\u2500\u2500 PingToolDesktop.tsx       # Desktop: graph + stats side-by-side\n\u2502   \u2502   \u251c\u2500\u2500 PingToolMobile.tsx        # Mobile: stacked graph then statistics\n\u2502   \u2502   \u251c\u2500\u2500 LatencyGraph.tsx          # Recharts real-time latency line chart\n\u2502   \u2502   \u251c\u2500\u2500 PingResults.tsx           # Per-packet result list\n\u2502   \u2502   \u251c\u2500\u2500 PingStatistics.tsx        # Min/Max/Avg/StdDev/Loss summary panel\n\u2502   \u2502   \u251c\u2500\u2500 ping.schema.ts            # Zod form validation schema\n\u2502   \u2502   \u251c\u2500\u2500 ping.utils.ts             # Statistics calculation utilities\n\u2502   \u2502   \u251c\u2500\u2500 ping.graphql.ts           # GraphQL subscription document\n\u2502   \u2502   \u251c\u2500\u2500 PingTool.types.ts         # PingResult, PingStatistics interfaces\n\u2502   \u2502   \u251c\u2500\u2500 usePing.ts                # Headless hook (wraps pingMachine actor)\n\u2502   \u2502   \u2514\u2500\u2500 index.ts\n\u2502   \u251c\u2500\u2500 TracerouteTool/\n\u2502   \u2502   \u251c\u2500\u2500 TracerouteTool.tsx        # Auto-detect platform wrapper\n\u2502   \u2502   \u251c\u2500\u2500 TracerouteToolDesktop.tsx # Desktop: full hop table + map panel\n\u2502   \u2502   \u251c\u2500\u2500 TracerouteToolMobile.tsx  # Mobile: hop card list\n\u2502   \u2502   \u251c\u2500\u2500 TracerouteHopsList.tsx    # Hop-by-hop visualization list\n\u2502   \u2502   \u251c\u2500\u2500 traceroute.schema.ts      # Zod form validation schema\n\u2502   \u2502   \u251c\u2500\u2500 TracerouteTool.types.ts   # TracerouteHop, TracerouteResult types\n\u2502   \u2502   \u2514\u2500\u2500 index.ts\n\u2502   \u2514\u2500\u2500 TroubleshootWizard/\n\u2502       \u251c\u2500\u2500 TroubleshootWizard.tsx         # Auto-detect platform wrapper\n\u2502       \u251c\u2500\u2500 TroubleshootWizardDesktop.tsx  # Desktop: step list + detail panel\n\u2502       \u251c\u2500\u2500 TroubleshootWizardMobile.tsx   # Mobile: step-by-step cards\n\u2502       \u251c\u2500\u2500 TroubleshootWizardSkeleton.tsx # Loading skeleton\n\u2502       \u251c\u2500\u2500 DiagnosticStep.tsx             # Single step status card\n\u2502       \u251c\u2500\u2500 FixSuggestion.tsx              # Fix card with apply/skip actions\n\u2502       \u251c\u2500\u2500 WizardSummary.tsx              # Completion summary with applied fixes\n\u2502       \u251c\u2500\u2500 StepAnnouncer.tsx              # WCAG live-region accessibility\n\u2502       \u2514\u2500\u2500 index.ts\n\u251c\u2500\u2500 machines/\n\u2502   \u251c\u2500\u2500 troubleshoot-machine.ts       # XState: 5-step diagnostic flow\n\u2502   \u2514\u2500\u2500 ping-machine.ts               # XState: real-time ping lifecycle\n\u251c\u2500\u2500 hooks/\n\u2502   \u251c\u2500\u2500 useTraceroute.ts              # Traceroute GraphQL subscription hook\n\u2502   \u251c\u2500\u2500 useTroubleshootWizard.ts      # Wrapper hook over troubleshootMachine actor\n\u2502   \u2514\u2500\u2500 index.ts\n\u251c\u2500\u2500 services/\n\u2502   \u251c\u2500\u2500 diagnostic-executor.ts        # Executes individual diagnostic steps via GraphQL\n\u2502   \u2514\u2500\u2500 fix-applicator.ts             # Applies RouterOS fix commands\n\u251c\u2500\u2500 constants/\n\u2502   \u2514\u2500\u2500 fix-registry.ts               # FIX_REGISTRY: issue codes \u2192 FixSuggestion\n\u251c\u2500\u2500 types/\n\u2502   \u2514\u2500\u2500 troubleshoot.types.ts         # Shared type definitions\n\u251c\u2500\u2500 utils/\n\u2502   \u251c\u2500\u2500 network-detection.ts          # WAN interface and gateway detection\n\u2502   \u2514\u2500\u2500 isp-detection.ts              # ISP name/contact detection from router\n\u251c\u2500\u2500 graphql/\n\u2502   \u2514\u2500\u2500 traceroute.graphql.ts         # Traceroute mutation + subscription documents\n\u2514\u2500\u2500 i18n/\n    \u2514\u2500\u2500 troubleshoot-messages.ts      # TROUBLESHOOT_MESSAGES constants\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"public-api",children:"Public API"}),"\n",(0,i.jsxs)(n.p,{children:["Exported from ",(0,i.jsx)(n.code,{children:"libs/features/diagnostics/src/index.ts"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// Components (all five tools + sub-components)\nexport * from './components/TroubleshootWizard';\nexport * from './components/TracerouteTool';\nexport * from './components/DnsLookupTool';\nexport * from './components/PingTool';\nexport * from './components/DeviceScan';\n\n// Hooks\nexport * from './hooks'; // useTraceroute, useTroubleshootWizard\n\n// GraphQL documents\nexport {\n  RUN_TRACEROUTE,\n  CANCEL_TRACEROUTE,\n  TRACEROUTE_PROGRESS_SUBSCRIPTION,\n  HOP_PROBE_FRAGMENT,\n  TRACEROUTE_HOP_FRAGMENT,\n  TRACEROUTE_RESULT_FRAGMENT,\n} from './graphql/traceroute.graphql';\n\n// Types\nexport type {\n  DiagnosticStep,\n  DiagnosticResult,\n  DiagnosticSummary,\n  AppliedFix,\n  FixSuggestion,\n  ISPInfo,\n  TroubleshootContext,\n  TroubleshootEvent,\n} from './types/troubleshoot.types';\n\n// Constants and utilities\nexport { FIX_REGISTRY, getFix } from './constants/fix-registry';\nexport { detectWanInterface, detectGateway } from './utils/network-detection';\nexport { detectISP, getWanIpForISPDetection } from './utils/isp-detection';\nexport { TROUBLESHOOT_MESSAGES } from './i18n/troubleshoot-messages';\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"component-table",children:"Component Table"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Component"}),(0,i.jsx)(n.th,{children:"File"}),(0,i.jsx)(n.th,{children:"Platform"}),(0,i.jsx)(n.th,{children:"Purpose"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DeviceScanTool"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DeviceScan/DeviceScanTool.tsx"})}),(0,i.jsx)(n.td,{children:"Both"}),(0,i.jsx)(n.td,{children:"Auto-detect coordinator"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DeviceScanDesktop"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DeviceScan/DeviceScanDesktop.tsx"})}),(0,i.jsx)(n.td,{children:"Desktop"}),(0,i.jsx)(n.td,{children:"Full table with sort/filter"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DeviceScanMobile"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DeviceScan/DeviceScanMobile.tsx"})}),(0,i.jsx)(n.td,{children:"Mobile"}),(0,i.jsx)(n.td,{children:"Card list with actions"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DeviceDiscoveryTable"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DeviceScan/DeviceDiscoveryTable.tsx"})}),(0,i.jsx)(n.td,{children:"Shared"}),(0,i.jsx)(n.td,{children:"ARP table renderer"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DeviceDetailPanel"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DeviceScan/DeviceDetailPanel.tsx"})}),(0,i.jsx)(n.td,{children:"Both"}),(0,i.jsx)(n.td,{children:"Slide-over device details"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ScanSummary"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DeviceScan/ScanSummary.tsx"})}),(0,i.jsx)(n.td,{children:"Both"}),(0,i.jsx)(n.td,{children:"Scan stats header"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DnsLookupTool"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DnsLookupTool/DnsLookupTool.tsx"})}),(0,i.jsx)(n.td,{children:"Both"}),(0,i.jsx)(n.td,{children:"Auto-detect wrapper"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DnsLookupToolDesktop"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DnsLookupTool/DnsLookupToolDesktop.tsx"})}),(0,i.jsx)(n.td,{children:"Desktop"}),(0,i.jsx)(n.td,{children:"Side-by-side layout"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DnsLookupToolMobile"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DnsLookupTool/DnsLookupToolMobile.tsx"})}),(0,i.jsx)(n.td,{children:"Mobile"}),(0,i.jsx)(n.td,{children:"Stacked layout"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DnsResults"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DnsLookupTool/DnsResults.tsx"})}),(0,i.jsx)(n.td,{children:"Both"}),(0,i.jsx)(n.td,{children:"DNS record display"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DnsError"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DnsLookupTool/DnsError.tsx"})}),(0,i.jsx)(n.td,{children:"Both"}),(0,i.jsx)(n.td,{children:"Error with suggestions"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DnsServerComparison"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DnsLookupTool/DnsServerComparison.tsx"})}),(0,i.jsx)(n.td,{children:"Both"}),(0,i.jsx)(n.td,{children:"Multi-server comparison"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"PingTool"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"PingTool/PingTool.tsx"})}),(0,i.jsx)(n.td,{children:"Both"}),(0,i.jsx)(n.td,{children:"Auto-detect wrapper"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"PingToolDesktop"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"PingTool/PingToolDesktop.tsx"})}),(0,i.jsx)(n.td,{children:"Desktop"}),(0,i.jsx)(n.td,{children:"Graph + stats side-by-side"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"PingToolMobile"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"PingTool/PingToolMobile.tsx"})}),(0,i.jsx)(n.td,{children:"Mobile"}),(0,i.jsx)(n.td,{children:"Stacked layout"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"LatencyGraph"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"PingTool/LatencyGraph.tsx"})}),(0,i.jsx)(n.td,{children:"Both"}),(0,i.jsx)(n.td,{children:"Recharts real-time chart"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"PingResults"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"PingTool/PingResults.tsx"})}),(0,i.jsx)(n.td,{children:"Both"}),(0,i.jsx)(n.td,{children:"Per-packet list"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"PingStatistics"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"PingTool/PingStatistics.tsx"})}),(0,i.jsx)(n.td,{children:"Both"}),(0,i.jsx)(n.td,{children:"Aggregate stats panel"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"TracerouteTool"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"TracerouteTool/TracerouteTool.tsx"})}),(0,i.jsx)(n.td,{children:"Both"}),(0,i.jsx)(n.td,{children:"Auto-detect wrapper"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"TracerouteToolDesktop"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"TracerouteTool/TracerouteToolDesktop.tsx"})}),(0,i.jsx)(n.td,{children:"Desktop"}),(0,i.jsx)(n.td,{children:"Table + RTT chart"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"TracerouteToolMobile"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"TracerouteTool/TracerouteToolMobile.tsx"})}),(0,i.jsx)(n.td,{children:"Mobile"}),(0,i.jsx)(n.td,{children:"Card list"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"TracerouteHopsList"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"TracerouteTool/TracerouteHopsList.tsx"})}),(0,i.jsx)(n.td,{children:"Both"}),(0,i.jsx)(n.td,{children:"Hop-by-hop list"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"TroubleshootWizard"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"TroubleshootWizard/TroubleshootWizard.tsx"})}),(0,i.jsx)(n.td,{children:"Both"}),(0,i.jsx)(n.td,{children:"Auto-detect wrapper"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"TroubleshootWizardDesktop"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"TroubleshootWizard/TroubleshootWizardDesktop.tsx"})}),(0,i.jsx)(n.td,{children:"Desktop"}),(0,i.jsx)(n.td,{children:"Step list + detail panel"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"TroubleshootWizardMobile"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"TroubleshootWizard/TroubleshootWizardMobile.tsx"})}),(0,i.jsx)(n.td,{children:"Mobile"}),(0,i.jsx)(n.td,{children:"Sequential step cards"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"TroubleshootWizardSkeleton"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"TroubleshootWizard/TroubleshootWizardSkeleton.tsx"})}),(0,i.jsx)(n.td,{children:"Both"}),(0,i.jsx)(n.td,{children:"Loading placeholder"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DiagnosticStep"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"TroubleshootWizard/DiagnosticStep.tsx"})}),(0,i.jsx)(n.td,{children:"Both"}),(0,i.jsx)(n.td,{children:"Single step status card"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"FixSuggestion"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"TroubleshootWizard/FixSuggestion.tsx"})}),(0,i.jsx)(n.td,{children:"Both"}),(0,i.jsx)(n.td,{children:"Fix card with actions"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"WizardSummary"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"TroubleshootWizard/WizardSummary.tsx"})}),(0,i.jsx)(n.td,{children:"Both"}),(0,i.jsx)(n.td,{children:"Completion report"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"StepAnnouncer"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"TroubleshootWizard/StepAnnouncer.tsx"})}),(0,i.jsx)(n.td,{children:"Both"}),(0,i.jsx)(n.td,{children:"WCAG aria-live region"})]})]})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"device-scan-tool",children:"Device Scan Tool"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Files:"})," ",(0,i.jsx)(n.code,{children:"components/DeviceScan/"})]}),"\n",(0,i.jsx)(n.p,{children:"The Device Scan tool discovers all active hosts on the local network by querying the router's ARP\ntable and optionally running an active port scan. Results are displayed with hostname resolution,\nMAC vendor lookup (via OUI database), and open port detection."}),"\n",(0,i.jsx)(n.h3,{id:"architecture",children:"Architecture"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// Headless hook drives both presenters\nconst { devices, isScanning, startScan, stopScan, progress } = useDeviceScan({\n  routerId,\n  scanRange: '192.168.1.0/24',\n});\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"useDeviceScan"})," manages the GraphQL query for ARP entries, optionally triggers port scan mutations,\nand tracks scan progress. Both ",(0,i.jsx)(n.code,{children:"DeviceScanDesktop"})," and ",(0,i.jsx)(n.code,{children:"DeviceScanMobile"})," receive the same hook\nreturn value."]}),"\n",(0,i.jsx)(n.h3,{id:"desktop-presenter",children:"Desktop Presenter"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"DeviceScanDesktop"})," renders a full ",(0,i.jsx)(n.code,{children:"DeviceDiscoveryTable"})," with:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Sortable columns: IP, hostname, MAC address, vendor, open ports, last seen"}),"\n",(0,i.jsxs)(n.li,{children:["Row click opens ",(0,i.jsx)(n.code,{children:"DeviceDetailPanel"})," as a slide-over sheet"]}),"\n",(0,i.jsx)(n.li,{children:"Toolbar with scan controls and filter input"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"mobile-presenter",children:"Mobile Presenter"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"DeviceScanMobile"})," renders devices as touch-friendly cards with:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"44px minimum touch targets (WCAG AAA)"}),"\n",(0,i.jsx)(n.li,{children:"Swipe-to-reveal actions"}),"\n",(0,i.jsxs)(n.li,{children:["Tap opens ",(0,i.jsx)(n.code,{children:"DeviceDetailPanel"})," as a bottom drawer"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"devicedetailpanel",children:"DeviceDetailPanel"}),"\n",(0,i.jsx)(n.p,{children:"Full device context in a slide-over panel:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"IP address, MAC address, hostname resolution"}),"\n",(0,i.jsx)(n.li,{children:"Open port list with service name guesses"}),"\n",(0,i.jsx)(n.li,{children:"ARP entry age and router interface"}),"\n",(0,i.jsx)(n.li,{children:"Action buttons: ping this device, traceroute to device"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"scansummary",children:"ScanSummary"}),"\n",(0,i.jsx)(n.p,{children:"Status header rendered at the top of both presenters:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"interface ScanSummaryProps {\n  totalDevices: number;\n  onlineDevices: number;\n  scanDuration: number | null;\n  isScanning: boolean;\n  lastScanTime: Date | null;\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"storybook-stories",children:"Storybook Stories"}),"\n",(0,i.jsxs)(n.p,{children:["Stories defined in ",(0,i.jsx)(n.code,{children:"DeviceScan.stories.tsx"}),", ",(0,i.jsx)(n.code,{children:"DeviceDetailPanel.stories.tsx"}),", and\n",(0,i.jsx)(n.code,{children:"ScanSummary.stories.tsx"}),". Run with:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"npx nx run diagnostics:storybook\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"dns-lookup-tool",children:"DNS Lookup Tool"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Files:"})," ",(0,i.jsx)(n.code,{children:"components/DnsLookupTool/"})]}),"\n",(0,i.jsx)(n.p,{children:"The DNS Lookup Tool queries the router's DNS resolver for a given hostname and record type. It\nsupports multi-server comparison (querying multiple DNS servers simultaneously) and displays\nstructured record results."}),"\n",(0,i.jsx)(n.h3,{id:"zod-schema",children:"Zod Schema"}),"\n",(0,i.jsxs)(n.p,{children:["Defined in ",(0,i.jsx)(n.code,{children:"dnsLookup.schema.ts"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"export const dnsLookupFormSchema = z.object({\n  // RFC 1123 hostname OR IPv4/IPv6 address\n  hostname: z\n    .string()\n    .min(1)\n    .max(253)\n    .refine(isValidHostname || isValidIPv4 || isValidIPv6),\n\n  // A, AAAA, MX, TXT, CNAME, NS, SOA, PTR, SRV, CAA\n  recordType: z.enum(DNS_RECORD_TYPES).default('A'),\n\n  // IPv4 or IPv6 DNS server address, or \"all\" for comparison mode\n  server: z\n    .string()\n    .optional()\n    .refine((val) => !val || val === 'all' || isValidIPv4(val) || isValidIPv6(val)),\n\n  // Query timeout: 100\u201330000ms (default 2000ms)\n  timeout: z.coerce.number().int().min(100).max(30000).default(2000),\n});\n\nexport type DnsLookupFormValues = z.infer<typeof dnsLookupFormSchema>;\n"})}),"\n",(0,i.jsx)(n.p,{children:"Hostname validation enforces RFC 1123 rules:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Max 253 total characters"}),"\n",(0,i.jsx)(n.li,{children:"Each label (part between dots) max 63 characters"}),"\n",(0,i.jsx)(n.li,{children:"Labels contain alphanumeric and hyphens only"}),"\n",(0,i.jsx)(n.li,{children:"Labels cannot start or end with hyphen"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"platform-presenters",children:"Platform Presenters"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsxs)(n.strong,{children:["Desktop (",(0,i.jsx)(n.code,{children:"DnsLookupToolDesktop"}),"):"]})," Two-column layout. Form on the left; results panel on the\nright. When ",(0,i.jsx)(n.code,{children:'server = "all"'})," is selected, ",(0,i.jsx)(n.code,{children:"DnsServerComparison"})," replaces the standard ",(0,i.jsx)(n.code,{children:"DnsResults"}),"\nview."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsxs)(n.strong,{children:["Mobile (",(0,i.jsx)(n.code,{children:"DnsLookupToolMobile"}),"):"]})," Single-column stacked layout. Form at top, results below.\nCollapsible advanced options panel for server and timeout fields."]}),"\n",(0,i.jsx)(n.h3,{id:"dnsresults-component",children:"DnsResults Component"}),"\n",(0,i.jsx)(n.p,{children:"Renders DNS answer records in a structured table:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Record type badge (color-coded per type: A=blue, MX=purple, TXT=gray, etc.)"}),"\n",(0,i.jsx)(n.li,{children:"TTL display with human-readable format"}),"\n",(0,i.jsx)(n.li,{children:"Raw value with copy-to-clipboard action"}),"\n",(0,i.jsx)(n.li,{children:"DNSSEC validation indicator when available"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"dnserror-component",children:"DnsError Component"}),"\n",(0,i.jsx)(n.p,{children:"Shown when the query fails with actionable guidance:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:'NXDOMAIN: "Domain does not exist. Check spelling or try another record type."'}),"\n",(0,i.jsx)(n.li,{children:'TIMEOUT: "DNS server did not respond. Try a different server or check connectivity."'}),"\n",(0,i.jsx)(n.li,{children:'REFUSED: "DNS server refused the query. The server may not allow external queries."'}),"\n",(0,i.jsx)(n.li,{children:'SERVFAIL: "DNS server internal error. Try an alternative DNS server."'}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"dnsservercomparison-component",children:"DnsServerComparison Component"}),"\n",(0,i.jsxs)(n.p,{children:["When ",(0,i.jsx)(n.code,{children:'server = "all"'}),", compares results from all router-configured DNS servers side by side:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"interface DnsServerComparisonProps {\n  hostname: string;\n  recordType: DnsRecordType;\n  servers: string[]; // All configured DNS servers\n  results: DnsComparisonResult[];\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"Renders a table with one column per server showing response time, resolved IPs, and whether\nresponses agree."}),"\n",(0,i.jsx)(n.h3,{id:"usednslookup-hook",children:"useDnsLookup Hook"}),"\n",(0,i.jsx)(n.p,{children:"Headless hook wrapping the GraphQL query:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'const {\n  query, // Function to run a lookup\n  results, // Latest results array\n  isLoading,\n  error,\n  history, // Recent queries (stored in sessionStorage)\n  clearHistory,\n  comparisonMode, // true when server === "all"\n} = useDnsLookup();\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"ping-tool",children:"Ping Tool"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Files:"})," ",(0,i.jsx)(n.code,{children:"components/PingTool/"})]}),"\n",(0,i.jsx)(n.p,{children:"The Ping Tool sends ICMP echo requests through the router and streams results in real time via a\nGraphQL subscription. Results are accumulated into a live latency graph and aggregate statistics\npanel."}),"\n",(0,i.jsx)(n.h3,{id:"zod-schema-1",children:"Zod Schema"}),"\n",(0,i.jsxs)(n.p,{children:["Defined in ",(0,i.jsx)(n.code,{children:"ping.schema.ts"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"export const pingFormSchema = z.object({\n  target: z.string().min(1).refine(isValidTarget), // IPv4, IPv6, or hostname\n  count: z.number().int().min(1).max(100).default(10),\n  size: z.number().int().min(1).max(65507).default(56), // Packet size in bytes\n  interval: z.number().min(0.1).max(10).default(1), // Seconds between pings\n});\n"})}),"\n",(0,i.jsx)(n.h3,{id:"platform-presenters-1",children:"Platform Presenters"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsxs)(n.strong,{children:["Desktop (",(0,i.jsx)(n.code,{children:"PingToolDesktop"}),"):"]})," Two-panel layout. ",(0,i.jsx)(n.code,{children:"LatencyGraph"})," occupies the left panel at 300px\nheight with full controls. ",(0,i.jsx)(n.code,{children:"PingStatistics"})," and ",(0,i.jsx)(n.code,{children:"PingResults"})," are in a scrollable right panel."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsxs)(n.strong,{children:["Mobile (",(0,i.jsx)(n.code,{children:"PingToolMobile"}),"):"]})," Single-column. Compact ",(0,i.jsx)(n.code,{children:"LatencyGraph"})," at 200px height. Statistics\nfolded into a collapsible summary. ",(0,i.jsx)(n.code,{children:"PingResults"}),' hidden by default behind a "Show packets" toggle.']}),"\n",(0,i.jsx)(n.h3,{id:"latencygraph-component",children:"LatencyGraph Component"}),"\n",(0,i.jsxs)(n.p,{children:["Recharts ",(0,i.jsx)(n.code,{children:"LineChart"})," showing RTT over packet index:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Real-time updates as packets arrive (no page refresh)"}),"\n",(0,i.jsxs)(n.li,{children:["Color-coded by latency: green (",(0,i.jsx)(n.code,{children:"<50ms"}),"), amber (50\u2013200ms), red (",(0,i.jsx)(n.code,{children:">200ms"}),")"]}),"\n",(0,i.jsx)(n.li,{children:"Timeout packets plotted as gaps in the line"}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:'role="img"'})," with accessible ",(0,i.jsx)(n.code,{children:"aria-label"})," describing current min/avg/max"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"prefers-reduced-motion"}),": disables line animation"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"interface LatencyGraphProps {\n  results: PingResult[];\n  height?: number; // Default: 200 (mobile), 300 (desktop)\n  showGrid?: boolean;\n  animationsEnabled?: boolean;\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"pingstatistics-component",children:"PingStatistics Component"}),"\n",(0,i.jsx)(n.p,{children:"Aggregate statistics panel calculated from all results received so far:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"interface PingStatistics {\n  sent: number;\n  received: number;\n  lost: number;\n  lossPercent: number;\n  minRtt: number | null; // null until first result\n  avgRtt: number | null;\n  maxRtt: number | null;\n  stdDev: number | null;\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Statistics are calculated in ",(0,i.jsx)(n.code,{children:"ping.utils.ts"})," using the ",(0,i.jsx)(n.code,{children:"calculateStatistics"})," function and updated\nafter each packet arrives via the XState machine's ",(0,i.jsx)(n.code,{children:"updateStatistics"})," action."]}),"\n",(0,i.jsx)(n.h3,{id:"pingresults-component",children:"PingResults Component"}),"\n",(0,i.jsx)(n.p,{children:"Per-packet result list:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Sequence number, TTL, RTT, and status (reply/timeout)"}),"\n",(0,i.jsx)(n.li,{children:"Color indicator: green (reply received), red (timeout)"}),"\n",(0,i.jsx)(n.li,{children:"Auto-scrolls to latest entry while running"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"useping-hook",children:"usePing Hook"}),"\n",(0,i.jsxs)(n.p,{children:["Thin wrapper over ",(0,i.jsx)(n.code,{children:"pingMachine"})," actor:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const {\n  state, // XState state: 'idle' | 'running' | 'stopped' | 'complete' | 'error'\n  send, // Send events to the machine\n  results, // context.results\n  statistics, // context.statistics\n  error, // context.error\n  start, // Convenience: sends START event\n  stop, // Convenience: sends STOP event\n} = usePing({ routerId });\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"traceroute-tool",children:"Traceroute Tool"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Files:"})," ",(0,i.jsx)(n.code,{children:"components/TracerouteTool/"})]}),"\n",(0,i.jsx)(n.p,{children:"The Traceroute Tool probes each hop along the route to a target host, displaying RTT for multiple\nprobes per hop. Results stream in progressively as hops are discovered via a GraphQL subscription."}),"\n",(0,i.jsx)(n.h3,{id:"zod-schema-2",children:"Zod Schema"}),"\n",(0,i.jsxs)(n.p,{children:["Defined in ",(0,i.jsx)(n.code,{children:"traceroute.schema.ts"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"export const tracerouteFormSchema = z.object({\n  // IPv4, IPv6, or hostname (validated by regex)\n  target: z.string().min(1).max(255).refine(isValidTarget),\n\n  // 1\u201364 hops, default 30\n  maxHops: z.number().int().min(1).max(64).optional().default(30),\n\n  // 100\u201330000ms per hop, default 3000\n  timeout: z.number().int().min(100).max(30000).optional().default(3000),\n\n  // 1\u20135 probes per hop, default 3\n  probeCount: z.number().int().min(1).max(5).optional().default(3),\n\n  // ICMP | UDP | TCP\n  protocol: TracerouteProtocolEnum.optional().default('ICMP'),\n});\n\nexport type TracerouteFormValues = z.infer<typeof tracerouteFormSchema>;\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"TracerouteProtocolEnum"})," is ",(0,i.jsx)(n.code,{children:"z.enum(['ICMP', 'UDP', 'TCP'])"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"platform-presenters-2",children:"Platform Presenters"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsxs)(n.strong,{children:["Desktop (",(0,i.jsx)(n.code,{children:"TracerouteToolDesktop"}),"):"]})," Two-panel layout. Hop list on the left streams in as probes\ncomplete. A mini RTT bar chart on the right shows comparative hop latencies. Asterisks (",(0,i.jsx)(n.code,{children:"*"}),")\ndisplayed for unresponsive hops (ICMP filtered)."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsxs)(n.strong,{children:["Mobile (",(0,i.jsx)(n.code,{children:"TracerouteToolMobile"}),"):"]})," Single-column card list. Each hop is a compact card showing hop\nnumber, IP address, hostname, and RTT. Streaming updates append new cards."]}),"\n",(0,i.jsx)(n.h3,{id:"traceroutehopslist-component",children:"TracerouteHopsList Component"}),"\n",(0,i.jsx)(n.p,{children:"Core visualization component used by both presenters:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"interface TracerouteHopsListProps {\n  hops: TracerouteHop[];\n  isRunning: boolean;\n  targetReached: boolean;\n}\n\ninterface TracerouteHop {\n  hopNumber: number;\n  probes: HopProbe[]; // Up to 5 probe results per hop\n  hostname: string | null;\n  ipAddress: string | null;\n  isPrivate: boolean; // RFC-1918 address indicator\n  ispName: string | null;\n}\n\ninterface HopProbe {\n  rtt: number | null; // null = timeout (*)\n  ipAddress: string | null;\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"usetraceroute-hook",children:"useTraceroute Hook"}),"\n",(0,i.jsxs)(n.p,{children:["Defined in ",(0,i.jsx)(n.code,{children:"hooks/useTraceroute.ts"}),". Manages the GraphQL mutation to start the traceroute and\nsubscribes to the progress subscription:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const {\n  hops,\n  isRunning,\n  targetReached,\n  error,\n  start, // (values: TracerouteFormValues) => void\n  cancel, // () => void\n} = useTraceroute({ routerId });\n"})}),"\n",(0,i.jsxs)(n.p,{children:["GraphQL documents are in ",(0,i.jsx)(n.code,{children:"graphql/traceroute.graphql.ts"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"RUN_TRACEROUTE"})," mutation: starts the job, returns job ID"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"CANCEL_TRACEROUTE"})," mutation"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"TRACEROUTE_PROGRESS_SUBSCRIPTION"}),": streams ",(0,i.jsx)(n.code,{children:"TracerouteHop"})," as each hop completes"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"troubleshoot-wizard",children:"Troubleshoot Wizard"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Files:"})," ",(0,i.jsx)(n.code,{children:"components/TroubleshootWizard/"}),", ",(0,i.jsx)(n.code,{children:"machines/troubleshoot-machine.ts"})]}),"\n",(0,i.jsxs)(n.p,{children:["The Troubleshoot Wizard is the most complex diagnostic tool. It runs five sequential diagnostic\nsteps, detects failures, offers automated fixes from the Fix Registry, verifies that fixes worked,\nand produces a final summary. State is managed by the XState ",(0,i.jsx)(n.code,{children:"troubleshootMachine"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"diagnostic-steps",children:"Diagnostic Steps"}),"\n",(0,i.jsx)(n.p,{children:"The wizard runs these five steps in order:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Step ID"}),(0,i.jsx)(n.th,{children:"Name"}),(0,i.jsx)(n.th,{children:"What it checks"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"wan"})}),(0,i.jsx)(n.td,{children:"WAN Interface"}),(0,i.jsx)(n.td,{children:"Physical link state and interface enabled status"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"gateway"})}),(0,i.jsx)(n.td,{children:"Gateway"}),(0,i.jsx)(n.td,{children:"ICMP ping to default gateway"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"internet"})}),(0,i.jsx)(n.td,{children:"Internet"}),(0,i.jsxs)(n.td,{children:["ICMP ping to ",(0,i.jsx)(n.code,{children:"8.8.8.8"})," (or configurable external host)"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"dns"})}),(0,i.jsx)(n.td,{children:"DNS"}),(0,i.jsx)(n.td,{children:"DNS resolution test for a known hostname"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"nat"})}),(0,i.jsx)(n.td,{children:"NAT"}),(0,i.jsx)(n.td,{children:"Presence and enabled status of masquerade rule"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"xstate-machine",children:"XState Machine"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"File:"})," ",(0,i.jsx)(n.code,{children:"machines/troubleshoot-machine.ts"})]}),"\n",(0,i.jsxs)(n.p,{children:["Created via ",(0,i.jsx)(n.code,{children:"createTroubleshootMachine(routerId: string)"})," factory function. The machine is\nrouter-instance-specific so multiple wizard instances can run concurrently."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"State hierarchy:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"idle\n  \u2193 START\ninitializing  (detects WAN interface and gateway via router API)\n  \u2193 (success or fallback to defaults)\nrunningDiagnostic  [compound state]\n  \u251c\u2500\u2500 executingStep       \u2192 invokes diagnosticExecutor service\n  \u2502     \u2193 onDone\n  \u251c\u2500\u2500 stepComplete        \u2192 always-transition to branch:\n  \u2502     \u251c\u2500\u2500 \u2192 awaitingFixDecision  (if step failed AND fix available)\n  \u2502     \u251c\u2500\u2500 \u2192 nextStep             (if more steps remain)\n  \u2502     \u2514\u2500\u2500 \u2192 #troubleshootWizard.completed (if last step)\n  \u2502\n  \u251c\u2500\u2500 awaitingFixDecision \u2192 APPLY_FIX \u2192 applyingFix\n  \u2502                       \u2192 SKIP_FIX  \u2192 nextStep\n  \u2502\n  \u251c\u2500\u2500 applyingFix         \u2192 invokes fixApplicator service\n  \u2502     \u2193 onDone\n  \u2514\u2500\u2500 verifyingFix        \u2192 invokes diagnosticExecutor again\n        \u251c\u2500\u2500 onDone (success=true)  \u2192 nextStep\n        \u2514\u2500\u2500 onDone (success=false) \u2192 awaitingFixDecision (with \"Fix applied, but issue persists\" message)\n\ncompleted  (entry: records endTime, sets overallStatus='completed')\n  \u2193 RESTART \u2192 idle\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Global event:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"on: {\n  CANCEL: { target: '.idle', actions: assign({ overallStatus: 'idle' }) }\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Context:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"interface TroubleshootContext {\n  routerId: string;\n  wanInterface: string; // Detected or fallback 'ether1'\n  gateway: string | null;\n  steps: DiagnosticStep[];\n  currentStepIndex: number;\n  overallStatus: 'idle' | 'running' | 'completed' | 'fixPending';\n  appliedFixes: string[]; // Issue codes of successfully applied fixes\n  startTime: Date | null;\n  endTime: Date | null;\n  error: Error | null;\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Events:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"type TroubleshootEvent =\n  | { type: 'START' }\n  | { type: 'STEP_COMPLETE'; result: DiagnosticResult }\n  | { type: 'APPLY_FIX'; fixId: string }\n  | { type: 'FIX_APPLIED'; success: boolean }\n  | { type: 'SKIP_FIX' }\n  | { type: 'RESTART' }\n  | { type: 'CANCEL' };\n"})}),"\n",(0,i.jsxs)(n.p,{children:["For full XState machine integration details, see ",(0,i.jsx)(n.a,{href:"/docs/features/xstate-machines",children:"xstate-machines.md"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"fix-registry",children:"Fix Registry"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"File:"})," ",(0,i.jsx)(n.code,{children:"constants/fix-registry.ts"})]}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"FIX_REGISTRY"})," maps issue codes to ",(0,i.jsx)(n.code,{children:"FixSuggestion"})," objects. The ",(0,i.jsx)(n.code,{children:"getFix(stepId, result)"}),"\nfunction looks up the fix by ",(0,i.jsx)(n.code,{children:"result.issueCode"}),"."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Registered fixes:"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Issue Code"}),(0,i.jsx)(n.th,{children:"Fix Title"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Confidence"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"WAN_LINK_DOWN"})}),(0,i.jsx)(n.td,{children:"Check Physical Connection"}),(0,i.jsx)(n.td,{children:"Manual"}),(0,i.jsx)(n.td,{children:"\u2014"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"WAN_DISABLED"})}),(0,i.jsx)(n.td,{children:"Enable WAN Interface"}),(0,i.jsx)(n.td,{children:"Automated"}),(0,i.jsx)(n.td,{children:"High"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"GATEWAY_UNREACHABLE"})}),(0,i.jsx)(n.td,{children:"Renew Internet Connection"}),(0,i.jsx)(n.td,{children:"Automated"}),(0,i.jsx)(n.td,{children:"High"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"GATEWAY_TIMEOUT"})}),(0,i.jsx)(n.td,{children:"Restart Network Connection"}),(0,i.jsx)(n.td,{children:"Automated"}),(0,i.jsx)(n.td,{children:"Medium"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"NO_INTERNET"})}),(0,i.jsx)(n.td,{children:"Contact Your Internet Provider"}),(0,i.jsx)(n.td,{children:"Manual"}),(0,i.jsx)(n.td,{children:"\u2014"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"INTERNET_TIMEOUT"})}),(0,i.jsx)(n.td,{children:"Check for Network Congestion"}),(0,i.jsx)(n.td,{children:"Manual"}),(0,i.jsx)(n.td,{children:"\u2014"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DNS_FAILED"})}),(0,i.jsx)(n.td,{children:"Switch to Cloudflare DNS"}),(0,i.jsx)(n.td,{children:"Automated"}),(0,i.jsx)(n.td,{children:"High"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DNS_TIMEOUT"})}),(0,i.jsx)(n.td,{children:"Add Backup DNS Server"}),(0,i.jsx)(n.td,{children:"Automated"}),(0,i.jsx)(n.td,{children:"Medium"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"NAT_MISSING"})}),(0,i.jsx)(n.td,{children:"Add NAT Rule"}),(0,i.jsx)(n.td,{children:"Automated"}),(0,i.jsx)(n.td,{children:"High"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"NAT_DISABLED"})}),(0,i.jsx)(n.td,{children:"Enable NAT Rule"}),(0,i.jsx)(n.td,{children:"Automated"}),(0,i.jsx)(n.td,{children:"High"})]})]})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Automated fix example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"WAN_DISABLED: {\n  issueCode: 'WAN_DISABLED',\n  title: 'Enable WAN Interface',\n  description: 'Your WAN interface is disabled...',\n  command: '/interface/enable [find where default-name~\"ether1\" or comment~\"WAN\"]',\n  confidence: 'high',\n  requiresConfirmation: true,\n  rollbackCommand: '/interface/disable [find where default-name~\"ether1\" or comment~\"WAN\"]',\n  isManualFix: false,\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Manual fix example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"WAN_LINK_DOWN: {\n  issueCode: 'WAN_LINK_DOWN',\n  title: 'Check Physical Connection',\n  description: 'The cable to your internet provider appears disconnected.',\n  command: null,\n  confidence: null,\n  requiresConfirmation: false,\n  isManualFix: true,\n  manualSteps: [\n    'Check that the ethernet cable is securely plugged into the WAN port',\n    'Try a different ethernet cable if available',\n    'Check if the modem/ONT has power and link lights',\n    'Restart your modem/ONT by unplugging for 30 seconds',\n  ],\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["DNS fixes also support dynamic rollback capture via ",(0,i.jsx)(n.code,{children:"storeDnsConfigForRollback()"}),", which reads the\ncurrent DNS configuration before applying changes."]}),"\n",(0,i.jsx)(n.h3,{id:"wizard-components",children:"Wizard Components"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"DiagnosticStep:"})," Renders a single step card with status icon (clock/spinner/check/X), step name,\ndescription, and optionally the result message. Uses semantic color tokens: ",(0,i.jsx)(n.code,{children:"stroke-success"}),"\n(passed), ",(0,i.jsx)(n.code,{children:"stroke-error"})," (failed), ",(0,i.jsx)(n.code,{children:"stroke-warning"})," (running)."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"FixSuggestion:"})," Shown when ",(0,i.jsx)(n.code,{children:"awaitingFixDecision"})," state is active. Displays:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Fix title and description"}),"\n",(0,i.jsx)(n.li,{children:"Confidence badge: High / Medium / Low"}),"\n",(0,i.jsxs)(n.li,{children:["RouterOS command preview (if ",(0,i.jsx)(n.code,{children:"isManualFix = false"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:["Manual steps list (if ",(0,i.jsx)(n.code,{children:"isManualFix = true"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:['"Apply Fix" button (triggers ',(0,i.jsx)(n.code,{children:"APPLY_FIX"})," event)"]}),"\n",(0,i.jsxs)(n.li,{children:['"Skip" button (triggers ',(0,i.jsx)(n.code,{children:"SKIP_FIX"})," event)"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"WizardSummary:"})," Shown in ",(0,i.jsx)(n.code,{children:"completed"})," state. Displays:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Pass/fail/skip counts"}),"\n",(0,i.jsx)(n.li,{children:"List of fixes applied during this session"}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"finalStatus"}),": ",(0,i.jsx)(n.code,{children:"all_passed"})," | ",(0,i.jsx)(n.code,{children:"issues_resolved"})," | ",(0,i.jsx)(n.code,{children:"issues_remaining"})," | ",(0,i.jsx)(n.code,{children:"contact_isp"})]}),"\n",(0,i.jsxs)(n.li,{children:['"Run Again" button (triggers ',(0,i.jsx)(n.code,{children:"RESTART"})," event)"]}),"\n",(0,i.jsx)(n.li,{children:"Session duration"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"StepAnnouncer:"})," Hidden ",(0,i.jsx)(n.code,{children:'aria-live="polite"'})," region that announces state transitions to screen\nreaders. When a step transitions to ",(0,i.jsx)(n.code,{children:"running"}),', announces "Running [step name] diagnostic". When ',(0,i.jsx)(n.code,{children:"passed"}),',\nannounces "Passed: [result message]". When ',(0,i.jsx)(n.code,{children:"failed"}),', announces "Failed: [result message]. Fix available."']}),"\n",(0,i.jsx)(n.h3,{id:"platform-presenters-3",children:"Platform Presenters"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsxs)(n.strong,{children:["Desktop (",(0,i.jsx)(n.code,{children:"TroubleshootWizardDesktop"}),"):"]})," Two-panel layout."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Left panel: vertical step list with all five ",(0,i.jsx)(n.code,{children:"DiagnosticStep"})," components visible simultaneously.\nCompleted steps remain visible above the active step."]}),"\n",(0,i.jsxs)(n.li,{children:["Right panel: active ",(0,i.jsx)(n.code,{children:"FixSuggestion"})," or ",(0,i.jsx)(n.code,{children:"WizardSummary"})," occupies the full right panel."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsxs)(n.strong,{children:["Mobile (",(0,i.jsx)(n.code,{children:"TroubleshootWizardMobile"}),"):"]})," Single-column card-by-card flow."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Only the current active step and its fix (if any) are visible."}),"\n",(0,i.jsx)(n.li,{children:"Previous completed steps shown as a compact progress indicator at the top."}),"\n",(0,i.jsxs)(n.li,{children:["Bottom sheet for ",(0,i.jsx)(n.code,{children:"FixSuggestion"})," with 44px touch targets on all action buttons."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"usetroubleshootwizard-hook",children:"useTroubleshootWizard Hook"}),"\n",(0,i.jsxs)(n.p,{children:["Defined in ",(0,i.jsx)(n.code,{children:"hooks/useTroubleshootWizard.ts"}),". Creates and manages the XState actor:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const {\n  state, // XState state value\n  context, // TroubleshootContext\n  steps, // context.steps shorthand\n  currentStep, // steps[context.currentStepIndex]\n  isRunning, // state matches 'runningDiagnostic'\n  isCompleted, // state matches 'completed'\n  summary, // DiagnosticSummary (when completed)\n  start, // () => void\n  applyFix, // () => void\n  skipFix, // () => void\n  cancel, // () => void\n  restart, // () => void\n} = useTroubleshootWizard({ routerId });\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h2,{id:"ping-machine-machinesping-machinets",children:["Ping Machine (",(0,i.jsx)(n.code,{children:"machines/ping-machine.ts"}),")"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"File:"})," ",(0,i.jsx)(n.code,{children:"machines/ping-machine.ts"})]}),"\n",(0,i.jsxs)(n.p,{children:["The ping machine manages the lifecycle of a single ping test session. Created using\n",(0,i.jsx)(n.code,{children:"setup({...}).createMachine({...})"})," (XState v5 typed setup pattern)."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"States:"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"State"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"idle"})}),(0,i.jsxs)(n.td,{children:["Ready to start. Waiting for ",(0,i.jsx)(n.code,{children:"START"})," event."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"running"})}),(0,i.jsxs)(n.td,{children:["Test in progress. Accumulates results and statistics on ",(0,i.jsx)(n.code,{children:"RESULT_RECEIVED"}),". Auto-transitions to ",(0,i.jsx)(n.code,{children:"complete"})," when ",(0,i.jsx)(n.code,{children:"isComplete"})," guard passes."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"stopped"})}),(0,i.jsx)(n.td,{children:"User manually stopped. Results and statistics preserved."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"complete"})}),(0,i.jsx)(n.td,{children:"All expected packets sent. Final statistics available."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"error"})}),(0,i.jsxs)(n.td,{children:["Test failed. ",(0,i.jsx)(n.code,{children:"context.error"})," contains error message."]})]})]})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Context:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"interface PingContext {\n  target: string; // Host or IP being pinged\n  count: number; // Total packets expected\n  jobId: string | null; // Backend job ID for cancellation\n  results: PingResult[]; // Accumulated per-packet results\n  statistics: PingStatistics; // Running aggregate stats\n  error: string | null;\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Key design:"})," The ",(0,i.jsx)(n.code,{children:"isComplete"})," guard checks ",(0,i.jsx)(n.code,{children:"context.results.length + 1 >= context.count"})," BEFORE\nthe ",(0,i.jsx)(n.code,{children:"addResult"})," action runs. This is evaluated on the ",(0,i.jsx)(n.code,{children:"RESULT_RECEIVED"})," event to automatically\ntransition to ",(0,i.jsx)(n.code,{children:"complete"})," when the final packet arrives:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"RESULT_RECEIVED: [\n  {\n    guard: 'isComplete',           // Evaluates before actions\n    target: 'complete',\n    actions: ['addResult', 'updateStatistics'],\n  },\n  {\n    actions: ['addResult', 'updateStatistics'],  // Stay in running\n  },\n],\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Statistics recalculation (",(0,i.jsx)(n.code,{children:"updateStatistics"}),") uses ",(0,i.jsx)(n.code,{children:"calculateStatistics(context.results)"})," from\n",(0,i.jsx)(n.code,{children:"ping.utils.ts"})," after each ",(0,i.jsx)(n.code,{children:"addResult"}),". Results and statistics are preserved when transitioning to\n",(0,i.jsx)(n.code,{children:"stopped"})," (user can view final stats after manually stopping)."]}),"\n",(0,i.jsxs)(n.p,{children:["For XState v5 setup pattern details, see ",(0,i.jsx)(n.a,{href:"/docs/features/xstate-machines",children:"xstate-machines.md"}),"."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"services",children:"Services"}),"\n",(0,i.jsxs)(n.h3,{id:"diagnostic-executor-servicesdiagnostic-executorts",children:["diagnostic-executor (",(0,i.jsx)(n.code,{children:"services/diagnostic-executor.ts"}),")"]}),"\n",(0,i.jsxs)(n.p,{children:["Executes individual diagnostic steps by invoking appropriate GraphQL mutations or router queries.\nInvoked by the ",(0,i.jsx)(n.code,{children:"troubleshootMachine"})," as the ",(0,i.jsx)(n.code,{children:"executeDiagnosticStep"})," actor service."]}),"\n",(0,i.jsx)(n.p,{children:"Each step maps to a specific diagnostic operation:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"wan"}),": Query interface list, check if WAN interface is enabled and has link"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"gateway"}),": Run ping to ",(0,i.jsx)(n.code,{children:"context.gateway"})," via router API"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"internet"}),": Run ping to ",(0,i.jsx)(n.code,{children:"8.8.8.8"})," via router API"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"dns"}),": Run DNS lookup for known hostname (e.g., ",(0,i.jsx)(n.code,{children:"google.com"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"nat"}),": Query firewall NAT rules for masquerade entry"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Returns ",(0,i.jsx)(n.code,{children:"DiagnosticResult"})," with ",(0,i.jsx)(n.code,{children:"success"}),", ",(0,i.jsx)(n.code,{children:"message"}),", optional ",(0,i.jsx)(n.code,{children:"issueCode"}),", and ",(0,i.jsx)(n.code,{children:"executionTimeMs"}),"."]}),"\n",(0,i.jsxs)(n.h3,{id:"fix-applicator-servicesfix-applicatorts",children:["fix-applicator (",(0,i.jsx)(n.code,{children:"services/fix-applicator.ts"}),")"]}),"\n",(0,i.jsxs)(n.p,{children:["Executes RouterOS commands for automated fixes. Invoked by the ",(0,i.jsx)(n.code,{children:"troubleshootMachine"})," as the\n",(0,i.jsx)(n.code,{children:"applyFix"})," actor service. For DNS fixes, calls ",(0,i.jsx)(n.code,{children:"storeDnsConfigForRollback()"})," before applying to\nenable rollback."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"utilities",children:"Utilities"}),"\n",(0,i.jsxs)(n.h3,{id:"network-detection-utilsnetwork-detectionts",children:["network-detection (",(0,i.jsx)(n.code,{children:"utils/network-detection.ts"}),")"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"detectWanInterface(routerId)"}),": Queries router interfaces to find the WAN interface by convention\n(first Ethernet with a public IP, or interface named ",(0,i.jsx)(n.code,{children:"ether1"}),' or tagged with comment containing\n"WAN")']}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"detectGateway(routerId)"}),": Reads the default route (",(0,i.jsx)(n.code,{children:"0.0.0.0/0"}),") gateway IP"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Used by ",(0,i.jsx)(n.code,{children:"troubleshootMachine"}),"'s ",(0,i.jsx)(n.code,{children:"initializing"})," state to populate ",(0,i.jsx)(n.code,{children:"wanInterface"})," and ",(0,i.jsx)(n.code,{children:"gateway"})," before\nrunning diagnostics."]}),"\n",(0,i.jsxs)(n.h3,{id:"isp-detection-utilsisp-detectionts",children:["isp-detection (",(0,i.jsx)(n.code,{children:"utils/isp-detection.ts"}),")"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"getWanIpForISPDetection(routerId)"}),": Reads the public IP from the WAN interface"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"detectISP(publicIp)"}),": Performs a reverse RDAP lookup to identify the ISP name and support contact\ninformation"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Returns ",(0,i.jsx)(n.code,{children:"ISPInfo"})," with ",(0,i.jsx)(n.code,{children:"name"}),", ",(0,i.jsx)(n.code,{children:"supportPhone"}),", ",(0,i.jsx)(n.code,{children:"supportUrl"}),", and ",(0,i.jsx)(n.code,{children:"detected"})," flag."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"testing",children:"Testing"}),"\n",(0,i.jsx)(n.p,{children:"All tools have unit tests for hooks, schemas, and utilities. XState machines have dedicated machine\ntest files."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Run all diagnostics tests\nnpx nx test diagnostics\n\n# Specific test files\nnpx nx test diagnostics --testPathPattern=troubleshoot-machine\nnpx nx test diagnostics --testPathPattern=ping-machine\nnpx nx test diagnostics --testPathPattern=dnsLookup.schema\nnpx nx test diagnostics --testPathPattern=traceroute.schema\n"})}),"\n",(0,i.jsx)(n.p,{children:"Test files follow the co-location pattern:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"troubleshoot-machine.test.ts"})," - XState state transition tests"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ping-machine.test.ts"})," - XState state and guard tests"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"useDeviceScan.test.tsx"})," - Hook rendering tests"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"useDnsLookup.test.tsx"})," - Hook with mocked GraphQL"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"usePing.test.ts"})," - Hook with mocked actor"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"useTraceroute.test.tsx"})," - Hook with mocked subscription"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"PingStatistics.test.tsx"})," - Component rendering tests"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"dnsLookup.schema.test.ts"})," - Zod validation boundary tests"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"traceroute.schema.test.ts"})," - Zod validation boundary tests"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"fix-registry.test.ts"})," - Registry lookup tests"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"isp-detection.test.ts"})," - ISP detection logic tests"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"network-detection.test.ts"})," - WAN detection logic tests"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"storybook",children:"Storybook"}),"\n",(0,i.jsx)(n.p,{children:"Stories are available for all major components:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"npx nx run diagnostics:storybook\n"})}),"\n",(0,i.jsx)(n.p,{children:"Available story files:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"DeviceScan.stories.tsx"})," \u2014 DeviceScanTool in all states"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"DeviceDetailPanel.stories.tsx"})," \u2014 Detail panel variants"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ScanSummary.stories.tsx"})," \u2014 Scan status header states"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"DnsLookupTool.stories.tsx"})," \u2014 DNS tool states (loading, results, error)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"DnsError.stories.tsx"})," \u2014 All error variants"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"DnsResults.stories.tsx"})," \u2014 All record type displays"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"DnsServerComparison.stories.tsx"})," \u2014 Multi-server comparison"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"PingTool.stories.tsx"})," \u2014 Ping tool states"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"LatencyGraph.stories.tsx"})," \u2014 Graph with varied data"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"PingResults.stories.tsx"})," \u2014 Packet list states"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"PingStatistics.stories.tsx"})," \u2014 Statistics panel states"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"TracerouteTool.stories.tsx"})," \u2014 Traceroute states"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"TracerouteHopsList.stories.tsx"})," \u2014 Hop list with timeouts"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"TroubleshootWizard.stories.tsx"})," \u2014 Full wizard flow"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"DiagnosticStep.stories.tsx"})," \u2014 All step status variants"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"FixSuggestion.stories.tsx"})," \u2014 Automated and manual fix variants"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"WizardSummary.stories.tsx"})," \u2014 Summary completion states"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"StepAnnouncer.stories.tsx"})," \u2014 Accessibility region testing"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"cross-references",children:"Cross-References"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"XState Machines:"})," ",(0,i.jsx)(n.a,{href:"/docs/features/xstate-machines",children:"xstate-machines.md"})," \u2014 ",(0,i.jsx)(n.code,{children:"troubleshootMachine"})," and\n",(0,i.jsx)(n.code,{children:"pingMachine"})," full documentation"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Platform Presenters:"})," ",(0,i.jsx)(n.code,{children:"Docs/design/PLATFORM_PRESENTER_GUIDE.md"})," \u2014 Headless + Presenter\nimplementation pattern"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"GraphQL Schema:"})," ",(0,i.jsx)(n.code,{children:"schema/diagnostics/"})," \u2014 Ping, traceroute, DNS, and device scan schema files"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"API Client Hooks:"})," ",(0,i.jsx)(n.code,{children:"libs/api-client/queries/src/diagnostics/"})," \u2014 Generated GraphQL hooks"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Dashboard Integration:"})," ",(0,i.jsx)(n.a,{href:"/docs/features/feature-dashboard",children:"feature-dashboard.md"})," \u2014 Dashboard widget\nintegration"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},71184:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>c});var t=s(14041);const i={},r=t.createContext(i);function o(e){const n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);