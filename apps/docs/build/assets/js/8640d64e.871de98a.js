"use strict";(globalThis.webpackChunk_nas_net_docs=globalThis.webpackChunk_nas_net_docs||[]).push([[8534],{71184:(e,s,t)=>{t.d(s,{R:()=>i,x:()=>c});var n=t(14041);const r={},d=n.createContext(r);function i(e){const s=n.useContext(d);return n.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),n.createElement(d.Provider,{value:s},e.children)}},94829:(e,s,t)=>{t.r(s),t.d(s,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>i,metadata:()=>n,toc:()=>o});const n=JSON.parse('{"id":"state-management/zustand-stores","title":"Zustand Stores Inventory","description":"All stores live in libs/state/stores/src/. Import from @nasnet/state/stores.","source":"@site/../connect/docs/state-management/zustand-stores.md","sourceDirName":"state-management","slug":"/state-management/zustand-stores","permalink":"/docs/frontend/state-management/zustand-stores","draft":false,"unlisted":false,"editUrl":"https://github.com/nasnet-community/nasnet-panel/tree/main/../connect/docs/state-management/zustand-stores.md","tags":[],"version":"current","frontMatter":{},"sidebar":"sidebar","previous":{"title":"XState State Machines","permalink":"/docs/frontend/state-management/xstate-machines"},"next":{"title":"Component Testing","permalink":"/docs/frontend/testing/component-testing"}}');var r=t(31085),d=t(71184);const i={},c="Zustand Stores Inventory",l={},o=[{value:"Quick Reference",id:"quick-reference",level:2},{value:"Auth Store",id:"auth-store",level:2},{value:"State Shape",id:"state-shape",level:3},{value:"Key Actions",id:"key-actions",level:3},{value:"Token Refresh Flow",id:"token-refresh-flow",level:3},{value:"Persistence",id:"persistence",level:3},{value:"Usage",id:"usage",level:3},{value:"Connection Store",id:"connection-store",level:2},{value:"State Shape",id:"state-shape-1",level:3},{value:"Key Actions",id:"key-actions-1",level:3},{value:"Persistence",id:"persistence-1",level:3},{value:"Selectors",id:"selectors",level:3},{value:"Usage",id:"usage-1",level:3},{value:"Theme Store",id:"theme-store",level:2},{value:"State Shape",id:"state-shape-2",level:3},{value:"Key Actions",id:"key-actions-2",level:3},{value:"Initialization",id:"initialization",level:3},{value:"Persistence",id:"persistence-2",level:3},{value:"UI Preferences Store",id:"ui-preferences-store",level:2},{value:"State Shape",id:"state-shape-3",level:3},{value:"Key Actions",id:"key-actions-3",level:3},{value:"Persistence",id:"persistence-3",level:3},{value:"Modal Store",id:"modal-store",level:2},{value:"State Shape",id:"state-shape-4",level:3},{value:"Known Modal IDs",id:"known-modal-ids",level:3},{value:"Usage",id:"usage-2",level:3},{value:"Notification Store",id:"notification-store",level:2},{value:"State Shape",id:"state-shape-5",level:3},{value:"Default Durations",id:"default-durations",level:3},{value:"Deduplication",id:"deduplication",level:3},{value:"Convenience Functions",id:"convenience-functions",level:3},{value:"Change Set Store",id:"change-set-store",level:2},{value:"State Shape",id:"state-shape-6",level:3},{value:"Key Actions",id:"key-actions-4",level:3},{value:"Persistence",id:"persistence-4",level:3},{value:"Sidebar Store",id:"sidebar-store",level:2},{value:"History Store",id:"history-store",level:2},{value:"Command Registry and Shortcut Registry",id:"command-registry-and-shortcut-registry",level:2},{value:"Feature UI Stores",id:"feature-ui-stores",level:2},{value:"Outside React Usage",id:"outside-react-usage",level:2}];function a(e){const s={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.header,{children:(0,r.jsx)(s.h1,{id:"zustand-stores-inventory",children:"Zustand Stores Inventory"})}),"\n",(0,r.jsxs)(s.p,{children:["All stores live in ",(0,r.jsx)(s.code,{children:"libs/state/stores/src/"}),". Import from ",(0,r.jsx)(s.code,{children:"@nasnet/state/stores"}),"."]}),"\n",(0,r.jsxs)(s.p,{children:["Every store uses the ",(0,r.jsx)(s.code,{children:"devtools"})," middleware (Redux DevTools, development only). Persisted stores use the ",(0,r.jsx)(s.code,{children:"persist"})," middleware with a ",(0,r.jsx)(s.code,{children:"partialize"})," function that controls exactly which fields survive a page reload."]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"quick-reference",children:"Quick Reference"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Store"}),(0,r.jsx)(s.th,{children:"Hook"}),(0,r.jsx)(s.th,{children:"Category"}),(0,r.jsx)(s.th,{children:"Persisted Fields"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Auth"}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"useAuthStore"})}),(0,r.jsx)(s.td,{children:"Auth"}),(0,r.jsxs)(s.td,{children:[(0,r.jsx)(s.code,{children:"token"}),", ",(0,r.jsx)(s.code,{children:"tokenExpiry"}),", ",(0,r.jsx)(s.code,{children:"refreshToken"}),", ",(0,r.jsx)(s.code,{children:"user"}),", ",(0,r.jsx)(s.code,{children:"isAuthenticated"})]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Connection"}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"useConnectionStore"})}),(0,r.jsx)(s.td,{children:"Connection"}),(0,r.jsxs)(s.td,{children:[(0,r.jsx)(s.code,{children:"activeRouterId"})," only"]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Network"}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"useNetworkStore"})}),(0,r.jsx)(s.td,{children:"Connection"}),(0,r.jsx)(s.td,{children:"\u2014"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Router"}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"useRouterStore"})}),(0,r.jsx)(s.td,{children:"Router"}),(0,r.jsx)(s.td,{children:"\u2014"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Theme"}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"useThemeStore"})}),(0,r.jsx)(s.td,{children:"UI"}),(0,r.jsxs)(s.td,{children:[(0,r.jsx)(s.code,{children:"theme"})," (mode)"]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"UI Preferences"}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"useUIStore"})}),(0,r.jsx)(s.td,{children:"UI"}),(0,r.jsxs)(s.td,{children:[(0,r.jsx)(s.code,{children:"compactMode"}),", ",(0,r.jsx)(s.code,{children:"animationsEnabled"}),", ",(0,r.jsx)(s.code,{children:"defaultNotificationDuration"}),", ",(0,r.jsx)(s.code,{children:"hideHostnames"})]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Sidebar"}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"useSidebarStore"})}),(0,r.jsx)(s.td,{children:"UI"}),(0,r.jsxs)(s.td,{children:[(0,r.jsx)(s.code,{children:"isOpen"}),", ",(0,r.jsx)(s.code,{children:"isPinned"})]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Modal"}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"useModalStore"})}),(0,r.jsx)(s.td,{children:"UI"}),(0,r.jsx)(s.td,{children:"None (session-only)"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Notification"}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"useNotificationStore"})}),(0,r.jsx)(s.td,{children:"UI"}),(0,r.jsx)(s.td,{children:"None (session-only)"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Help Mode"}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"useHelpModeStore"})}),(0,r.jsx)(s.td,{children:"UI"}),(0,r.jsx)(s.td,{children:"\u2014"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Change Set"}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"useChangeSetStore"})}),(0,r.jsx)(s.td,{children:"Operations"}),(0,r.jsxs)(s.td,{children:["Draft/ready change sets, ",(0,r.jsx)(s.code,{children:"activeChangeSetId"})]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"History"}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"useHistoryStore"})}),(0,r.jsx)(s.td,{children:"Operations"}),(0,r.jsx)(s.td,{children:"\u2014"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Command Registry"}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"useCommandRegistryStore"})}),(0,r.jsx)(s.td,{children:"Command"}),(0,r.jsx)(s.td,{children:"\u2014"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Shortcut Registry"}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"useShortcutRegistryStore"})}),(0,r.jsx)(s.td,{children:"Command"}),(0,r.jsx)(s.td,{children:"\u2014"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"DHCP UI"}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"useDHCPUIStore"})}),(0,r.jsx)(s.td,{children:"Feature UI"}),(0,r.jsx)(s.td,{children:"\u2014"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Service UI"}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"useServiceUIStore"})}),(0,r.jsx)(s.td,{children:"Feature UI"}),(0,r.jsx)(s.td,{children:"\u2014"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Firewall Log UI"}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"useFirewallLogUIStore"})}),(0,r.jsx)(s.td,{children:"Feature UI"}),(0,r.jsx)(s.td,{children:"\u2014"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Mangle UI"}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"useMangleUIStore"})}),(0,r.jsx)(s.td,{children:"Feature UI"}),(0,r.jsx)(s.td,{children:"\u2014"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"NAT UI"}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"useNATUIStore"})}),(0,r.jsx)(s.td,{children:"Feature UI"}),(0,r.jsx)(s.td,{children:"\u2014"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Port Knock UI"}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"usePortKnockUIStore"})}),(0,r.jsx)(s.td,{children:"Feature UI"}),(0,r.jsx)(s.td,{children:"\u2014"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Rate Limiting UI"}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"useRateLimitingUIStore"})}),(0,r.jsx)(s.td,{children:"Feature UI"}),(0,r.jsx)(s.td,{children:"\u2014"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Raw UI"}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"useRawUIStore"})}),(0,r.jsx)(s.td,{children:"Feature UI"}),(0,r.jsx)(s.td,{children:"\u2014"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Alert Notification"}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"useAlertNotificationStore"})}),(0,r.jsx)(s.td,{children:"Alerts"}),(0,r.jsx)(s.td,{children:"\u2014"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Alert Rule Template UI"}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"useAlertRuleTemplateUIStore"})}),(0,r.jsx)(s.td,{children:"Alerts"}),(0,r.jsx)(s.td,{children:"\u2014"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Interface Stats"}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"useInterfaceStatsStore"})}),(0,r.jsx)(s.td,{children:"Network"}),(0,r.jsx)(s.td,{children:"\u2014"})]})]})]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"auth-store",children:"Auth Store"}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"File:"})," ",(0,r.jsx)(s.code,{children:"libs/state/stores/src/auth/auth.store.ts"})]}),"\n",(0,r.jsx)(s.p,{children:"Manages JWT tokens, user sessions, and token refresh state."}),"\n",(0,r.jsx)(s.h3,{id:"state-shape",children:"State Shape"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-ts",children:"interface AuthState {\n  token: string | null;\n  tokenExpiry: Date | null;\n  refreshToken: string | null;\n  user: User | null;         // { id, username, email, permissions[] }\n  isAuthenticated: boolean;\n  isRefreshing: boolean;\n  refreshAttempts: number;   // max 3 before re-auth required\n  lastActivity: Date | null;\n}\n"})}),"\n",(0,r.jsx)(s.h3,{id:"key-actions",children:"Key Actions"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Action"}),(0,r.jsx)(s.th,{children:"Description"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"setAuth(token, user, expiresAt, refreshToken?)"})}),(0,r.jsx)(s.td,{children:"Set auth state after successful login"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"clearAuth()"})}),(0,r.jsx)(s.td,{children:"Log out \u2014 clears all token and user state"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"setRefreshing(bool)"})}),(0,r.jsx)(s.td,{children:"Mark token refresh in progress"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"isTokenExpiringSoon()"})}),(0,r.jsxs)(s.td,{children:["Returns ",(0,r.jsx)(s.code,{children:"true"})," if token expires within 5 minutes"]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"shouldAttemptRefresh()"})}),(0,r.jsxs)(s.td,{children:["Returns ",(0,r.jsx)(s.code,{children:"true"})," if refresh should be tried"]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"getTimeUntilExpiry()"})}),(0,r.jsx)(s.td,{children:"Milliseconds until token expires"})]})]})]}),"\n",(0,r.jsx)(s.h3,{id:"token-refresh-flow",children:"Token Refresh Flow"}),"\n",(0,r.jsxs)(s.p,{children:["The ",(0,r.jsx)(s.code,{children:"useTokenRefresh"})," hook polls ",(0,r.jsx)(s.code,{children:"isTokenExpiringSoon()"})," every minute. When true and ",(0,r.jsx)(s.code,{children:"shouldAttemptRefresh()"})," returns true, it initiates a refresh. After 3 failures, it shows a session-expiring dialog."]}),"\n",(0,r.jsx)(s.h3,{id:"persistence",children:"Persistence"}),"\n",(0,r.jsxs)(s.p,{children:["Uses a custom ",(0,r.jsx)(s.code,{children:"authStorage"})," handler that properly deserializes ",(0,r.jsx)(s.code,{children:"Date"})," objects from ",(0,r.jsx)(s.code,{children:"localStorage"})," on hydration (standard JSON serialization converts dates to strings, breaking comparison logic)."]}),"\n",(0,r.jsx)(s.h3,{id:"usage",children:"Usage"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-tsx",children:"// Read auth state\nconst isAuthenticated = useAuthStore(state => state.isAuthenticated);\nconst user = useAuthStore(state => state.user);\n\n// Outside React (e.g., in Apollo links)\nimport { getAuthToken } from '@nasnet/state/stores';\nconst token = getAuthToken(); // Returns null if expired\n"})}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"connection-store",children:"Connection Store"}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"File:"})," ",(0,r.jsx)(s.code,{children:"libs/state/stores/src/connection/connection.store.ts"})]}),"\n",(0,r.jsx)(s.p,{children:"Manages WebSocket status, per-router connection state, and reconnection tracking."}),"\n",(0,r.jsx)(s.h3,{id:"state-shape-1",children:"State Shape"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-ts",children:"interface ConnectionState {\n  wsStatus: 'connecting' | 'connected' | 'disconnected' | 'error';\n  wsError: string | null;\n  routers: Record<string, RouterConnection>; // keyed by routerId\n  activeRouterId: string | null;\n  reconnectAttempts: number;\n  maxReconnectAttempts: number;  // default: 10\n  isReconnecting: boolean;\n\n  // Legacy fields (kept for backward compat)\n  currentRouterId: string | null;\n  currentRouterIp: string | null;\n}\n\ninterface RouterConnection {\n  routerId: string;\n  status: WebSocketStatus;\n  protocol: 'rest' | 'api' | 'ssh';\n  latencyMs: number | null;\n  lastConnected: Date | null;\n  lastError: string | null;\n}\n"})}),"\n",(0,r.jsx)(s.h3,{id:"key-actions-1",children:"Key Actions"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Action"}),(0,r.jsx)(s.th,{children:"Description"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"setWsStatus(status, error?)"})}),(0,r.jsx)(s.td,{children:"Update global WebSocket status"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"setRouterConnection(routerId, partial)"})}),(0,r.jsx)(s.td,{children:"Merge connection info for a router"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"setActiveRouter(routerId)"})}),(0,r.jsx)(s.td,{children:"Switch the active router"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"updateLatency(routerId, ms)"})}),(0,r.jsx)(s.td,{children:"Record latency measurement"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"incrementReconnectAttempts()"})}),(0,r.jsx)(s.td,{children:"Called by WebSocket client on disconnect"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"resetReconnection()"})}),(0,r.jsx)(s.td,{children:"Called on successful reconnect"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"hasExceededMaxAttempts()"})}),(0,r.jsxs)(s.td,{children:["Returns ",(0,r.jsx)(s.code,{children:"true"})," at 10 attempts"]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"setCurrentRouter(id, ip)"})}),(0,r.jsx)(s.td,{children:"Legacy + new: establishes connection"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"clearCurrentRouter()"})}),(0,r.jsx)(s.td,{children:"Clears all active router state"})]})]})]}),"\n",(0,r.jsx)(s.h3,{id:"persistence-1",children:"Persistence"}),"\n",(0,r.jsxs)(s.p,{children:["Only ",(0,r.jsx)(s.code,{children:"activeRouterId"})," is persisted to ",(0,r.jsx)(s.code,{children:"localStorage"})," (key: ",(0,r.jsx)(s.code,{children:"connection-storage"}),"). All connection status resets on page reload."]}),"\n",(0,r.jsx)(s.h3,{id:"selectors",children:"Selectors"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-ts",children:"import {\n  selectWsStatus,\n  selectIsConnected,\n  selectActiveRouterId,\n  selectActiveRouterConnection,\n  selectIsReconnecting,\n  selectHasExceededMaxAttempts,\n} from '@nasnet/state/stores';\n"})}),"\n",(0,r.jsx)(s.h3,{id:"usage-1",children:"Usage"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-tsx",children:"// In components\nconst wsStatus = useConnectionStore(state => state.wsStatus);\nconst activeRouterId = useConnectionStore(selectActiveRouterId);\n\n// Outside React (Apollo link, WebSocket client)\nimport { getConnectionState } from '@nasnet/state/stores';\nconst { currentRouterId } = getConnectionState();\n"})}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"theme-store",children:"Theme Store"}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"File:"})," ",(0,r.jsx)(s.code,{children:"libs/state/stores/src/ui/theme.store.ts"})]}),"\n",(0,r.jsx)(s.p,{children:"Manages light/dark/system theme with DOM synchronization."}),"\n",(0,r.jsx)(s.h3,{id:"state-shape-2",children:"State Shape"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-ts",children:"interface ThemeState {\n  theme: 'light' | 'dark' | 'system';\n  resolvedTheme: 'light' | 'dark'; // Computed from OS if theme === 'system'\n}\n"})}),"\n",(0,r.jsx)(s.h3,{id:"key-actions-2",children:"Key Actions"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Action"}),(0,r.jsx)(s.th,{children:"Description"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"setTheme(mode)"})}),(0,r.jsx)(s.td,{children:"Set theme and compute resolved value"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"toggleTheme()"})}),(0,r.jsx)(s.td,{children:"Switch between light and dark"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"resetTheme()"})}),(0,r.jsx)(s.td,{children:"Revert to system preference"})]})]})]}),"\n",(0,r.jsx)(s.h3,{id:"initialization",children:"Initialization"}),"\n",(0,r.jsx)(s.p,{children:"Call these once at app startup:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-ts",children:"import { initThemeListener, syncThemeToDOM } from '@nasnet/state/stores';\n\n// Listen for OS theme changes (updates resolvedTheme if mode is 'system')\nconst cleanupListener = initThemeListener();\n\n// Keep document.documentElement.classList in sync\nconst cleanupSync = syncThemeToDOM();\n"})}),"\n",(0,r.jsx)(s.h3,{id:"persistence-2",children:"Persistence"}),"\n",(0,r.jsxs)(s.p,{children:["Stored under ",(0,r.jsx)(s.code,{children:"nasnet-theme"})," in ",(0,r.jsx)(s.code,{children:"localStorage"}),". Dates not involved, so standard JSON storage works."]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"ui-preferences-store",children:"UI Preferences Store"}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"File:"})," ",(0,r.jsx)(s.code,{children:"libs/state/stores/src/ui/ui.store.ts"})]}),"\n",(0,r.jsx)(s.p,{children:"Global UI preferences and transient state."}),"\n",(0,r.jsx)(s.h3,{id:"state-shape-3",children:"State Shape"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-ts",children:"interface UIState {\n  activeTab: string | null;\n  commandPaletteOpen: boolean;\n  compactMode: boolean;\n  animationsEnabled: boolean;    // Defaults to !prefersReducedMotion()\n  defaultNotificationDuration: number; // ms, default: 4000\n  hideHostnames: boolean;        // Privacy mode for device lists\n}\n"})}),"\n",(0,r.jsx)(s.h3,{id:"key-actions-3",children:"Key Actions"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Action"}),(0,r.jsx)(s.th,{children:"Description"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"toggleCommandPalette()"})}),(0,r.jsx)(s.td,{children:"Open/close command palette"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"setCompactMode(bool)"})}),(0,r.jsx)(s.td,{children:"Compact layout mode"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"toggleHideHostnames()"})}),(0,r.jsx)(s.td,{children:"Privacy mode for connected devices"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"resetPreferences()"})}),(0,r.jsx)(s.td,{children:"Reset to defaults"})]})]})]}),"\n",(0,r.jsx)(s.h3,{id:"persistence-3",children:"Persistence"}),"\n",(0,r.jsxs)(s.p,{children:["Saved to ",(0,r.jsx)(s.code,{children:"localStorage"})," under ",(0,r.jsx)(s.code,{children:"nasnet-ui-store"}),". Transient fields (",(0,r.jsx)(s.code,{children:"commandPaletteOpen"}),", ",(0,r.jsx)(s.code,{children:"activeTab"}),") are excluded from persistence via ",(0,r.jsx)(s.code,{children:"partialize"}),"."]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"modal-store",children:"Modal Store"}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"File:"})," ",(0,r.jsx)(s.code,{children:"libs/state/stores/src/ui/modal.store.ts"})]}),"\n",(0,r.jsx)(s.p,{children:"Single-modal paradigm: only one modal can be open at a time. Opening a new modal closes the current one."}),"\n",(0,r.jsx)(s.h3,{id:"state-shape-4",children:"State Shape"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-ts",children:"interface ModalState {\n  activeModal: ModalId | null;\n  modalData: Record<string, unknown> | null;\n}\n"})}),"\n",(0,r.jsx)(s.h3,{id:"known-modal-ids",children:"Known Modal IDs"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-ts",children:"type KnownModalId =\n  | 'confirm-delete' | 'confirm-action'\n  | 'router-credentials' | 'add-router' | 'edit-router'\n  | 'settings' | 'keyboard-shortcuts' | 'router-details'\n  | 'vpn-config' | 'firewall-rule' | 'network-interface';\n"})}),"\n",(0,r.jsx)(s.h3,{id:"usage-2",children:"Usage"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-tsx",children:"const { openModal, closeModal, activeModal, modalData } = useModalStore();\n\n// Open with typed data\nopenModal('confirm-delete', { itemId: 'abc', itemName: 'Router 1' });\n\n// In the modal component\nif (activeModal !== 'confirm-delete') return null;\nconst { itemId, itemName } = modalData as { itemId: string; itemName: string };\n"})}),"\n",(0,r.jsx)(s.p,{children:"Not persisted \u2014 session-only."}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"notification-store",children:"Notification Store"}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"File:"})," ",(0,r.jsx)(s.code,{children:"libs/state/stores/src/ui/notification.store.ts"})]}),"\n",(0,r.jsx)(s.p,{children:"Toast notification queue with deduplication."}),"\n",(0,r.jsx)(s.h3,{id:"state-shape-5",children:"State Shape"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-ts",children:"interface NotificationState {\n  notifications: Notification[]; // Max 10, oldest removed when exceeded\n}\n\ninterface Notification {\n  id: string;\n  type: 'success' | 'error' | 'warning' | 'info' | 'progress';\n  title: string;\n  message?: string;\n  duration?: number | null; // null = no auto-dismiss\n  action?: { label: string; onClick: () => void };\n  progress?: number;        // 0-100 for progress type\n  createdAt: Date;\n}\n"})}),"\n",(0,r.jsx)(s.h3,{id:"default-durations",children:"Default Durations"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Type"}),(0,r.jsx)(s.th,{children:"Duration"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"success"})}),(0,r.jsx)(s.td,{children:"4000 ms"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"info"})}),(0,r.jsx)(s.td,{children:"4000 ms"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"warning"})}),(0,r.jsx)(s.td,{children:"5000 ms"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"error"})}),(0,r.jsx)(s.td,{children:"No auto-dismiss"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"progress"})}),(0,r.jsx)(s.td,{children:"No auto-dismiss"})]})]})]}),"\n",(0,r.jsx)(s.h3,{id:"deduplication",children:"Deduplication"}),"\n",(0,r.jsxs)(s.p,{children:["Notifications with the same ",(0,r.jsx)(s.code,{children:"title + message"})," within 2 seconds are silently dropped. ",(0,r.jsx)(s.code,{children:"addNotification()"})," returns an empty string for duplicates."]}),"\n",(0,r.jsx)(s.h3,{id:"convenience-functions",children:"Convenience Functions"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-ts",children:"import { showSuccess, showError, showWarning, showInfo } from '@nasnet/state/stores';\n\nshowSuccess('Router connected', 'Successfully connected to 192.168.88.1');\nshowError('Connection failed', 'Check router credentials.');\n\n// Progress notification\nconst id = useNotificationStore.getState().addNotification({\n  type: 'progress', title: 'Uploading firmware...', progress: 0,\n});\nuseNotificationStore.getState().updateNotification(id, { progress: 50 });\n"})}),"\n",(0,r.jsx)(s.p,{children:"Not persisted \u2014 session-only."}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"change-set-store",children:"Change Set Store"}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"File:"})," ",(0,r.jsx)(s.code,{children:"libs/state/stores/src/change-set/change-set.store.ts"})]}),"\n",(0,r.jsxs)(s.p,{children:["Tracks atomic multi-resource operation bundles. See also the ",(0,r.jsx)(s.code,{children:"changeSetMachine"})," in ",(0,r.jsx)(s.code,{children:"xstate-machines.md"})," which orchestrates the apply/rollback lifecycle."]}),"\n",(0,r.jsx)(s.h3,{id:"state-shape-6",children:"State Shape"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-ts",children:"interface ChangeSetState {\n  changeSets: Record<string, ChangeSet>;\n  activeChangeSetId: string | null;\n  applyingChangeSetIds: string[];\n  lastError: string | null;\n}\n"})}),"\n",(0,r.jsx)(s.h3,{id:"key-actions-4",children:"Key Actions"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Action"}),(0,r.jsx)(s.th,{children:"Description"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"createChangeSet(params)"})}),(0,r.jsx)(s.td,{children:"Create new change set, returns ID"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"addItem(changeSetId, item)"})}),(0,r.jsx)(s.td,{children:"Add resource operation to change set"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"updateItem(changeSetId, itemId, updates)"})}),(0,r.jsx)(s.td,{children:"Modify item configuration"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"removeItem(changeSetId, itemId)"})}),(0,r.jsx)(s.td,{children:"Remove item (also cleans dependencies)"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"setItemDependencies(changeSetId, itemId, deps)"})}),(0,r.jsx)(s.td,{children:"Set apply-order dependencies"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"recalculateApplyOrder(changeSetId)"})}),(0,r.jsx)(s.td,{children:"Recompute topological sort after changes"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"markApplying(id)"})}),(0,r.jsx)(s.td,{children:"Transitions to APPLYING status"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"markCompleted(id)"})}),(0,r.jsx)(s.td,{children:"Transitions to COMPLETED"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"markFailed(id, error, failedItemId)"})}),(0,r.jsx)(s.td,{children:"Transitions to FAILED with partial rollback info"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"markRolledBack(id)"})}),(0,r.jsx)(s.td,{children:"Marks rolled-back items"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"clearCompleted(routerId?)"})}),(0,r.jsx)(s.td,{children:"Remove completed/failed/cancelled sets"})]})]})]}),"\n",(0,r.jsx)(s.h3,{id:"persistence-4",children:"Persistence"}),"\n",(0,r.jsxs)(s.p,{children:["Only ",(0,r.jsx)(s.code,{children:"DRAFT"})," and ",(0,r.jsx)(s.code,{children:"READY"})," status change sets survive page reload (persisted to ",(0,r.jsx)(s.code,{children:"localStorage"})," under ",(0,r.jsx)(s.code,{children:"nasnet-change-sets"}),"). Completed, failed, and applying sets are ephemeral."]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"sidebar-store",children:"Sidebar Store"}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"File:"})," ",(0,r.jsx)(s.code,{children:"libs/state/stores/src/ui/sidebar.store.ts"})]}),"\n",(0,r.jsx)(s.p,{children:"Controls navigation sidebar open/collapsed state and pinning."}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"history-store",children:"History Store"}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"File:"})," ",(0,r.jsx)(s.code,{children:"libs/state/stores/src/history/history.store.ts"})]}),"\n",(0,r.jsxs)(s.p,{children:["Undo/redo history for command-based operations. Works with the command registry via ",(0,r.jsx)(s.code,{children:"command-utils.ts"}),"."]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"command-registry-and-shortcut-registry",children:"Command Registry and Shortcut Registry"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Files:"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.code,{children:"libs/state/stores/src/command/command-registry.store.ts"})}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.code,{children:"libs/state/stores/src/command/shortcut-registry.store.ts"})}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"The command registry holds all registered commands (actions with names and descriptions). The shortcut registry maps keyboard shortcuts to command IDs, enabling the command palette and global keyboard shortcuts."}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"feature-ui-stores",children:"Feature UI Stores"}),"\n",(0,r.jsx)(s.p,{children:"These stores hold transient UI state specific to a single feature page (selected rows, filter state, dialog open state, etc.). They are not persisted."}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Store"}),(0,r.jsx)(s.th,{children:"Purpose"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"useDHCPUIStore"})}),(0,r.jsx)(s.td,{children:"DHCP page: selected pool, filter, dialog state"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"useServiceUIStore"})}),(0,r.jsx)(s.td,{children:"Plugin/service page: selected service, install dialog"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"useFirewallLogUIStore"})}),(0,r.jsx)(s.td,{children:"Firewall logs: filter, selected entry"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"useMangleUIStore"})}),(0,r.jsx)(s.td,{children:"Mangle rules: editing state"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"useNATUIStore"})}),(0,r.jsx)(s.td,{children:"NAT rules: editing state"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"usePortKnockUIStore"})}),(0,r.jsx)(s.td,{children:"Port knocking: sequence editing"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"useRateLimitingUIStore"})}),(0,r.jsx)(s.td,{children:"Rate limits: rule editing"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"useRawUIStore"})}),(0,r.jsx)(s.td,{children:"Raw firewall rules: editing state"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"useAlertNotificationStore"})}),(0,r.jsx)(s.td,{children:"Alert notifications: read/unread, filter"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"useAlertRuleTemplateUIStore"})}),(0,r.jsx)(s.td,{children:"Alert template browser: selected template, apply dialog"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"useInterfaceStatsStore"})}),(0,r.jsx)(s.td,{children:"Interface stats: polling interval, selected interface"})]})]})]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"outside-react-usage",children:"Outside React Usage"}),"\n",(0,r.jsx)(s.p,{children:"All stores expose helpers for use in non-React code (Apollo links, XState services, etc.):"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-ts",children:"import {\n  getAuthState,\n  getConnectionState,\n  getChangeSetState,\n} from '@nasnet/state/stores';\n\n// Read state imperatively\nconst { token } = getAuthState();\nconst { currentRouterId } = getConnectionState();\n"})}),"\n",(0,r.jsx)(s.p,{children:"Subscribe to changes outside React:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-ts",children:"import { subscribeConnectionState } from '@nasnet/state/stores';\n\nconst unsubscribe = subscribeConnectionState((state) => {\n  if (state.wsStatus === 'connected') {\n    // ...\n  }\n});\n\n// Later\nunsubscribe();\n"})})]})}function h(e={}){const{wrapper:s}={...(0,d.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}}}]);