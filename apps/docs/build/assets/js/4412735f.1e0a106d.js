"use strict";(globalThis.webpackChunk_nas_net_docs=globalThis.webpackChunk_nas_net_docs||[]).push([[38677],{1789:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>p,frontMatter:()=>a,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"guides/universal-state-v2","title":"Universal State v2: The 8-Layer Resource Model","description":"Reference: ADR-012 - Universal State v2 | libs/core/types/src/resource/","source":"@site/../../libs/core/docs/guides/universal-state-v2.md","sourceDirName":"guides","slug":"/guides/universal-state-v2","permalink":"/docs/core/guides/universal-state-v2","draft":false,"unlisted":false,"editUrl":"https://github.com/nasnet-community/nasnet-panel/tree/main/../../libs/core/docs/guides/universal-state-v2.md","tags":[],"version":"current","frontMatter":{},"sidebar":"sidebar","previous":{"title":"Network Configuration Guide","permalink":"/docs/core/guides/network-configuration"},"next":{"title":"Validation Pipeline: 7-Stage Risk-Based Validation","permalink":"/docs/core/guides/validation-pipeline"}}');var i=r(31085),s=r(71184);const a={},o="Universal State v2: The 8-Layer Resource Model",l={},c=[{value:"Table of Contents",id:"table-of-contents",level:2},{value:"Problem Statement",id:"problem-statement",level:2},{value:"The 8-Layer Model",id:"the-8-layer-model",level:2},{value:"Layer Breakdown",id:"layer-breakdown",level:3},{value:"Layer 1: Source (Backend / Router State)",id:"layer-1-source-backend--router-state",level:4},{value:"Layer 2: Validation Result",id:"layer-2-validation-result",level:4},{value:"Layer 3: Deployment State",id:"layer-3-deployment-state",level:4},{value:"Layer 4: Runtime State",id:"layer-4-runtime-state",level:4},{value:"Layer 5: Telemetry",id:"layer-5-telemetry",level:4},{value:"Layer 6: Metadata",id:"layer-6-metadata",level:4},{value:"Layer 7: Relationships",id:"layer-7-relationships",level:4},{value:"Layer 8: Platform Info",id:"layer-8-platform-info",level:4},{value:"Resource Lifecycle",id:"resource-lifecycle",level:2},{value:"Composite Resources",id:"composite-resources",level:2},{value:"Type Guards and Runtime Checking",id:"type-guards-and-runtime-checking",level:2},{value:"Form Integration",id:"form-integration",level:2},{value:"Change Set Ordering",id:"change-set-ordering",level:2},{value:"Practical Examples",id:"practical-examples",level:2},{value:"Example 1: Create LAN Network with DHCP",id:"example-1-create-lan-network-with-dhcp",level:3},{value:"Example 2: Update with Conflict Detection",id:"example-2-update-with-conflict-detection",level:3},{value:"Example 3: Optimistic Updates in React",id:"example-3-optimistic-updates-in-react",level:3},{value:"See Also",id:"see-also",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"universal-state-v2-the-8-layer-resource-model",children:"Universal State v2: The 8-Layer Resource Model"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Reference:"})," ADR-012 - Universal State v2 | ",(0,i.jsx)(n.code,{children:"libs/core/types/src/resource/"})]}),"\n",(0,i.jsx)(n.h2,{id:"table-of-contents",children:"Table of Contents"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#problem-statement",children:"Problem Statement"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#the-8-layer-model",children:"The 8-Layer Model"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#resource-lifecycle",children:"Resource Lifecycle"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#composite-resources",children:"Composite Resources"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#type-guards-and-runtime-checking",children:"Type Guards and Runtime Checking"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#form-integration",children:"Form Integration"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#change-set-ordering",children:"Change Set Ordering"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#practical-examples",children:"Practical Examples"})}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"problem-statement",children:"Problem Statement"}),"\n",(0,i.jsx)(n.p,{children:"Managing router configuration is complex because multiple systems need to track different aspects of the same resource:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Backend"})," has the authoritative source (what's on the router)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Caches"})," need to optimize queries (TanStack Query)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Forms"})," need draft state (React Hook Form)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Optimistic UI"})," needs instant feedback before confirmation"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Validation"})," happens across multiple stages"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Runtime"})," state changes independently (health, metrics)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Telemetry"})," tracks historical data"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Metadata"})," tracks who changed what"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Without a unified model, these concerns scatter across the codebase, causing:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Stale data conflicts"}),"\n",(0,i.jsx)(n.li,{children:"Lost user edits"}),"\n",(0,i.jsx)(n.li,{children:"Cache invalidation bugs"}),"\n",(0,i.jsx)(n.li,{children:"Form validation mismatches"}),"\n",(0,i.jsx)(n.li,{children:"Impossible dependency tracking"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Universal State v2"})," solves this by defining 8 orthogonal layers that never conflict."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"the-8-layer-model",children:"The 8-Layer Model"}),"\n",(0,i.jsx)(n.p,{children:"Each resource passes through 8 distinct layers, each with a specific responsibility:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Layer 1: SOURCE (Backend / Router State)                    \u2502\n\u2502 \u251c\u2500 The authoritative data from the router                   \u2502\n\u2502 \u251c\u2500 Updated by: apply-confirm operations                    \u2502\n\u2502 \u2514\u2500 Accessed by: cache, optimistic UI baseline               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                         \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Layer 2: VALIDATION RESULT (Pipeline Output)                \u2502\n\u2502 \u251c\u2500 7-stage validation pipeline output                       \u2502\n\u2502 \u251c\u2500 Schema, semantic, dependency, conflict, platform, quota, \u2502\n\u2502 \u2502  dry-run validation results                               \u2502\n\u2502 \u2514\u2500 Updated by: validation service                           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                         \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Layer 3: DEPLOYMENT STATE (Router-Confirmed)                \u2502\n\u2502 \u251c\u2500 What's actually on the router after apply               \u2502\n\u2502 \u251c\u2500 Router-generated fields, version info                   \u2502\n\u2502 \u251c\u2500 Drift detection (config vs deployment mismatch)         \u2502\n\u2502 \u2514\u2500 Updated by: apply-confirm mutation                       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                         \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Layer 4: RUNTIME STATE (Live Operational)                   \u2502\n\u2502 \u251c\u2500 Real-time health, metrics, uptime                        \u2502\n\u2502 \u251c\u2500 Continuously updated via polling/streams                \u2502\n\u2502 \u2514\u2500 Read-only, system-managed                                \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                         \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Layer 5: TELEMETRY (Historical Data)                        \u2502\n\u2502 \u251c\u2500 Bandwidth history, uptime trends                         \u2502\n\u2502 \u251c\u2500 Hourly/daily aggregates                                  \u2502\n\u2502 \u2514\u2500 Automatically collected, retention-managed               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                         \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Layer 6: METADATA (Lifecycle & Audit)                       \u2502\n\u2502 \u251c\u2500 Created/updated timestamps, lifecycle state              \u2502\n\u2502 \u251c\u2500 Version number (optimistic locking)                      \u2502\n\u2502 \u251c\u2500 Tags, description, audit trail                           \u2502\n\u2502 \u2514\u2500 Partially user-editable (description, tags, notes)       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                         \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Layer 7: RELATIONSHIPS (Dependencies & Links)               \u2502\n\u2502 \u251c\u2500 Direct dependencies (requires these resources)           \u2502\n\u2502 \u251c\u2500 Dependents (resources depending on this)                 \u2502\n\u2502 \u251c\u2500 Routing paths, hierarchy, custom relationships           \u2502\n\u2502 \u2514\u2500 Computed and stored for quick lookups                    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                         \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Layer 8: PLATFORM INFO (Router Capabilities)                \u2502\n\u2502 \u251c\u2500 Platform type (MikroTik, OpenWRT, VyOS)                  \u2502\n\u2502 \u251c\u2500 Capability level (none/basic/advanced/full)              \u2502\n\u2502 \u251c\u2500 Field mappings, limitations, optional features           \u2502\n\u2502 \u2514\u2500 Determines which operations are supported                \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,i.jsx)(n.h3,{id:"layer-breakdown",children:"Layer Breakdown"}),"\n",(0,i.jsx)(n.h4,{id:"layer-1-source-backend--router-state",children:"Layer 1: Source (Backend / Router State)"}),"\n",(0,i.jsx)(n.p,{children:'The authoritative data from the router. This is the "source of truth" that everything else syncs against.'}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import type { Resource } from '@nasnet/core/types';\n\n// Example: WireGuard Server resource\nconst wgServer: Resource = {\n  uuid: 'wg-srv-001',\n  id: 'wireguard-server',\n  type: 'services.wireguard.server',\n  category: 'SERVICE',\n  // Layer 1: Source data\n  configuration: {\n    enabled: true,\n    port: 51820,\n    privateKey: '...',\n    ipAddress: '10.0.0.1/24',\n  },\n  // Layers 2-8 attached...\n};\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"When it updates:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"After a successful apply-confirm operation"}),"\n",(0,i.jsx)(n.li,{children:"When re-fetching from the backend"}),"\n",(0,i.jsx)(n.li,{children:"Via cache updates (TanStack Query mutations)"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Accessed by:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Optimistic UI to establish baseline"}),"\n",(0,i.jsx)(n.li,{children:"Forms to pre-fill with current values"}),"\n",(0,i.jsx)(n.li,{children:"Validation to detect conflicts"}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h4,{id:"layer-2-validation-result",children:"Layer 2: Validation Result"}),"\n",(0,i.jsx)(n.p,{children:"Output from the 7-stage validation pipeline (schema, semantic, dependency, conflict, platform, quota, dry-run)."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import type { ValidationResult, ValidationStage } from '@nasnet/core/types';\n\nconst validationResult: ValidationResult = {\n  // Can apply if no blocking errors\n  canApply: true,\n\n  // Current stage in pipeline\n  stage: 'SIMULATION' as ValidationStage,\n\n  // Blocking errors (must fix before apply)\n  errors: [\n    {\n      code: 'PORT_CONFLICT',\n      message: 'Port 51820 already used by OpenVPN',\n      field: 'port',\n      severity: 'ERROR',\n      suggestedFix: 'Use port 51821 or higher',\n    },\n  ],\n\n  // Non-blocking warnings (informational)\n  warnings: [\n    {\n      code: 'HIGH_SECURITY_RISK',\n      message: 'Consider enabling perfect forward secrecy',\n      severity: 'WARNING',\n    },\n  ],\n\n  // Conflicts with other resources\n  conflicts: [\n    {\n      type: 'PORT',\n      conflictingResourceUuid: 'openvpn-001',\n      description: 'OpenVPN server also uses port 51820',\n      resolution: 'Change one of the ports',\n    },\n  ],\n\n  // Status of required dependencies\n  requiredDependencies: [\n    {\n      resourceUuid: 'lan-network-001',\n      resourceType: 'network.bridge',\n      isActive: true,\n      state: 'ACTIVE',\n      reason: 'WireGuard needs a LAN to tunnel through',\n    },\n  ],\n\n  validatedAt: '2024-02-27T10:15:00Z',\n  validationDurationMs: 1250,\n};\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Pipeline stages:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"SCHEMA"})," - Zod/GraphQL type validation"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"SEMANTIC"})," - Business rule validation"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"DEPENDENCY"})," - Required resources exist"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"CONFLICT"})," - Port/IP/route conflicts"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"PLATFORM"})," - Router capability checks"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"QUOTA"})," - Resource limit checks"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"SIMULATION"})," - Pre-flight dry-run"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Severity levels:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ERROR"})," - Blocks apply (must fix)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"WARNING"})," - Non-blocking (informational)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"INFO"})," - Help text"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h4,{id:"layer-3-deployment-state",children:"Layer 3: Deployment State"}),"\n",(0,i.jsx)(n.p,{children:"What's actually on the router after apply. Includes router-generated fields and drift information."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import type { DeploymentState, DriftInfo } from '@nasnet/core/types';\n\nconst deployment: DeploymentState = {\n  // Router-assigned ID (may differ from config)\n  routerResourceId: '.id=*5C',\n\n  // When applied\n  appliedAt: '2024-02-27T09:50:00Z',\n  appliedBy: 'admin@example.com',\n\n  // For optimistic locking (conflict detection)\n  routerVersion: 42,\n\n  // Router-generated vendor fields\n  generatedFields: {\n    hwAddress: '02:11:22:33:44:55',\n    uptime: '4d 8h 15m',\n  },\n\n  // Matches configuration?\n  isInSync: true,\n\n  // Drift detected?\n  drift: {\n    detectedAt: '2024-02-27T10:00:00Z',\n    driftedFields: [\n      {\n        path: 'configuration.enabled',\n        expected: true,\n        actual: false,  // User disabled on router\n      },\n    ],\n    suggestedAction: 'REAPPLY', // or ACCEPT or REVIEW\n  },\n\n  // For audit/undo trail\n  applyOperationId: 'op-2024-02-27-001',\n};\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Drift scenarios:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["User manually changes on router \u2192 ",(0,i.jsx)(n.code,{children:"actual"})," differs from ",(0,i.jsx)(n.code,{children:"expected"})]}),"\n",(0,i.jsxs)(n.li,{children:["Suggest: ",(0,i.jsx)(n.code,{children:"REAPPLY"})," (push config), ",(0,i.jsx)(n.code,{children:"ACCEPT"})," (accept router), or ",(0,i.jsx)(n.code,{children:"REVIEW"})," (manual)"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h4,{id:"layer-4-runtime-state",children:"Layer 4: Runtime State"}),"\n",(0,i.jsx)(n.p,{children:"Live operational data, updated continuously via polling/WebSocket."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import type { RuntimeState, RuntimeHealth } from '@nasnet/core/types';\n\nconst runtime: RuntimeState = {\n  // Is the resource running right now?\n  isRunning: true,\n\n  // Health status\n  health: 'HEALTHY' as RuntimeHealth,\n\n  // Error if unhealthy\n  errorMessage: null,\n\n  // Metrics collected from router\n  metrics: {\n    bytesIn: 1024000,\n    bytesOut: 512000,\n    packetsIn: 10000,\n    packetsOut: 5000,\n    errors: 0,\n    drops: 0,\n    throughputIn: 12500,  // bytes/sec\n    throughputOut: 6250,\n  },\n\n  lastUpdated: '2024-02-27T10:14:59Z',\n  lastSuccessfulOperation: '2024-02-27T09:50:00Z',\n\n  // WireGuard specific\n  activeConnections: 3,  // connected peers\n  uptime: 'PT4H15M',  // ISO 8601 duration\n};\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Updated by:"})," Polling service, WebSocket stream, health checker"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Never manually modified:"})," System-managed, read-only in forms"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h4,{id:"layer-5-telemetry",children:"Layer 5: Telemetry"}),"\n",(0,i.jsx)(n.p,{children:"Historical time-series data and aggregated statistics."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import type { TelemetryData, BandwidthDataPoint } from '@nasnet/core/types';\n\nconst telemetry: TelemetryData = {\n  // Raw bandwidth history (last 24h)\n  bandwidthHistory: [\n    {\n      timestamp: '2024-02-27T09:00:00Z',\n      bytesIn: 1000000,\n      bytesOut: 500000,\n      periodSeconds: 300,\n    },\n    // ... more points\n  ],\n\n  // Raw uptime history (last 24h)\n  uptimeHistory: [\n    {\n      timestamp: '2024-02-27T09:00:00Z',\n      isUp: true,\n      periodSeconds: 300,\n    },\n    // ... more points\n  ],\n\n  // Hourly aggregates\n  hourlyStats: [\n    {\n      hour: '2024-02-27T09:00:00Z',\n      totalBytesIn: 1000000,\n      totalBytesOut: 500000,\n      uptimePercent: 100,\n      errorCount: 0,\n    },\n  ],\n\n  // Daily aggregates\n  dailyStats: [\n    {\n      date: '2024-02-27',\n      totalBytesIn: 24000000,\n      totalBytesOut: 12000000,\n      uptimePercent: 99.8,\n      errorCount: 2,\n      peakThroughputIn: 50000,\n      peakThroughputOut: 25000,\n    },\n  ],\n\n  dataStartedAt: '2024-01-30T10:15:00Z',\n  lastUpdatedAt: '2024-02-27T10:14:59Z',\n  retentionDays: 30,\n};\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Automatically collected"})," by telemetry pipeline"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Retention:"})," Configurable (default 30 days)"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h4,{id:"layer-6-metadata",children:"Layer 6: Metadata"}),"\n",(0,i.jsx)(n.p,{children:"Lifecycle information, audit trail, and user-customizable fields."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import type { ResourceMetadata, ChangeLogEntry } from '@nasnet/core/types';\n\nconst metadata: ResourceMetadata = {\n  // Creation timestamp\n  createdAt: '2024-02-20T08:30:00Z',\n  createdBy: 'setup-wizard',\n\n  // Last update\n  updatedAt: '2024-02-27T09:50:00Z',\n  updatedBy: 'admin@example.com',\n\n  // Lifecycle state\n  state: 'ACTIVE',\n\n  // Version for optimistic locking\n  version: 5,\n\n  // User-defined organization\n  tags: ['production', 'vpn-gateway', 'critical'],\n  description: 'Primary WireGuard server for remote access',\n  isFavorite: true,\n  isPinned: true,\n  notes: 'Backup to wg-srv-002 if this fails',\n\n  // Audit trail (last 10 changes)\n  recentChanges: [\n    {\n      timestamp: '2024-02-27T09:50:00Z',\n      user: 'admin@example.com',\n      changeType: 'UPDATE',\n      changedFields: ['configuration.enabled', 'configuration.port'],\n      summary: 'Enabled server and changed port',\n    },\n    {\n      timestamp: '2024-02-20T08:30:00Z',\n      user: 'setup-wizard',\n      changeType: 'CREATE',\n      changedFields: ['configuration'],\n      summary: 'Created via wizard',\n    },\n  ],\n};\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"User-editable fields:"})," ",(0,i.jsx)(n.code,{children:"tags"}),", ",(0,i.jsx)(n.code,{children:"description"}),", ",(0,i.jsx)(n.code,{children:"notes"}),", ",(0,i.jsx)(n.code,{children:"isFavorite"}),", ",(0,i.jsx)(n.code,{children:"isPinned"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"System-managed:"})," ",(0,i.jsx)(n.code,{children:"createdAt"}),", ",(0,i.jsx)(n.code,{children:"updatedAt"}),", ",(0,i.jsx)(n.code,{children:"state"}),", ",(0,i.jsx)(n.code,{children:"version"}),", ",(0,i.jsx)(n.code,{children:"recentChanges"})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h4,{id:"layer-7-relationships",children:"Layer 7: Relationships"}),"\n",(0,i.jsx)(n.p,{children:"Dependencies and connections with other resources."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import type { ResourceRelationships } from '@nasnet/core/types';\n\nconst relationships: ResourceRelationships = {\n  // This resource depends on these\n  dependsOn: [\n    {\n      uuid: 'lan-network-001',\n      id: 'lan',\n      type: 'network.bridge',\n      category: 'NETWORK',\n      state: 'ACTIVE',\n    },\n  ],\n\n  // These resources depend on this\n  dependents: [\n    {\n      uuid: 'firewall-rule-001',\n      id: 'wg-allow-in',\n      type: 'firewall.filter',\n      category: 'FIREWALL',\n      state: 'ACTIVE',\n    },\n  ],\n\n  // Routes via this interface\n  routesVia: {\n    uuid: 'wan-interface-001',\n    id: 'wan',\n    type: 'network.interface',\n    category: 'NETWORK',\n    state: 'ACTIVE',\n  },\n\n  // Routed via this resource\n  routedBy: [\n    {\n      uuid: 'split-tunnel-rule-001',\n      id: 'split-rule',\n      type: 'routing.policy',\n      category: 'ROUTING',\n      state: 'ACTIVE',\n    },\n  ],\n\n  // Parent in hierarchy\n  parent: null,\n\n  // Child resources\n  children: [\n    {\n      uuid: 'wg-peer-001',\n      id: 'client-alice',\n      type: 'services.wireguard.peer',\n      category: 'SERVICE',\n      state: 'ACTIVE',\n    },\n    {\n      uuid: 'wg-peer-002',\n      id: 'client-bob',\n      type: 'services.wireguard.peer',\n      category: 'SERVICE',\n      state: 'ACTIVE',\n    },\n  ],\n};\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Used for:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Dependency graph construction"}),"\n",(0,i.jsx)(n.li,{children:"Impact analysis (deleting parent deletes children?)"}),"\n",(0,i.jsx)(n.li,{children:"Change set ordering"}),"\n",(0,i.jsx)(n.li,{children:"Cascading operations"}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h4,{id:"layer-8-platform-info",children:"Layer 8: Platform Info"}),"\n",(0,i.jsx)(n.p,{children:"Router platform capabilities and constraints."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import type { PlatformInfo, RouterPlatform } from '@nasnet/core/types';\n\nconst platform: PlatformInfo = {\n  // Current platform\n  current: 'MIKROTIK' as RouterPlatform,\n\n  // Capability level for this resource type\n  capabilities: {\n    isSupported: true,\n    level: 'FULL',\n    minVersion: '6.48.0',\n    requiredPackages: ['routeros-system', 'routeros-routing'],\n    details: {\n      maxPeers: 1000,\n      maxTunnels: 100,\n    },\n  },\n\n  // Field mappings: GraphQL schema \u2192 platform-native\n  fieldMappings: {\n    'configuration.enabled': '/ip/service/wireguard/.../enabled',\n    'configuration.port': '/ip/service/wireguard/.../listen-port',\n    'configuration.privateKey': '/ip/service/wireguard/.../private-key',\n  },\n\n  // Platform-specific limitations\n  limitations: [\n    {\n      code: 'MTK_WG_PEERS_LIMIT',\n      description: 'MikroTik limits WireGuard to 1000 peers',\n      affectedFields: ['configuration.peers'],\n      workaround: 'Use multiple servers to distribute load',\n    },\n  ],\n\n  // Optional features\n  features: [\n    {\n      id: 'ipv6-support',\n      name: 'IPv6 Support',\n      enabled: true,\n      description: 'Support for IPv6 addresses in WireGuard',\n    },\n  ],\n};\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Accessed by:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Validation (check capabilities before apply)"}),"\n",(0,i.jsx)(n.li,{children:"Forms (hide unsupported fields)"}),"\n",(0,i.jsx)(n.li,{children:"Dashboard (show capability warnings)"}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"resource-lifecycle",children:"Resource Lifecycle"}),"\n",(0,i.jsx)(n.p,{children:"Resources progress through lifecycle states as they are created, validated, deployed, and managed."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import type { ResourceLifecycleState } from '@nasnet/core/types';\n\ntype LifecycleState =\n  | 'DRAFT'        // User is editing, not yet validated\n  | 'VALID'        // Validation passed, ready to apply\n  | 'APPLYING'     // Apply operation in progress\n  | 'ACTIVE'       // Successfully deployed on router\n  | 'UPDATING'     // Update operation in progress\n  | 'DELETING'     // Delete operation in progress\n  | 'DELETED'      // Soft-deleted (for audit trail)\n  | 'ERROR'        // Failed to apply, waiting for retry\n  | 'DEPRECATED';  // Superseded by newer version\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"State diagram:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n     \u2502   DRAFT     \u2502 \u2190 User is editing\n     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n            \u2502 validate()\n     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n     \u2502   VALID     \u2502 \u2190 Ready to apply\n     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n            \u2502 apply()\n     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n     \u2502  APPLYING   \u2502 \u2190 In progress\n     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n            \u2502 \u2713 success / \u2717 error\n     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n     \u2502   ACTIVE    \u2502 \u2500\u2500\u2500\u2192 \u2502 ERROR \u2502 \u2190 Needs retry\n     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u2514\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2518\n            \u2502 update()        \u2502 retry()\n     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2510          \u2502\n     \u2502  UPDATING   \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n            \u2502 \u2713\n     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n     \u2502   ACTIVE    \u2502\n     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n            \u2502 delete()\n     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n     \u2502  DELETING   \u2502 \u2190 In progress\n     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n            \u2502 \u2713\n     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n     \u2502  DELETED    \u2502 \u2190 Soft-deleted\n     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"composite-resources",children:"Composite Resources"}),"\n",(0,i.jsx)(n.p,{children:"Composite resources aggregate multiple sub-resources (e.g., WireGuard Server + Clients, LAN Network + DHCP + Leases)."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import type { CompositeResource, CompositeResourceStatus } from '@nasnet/core/types';\n\n// Root resource + sub-resources\nconst composite: CompositeResource = {\n  root: wgServer,  // WireGuard server\n  children: [      // WireGuard clients\n    wgClient1,\n    wgClient2,\n    wgClient3,\n  ],\n  relationships: [\n    { from: 'wg-srv-001', to: 'wg-peer-001', type: 'PARENT_CHILD' },\n    { from: 'wg-srv-001', to: 'wg-peer-002', type: 'PARENT_CHILD' },\n    // ...\n  ],\n};\n\n// Aggregated status\nconst status: CompositeResourceStatus = {\n  totalCount: 3,\n  activeCount: 3,\n  errorCount: 0,\n  degradedCount: 0,\n  pendingCount: 0,\n  overallHealth: 'HEALTHY',\n  allRunning: true,\n  hasDrift: false,\n  isFullySynced: true,\n};\n\n// Check status\nif (status.overallHealth === 'CRITICAL') {\n  // Handle critical state\n}\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"type-guards-and-runtime-checking",children:"Type Guards and Runtime Checking"}),"\n",(0,i.jsx)(n.p,{children:"Runtime type guards for checking resource states and capabilities."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import type { Resource } from '@nasnet/core/types';\nimport {\n  isResourceActive,\n  isResourcePending,\n  canResourceApply,\n} from '@nasnet/core/types';\n\nfunction handleResource(resource: Resource) {\n  // Is the resource currently deployed and running?\n  if (isResourceActive(resource)) {\n    console.log('Resource is running on router');\n  }\n\n  // Is the resource waiting for something?\n  if (isResourcePending(resource)) {\n    console.log('Resource is pending:', resource.metadata?.state);\n  }\n\n  // Can this resource be applied right now?\n  if (canResourceApply(resource)) {\n    console.log('Resource validation passed');\n  }\n\n  // Check validation errors\n  if (resource.validation?.errors?.length) {\n    resource.validation.errors.forEach((err) => {\n      console.error(`${err.code}: ${err.message}`);\n    });\n  }\n\n  // Check conflicts\n  if (resource.validation?.conflicts?.length) {\n    resource.validation.conflicts.forEach((conflict) => {\n      console.warn(`Conflict: ${conflict.description}`);\n    });\n  }\n}\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"form-integration",children:"Form Integration"}),"\n",(0,i.jsxs)(n.p,{children:["Synchronizing forms with Universal State v2 using ",(0,i.jsx)(n.code,{children:"useFormResourceSync"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import { useForm } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport { useFormResourceSync } from '@nasnet/core/forms';\nimport { z } from 'zod';\n\nconst schema = z.object({\n  port: z.number().min(1).max(65535),\n  enabled: z.boolean(),\n});\n\nfunction WireGuardServerForm({ server }: { server: Resource }) {\n  const form = useForm({\n    resolver: zodResolver(schema),\n    defaultValues: server.configuration,\n  });\n\n  // Sync form with 8-layer state\n  const { state, actions, canSave, changedFields } = useFormResourceSync({\n    sourceData: server.configuration,\n    resourceId: server.uuid,\n    resourceVersion: server.metadata?.version?.toString(),\n    onSave: async (data) => {\n      // Apply changes\n    },\n  });\n\n  // React to form changes\n  useEffect(() => {\n    if (state.hasSourceChanged) {\n      // Source was updated while user was editing\n      alert('Configuration changed elsewhere. Merge or discard?');\n    }\n  }, [state.hasSourceChanged]);\n\n  return (\n    <form onSubmit={form.handleSubmit(() => actions.startSave())}>\n      {/* Form fields */}\n\n      {/* Show changed fields */}\n      {changedFields.length > 0 && (\n        <p>Changed: {changedFields.join(', ')}</p>\n      )}\n\n      {/* Show validation errors */}\n      {state.validation.errors.map((err) => (\n        <Alert key={err.code}>{err.message}</Alert>\n      ))}\n\n      {/* Conflict resolution */}\n      {state.error && (\n        <ConflictDialog\n          onMerge={() => actions.mergeSourceChanges(customMerger)}\n          onDiscard={() => actions.discardChanges()}\n        />\n      )}\n\n      <button type=\"submit\" disabled={!canSave}>\n        Save\n      </button>\n    </form>\n  );\n}\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"change-set-ordering",children:"Change Set Ordering"}),"\n",(0,i.jsx)(n.p,{children:"Change sets use dependency graphs to determine application order."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import { topologicalSort, getParallelApplicableNodes } from '@nasnet/core/utils';\n\n// Items with dependencies\nconst changeSet = [\n  { id: 'bridge', dependencies: [] },       // No dependencies - apply first\n  { id: 'dhcp', dependencies: ['bridge'] }, // Depends on bridge\n  { id: 'firewall', dependencies: ['bridge'] }, // Also depends on bridge\n];\n\n// Compute apply order\nconst sorted = topologicalSort(changeSet);\nif (sorted.success) {\n  console.log('Apply order:', sorted.sortedIds);\n  // ['bridge', 'dhcp', 'firewall'] or ['bridge', 'firewall', 'dhcp']\n}\n\n// Find nodes that can apply in parallel\nconst applied = new Set(['bridge']);\nconst parallel = getParallelApplicableNodes(changeSet, applied);\nconsole.log('Can apply in parallel:', parallel);\n// ['dhcp', 'firewall']\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"practical-examples",children:"Practical Examples"}),"\n",(0,i.jsx)(n.h3,{id:"example-1-create-lan-network-with-dhcp",children:"Example 1: Create LAN Network with DHCP"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import { ChangeSet, ChangeSetItem, ChangeOperation } from '@nasnet/core/types';\n\nconst lanSetup: ChangeSet = {\n  id: 'cs-lan-setup-001',\n  name: 'Create LAN Network',\n  routerId: 'router-01',\n  status: 'DRAFT',\n\n  items: [\n    // Step 1: Create bridge (no dependencies)\n    {\n      id: 'bridge-1',\n      resourceType: 'network.bridge',\n      operation: 'CREATE' as ChangeOperation,\n      configuration: {\n        name: 'br-lan',\n        mtu: 1500,\n      },\n      dependencies: [],\n    },\n\n    // Step 2: Add interfaces to bridge (depends on bridge)\n    {\n      id: 'bridge-port-eth1',\n      resourceType: 'network.bridge-port',\n      operation: 'CREATE' as ChangeOperation,\n      configuration: {\n        interface: 'ether1',\n        bridge: 'br-lan',\n      },\n      dependencies: ['bridge-1'],\n    },\n\n    // Step 3: Create DHCP server (depends on bridge)\n    {\n      id: 'dhcp-1',\n      resourceType: 'dhcp.server',\n      operation: 'CREATE' as ChangeOperation,\n      configuration: {\n        interface: 'br-lan',\n        addressPool: '192.168.1.100-200',\n        gateway: '192.168.1.1',\n        dns1: '8.8.8.8',\n      },\n      dependencies: ['bridge-1'],\n    },\n\n    // Step 4: Create firewall rule (depends on bridge existing)\n    {\n      id: 'firewall-1',\n      resourceType: 'firewall.nat',\n      operation: 'CREATE' as ChangeOperation,\n      configuration: {\n        chain: 'dstnat',\n        'in-interface': 'br-lan',\n        action: 'accept',\n      },\n      dependencies: ['bridge-1'],\n    },\n  ],\n\n  // Apply order computed from dependencies:\n  // 1. bridge-1 (no deps)\n  // 2. bridge-port-eth1, dhcp-1, firewall-1 (all depend on bridge-1, can run parallel)\n};\n"})}),"\n",(0,i.jsx)(n.h3,{id:"example-2-update-with-conflict-detection",children:"Example 2: Update with Conflict Detection"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"function updateWireGuardServer(server: Resource, updates: Partial<Resource>) {\n  // Check if configuration drifted\n  if (server.deployment?.drift) {\n    const drift = server.deployment.drift;\n\n    console.error('Configuration drift detected:');\n    drift.driftedFields.forEach((field) => {\n      console.error(\n        `  ${field.path}: expected ${field.expected}, actual ${field.actual}`\n      );\n    });\n\n    // Suggest resolution\n    switch (drift.suggestedAction) {\n      case 'REAPPLY':\n        console.log('\u2192 Re-apply configuration to router');\n        break;\n      case 'ACCEPT':\n        console.log('\u2192 Accept router version');\n        break;\n      case 'REVIEW':\n        console.log('\u2192 Manual review required');\n        break;\n    }\n  }\n\n  // Check dependencies\n  server.relationships?.dependents?.forEach((dependent) => {\n    console.log(\n      `Warning: ${dependent.id} depends on this resource`\n    );\n  });\n\n  // Perform update with full validation\n  const updated: Resource = {\n    ...server,\n    configuration: { ...server.configuration, ...updates },\n    metadata: {\n      ...server.metadata,\n      updatedAt: new Date().toISOString(),\n      version: (server.metadata?.version || 0) + 1,\n    },\n  };\n\n  return updated;\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"example-3-optimistic-updates-in-react",children:"Example 3: Optimistic Updates in React"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import { useApolloClient } from '@apollo/client';\n\nfunction useOptimisticResourceUpdate() {\n  const client = useApolloClient();\n\n  async function updateResource(\n    resourceId: string,\n    updates: Partial<Resource>\n  ) {\n    // Read current state (Layer 1: Source)\n    const current = client.cache.readQuery({\n      query: GET_RESOURCE,\n      variables: { id: resourceId },\n    });\n\n    // Create optimistic version (combine Layers 1 + 4)\n    const optimistic: Resource = {\n      ...current,\n      configuration: { ...current.configuration, ...updates },\n      metadata: {\n        ...current.metadata,\n        updatedAt: new Date().toISOString(),\n      },\n      // Clear old validation since we're updating\n      validation: null,\n    };\n\n    // Update cache immediately (optimistic)\n    client.cache.writeQuery({\n      query: GET_RESOURCE,\n      variables: { id: resourceId },\n      data: optimistic,\n    });\n\n    try {\n      // Actually apply to router\n      const result = await client.mutate({\n        mutation: UPDATE_RESOURCE,\n        variables: { id: resourceId, input: updates },\n      });\n\n      // Update cache with confirmed state (Layer 3: Deployment)\n      client.cache.writeQuery({\n        query: GET_RESOURCE,\n        variables: { id: resourceId },\n        data: result.data.updateResource,\n      });\n    } catch (error) {\n      // Rollback on error\n      client.cache.writeQuery({\n        query: GET_RESOURCE,\n        variables: { id: resourceId },\n        data: current,\n      });\n      throw error;\n    }\n  }\n\n  return { updateResource };\n}\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"see-also",children:"See Also"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"types.md"})," - Complete type reference for all resource interfaces"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"validation-pipeline.md"})," - 7-stage validation pipeline details"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"change-set-operations.md"})," - Atomic multi-resource operations"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"forms.md"})," - React Hook Form integration patterns"]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},71184:(e,n,r)=>{r.d(n,{R:()=>a,x:()=>o});var t=r(14041);const i={},s=t.createContext(i);function a(e){const n=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);