"use strict";(globalThis.webpackChunk_nas_net_docs=globalThis.webpackChunk_nas_net_docs||[]).push([[7345],{46830:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>l,contentTitle:()=>d,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"feature-modules/diagnostics","title":"Diagnostics Feature Module","description":"Source: libs/features/diagnostics/src/","source":"@site/../connect/docs/feature-modules/diagnostics.md","sourceDirName":"feature-modules","slug":"/feature-modules/diagnostics","permalink":"/docs/frontend/feature-modules/diagnostics","draft":false,"unlisted":false,"editUrl":"https://github.com/nasnet-community/nasnet-panel/tree/main/../connect/docs/feature-modules/diagnostics.md","tags":[],"version":"current","frontMatter":{},"sidebar":"sidebar","previous":{"title":"Dashboard Feature","permalink":"/docs/frontend/feature-modules/dashboard"},"next":{"title":"Firewall Feature","permalink":"/docs/frontend/feature-modules/firewall"}}');var r=n(31085),t=n(71184);const o={},d="Diagnostics Feature Module",l={},c=[{value:"Public API",id:"public-api",level:2},{value:"DNS Lookup Tool",id:"dns-lookup-tool",level:2},{value:"How It Works",id:"how-it-works",level:3},{value:"Query Options",id:"query-options",level:3},{value:"Validation Schema",id:"validation-schema",level:3},{value:"Components",id:"components",level:3},{value:"GraphQL Operation",id:"graphql-operation",level:3},{value:"Ping Tool",id:"ping-tool",level:2},{value:"How It Works",id:"how-it-works-1",level:3},{value:"Platform Behavior",id:"platform-behavior",level:3},{value:"Latency Color Coding",id:"latency-color-coding",level:3},{value:"Configuration Options",id:"configuration-options",level:3},{value:"XState Machine",id:"xstate-machine",level:3},{value:"Components",id:"components-1",level:3},{value:"GraphQL Operation",id:"graphql-operation-1",level:3},{value:"Traceroute Tool",id:"traceroute-tool",level:2},{value:"How It Works",id:"how-it-works-2",level:3},{value:"Subscription Flow",id:"subscription-flow",level:3},{value:"Latency Color Coding",id:"latency-color-coding-1",level:3},{value:"Components",id:"components-2",level:3},{value:"Types",id:"types",level:3},{value:"GraphQL",id:"graphql",level:3},{value:"Troubleshooting Wizard",id:"troubleshooting-wizard",level:2},{value:"Five Diagnostic Steps",id:"five-diagnostic-steps",level:3},{value:"XState Machine",id:"xstate-machine-1",level:3},{value:"Fix Registry",id:"fix-registry",level:3},{value:"Component Props",id:"component-props",level:3},{value:"Platform Presenters",id:"platform-presenters",level:3},{value:"Sub-Components",id:"sub-components",level:3},{value:"Route Lookup Tool",id:"route-lookup-tool",level:2},{value:"Device Scan Tool",id:"device-scan-tool",level:2},{value:"Utility Functions",id:"utility-functions",level:2},{value:"Network Detection",id:"network-detection",level:3},{value:"ISP Detection",id:"isp-detection",level:3},{value:"Internationalization",id:"internationalization",level:2},{value:"See Also",id:"see-also",level:2}];function a(e){const s={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.header,{children:(0,r.jsx)(s.h1,{id:"diagnostics-feature-module",children:"Diagnostics Feature Module"})}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Source:"})," ",(0,r.jsx)(s.code,{children:"libs/features/diagnostics/src/"})]}),"\n",(0,r.jsx)(s.p,{children:"The diagnostics feature provides a set of network troubleshooting tools: DNS lookup, Ping,\nTraceroute, Route lookup, Device scan, and a guided Troubleshooting Wizard. Every tool follows the\nHeadless + Platform Presenters pattern \u2014 a platform-agnostic hook contains the business logic while\nseparate Mobile and Desktop presenter components handle rendering."}),"\n",(0,r.jsx)(s.h2,{id:"public-api",children:"Public API"}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"File:"})," ",(0,r.jsx)(s.code,{children:"libs/features/diagnostics/src/index.ts"})]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-typescript",children:"// Components\nexport { DnsLookupTool, PingTool, TracerouteTool, TroubleshootWizard, DeviceScanTool } from '...';\n\n// Hooks\nexport { useTraceroute, useTroubleshootWizard } from '...';\n\n// Types\nexport type { DiagnosticStep, DiagnosticResult, FixSuggestion, ISPInfo, TroubleshootContext } from '...';\n\n// Utilities\nexport { detectWanInterface, detectGateway, detectISP, getWanIpForISPDetection } from '...';\n\n// GraphQL operations\nexport { RUN_TRACEROUTE, TRACEROUTE_PROGRESS_SUBSCRIPTION, ... } from '...';\n"})}),"\n",(0,r.jsx)(s.h2,{id:"dns-lookup-tool",children:"DNS Lookup Tool"}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Entry point:"})," ",(0,r.jsx)(s.code,{children:"libs/features/diagnostics/src/components/DnsLookupTool/DnsLookupTool.tsx"})]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Route:"})," ",(0,r.jsx)(s.code,{children:"apps/connect/src/routes/dashboard.dns-lookup.tsx"})," \u2192 ",(0,r.jsx)(s.code,{children:"/dashboard/dns-lookup"})]}),"\n",(0,r.jsx)(s.h3,{id:"how-it-works",children:"How It Works"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:["User opens ",(0,r.jsx)(s.code,{children:"/dashboard/dns-lookup"})," \u2014 the route reads ",(0,r.jsx)(s.code,{children:"activeRouterId"})," from ",(0,r.jsx)(s.code,{children:"useConnectionStore"}),';\nif no router is selected, shows an error state with a "Return to Dashboard" button.']}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"DnsLookupTool"})," renders the platform-appropriate presenter via ",(0,r.jsx)(s.code,{children:"usePlatform()"}),":","\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Mobile presenter: stacked single-column layout"}),"\n",(0,r.jsx)(s.li,{children:"Desktop presenter: side-by-side layout with comparison panel"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["The ",(0,r.jsx)(s.code,{children:"useDnsLookup"})," hook manages query state, request submission, and result parsing."]}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"query-options",children:"Query Options"}),"\n",(0,r.jsxs)(s.p,{children:["Supported DNS record types: ",(0,r.jsx)(s.code,{children:"A"}),", ",(0,r.jsx)(s.code,{children:"AAAA"}),", ",(0,r.jsx)(s.code,{children:"MX"}),", ",(0,r.jsx)(s.code,{children:"TXT"}),", ",(0,r.jsx)(s.code,{children:"CNAME"}),", ",(0,r.jsx)(s.code,{children:"NS"}),", ",(0,r.jsx)(s.code,{children:"PTR"}),", ",(0,r.jsx)(s.code,{children:"SOA"}),", ",(0,r.jsx)(s.code,{children:"SRV"})]}),"\n",(0,r.jsx)(s.p,{children:"Multiple DNS servers can be queried simultaneously for comparison. Results show query time per\nserver."}),"\n",(0,r.jsx)(s.h3,{id:"validation-schema",children:"Validation Schema"}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"File:"})," ",(0,r.jsx)(s.code,{children:"libs/features/diagnostics/src/components/DnsLookupTool/dnsLookup.schema.ts"})]}),"\n",(0,r.jsx)(s.p,{children:"Zod schema validates:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"hostname"})," \u2014 non-empty domain name string"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"recordType"})," \u2014 one of the supported record types"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"servers"})," \u2014 optional array of DNS server IP addresses"]}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"components",children:"Components"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Component"}),(0,r.jsx)(s.th,{children:"Purpose"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"DnsLookupTool"})}),(0,r.jsx)(s.td,{children:"Platform router (Mobile/Desktop)"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"DnsLookupToolDesktop"})}),(0,r.jsx)(s.td,{children:"Side-by-side input + results layout"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"DnsLookupToolMobile"})}),(0,r.jsx)(s.td,{children:"Stacked layout with expandable results"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"DnsResults"})}),(0,r.jsx)(s.td,{children:"Tabular display of DNS records"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"DnsServerComparison"})}),(0,r.jsx)(s.td,{children:"Side-by-side comparison of multiple servers"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"DnsError"})}),(0,r.jsx)(s.td,{children:"Error state display"})]})]})]}),"\n",(0,r.jsx)(s.h3,{id:"graphql-operation",children:"GraphQL Operation"}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"File:"})," ",(0,r.jsx)(s.code,{children:"libs/features/diagnostics/src/components/DnsLookupTool/dnsLookup.graphql.ts"})]}),"\n",(0,r.jsxs)(s.p,{children:["Executes a DNS lookup query against the router's DNS infrastructure. The ",(0,r.jsx)(s.code,{children:"deviceId"})," identifies which\nrouter to use as the DNS resolver."]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"ping-tool",children:"Ping Tool"}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Entry point:"})," ",(0,r.jsx)(s.code,{children:"libs/features/diagnostics/src/components/PingTool/PingTool.tsx"})]}),"\n",(0,r.jsx)(s.h3,{id:"how-it-works-1",children:"How It Works"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsx)(s.li,{children:"User enters a target hostname or IP address."}),"\n",(0,r.jsxs)(s.li,{children:["The ",(0,r.jsx)(s.code,{children:"usePing"})," hook manages an XState machine (",(0,r.jsx)(s.code,{children:"ping-machine.ts"}),") that sequences ping packets."]}),"\n",(0,r.jsx)(s.li,{children:"Results stream in real time with virtualization support for 100+ results."}),"\n",(0,r.jsx)(s.li,{children:"On completion, statistics (min/avg/max latency, packet loss) are calculated."}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"platform-behavior",children:"Platform Behavior"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Platform"}),(0,r.jsx)(s.th,{children:"Layout"}),(0,r.jsx)(s.th,{children:"Notes"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsxs)(s.td,{children:["Mobile (",(0,r.jsx)(s.code,{children:"<640px"}),")"]}),(0,r.jsx)(s.td,{children:"Stacked single column"}),(0,r.jsx)(s.td,{children:"Bottom sheet for results, 44px touch targets"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsxs)(s.td,{children:["Desktop (",(0,r.jsx)(s.code,{children:">=640px"}),")"]}),(0,r.jsx)(s.td,{children:"Side-by-side"}),(0,r.jsx)(s.td,{children:"Dense data display with latency graph"})]})]})]}),"\n",(0,r.jsx)(s.h3,{id:"latency-color-coding",children:"Latency Color Coding"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"< 100ms  \u2192 green (success)\n< 200ms  \u2192 amber (warning)\n>= 200ms \u2192 red (error)\n"})}),"\n",(0,r.jsx)(s.h3,{id:"configuration-options",children:"Configuration Options"}),"\n",(0,r.jsxs)(s.p,{children:["From ",(0,r.jsx)(s.code,{children:"libs/features/diagnostics/src/components/PingTool/ping.schema.ts"}),":"]}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"target"})," \u2014 hostname or IP"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"count"})," \u2014 number of packets (default: 4)"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"size"})," \u2014 packet size in bytes"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"timeout"})," \u2014 per-packet timeout"]}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"xstate-machine",children:"XState Machine"}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"File:"})," ",(0,r.jsx)(s.code,{children:"libs/features/diagnostics/src/machines/ping-machine.ts"})]}),"\n",(0,r.jsxs)(s.p,{children:["States: ",(0,r.jsx)(s.code,{children:"idle"})," \u2192 ",(0,r.jsx)(s.code,{children:"running"})," \u2192 ",(0,r.jsx)(s.code,{children:"completed"})," | ",(0,r.jsx)(s.code,{children:"error"})]}),"\n",(0,r.jsxs)(s.p,{children:["Supports cancellation from the ",(0,r.jsx)(s.code,{children:"running"})," state via a ",(0,r.jsx)(s.code,{children:"CANCEL"})," event."]}),"\n",(0,r.jsx)(s.h3,{id:"components-1",children:"Components"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Component"}),(0,r.jsx)(s.th,{children:"Purpose"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"PingTool"})}),(0,r.jsx)(s.td,{children:"Platform router"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"PingToolDesktop"})}),(0,r.jsx)(s.td,{children:"Dense side-by-side layout"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"PingToolMobile"})}),(0,r.jsx)(s.td,{children:"Touch-first stacked layout"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"PingResults"})}),(0,r.jsx)(s.td,{children:"Live result list with virtualization"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"PingStatistics"})}),(0,r.jsx)(s.td,{children:"Min/avg/max/loss summary"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"LatencyGraph"})}),(0,r.jsx)(s.td,{children:"Bar/line chart of per-packet latency"})]})]})]}),"\n",(0,r.jsx)(s.h3,{id:"graphql-operation-1",children:"GraphQL Operation"}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"File:"})," ",(0,r.jsx)(s.code,{children:"libs/features/diagnostics/src/components/PingTool/ping.graphql.ts"})]}),"\n",(0,r.jsx)(s.p,{children:"Mutation to initiate ping and subscription to stream results incrementally."}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"traceroute-tool",children:"Traceroute Tool"}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Entry point:"})," ",(0,r.jsx)(s.code,{children:"libs/features/diagnostics/src/components/TracerouteTool/TracerouteTool.tsx"})]}),"\n",(0,r.jsx)(s.h3,{id:"how-it-works-2",children:"How It Works"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsx)(s.li,{children:"User submits a target host."}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"useTraceroute"})," hook sends ",(0,r.jsx)(s.code,{children:"RUN_TRACEROUTE"})," mutation and subscribes to\n",(0,r.jsx)(s.code,{children:"TRACEROUTE_PROGRESS_SUBSCRIPTION"}),"."]}),"\n",(0,r.jsx)(s.li,{children:"Hops are discovered progressively and rendered as they arrive."}),"\n",(0,r.jsx)(s.li,{children:"On completion (or max TTL reached), the route shows total hops and round-trip summary."}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"subscription-flow",children:"Subscription Flow"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"User submits target\n      \u2193\nRUN_TRACEROUTE mutation (returns traceId)\n      \u2193\nSubscribe to TRACEROUTE_PROGRESS_SUBSCRIPTION(traceId)\n      \u2193\nHops arrive incrementally \u2192 rendered in TracerouteHopsList\n      \u2193\nSubscription completes \u2192 final summary displayed\n"})}),"\n",(0,r.jsx)(s.h3,{id:"latency-color-coding-1",children:"Latency Color Coding"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"< 50ms   \u2192 green\n50-150ms \u2192 yellow\n> 150ms  \u2192 red\n"})}),"\n",(0,r.jsx)(s.h3,{id:"components-2",children:"Components"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Component"}),(0,r.jsx)(s.th,{children:"Purpose"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"TracerouteTool"})}),(0,r.jsx)(s.td,{children:"Platform router (Mobile/Desktop)"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"TracerouteToolDesktop"})}),(0,r.jsx)(s.td,{children:"Real-time hop visualization side-by-side"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"TracerouteToolMobile"})}),(0,r.jsx)(s.td,{children:"Progressive stacked hop list"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"TracerouteHopsList"})}),(0,r.jsx)(s.td,{children:"Renders each TTL hop row with latency"})]})]})]}),"\n",(0,r.jsx)(s.h3,{id:"types",children:"Types"}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"File:"})," ",(0,r.jsx)(s.code,{children:"libs/features/diagnostics/src/components/TracerouteTool/TracerouteTool.types.ts"})]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-typescript",children:"interface TracerouteToolProps {\n  routerId: string;\n  onComplete?: (result: TracerouteResult) => void;\n  onError?: (err: Error) => void;\n  onHopDiscovered?: (hop: TracerouteHop) => void;\n}\n"})}),"\n",(0,r.jsx)(s.h3,{id:"graphql",children:"GraphQL"}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"File:"})," ",(0,r.jsx)(s.code,{children:"libs/features/diagnostics/src/graphql/traceroute.graphql.ts"})]}),"\n",(0,r.jsxs)(s.p,{children:["Exported: ",(0,r.jsx)(s.code,{children:"RUN_TRACEROUTE"}),", ",(0,r.jsx)(s.code,{children:"CANCEL_TRACEROUTE"}),", ",(0,r.jsx)(s.code,{children:"TRACEROUTE_PROGRESS_SUBSCRIPTION"}),",\n",(0,r.jsx)(s.code,{children:"HOP_PROBE_FRAGMENT"}),", ",(0,r.jsx)(s.code,{children:"TRACEROUTE_HOP_FRAGMENT"}),", ",(0,r.jsx)(s.code,{children:"TRACEROUTE_RESULT_FRAGMENT"})]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"troubleshooting-wizard",children:"Troubleshooting Wizard"}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Entry point:"}),"\n",(0,r.jsx)(s.code,{children:"libs/features/diagnostics/src/components/TroubleshootWizard/TroubleshootWizard.tsx"})]}),"\n",(0,r.jsx)(s.p,{children:"The wizard automates a five-step connectivity diagnostic sequence and offers targeted fix\nsuggestions for each failing step."}),"\n",(0,r.jsx)(s.h3,{id:"five-diagnostic-steps",children:"Five Diagnostic Steps"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Step ID"}),(0,r.jsx)(s.th,{children:"Name"}),(0,r.jsx)(s.th,{children:"What it checks"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"wan"})}),(0,r.jsx)(s.td,{children:"WAN Interface"}),(0,r.jsx)(s.td,{children:"Physical connection on WAN port"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"gateway"})}),(0,r.jsx)(s.td,{children:"Gateway"}),(0,r.jsx)(s.td,{children:"ICMP ping to default gateway"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"internet"})}),(0,r.jsx)(s.td,{children:"Internet"}),(0,r.jsx)(s.td,{children:"ICMP ping to external server (e.g., 8.8.8.8)"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"dns"})}),(0,r.jsx)(s.td,{children:"DNS"}),(0,r.jsx)(s.td,{children:"Name resolution test"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"nat"})}),(0,r.jsx)(s.td,{children:"NAT"}),(0,r.jsx)(s.td,{children:"Masquerade rule presence"})]})]})]}),"\n",(0,r.jsx)(s.h3,{id:"xstate-machine-1",children:"XState Machine"}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"File:"})," ",(0,r.jsx)(s.code,{children:"libs/features/diagnostics/src/machines/troubleshoot-machine.ts"})]}),"\n",(0,r.jsxs)(s.p,{children:["Created via ",(0,r.jsx)(s.code,{children:"createTroubleshootMachine(routerId)"}),". Each wizard instance gets its own isolated\nmachine."]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"State flow:"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"idle\n  \u2192 initializing         (detect WAN interface + gateway)\n  \u2192 runningDiagnostic\n      \u251c\u2500\u2500 executingStep  (runs diagnostic via backend mutation)\n      \u251c\u2500\u2500 stepComplete   (evaluates pass/fail)\n      \u251c\u2500\u2500 awaitingFixDecision  (if failed and fix available)\n      \u251c\u2500\u2500 applyingFix    (sends fix mutation)\n      \u251c\u2500\u2500 verifyingFix   (re-runs the same step)\n      \u2514\u2500\u2500 nextStep       (advances currentStepIndex)\n  \u2192 completed\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Events:"})}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Event"}),(0,r.jsx)(s.th,{children:"Valid from"}),(0,r.jsx)(s.th,{children:"Effect"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"START"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"idle"})}),(0,r.jsx)(s.td,{children:"Begin initialization"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"APPLY_FIX"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"awaitingFixDecision"})}),(0,r.jsx)(s.td,{children:"Execute the suggested fix"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"SKIP_FIX"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"awaitingFixDecision"})}),(0,r.jsx)(s.td,{children:"Advance to next step"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"RESTART"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"completed"})}),(0,r.jsxs)(s.td,{children:["Reset all steps to ",(0,r.jsx)(s.code,{children:"pending"})]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"CANCEL"})}),(0,r.jsx)(s.td,{children:"any"}),(0,r.jsxs)(s.td,{children:["Return to ",(0,r.jsx)(s.code,{children:"idle"})]})]})]})]}),"\n",(0,r.jsx)(s.h3,{id:"fix-registry",children:"Fix Registry"}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"File:"})," ",(0,r.jsx)(s.code,{children:"libs/features/diagnostics/src/constants/fix-registry.ts"})]}),"\n",(0,r.jsxs)(s.p,{children:["Maps step IDs to ",(0,r.jsx)(s.code,{children:"FixSuggestion"})," objects. ",(0,r.jsx)(s.code,{children:"getFix(stepId, result)"})," returns the appropriate fix for a\nfailed step, or ",(0,r.jsx)(s.code,{children:"undefined"})," if no fix is known. Each fix includes an ",(0,r.jsx)(s.code,{children:"issueCode"})," tracked in\n",(0,r.jsx)(s.code,{children:"context.appliedFixes"}),"."]}),"\n",(0,r.jsx)(s.h3,{id:"component-props",children:"Component Props"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-typescript",children:"interface TroubleshootWizardProps {\n  routerId: string; // Router UUID to diagnose\n  autoStart?: boolean; // Start on mount (default: false)\n  onClose?: () => void; // Called when wizard is dismissed\n  ispInfo?: ISPInfo; // ISP contact info for suggestions\n  className?: string;\n}\n"})}),"\n",(0,r.jsx)(s.h3,{id:"platform-presenters",children:"Platform Presenters"}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.code,{children:"TroubleshootWizard"})," renders CSS-hidden presenters for both platforms simultaneously (using\n",(0,r.jsx)(s.code,{children:"hidden lg:block"})," / ",(0,r.jsx)(s.code,{children:"lg:hidden"}),"), avoiding a runtime check on every render:"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-tsx",children:'<div className="hidden lg:block">\n  <TroubleshootWizardDesktop {...} />\n</div>\n<div className="lg:hidden">\n  <TroubleshootWizardMobile {...} />\n</div>\n'})}),"\n",(0,r.jsx)(s.h3,{id:"sub-components",children:"Sub-Components"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Component"}),(0,r.jsx)(s.th,{children:"Purpose"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"DiagnosticStep"})}),(0,r.jsx)(s.td,{children:"Renders a single step row (pending/running/passed/failed)"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"FixSuggestion"})}),(0,r.jsx)(s.td,{children:"Shows actionable fix card with apply/skip buttons"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"WizardSummary"})}),(0,r.jsx)(s.td,{children:"Final results card after all steps complete"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"StepAnnouncer"})}),(0,r.jsx)(s.td,{children:"ARIA live region for screen-reader step announcements"})]})]})]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"route-lookup-tool",children:"Route Lookup Tool"}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Entry point:"})," ",(0,r.jsx)(s.code,{children:"libs/features/diagnostics/src/components/RouteLookupTool/"})]}),"\n",(0,r.jsxs)(s.p,{children:["Status: Schema and test utilities are present but the component itself is not yet exported\n(commented out in ",(0,r.jsx)(s.code,{children:"index.ts"}),"). Validates a destination IP or network against the router's routing\ntable."]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"device-scan-tool",children:"Device Scan Tool"}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Entry point:"})," ",(0,r.jsx)(s.code,{children:"libs/features/diagnostics/src/components/DeviceScan/DeviceScanTool.tsx"})]}),"\n",(0,r.jsx)(s.p,{children:"Discovers devices on the local network via ARP scan. Features:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"DeviceDiscoveryTable"})," \u2014 tabular display of discovered hosts with MAC vendor lookup"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"DeviceDetailPanel"})," \u2014 side panel with device details"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"ScanSummary"})," \u2014 scan completion stats"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"DeviceScanDesktop"})," / ",(0,r.jsx)(s.code,{children:"DeviceScanMobile"})," \u2014 platform presenters"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"useDeviceScan"})," hook \u2014 manages scan lifecycle, progress, and result state"]}),"\n"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"utility-functions",children:"Utility Functions"}),"\n",(0,r.jsx)(s.h3,{id:"network-detection",children:"Network Detection"}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"File:"})," ",(0,r.jsx)(s.code,{children:"libs/features/diagnostics/src/utils/network-detection.ts"})]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-typescript",children:"detectWanInterface(routerId: string): Promise<string>\n// Identifies the WAN interface name from the router's routing table\n\ndetectGateway(routerId: string, wanInterface: string): Promise<string | null>\n// Finds the default gateway IP for a given WAN interface\n"})}),"\n",(0,r.jsxs)(s.p,{children:["Used by ",(0,r.jsx)(s.code,{children:"troubleshoot-machine.ts"})," during the ",(0,r.jsx)(s.code,{children:"initializing"})," state."]}),"\n",(0,r.jsx)(s.h3,{id:"isp-detection",children:"ISP Detection"}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"File:"})," ",(0,r.jsx)(s.code,{children:"libs/features/diagnostics/src/utils/isp-detection.ts"})]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-typescript",children:"detectISP(ipAddress: string): Promise<ISPInfo | null>\ngetWanIpForISPDetection(routerId: string): Promise<string | null>\n"})}),"\n",(0,r.jsxs)(s.p,{children:["Used to populate ",(0,r.jsx)(s.code,{children:"ispInfo"})," in the ",(0,r.jsx)(s.code,{children:"TroubleshootWizard"})," with contact details."]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"internationalization",children:"Internationalization"}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"File:"})," ",(0,r.jsx)(s.code,{children:"libs/features/diagnostics/src/i18n/troubleshoot-messages.ts"})]}),"\n",(0,r.jsxs)(s.p,{children:["Exports ",(0,r.jsx)(s.code,{children:"TROUBLESHOOT_MESSAGES"})," \u2014 a typed map of step IDs and fix codes to user-readable strings.\nUsed by the wizard presenters to display step descriptions, fix suggestions, and ISP contact\nprompts."]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"see-also",children:"See Also"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"../data-fetching/graphql-hooks.md"})," \u2014 GraphQL operations for each tool"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"../ui-system/platform-presenters.md"})," \u2014 Headless + Platform Presenters pattern (ADR-018)"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"../cross-cutting-features/service-marketplace.md"})," \u2014 Service-level diagnostics in\n",(0,r.jsx)(s.code,{children:"DiagnosticsPanel"})]}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},71184:(e,s,n)=>{n.d(s,{R:()=>o,x:()=>d});var i=n(14041);const r={},t=i.createContext(r);function o(e){const s=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function d(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(t.Provider,{value:s},e.children)}}}]);