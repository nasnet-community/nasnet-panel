"use strict";(globalThis.webpackChunk_nas_net_docs=globalThis.webpackChunk_nas_net_docs||[]).push([[82220],{19977:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>p,frontMatter:()=>l,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"feature-vpn","title":"VPN Feature Module Documentation","description":"Overview","source":"@site/../../libs/features/docs/feature-vpn.md","sourceDirName":".","slug":"/feature-vpn","permalink":"/docs/features/feature-vpn","draft":false,"unlisted":false,"editUrl":"https://github.com/nasnet-community/nasnet-panel/tree/main/../../libs/features/docs/feature-vpn.md","tags":[],"version":"current","frontMatter":{},"sidebar":"sidebar","previous":{"title":"Feature Services Module (libs/features/services)","permalink":"/docs/features/feature-services"},"next":{"title":"Feature Library Documentation","permalink":"/docs/features/"}}');var i=r(31085),t=r(71184);const l={},c="VPN Feature Module Documentation",o={},d=[{value:"Overview",id:"overview",level:2},{value:"Module Architecture",id:"module-architecture",level:2},{value:"Page Hierarchy",id:"page-hierarchy",level:3},{value:"Component Composition",id:"component-composition",level:3},{value:"Supported VPN Protocols",id:"supported-vpn-protocols",level:2},{value:"Protocol Implementation Details",id:"protocol-implementation-details",level:3},{value:"Route Structure",id:"route-structure",level:2},{value:"Page Components",id:"page-components",level:2},{value:"VPNDashboard",id:"vpndashboard",level:3},{value:"VPNPage",id:"vpnpage",level:3},{value:"VPNClientsPage",id:"vpnclientspage",level:3},{value:"VPNServersPage",id:"vpnserverspage",level:3},{value:"Pattern Components (Layer 2)",id:"pattern-components-layer-2",level:2},{value:"VPNClientCard",id:"vpnclientcard",level:3},{value:"VPNServerCard",id:"vpnservercard",level:3},{value:"VPNStatusHero",id:"vpnstatushero",level:3},{value:"VPNTypeSection",id:"vpntypesection",level:3},{value:"VPNProtocolStatsCard",id:"vpnprotocolstatscard",level:3},{value:"VPNNavigationCard",id:"vpnnavigationcard",level:3},{value:"VPNIssuesList",id:"vpnissueslist",level:3},{value:"API Layer",id:"api-layer",level:2},{value:"Query Hooks (Data Fetching)",id:"query-hooks-data-fetching",level:3},{value:"Dashboard Stats",id:"dashboard-stats",level:4},{value:"WireGuard Queries",id:"wireguard-queries",level:4},{value:"OpenVPN Queries",id:"openvpn-queries",level:4},{value:"L2TP Queries",id:"l2tp-queries",level:4},{value:"PPTP Queries",id:"pptp-queries",level:4},{value:"SSTP Queries",id:"sstp-queries",level:4},{value:"IKEv2/IPsec Queries",id:"ikev2ipsec-queries",level:4},{value:"PPP Queries (Shared by L2TP, PPTP, SSTP)",id:"ppp-queries-shared-by-l2tp-pptp-sstp",level:4},{value:"Mutation Hooks (Write Operations)",id:"mutation-hooks-write-operations",level:3},{value:"useToggleVPNInterface",id:"usetogglevpninterface",level:4},{value:"useCreateVPNInterface",id:"usecreatevpninterface",level:4},{value:"useUpdateVPNInterface",id:"useupdatevpninterface",level:4},{value:"useDeleteVPNInterface",id:"usedeletevpninterface",level:4},{value:"Query Keys",id:"query-keys",level:3},{value:"State Management",id:"state-management",level:2},{value:"Apollo Client / TanStack Query",id:"apollo-client--tanstack-query",level:3},{value:"Zustand (UI State)",id:"zustand-ui-state",level:3},{value:"Future: XState Integration",id:"future-xstate-integration",level:3},{value:"Backend Integration",id:"backend-integration",level:2},{value:"REST Endpoints (rosproxy)",id:"rest-endpoints-rosproxy",level:3},{value:"Backend Provisioning",id:"backend-provisioning",level:3},{value:"Cross-References",id:"cross-references",level:2},{value:"Implementation Checklist",id:"implementation-checklist",level:2}];function a(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",input:"input",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"vpn-feature-module-documentation",children:"VPN Feature Module Documentation"})}),"\n",(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsx)(n.p,{children:"The VPN feature in NasNetConnect provides comprehensive multi-protocol VPN management for MikroTik routers. It supports six major VPN protocols (WireGuard, OpenVPN, L2TP, PPTP, SSTP, and IKEv2/IPsec) with both client and server configurations."}),"\n",(0,i.jsx)(n.p,{children:"This module implements:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Real-time VPN infrastructure monitoring via a dashboard"}),"\n",(0,i.jsx)(n.li,{children:"Protocol-specific client and server management pages"}),"\n",(0,i.jsx)(n.li,{children:"Multi-protocol status and statistics aggregation"}),"\n",(0,i.jsx)(n.li,{children:"Support for active connection tracking and traffic statistics"}),"\n",(0,i.jsx)(n.li,{children:"Responsive design across mobile, tablet, and desktop platforms"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"module-architecture",children:"Module Architecture"}),"\n",(0,i.jsx)(n.h3,{id:"page-hierarchy",children:"Page Hierarchy"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"VPNDashboard (overview)\n\u251c\u2500\u2500 VPNStatusHero (health indicator)\n\u251c\u2500\u2500 VPNNavigationCard (server/client navigation)\n\u251c\u2500\u2500 VPNProtocolStatsCard (6 cards, one per protocol)\n\u2514\u2500\u2500 VPNIssuesList (warnings/errors)\n\nVPNPage (protocol viewer)\n\u251c\u2500\u2500 WireGuardCard (primary protocol)\n\u2514\u2500\u2500 VPNTypeSection (L2TP, PPTP, SSTP - read-only)\n\nVPNClientsPage (client management)\n\u251c\u2500\u2500 VPNTypeSection \xd7 6 (one per protocol)\n\u2502   \u2514\u2500\u2500 VPNClientCard[] (individual clients)\n\u2514\u2500\u2500 Tab navigation by protocol\n\nVPNServersPage (server management)\n\u251c\u2500\u2500 VPNTypeSection \xd7 6 (one per protocol)\n\u2502   \u2514\u2500\u2500 VPNServerCard[] (individual servers)\n\u2514\u2500\u2500 Tab navigation by protocol\n"})}),"\n",(0,i.jsx)(n.h3,{id:"component-composition",children:"Component Composition"}),"\n",(0,i.jsx)(n.p,{children:"Each page combines:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Layout"}),": Header with refresh button, loading skeletons, error states"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Pattern Components"}),": Reusable UI patterns from Layer 2"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"State Management"}),": Apollo Client queries via TanStack Query hooks"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Mutations"}),": Toggle, create, update, delete operations"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"supported-vpn-protocols",children:"Supported VPN Protocols"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Protocol"}),(0,i.jsx)(n.th,{children:"Client"}),(0,i.jsx)(n.th,{children:"Server"}),(0,i.jsx)(n.th,{children:"Notes"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"WireGuard"})}),(0,i.jsx)(n.td,{children:"\u2713 Peers"}),(0,i.jsx)(n.td,{children:"\u2713 Interfaces"}),(0,i.jsx)(n.td,{children:"Modern, encrypted peer-to-peer"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"OpenVPN"})}),(0,i.jsx)(n.td,{children:"\u2713 Clients"}),(0,i.jsx)(n.td,{children:"\u2713 Servers"}),(0,i.jsx)(n.td,{children:"Industry standard, TLS/SSL"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"L2TP/IPsec"})}),(0,i.jsx)(n.td,{children:"\u2713 Clients"}),(0,i.jsx)(n.td,{children:"\u2713 Single Server"}),(0,i.jsx)(n.td,{children:"PPP-based, uses IPsec for encryption"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"PPTP"})}),(0,i.jsx)(n.td,{children:"\u2713 Clients"}),(0,i.jsx)(n.td,{children:"\u2713 Single Server"}),(0,i.jsx)(n.td,{children:"Legacy, PPP tunneling"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"SSTP"})}),(0,i.jsx)(n.td,{children:"\u2713 Clients"}),(0,i.jsx)(n.td,{children:"\u2713 Single Server"}),(0,i.jsx)(n.td,{children:"HTTPS-based tunneling"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"IKEv2/IPsec"})}),(0,i.jsx)(n.td,{children:"\u2713 Peers (Client)"}),(0,i.jsx)(n.td,{children:"\u2713 Peers (Server)"}),(0,i.jsx)(n.td,{children:"Modern, passive/non-passive mode"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"protocol-implementation-details",children:"Protocol Implementation Details"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"WireGuard"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Interfaces have multiple peers (bidirectional)"}),"\n",(0,i.jsx)(n.li,{children:"Stores public keys, endpoints, and allowed IPs"}),"\n",(0,i.jsxs)(n.li,{children:["Per-peer traffic stats via ",(0,i.jsx)(n.code,{children:"rx"}),"/",(0,i.jsx)(n.code,{children:"tx"})," counters"]}),"\n",(0,i.jsxs)(n.li,{children:["Query hooks: ",(0,i.jsx)(n.code,{children:"useWireGuardInterfaces"}),", ",(0,i.jsx)(n.code,{children:"useWireGuardPeers"})]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"OpenVPN"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Separate server and client configurations"}),"\n",(0,i.jsx)(n.li,{children:"PPP-based user authentication"}),"\n",(0,i.jsx)(n.li,{children:"Real-time connection tracking"}),"\n",(0,i.jsxs)(n.li,{children:["Query hooks: ",(0,i.jsx)(n.code,{children:"useOpenVPNServers"}),", ",(0,i.jsx)(n.code,{children:"useOpenVPNClients"})]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"L2TP/PPTP/SSTP"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Single server instance per protocol"}),"\n",(0,i.jsx)(n.li,{children:"PPP-based authentication (shared PPP secrets)"}),"\n",(0,i.jsxs)(n.li,{children:["Multiple active connections tracked via ",(0,i.jsx)(n.code,{children:"usePPPActive"})]}),"\n",(0,i.jsxs)(n.li,{children:["Query hooks: ",(0,i.jsx)(n.code,{children:"useL2TPServer"}),"/",(0,i.jsx)(n.code,{children:"useL2TPClients"}),", etc."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"IKEv2/IPsec"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Peers marked as ",(0,i.jsx)(n.code,{children:"isPassive"})," (server) or active (client)"]}),"\n",(0,i.jsx)(n.li,{children:"Detailed identity and policy configuration"}),"\n",(0,i.jsx)(n.li,{children:"Active connections tracked separately from policies"}),"\n",(0,i.jsxs)(n.li,{children:["Query hooks: ",(0,i.jsx)(n.code,{children:"useIPsecPeers"}),", ",(0,i.jsx)(n.code,{children:"useIPsecActive"}),", ",(0,i.jsx)(n.code,{children:"useIPsecPolicies"})]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"route-structure",children:"Route Structure"}),"\n",(0,i.jsxs)(n.p,{children:["Routes defined under ",(0,i.jsx)(n.code,{children:"/router/$id/vpn/"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"/router/[routerId]/vpn/                    \u2192 VPNDashboard (default)\n/router/[routerId]/vpn/clients             \u2192 VPNClientsPage\n/router/[routerId]/vpn/servers             \u2192 VPNServersPage\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Dynamic Routing"}),": Pages support ",(0,i.jsx)(n.code,{children:"?protocol=wireguard"})," query parameter to auto-select tab."]}),"\n",(0,i.jsx)(n.h2,{id:"page-components",children:"Page Components"}),"\n",(0,i.jsx)(n.h3,{id:"vpndashboard",children:"VPNDashboard"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"File"}),": ",(0,i.jsx)(n.code,{children:"apps/connect/src/app/pages/vpn/VPNDashboard.tsx"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Purpose"}),": Main overview page showing aggregate VPN infrastructure health."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Key Features"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Uses ",(0,i.jsx)(n.code,{children:"useVPNStats()"})," to fetch aggregated data from all protocols"]}),"\n",(0,i.jsx)(n.li,{children:"Displays health status (healthy/warning/critical)"}),"\n",(0,i.jsx)(n.li,{children:"Shows server/client count and active connections"}),"\n",(0,i.jsx)(n.li,{children:"Renders 6 protocol stat cards in grid"}),"\n",(0,i.jsx)(n.li,{children:"Navigation cards link to servers/clients pages"}),"\n",(0,i.jsx)(n.li,{children:"Issues section shows up to 5 alerts"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Hooks Used"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const { data: stats } = useVPNStats(routerIp);\n// Returns VPNDashboardStats with:\n// - totalServers, totalClients, activeServers, activeClients\n// - protocolStats array (6 items, one per protocol)\n// - overallHealth ('healthy' | 'warning' | 'critical')\n// - issues: VPNIssue[] (warnings and errors)\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Responsive Design"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Mobile: Single column layout, bottom navigation"}),"\n",(0,i.jsx)(n.li,{children:"Tablet: 2-column grid for nav cards"}),"\n",(0,i.jsx)(n.li,{children:"Desktop: 3-column grid for protocol stats"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"vpnpage",children:"VPNPage"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"File"}),": ",(0,i.jsx)(n.code,{children:"apps/connect/src/app/pages/vpn/VPNPage.tsx"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Purpose"}),": Display WireGuard interfaces (primary protocol) plus read-only view of other protocols."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Key Features"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Parallel queries for WireGuard, L2TP, PPTP, SSTP"}),"\n",(0,i.jsx)(n.li,{children:"Manual refresh button (only refreshes WireGuard)"}),"\n",(0,i.jsx)(n.li,{children:"Auto-refreshes every 5 seconds"}),"\n",(0,i.jsx)(n.li,{children:"WireGuard cards fully editable (future: peer management)"}),"\n",(0,i.jsx)(n.li,{children:"Other VPN types in collapsible sections (read-only)"}),"\n",(0,i.jsx)(n.li,{children:"Empty state with helpful messaging"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Hooks Used"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const { data: wireguardInterfaces } = useWireGuardInterfaces(routerIp);\nconst { data: l2tpInterfaces } = useL2TPInterfaces(routerIp);\nconst { data: pptpInterfaces } = usePPTPInterfaces(routerIp);\nconst { data: sstpInterfaces } = useSSTPInterfaces(routerIp);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"vpnclientspage",children:"VPNClientsPage"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"File"}),": ",(0,i.jsx)(n.code,{children:"apps/connect/src/app/pages/vpn/clients/VPNClientsPage.tsx"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Purpose"}),": Manage all VPN client configurations across protocols."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Key Features"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Protocol-based tab navigation (All, WireGuard, OpenVPN, L2TP, PPTP, SSTP, IKEv2)"}),"\n",(0,i.jsx)(n.li,{children:"Toggle client enabled/disabled"}),"\n",(0,i.jsx)(n.li,{children:"View connection status and traffic stats"}),"\n",(0,i.jsx)(n.li,{children:"Edit/delete handlers (wired but not fully implemented)"}),"\n",(0,i.jsx)(n.li,{children:'Empty states with "Add Client" CTA per protocol'}),"\n",(0,i.jsx)(n.li,{children:"2-column grid layout for client cards"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Client Types"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"WireGuard Peers"}),": Filter interfaces with ",(0,i.jsx)(n.code,{children:"endpoint"})," defined"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"OpenVPN Clients"}),": All configured OpenVPN clients"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"L2TP Clients"}),": All configured L2TP clients"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"PPTP Clients"}),": All configured PPTP clients"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"SSTP Clients"}),": All configured SSTP clients"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"IKEv2 Peers"}),": Filter peers with ",(0,i.jsx)(n.code,{children:"isPassive === false"})," (client mode)"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Hooks Used"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const wireguardPeers = useWireGuardPeers(routerIp);\nconst openvpnClients = useOpenVPNClients(routerIp);\nconst ipsecPeers = useIPsecPeers(routerIp);\nconst ipsecActive = useIPsecActive(routerIp);\nconst toggleMutation = useToggleVPNInterface();\n"})}),"\n",(0,i.jsx)(n.h3,{id:"vpnserverspage",children:"VPNServersPage"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"File"}),": ",(0,i.jsx)(n.code,{children:"apps/connect/src/app/pages/vpn/servers/VPNServersPage.tsx"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Purpose"}),": Manage all VPN server configurations across protocols."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Key Features"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Protocol-based tab navigation (All, WireGuard, OpenVPN, L2TP, PPTP, SSTP, IKEv2)"}),"\n",(0,i.jsx)(n.li,{children:"Toggle server enabled/disabled"}),"\n",(0,i.jsx)(n.li,{children:"View port, connected client count"}),"\n",(0,i.jsxs)(n.li,{children:["Connected clients pulled from ",(0,i.jsx)(n.code,{children:"usePPPActive"})," for PPP-based protocols"]}),"\n",(0,i.jsx)(n.li,{children:"Single server instances for L2TP/PPTP/SSTP (singleton pattern)"}),"\n",(0,i.jsx)(n.li,{children:"2-column grid layout for server cards"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Server Types"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"WireGuard Interfaces"}),": Multiple servers, each with ",(0,i.jsx)(n.code,{children:"listenPort"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"OpenVPN Servers"}),": Multiple servers with port configuration"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"L2TP Server"}),": Single instance, client count from PPP active"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"PPTP Server"}),": Single instance, client count from PPP active"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"SSTP Server"}),": Single instance, client count from PPP active"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"IKEv2 Peers"}),": Filter peers with ",(0,i.jsx)(n.code,{children:"isPassive === true"})," (server mode)"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Hooks Used"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const wireguardServers = useWireGuardInterfaces(routerIp);\nconst openvpnServers = useOpenVPNServers(routerIp);\nconst l2tpServer = useL2TPServer(routerIp);\nconst pppActive = usePPPActive(routerIp);\nconst toggleMutation = useToggleVPNInterface();\n"})}),"\n",(0,i.jsx)(n.h2,{id:"pattern-components-layer-2",children:"Pattern Components (Layer 2)"}),"\n",(0,i.jsx)(n.h3,{id:"vpnclientcard",children:"VPNClientCard"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"File"}),": ",(0,i.jsx)(n.code,{children:"libs/ui/patterns/src/vpn-client-card/VPNClientCard.tsx"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Purpose"}),": Display a single VPN client with connection status and stats."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Props"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"interface VPNClientCardProps {\n  id: string;\n  name: string;\n  protocol: VPNProtocol;\n  isDisabled: boolean;\n  isRunning: boolean;\n  connectTo: string;           // Remote server address\n  port?: number;\n  user?: string;\n  uptime?: string;\n  rx?: number;                 // Bytes received\n  tx?: number;                 // Bytes transmitted\n  localAddress?: string;\n  remoteAddress?: string;\n  comment?: string;\n  onToggle?: (id: string, enabled: boolean) => void;\n  onConnect?: (id: string) => void;\n  onEdit?: (id: string) => void;\n  onDelete?: (id: string) => void;\n  isToggling?: boolean;\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Rendering"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Protocol icon badge + status indicator"}),"\n",(0,i.jsx)(n.li,{children:"Remote server address display"}),"\n",(0,i.jsx)(n.li,{children:"Connection info section (when connected): uptime, IP addresses, traffic stats"}),"\n",(0,i.jsx)(n.li,{children:"Dropdown menu for edit/delete/connect actions"}),"\n",(0,i.jsxs)(n.li,{children:["Green left border (",(0,i.jsx)(n.code,{children:"border-l-4 border-l-category-vpn"}),")"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Responsive Design"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Unified component (no separate mobile/desktop presenters)"}),"\n",(0,i.jsx)(n.li,{children:"Touch-friendly: 44px minimum touch targets"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"vpnservercard",children:"VPNServerCard"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"File"}),": ",(0,i.jsx)(n.code,{children:"libs/ui/patterns/src/vpn-server-card/VPNServerCard.tsx"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Purpose"}),": Display a single VPN server with active connections and stats."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Props"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"interface VPNServerCardProps {\n  id: string;\n  name: string;\n  protocol: VPNProtocol;\n  isDisabled: boolean;\n  isRunning: boolean;\n  port?: number;\n  connectedClients?: number;   // Active client count\n  rx?: number;                 // Bytes received\n  tx?: number;                 // Bytes transmitted\n  comment?: string;\n  onToggle?: (id: string, enabled: boolean) => void;\n  onEdit?: (id: string) => void;\n  onDelete?: (id: string) => void;\n  onViewDetails?: (id: string) => void;\n  isToggling?: boolean;\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Rendering"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Protocol icon badge + status indicator"}),"\n",(0,i.jsx)(n.li,{children:"Port display + connected clients count"}),"\n",(0,i.jsx)(n.li,{children:"Traffic stats (rx/tx)"}),"\n",(0,i.jsx)(n.li,{children:"Dropdown menu for view/edit/delete actions"}),"\n",(0,i.jsxs)(n.li,{children:["Green left border (",(0,i.jsx)(n.code,{children:"border-l-4 border-l-category-vpn"}),")"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"vpnstatushero",children:"VPNStatusHero"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"File"}),": ",(0,i.jsx)(n.code,{children:"libs/ui/patterns/src/vpn-status-hero/VPNStatusHero.tsx"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Purpose"}),": Large health indicator card for VPN infrastructure."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Props"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"type VPNHealthStatus = 'healthy' | 'warning' | 'critical' | 'loading';\n\ninterface VPNStatusHeroProps {\n  status: VPNHealthStatus;\n  totalServers: number;\n  totalClients: number;\n  activeServerConnections: number;\n  activeClientConnections: number;\n  totalRx: number;\n  totalTx: number;\n  issueCount?: number;\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Rendering"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Large status icon (Shield/ShieldAlert/ShieldX/Loader2)"}),"\n",(0,i.jsx)(n.li,{children:"Title and subtitle based on health status"}),"\n",(0,i.jsx)(n.li,{children:"Stats bar (4 columns): Servers, Clients, Active, Traffic"}),"\n",(0,i.jsxs)(n.li,{children:["Color coding per status:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"healthy"}),": Green (success)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"warning"}),": Amber (warning)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"critical"}),": Red (error)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"loading"}),": Gray with spinner"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"vpntypesection",children:"VPNTypeSection"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"File"}),": ",(0,i.jsx)(n.code,{children:"libs/ui/patterns/src/vpn-type-section/VPNTypeSection.tsx"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Purpose"}),": Collapsible section grouping VPN interfaces by protocol type."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Props"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'interface VPNTypeSectionProps {\n  type: string;                         // "L2TP", "PPTP", etc.\n  count: number;                        // Interface count\n  defaultExpanded?: boolean;\n  children: React.ReactNode;\n  icon?: React.ReactNode;\n  showReadOnlyNotice?: boolean;         // Shows "Read-only" notice\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Rendering"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Collapsible header with chevron icon"}),"\n",(0,i.jsx)(n.li,{children:"Count badge"}),"\n",(0,i.jsx)(n.li,{children:'"Read-only" notice (for non-WireGuard protocols)'}),"\n",(0,i.jsx)(n.li,{children:"Animated expand/collapse with Framer Motion"}),"\n",(0,i.jsx)(n.li,{children:"Children rendered in background color with padding"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"vpnprotocolstatscard",children:"VPNProtocolStatsCard"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"File"}),": ",(0,i.jsx)(n.code,{children:"libs/ui/patterns/src/vpn-protocol-stats-card/VPNProtocolStatsCard.tsx"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Purpose"}),": Display protocol-level statistics in grid format."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Rendering"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Protocol icon with name"}),"\n",(0,i.jsx)(n.li,{children:"Server/client count"}),"\n",(0,i.jsx)(n.li,{children:"Active connections"}),"\n",(0,i.jsx)(n.li,{children:"Total traffic (rx+tx)"}),"\n",(0,i.jsx)(n.li,{children:"Clickable to navigate to servers page with protocol filter"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"vpnnavigationcard",children:"VPNNavigationCard"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"File"}),": ",(0,i.jsx)(n.code,{children:"libs/ui/patterns/src/vpn-navigation-card/VPNNavigationCard.tsx"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Purpose"}),": Navigation card to servers or clients page."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Props"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"interface VPNNavigationCardProps {\n  type: 'server' | 'client';\n  count: number;\n  activeCount: number;\n  onClick: () => void;\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Rendering"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:'Icon + "VPN Servers" or "VPN Clients"'}),"\n",(0,i.jsx)(n.li,{children:"Count display with active/total formatting"}),"\n",(0,i.jsx)(n.li,{children:"Click handler for navigation"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"vpnissueslist",children:"VPNIssuesList"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"File"}),": ",(0,i.jsx)(n.code,{children:"libs/ui/patterns/src/vpn-issue-alert/VPNIssueAlert.tsx"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Purpose"}),": Display list of VPN warnings/errors."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Rendering"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Each issue as red/amber alert"}),"\n",(0,i.jsx)(n.li,{children:"Issue type, protocol, entity name"}),"\n",(0,i.jsx)(n.li,{children:"Severity indicator"}),"\n",(0,i.jsx)(n.li,{children:'Limit to 5 items with "See all" link'}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"api-layer",children:"API Layer"}),"\n",(0,i.jsx)(n.h3,{id:"query-hooks-data-fetching",children:"Query Hooks (Data Fetching)"}),"\n",(0,i.jsx)(n.p,{children:"All hooks follow TanStack Query patterns with auto-refetch enabled."}),"\n",(0,i.jsx)(n.h4,{id:"dashboard-stats",children:"Dashboard Stats"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// Aggregate stats from all protocols\nuseVPNStats(routerIp: string) \u2192 Promise<VPNDashboardStats>\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Behavior"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Fetches individual hooks for all protocols"}),"\n",(0,i.jsx)(n.li,{children:"Aggregates into single stats object"}),"\n",(0,i.jsxs)(n.li,{children:["Calculates ",(0,i.jsx)(n.code,{children:"overallHealth"})," based on issues"]}),"\n",(0,i.jsx)(n.li,{children:"Auto-refetches every 5 seconds"}),"\n",(0,i.jsx)(n.li,{children:"Used by: VPNDashboard"}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"wireguard-queries",children:"WireGuard Queries"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"useWireGuardInterfaces(routerIp: string)\n  \u2192 Promise<WireGuardInterface[]>\n  // Endpoint: GET /rest/interface/wireguard\n  // Cache key: ['vpn', 'wireguard', routerIp, 'interfaces']\n\nuseWireGuardPeers(routerIp: string, interfaceName?: string)\n  \u2192 Promise<WireGuardPeer[]>\n  // Endpoint: GET /rest/interface/wireguard/[id]/peers\n  // Cache key: ['vpn', 'wireguard', routerIp, 'peers', interfaceName]\n"})}),"\n",(0,i.jsx)(n.h4,{id:"openvpn-queries",children:"OpenVPN Queries"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"useOpenVPNServers(routerIp: string) \u2192 Promise<OpenVPNServer[]>\n  // Endpoint: GET /rest/interface/ovpn-server\n\nuseOpenVPNClients(routerIp: string) \u2192 Promise<OpenVPNClient[]>\n  // Endpoint: GET /rest/interface/ovpn-client\n"})}),"\n",(0,i.jsx)(n.h4,{id:"l2tp-queries",children:"L2TP Queries"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"useL2TPServer(routerIp: string) \u2192 Promise<L2TPServer | null>\n  // Endpoint: GET /rest/interface/l2tp-server\n  // Returns single instance\n\nuseL2TPClients(routerIp: string) \u2192 Promise<L2TPClient[]>\n  // Endpoint: GET /rest/interface/l2tp-client\n\nuseL2TPInterfaces(routerIp: string) \u2192 Promise<L2TPInterface[]>\n  // Endpoint: GET /rest/interface/l2tp\n"})}),"\n",(0,i.jsx)(n.h4,{id:"pptp-queries",children:"PPTP Queries"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"usePPTPServer(routerIp: string) \u2192 Promise<PPTPServer | null>\nusePPTPClients(routerIp: string) \u2192 Promise<PPTPClient[]>\nusePPTPInterfaces(routerIp: string) \u2192 Promise<PPTPInterface[]>\n"})}),"\n",(0,i.jsx)(n.h4,{id:"sstp-queries",children:"SSTP Queries"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"useSSTPServer(routerIp: string) \u2192 Promise<SSTPServer | null>\nuseSSTPClients(routerIp: string) \u2192 Promise<SSTPClient[]>\nuseSSTPInterfaces(routerIp: string) \u2192 Promise<SSTPInterface[]>\n"})}),"\n",(0,i.jsx)(n.h4,{id:"ikev2ipsec-queries",children:"IKEv2/IPsec Queries"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"useIPsecPeers(routerIp: string) \u2192 Promise<IPsecPeer[]>\n  // Peers marked with isPassive (server) or not (client)\n  // Endpoint: GET /rest/ip/ipsec/peer\n\nuseIPsecActive(routerIp: string) \u2192 Promise<IPsecActive[]>\n  // Active connections (status tracking)\n  // Endpoint: GET /rest/ip/ipsec/active\n\nuseIPsecPolicies(routerIp: string) \u2192 Promise<IPsecPolicy[]>\nuseIPsecIdentities(routerIp: string) \u2192 Promise<IPsecIdentity[]>\n"})}),"\n",(0,i.jsx)(n.h4,{id:"ppp-queries-shared-by-l2tp-pptp-sstp",children:"PPP Queries (Shared by L2TP, PPTP, SSTP)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"usePPPActive(routerIp: string) \u2192 Promise<PPPActive[]>\n  // Active PPP sessions across all PPP-based servers\n  // Filter by service: 'l2tp' | 'pptp' | 'sstp' | 'ovpn'\n  // Endpoint: GET /rest/ppp/active\n\nusePPPSecrets(routerIp: string) \u2192 Promise<PPPSecret[]>\n  // User credentials for PPP authentication\n  // Endpoint: GET /rest/ppp/secret\n"})}),"\n",(0,i.jsx)(n.h3,{id:"mutation-hooks-write-operations",children:"Mutation Hooks (Write Operations)"}),"\n",(0,i.jsx)(n.h4,{id:"usetogglevpninterface",children:"useToggleVPNInterface"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"useToggleVPNInterface() \u2192 UseMutationResult<void, Error, {\n  routerIp: string;\n  id: string;\n  name: string;\n  protocol: VPNProtocol;\n  disabled: boolean;\n}>\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Behavior"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Sets ",(0,i.jsx)(n.code,{children:"disabled"})," flag on VPN interface"]}),"\n",(0,i.jsx)(n.li,{children:"Invalidates relevant query cache after mutation"}),"\n",(0,i.jsx)(n.li,{children:"Used by: VPNClientCard, VPNServerCard toggle buttons"}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"usecreatevpninterface",children:"useCreateVPNInterface"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"useCreateVPNInterface() \u2192 UseMutationResult<VPNInterface, Error, {\n  routerIp: string;\n  protocol: VPNProtocol;\n  config: ProtocolConfig;\n}>\n"})}),"\n",(0,i.jsx)(n.h4,{id:"useupdatevpninterface",children:"useUpdateVPNInterface"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"useUpdateVPNInterface() \u2192 UseMutationResult<VPNInterface, Error, {\n  routerIp: string;\n  id: string;\n  config: Partial<ProtocolConfig>;\n}>\n"})}),"\n",(0,i.jsx)(n.h4,{id:"usedeletevpninterface",children:"useDeleteVPNInterface"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"useDeleteVPNInterface() \u2192 UseMutationResult<void, Error, {\n  routerIp: string;\n  id: string;\n  protocol: VPNProtocol;\n}>\n"})}),"\n",(0,i.jsx)(n.h3,{id:"query-keys",children:"Query Keys"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"File"}),": ",(0,i.jsx)(n.code,{children:"libs/api-client/queries/src/vpn/queryKeys.ts"})]}),"\n",(0,i.jsx)(n.p,{children:"Hierarchical query key structure for TanStack Query cache management:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"vpnKeys = {\n  all: ['vpn'],\n\n  stats: (routerIp) => ['vpn', 'stats', routerIp],\n\n  wireguard: (routerIp) => ['vpn', 'wireguard', routerIp],\n  wireguardInterfaces: (routerIp) => [...wireguard, 'interfaces'],\n  wireguardPeers: (routerIp, interfaceName) => [...wireguard, 'peers', interfaceName],\n\n  openvpn: (routerIp) => ['vpn', 'openvpn', routerIp],\n  openvpnServers: (routerIp) => [...openvpn, 'servers'],\n  openvpnClients: (routerIp) => [...openvpn, 'clients'],\n\n  l2tp: (routerIp) => ['vpn', 'l2tp', routerIp],\n  l2tpServer: (routerIp) => [...l2tp, 'server'],\n  l2tpClients: (routerIp) => [...l2tp, 'clients'],\n\n  pptp: (routerIp) => ['vpn', 'pptp', routerIp],\n  pptpServer: (routerIp) => [...pptp, 'server'],\n  pptpClients: (routerIp) => [...pptp, 'clients'],\n\n  sstp: (routerIp) => ['vpn', 'sstp', routerIp],\n  sstpServer: (routerIp) => [...sstp, 'server'],\n  sstpClients: (routerIp) => [...sstp, 'clients'],\n\n  ipsec: (routerIp) => ['vpn', 'ipsec', routerIp],\n  ipsecPeers: (routerIp) => [...ipsec, 'peers'],\n  ipsecActive: (routerIp) => [...ipsec, 'active'],\n\n  ppp: (routerIp) => ['vpn', 'ppp', routerIp],\n  pppActive: (routerIp) => [...ppp, 'active'],\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"state-management",children:"State Management"}),"\n",(0,i.jsx)(n.h3,{id:"apollo-client--tanstack-query",children:"Apollo Client / TanStack Query"}),"\n",(0,i.jsx)(n.p,{children:"All VPN data flows through TanStack Query (React Query):"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Caching Strategy"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"staleTime: 5000-10000ms"})," - Config data cached briefly"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"refetchInterval: 5000ms"})," - Auto-refresh for real-time status"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"refetchOnWindowFocus: true"})," - Update when tab regains focus"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"refetchIntervalInBackground: false"})," - Pause when tab hidden"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Examples"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// Page component fetching WireGuard and stats\nconst { data: stats, isLoading } = useVPNStats(routerIp);\nconst { data: wireguardInterfaces } = useWireGuardInterfaces(routerIp);\n\n// VPNClientsPage combining multiple protocols\nconst { data: wgPeers } = useWireGuardPeers(routerIp);\nconst { data: ovpnClients } = useOpenVPNClients(routerIp);\nconst { data: ipsecActive } = useIPsecActive(routerIp);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"zustand-ui-state",children:"Zustand (UI State)"}),"\n",(0,i.jsxs)(n.p,{children:["Connection state managed via ",(0,i.jsx)(n.code,{children:"useConnectionStore"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const routerIp = useConnectionStore((state) => state.currentRouterIp);\n"})}),"\n",(0,i.jsx)(n.p,{children:"VPN-specific UI state (selected protocol tab, filters) managed locally in components."}),"\n",(0,i.jsx)(n.h3,{id:"future-xstate-integration",children:"Future: XState Integration"}),"\n",(0,i.jsx)(n.p,{children:"Multi-step VPN connection flows (e.g., WireGuard peer configuration) will use XState machines (reference: doc 03)."}),"\n",(0,i.jsx)(n.h2,{id:"backend-integration",children:"Backend Integration"}),"\n",(0,i.jsx)(n.h3,{id:"rest-endpoints-rosproxy",children:"REST Endpoints (rosproxy)"}),"\n",(0,i.jsx)(n.p,{children:"VPN hooks communicate with RouterOS REST API via rosproxy backend:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"GET  /rest/interface/wireguard              \u2192 WireGuardInterface[]\nGET  /rest/interface/wireguard/[id]/peers   \u2192 WireGuardPeer[]\nGET  /rest/interface/ovpn-server            \u2192 OpenVPNServer[]\nGET  /rest/interface/ovpn-client            \u2192 OpenVPNClient[]\nGET  /rest/interface/l2tp-server            \u2192 L2TPServer\nGET  /rest/interface/l2tp-client            \u2192 L2TPClient[]\nGET  /rest/interface/pptp-server            \u2192 PPTPServer\nGET  /rest/interface/pptp-client            \u2192 PPTPClient[]\nGET  /rest/interface/sstp-server            \u2192 SSTPServer\nGET  /rest/interface/sstp-client            \u2192 SSTPClient[]\nGET  /rest/ip/ipsec/peer                    \u2192 IPsecPeer[]\nGET  /rest/ip/ipsec/active                  \u2192 IPsecActive[]\nGET  /rest/ppp/active                       \u2192 PPPActive[]\nGET  /rest/ppp/secret                       \u2192 PPPSecret[]\n"})}),"\n",(0,i.jsx)(n.h3,{id:"backend-provisioning",children:"Backend Provisioning"}),"\n",(0,i.jsxs)(n.p,{children:["VPN server provisioning implemented in ",(0,i.jsx)(n.code,{children:"apps/backend/internal/provisioning/vpnserver/"}),":"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Files"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ikev2_server.go"})," - IKEv2/IPsec server setup"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ppp_servers.go"})," - L2TP/PPTP/SSTP PPP server setup"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Provisioning Flow"}),":"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"User configures VPN server via UI form"}),"\n",(0,i.jsx)(n.li,{children:"Apply mutation sent to backend GraphQL"}),"\n",(0,i.jsx)(n.li,{children:"Backend validates and applies via RouterOS API"}),"\n",(0,i.jsx)(n.li,{children:"Frontend refetches query to reflect changes"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"cross-references",children:"Cross-References"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Doc 01 (Architecture)"}),": Overall frontend/backend architecture"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Doc 03 (XState Machines)"}),": For future multi-step VPN setup flows"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Doc 12 (API Client)"}),": Apollo Client setup and query patterns"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Design System Docs"}),": Theme tokens, responsive design patterns"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"implementation-checklist",children:"Implementation Checklist"}),"\n",(0,i.jsx)(n.p,{children:"When extending VPN features:"}),"\n",(0,i.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Add new protocol queries following existing hook patterns"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Create pattern component with mobile/desktop presenters if needed"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Update ",(0,i.jsx)(n.code,{children:"vpnKeys"})," query key hierarchy"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Add mutation for create/update/delete operations"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Update ",(0,i.jsx)(n.code,{children:"useVPNStats"})," to aggregate new protocol stats"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Add protocol to ",(0,i.jsx)(n.code,{children:"VPNProtocol"})," type in ",(0,i.jsx)(n.code,{children:"@nasnet/core/types"})]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Implement responsive design (mobile/tablet/desktop)"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Test with WCAG AAA accessibility standards"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Document in this file"]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},71184:(e,n,r)=>{r.d(n,{R:()=>l,x:()=>c});var s=r(14041);const i={},t=s.createContext(i);function l(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);