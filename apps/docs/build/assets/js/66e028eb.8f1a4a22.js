"use strict";(globalThis.webpackChunk_nas_net_docs=globalThis.webpackChunk_nas_net_docs||[]).push([[56191],{71184:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>c});var t=s(14041);const r={},a=t.createContext(r);function i(e){const n=t.useContext(a);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),t.createElement(a.Provider,{value:n},e.children)}},93221:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>h,frontMatter:()=>i,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"change-set-pattern","title":"Change Set Pattern","description":"A Change Set is an ordered, atomic batch of resource operations (creates, updates, and deletes) that must all succeed or all roll back together. Rather than applying individual mutations one at a time and hoping the router ends up in a consistent state, a Change Set lets UI flows compose several operations \u2014 create a bridge, add a DHCP server, write three firewall rules \u2014 and commit them in a single transactional unit. The libs/api-client/queries/src/change-set/ module provides GraphQL fragments, query hooks, mutation hooks, and real-time subscription hooks that implement every stage of this lifecycle.","source":"@site/../../libs/api-client/docs/change-set-pattern.md","sourceDirName":".","slug":"/change-set-pattern","permalink":"/docs/api-client/change-set-pattern","draft":false,"unlisted":false,"editUrl":"https://github.com/nasnet-community/nasnet-panel/tree/main/../../libs/api-client/docs/change-set-pattern.md","tags":[],"version":"current","sidebarPosition":8,"frontMatter":{"sidebar_position":8,"title":"Change Set Pattern"},"sidebar":"sidebar","previous":{"title":"Universal State v2 Resource Model","permalink":"/docs/api-client/universal-state-resource-model"},"next":{"title":"GraphQL Schema Contracts \u2014 Scalars and Directives","permalink":"/docs/api-client/graphql-schema-contracts"}}');var r=s(31085),a=s(71184);const i={sidebar_position:8,title:"Change Set Pattern"},c="Change Set Pattern",o={},l=[{value:"Table of Contents",id:"table-of-contents",level:2},{value:"Apply-Confirm-Merge Lifecycle",id:"apply-confirm-merge-lifecycle",level:2},{value:"Stage-by-Stage Walkthrough",id:"stage-by-stage-walkthrough",level:3},{value:"GraphQL Fragments",id:"graphql-fragments",level:2},{value:"Base Fragments",id:"base-fragments",level:3},{value:"Composite Fragments",id:"composite-fragments",level:3},{value:"Subscription Event Fragments",id:"subscription-event-fragments",level:3},{value:"Query Keys and Cache Invalidation",id:"query-keys-and-cache-invalidation",level:2},{value:"Query Hooks",id:"query-hooks",level:2},{value:"<code>useChangeSet</code>",id:"usechangeset",level:3},{value:"<code>useLazyChangeSet</code>",id:"uselazychangeset",level:3},{value:"<code>useChangeSets</code>",id:"usechangesets",level:3},{value:"<code>useActiveChangeSets</code>",id:"useactivechangesets",level:3},{value:"<code>usePendingChangeSetsCount</code>",id:"usependingchangesetscount",level:3},{value:"Mutation Hooks",id:"mutation-hooks",level:2},{value:"<code>useCreateChangeSet</code>",id:"usecreatechangeset",level:3},{value:"<code>useAddChangeSetItem</code>",id:"useaddchangesetitem",level:3},{value:"<code>useUpdateChangeSetItem</code>",id:"useupdatechangesetitem",level:3},{value:"<code>useRemoveChangeSetItem</code>",id:"useremovechangesetitem",level:3},{value:"<code>useValidateChangeSet</code>",id:"usevalidatechangeset",level:3},{value:"<code>useApplyChangeSet</code>",id:"useapplychangeset",level:3},{value:"<code>useCancelChangeSet</code>",id:"usecancelchangeset",level:3},{value:"<code>useRollbackChangeSet</code>",id:"userollbackchangeset",level:3},{value:"<code>useDeleteChangeSet</code>",id:"usedeletechangeset",level:3},{value:"useChangeSetOperations \u2014 Combined Hook",id:"usechangesetoperations--combined-hook",level:2},{value:"Subscription Hooks",id:"subscription-hooks",level:2},{value:"<code>useChangeSetProgressSubscription</code>",id:"usechangesetprogresssubscription",level:3},{value:"<code>useChangeSetStatusSubscription</code>",id:"usechangesetstatussubscription",level:3},{value:"<code>useChangeSetSubscriptions</code> \u2014 Combined",id:"usechangesetsubscriptions--combined",level:3},{value:"useApplyWithProgress \u2014 Complete Apply Workflow",id:"useapplywithprogress--complete-apply-workflow",level:2},{value:"Cache Eviction on Delete",id:"cache-eviction-on-delete",level:2},{value:"Cross-References",id:"cross-references",level:2}];function d(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"change-set-pattern",children:"Change Set Pattern"})}),"\n",(0,r.jsxs)(n.p,{children:["A Change Set is an ordered, atomic batch of resource operations (creates, updates, and deletes) that must all succeed or all roll back together. Rather than applying individual mutations one at a time and hoping the router ends up in a consistent state, a Change Set lets UI flows compose several operations \u2014 create a bridge, add a DHCP server, write three firewall rules \u2014 and commit them in a single transactional unit. The ",(0,r.jsx)(n.code,{children:"libs/api-client/queries/src/change-set/"})," module provides GraphQL fragments, query hooks, mutation hooks, and real-time subscription hooks that implement every stage of this lifecycle."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"table-of-contents",children:"Table of Contents"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#apply-confirm-merge-lifecycle",children:"Apply-Confirm-Merge Lifecycle"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#graphql-fragments",children:"GraphQL Fragments"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#query-keys-and-cache-invalidation",children:"Query Keys and Cache Invalidation"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#query-hooks",children:"Query Hooks"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#mutation-hooks",children:"Mutation Hooks"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#usechangesetoperations--combined-hook",children:"useChangeSetOperations \u2014 Combined Hook"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#subscription-hooks",children:"Subscription Hooks"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#useapplywithprogress--complete-apply-workflow",children:"useApplyWithProgress \u2014 Complete Apply Workflow"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#cache-eviction-on-delete",children:"Cache Eviction on Delete"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#cross-references",children:"Cross-References"})}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"apply-confirm-merge-lifecycle",children:"Apply-Confirm-Merge Lifecycle"}),"\n",(0,r.jsx)(n.p,{children:"A Change Set moves through the following status transitions. The client drives all transitions via mutations; the server confirms each transition and broadcasts progress events via WebSocket subscription."}),"\n",(0,r.jsx)(n.mermaid,{value:"stateDiagram-v2\n    DRAFT --\x3e READY: validateChangeSet() \u2713\n    DRAFT --\x3e DRAFT: validateChangeSet() errors\n    DRAFT --\x3e CANCELLED: cancelChangeSet()\n\n    READY --\x3e APPLYING: applyChangeSet()\n    READY --\x3e CANCELLED: cancelChangeSet()\n\n    APPLYING --\x3e COMPLETED: All items applied\n    APPLYING --\x3e PARTIAL_FAILURE: Some items failed\n    APPLYING --\x3e FAILED: Apply failed\n\n    PARTIAL_FAILURE --\x3e ROLLED_BACK: rollbackChangeSet()\n    FAILED --\x3e ROLLED_BACK: rollbackChangeSet()"}),"\n",(0,r.jsx)(n.h3,{id:"stage-by-stage-walkthrough",children:"Stage-by-Stage Walkthrough"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"1. CREATE     useCreateChangeSet()          DRAFT\n              \u251c\u2500\u2500 Name, description, source\n              \u2514\u2500\u2500 Returns empty ChangeSet\n\n2. COMPOSE    useAddChangeSetItem() \xd7 N     DRAFT\n              \u251c\u2500\u2500 Each item: resourceType, operation, configuration\n              \u2514\u2500\u2500 Server assigns applyOrder based on dependency analysis\n\n3. UPDATE     useUpdateChangeSetItem()      DRAFT\n              \u2514\u2500\u2500 Modify item configuration before validating\n\n4. REMOVE     useRemoveChangeSetItem()      DRAFT\n              \u2514\u2500\u2500 Drop an item before applying\n\n5. VALIDATE   useValidateChangeSet()        DRAFT \u2192 READY (if canApply)\n              \u251c\u2500\u2500 Checks: syntax, semantic, dependency, conflict, security\n              \u251c\u2500\u2500 Returns ChangeSetValidationResult\n              \u2514\u2500\u2500 Items with errors block apply unless force: true\n\n6. APPLY      useApplyChangeSet()           READY \u2192 APPLYING\n              \u251c\u2500\u2500 Server processes items in applyOrder sequence\n              \u2514\u2500\u2500 Progress streams via useChangeSetProgressSubscription\n\n7. MONITOR    useChangeSetProgressSubscription()  (during APPLYING)\n              \u251c\u2500\u2500 progressPercent, currentItem, estimatedRemainingMs\n              \u251c\u2500\u2500 onComplete \u2192 COMPLETED\n              \u2514\u2500\u2500 onError \u2192 FAILED or PARTIAL_FAILURE\n\n8. ROLLBACK   useRollbackChangeSet()        FAILED \u2192 ROLLED_BACK\n              \u251c\u2500\u2500 Executes rollbackPlan steps in reverse applyOrder\n              \u2514\u2500\u2500 Returns { success, failedItems }\n\n9. CANCEL     useCancelChangeSet()          DRAFT/READY \u2192 CANCELLED\n              \u2514\u2500\u2500 Cannot cancel while APPLYING\n\n10. DELETE    useDeleteChangeSet()          any non-APPLYING state\n              \u2514\u2500\u2500 Evicts from Apollo cache\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"graphql-fragments",children:"GraphQL Fragments"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Source file:"})," ",(0,r.jsx)(n.code,{children:"libs/api-client/queries/src/change-set/fragments.ts"})]}),"\n",(0,r.jsx)(n.h3,{id:"base-fragments",children:"Base Fragments"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"CHANGE_SET_ITEM_LIGHT_FRAGMENT"})})," (",(0,r.jsx)(n.code,{children:"ChangeSetItemLight"}),") \u2014 for progress tracking:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"// fragments.ts:18\n// id, name, resourceType, resourceCategory, operation, status, applyOrder, error\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"CHANGE_SET_ITEM_FULL_FRAGMENT"})})," (",(0,r.jsx)(n.code,{children:"ChangeSetItemFull"}),") \u2014 for detail views:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"// fragments.ts:34\n// id, name, description, resourceType, resourceCategory, resourceUuid,\n// operation, status, configuration, previousState, dependencies, error,\n// applyOrder, applyStartedAt, applyCompletedAt\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"CHANGE_SET_VALIDATION_ERROR_FRAGMENT"})})," (",(0,r.jsx)(n.code,{children:"ChangeSetValidationError"}),"):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"// fragments.ts:57\n// itemId, field, message, severity, code\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"CHANGE_SET_CONFLICT_FRAGMENT"})})," (",(0,r.jsx)(n.code,{children:"ChangeSetConflict"}),"):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"// fragments.ts:70\n// itemId1, itemId2OrResourceUuid, isExternalConflict, description, resolution\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"MISSING_DEPENDENCY_FRAGMENT"})})," (",(0,r.jsx)(n.code,{children:"MissingDependency"}),"):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"// fragments.ts:83\n// itemId, missingResourceType, missingResourceId\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"CHANGE_SET_VALIDATION_RESULT_FRAGMENT"})})," (",(0,r.jsx)(n.code,{children:"ChangeSetValidationResult"}),"):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"// fragments.ts:94\n// canApply\n// errors    { ...ChangeSetValidationError }\n// warnings  { ...ChangeSetValidationError }\n// conflicts { ...ChangeSetConflict }\n// missingDependencies { ...MissingDependency }\n// circularDependencies (string[])\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"ROLLBACK_STEP_FRAGMENT"})})," (",(0,r.jsx)(n.code,{children:"RollbackStep"}),"):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"// fragments.ts:119\n// itemId, operation, restoreState, resourceUuid, success, error, rollbackOrder\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"CHANGE_SET_ERROR_FRAGMENT"})})," (",(0,r.jsx)(n.code,{children:"ChangeSetError"}),"):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"// fragments.ts:134\n// message, failedItemId, code\n// partiallyAppliedItemIds, failedRollbackItemIds\n// requiresManualIntervention\n"})}),"\n",(0,r.jsx)(n.h3,{id:"composite-fragments",children:"Composite Fragments"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"CHANGE_SET_SUMMARY_FRAGMENT"})})," (",(0,r.jsx)(n.code,{children:"ChangeSetSummary"}),") \u2014 for list views:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"// fragments.ts:152\n// id, name, status\n// operationCounts { create, update, delete }\n// totalItems, createdAt, hasErrors, hasWarnings\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"CHANGE_SET_FULL_FRAGMENT"})})," (",(0,r.jsx)(n.code,{children:"ChangeSetFull"}),") \u2014 for detail views:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"// fragments.ts:172\nfragment ChangeSetFull on ChangeSet {\n  id\n  name\n  description\n  routerId\n  status\n  version\n  createdAt\n  applyStartedAt\n  completedAt\n  createdBy\n  source\n  items     { ...ChangeSetItemFull }\n  validation { ...ChangeSetValidationResult }\n  rollbackPlan { ...RollbackStep }\n  error     { ...ChangeSetError }\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"CHANGE_SET_PROGRESS_FRAGMENT"})})," (",(0,r.jsx)(n.code,{children:"ChangeSetProgress"}),") \u2014 lightweight for live tracking:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"// fragments.ts:207\n// id, name, status, version\n// items { ...ChangeSetItemLight }\n// error { ...ChangeSetError }\n"})}),"\n",(0,r.jsx)(n.h3,{id:"subscription-event-fragments",children:"Subscription Event Fragments"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"CURRENT_ITEM_INFO_FRAGMENT"})})," (",(0,r.jsx)(n.code,{children:"CurrentItemInfo"}),"):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"// fragments.ts:231\n// id, name, operation, status\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"CHANGE_SET_PROGRESS_EVENT_FRAGMENT"})})," (",(0,r.jsx)(n.code,{children:"ChangeSetProgressEvent"}),"):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"// fragments.ts:243\n// changeSetId, status\n// currentItem { ...CurrentItemInfo }\n// appliedCount, totalCount, progressPercent\n// estimatedRemainingMs\n// error { ...ChangeSetError }\n// timestamp\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"CHANGE_SET_STATUS_EVENT_FRAGMENT"})})," (",(0,r.jsx)(n.code,{children:"ChangeSetStatusEvent"}),"):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"// fragments.ts:266\n// changeSetId, previousStatus, newStatus\n// error { ...ChangeSetError }\n// timestamp\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"query-keys-and-cache-invalidation",children:"Query Keys and Cache Invalidation"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Source file:"})," ",(0,r.jsx)(n.code,{children:"libs/api-client/queries/src/change-set/queryKeys.ts"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"changeSetKeys.all                                        // ['changeSets']\nchangeSetKeys.lists()                                    // ['changeSets', 'list']\nchangeSetKeys.list('r-abc', { status: 'DRAFT' })         // ['changeSets', 'list', 'r-abc', { status: 'DRAFT' }]\nchangeSetKeys.details()                                  // ['changeSets', 'detail']\nchangeSetKeys.detail('r-abc', 'cs-id')                   // ['changeSets', 'detail', 'r-abc', 'cs-id']\nchangeSetKeys.validation('cs-id')                        // ['changeSets', 'validation', 'cs-id']\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Invalidation helpers:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"// Trigger refetch of all change sets for a router\nchangeSetInvalidations.router('r-abc')\n// Returns: { refetchQueries: [{ query: 'changeSets', variables: { routerId: 'r-abc' } }] }\n\n// Evict a specific change set from cache\nchangeSetInvalidations.changeSet('cs-id')\n// Calls: cache.evict({ id: 'ChangeSet:cs-id' }) + cache.gc()\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"query-hooks",children:"Query Hooks"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Source file:"})," ",(0,r.jsx)(n.code,{children:"libs/api-client/queries/src/change-set/useChangeSetQueries.ts"})]}),"\n",(0,r.jsx)(n.h3,{id:"usechangeset",children:(0,r.jsx)(n.code,{children:"useChangeSet"})}),"\n",(0,r.jsxs)(n.p,{children:["Fetches a single change set by ID. Returns the full ",(0,r.jsx)(n.code,{children:"ChangeSet"})," object using ",(0,r.jsx)(n.code,{children:"ChangeSetFull"})," fragment."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"function useChangeSet(\n  routerId: string | undefined,\n  changeSetId: string | undefined,\n  options?: GetChangeSetOptions\n): {\n  changeSet: ChangeSet | undefined;\n  loading: boolean;\n  error: ApolloError | undefined;\n  refetch: () => Promise<void>;\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsxs)(n.strong,{children:[(0,r.jsx)(n.code,{children:"GetChangeSetOptions"}),":"]})}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Option"}),(0,r.jsx)(n.th,{children:"Type"}),(0,r.jsx)(n.th,{children:"Default"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"skip"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"boolean"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"false"})}),(0,r.jsx)(n.td,{children:"Skip if IDs not yet available"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"pollInterval"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"number"})}),(0,r.jsx)(n.td,{children:"\u2014"}),(0,r.jsx)(n.td,{children:"Background polling in ms"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"fetchPolicy"})}),(0,r.jsx)(n.td,{children:"Apollo fetch policy"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"'cache-first'"})}),(0,r.jsx)(n.td,{children:"Cache behaviour"})]})]})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:"query GetChangeSet($id: ID!, $routerId: ID!) {\n  changeSet(id: $id, routerId: $routerId) {\n    ...ChangeSetFull\n  }\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"uselazychangeset",children:(0,r.jsx)(n.code,{children:"useLazyChangeSet"})}),"\n",(0,r.jsx)(n.p,{children:"On-demand version for cases where the change set ID is determined by user interaction rather than URL params."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"function useLazyChangeSet(): {\n  fetch: (routerId: string, changeSetId: string) => Promise<ChangeSet | undefined>;\n  changeSet: ChangeSet | undefined;\n  loading: boolean;\n  error: ApolloError | undefined;\n}\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"const { fetch, changeSet, loading } = useLazyChangeSet();\n\nconst handleSelect = async (id: string) => {\n  const result = await fetch(routerId, id);\n  if (result) navigate(`/change-sets/${result.id}`);\n};\n"})}),"\n",(0,r.jsx)(n.h3,{id:"usechangesets",children:(0,r.jsx)(n.code,{children:"useChangeSets"})}),"\n",(0,r.jsxs)(n.p,{children:["Lists change sets for a router using the lightweight ",(0,r.jsx)(n.code,{children:"ChangeSetSummary"})," fragment."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"function useChangeSets(\n  routerId: string | undefined,\n  options?: ListChangeSetsOptions\n): {\n  changeSets: ChangeSetSummary[];\n  loading: boolean;\n  error: ApolloError | undefined;\n  refetch: () => Promise<void>;\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsxs)(n.strong,{children:[(0,r.jsx)(n.code,{children:"ListChangeSetsOptions"}),":"]})}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Option"}),(0,r.jsx)(n.th,{children:"Type"}),(0,r.jsx)(n.th,{children:"Default"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"status"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"ChangeSetStatus"})}),(0,r.jsx)(n.td,{children:"\u2014"}),(0,r.jsx)(n.td,{children:"Filter by status"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"includeCompleted"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"boolean"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"false"})}),(0,r.jsx)(n.td,{children:"Include COMPLETED/FAILED entries"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"skip"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"boolean"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"false"})}),(0,r.jsx)(n.td,{children:"Skip execution"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"pollInterval"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"number"})}),(0,r.jsx)(n.td,{children:"\u2014"}),(0,r.jsx)(n.td,{children:"Background polling"})]})]})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:"query ListChangeSets($routerId: ID!, $status: ChangeSetStatus, $includeCompleted: Boolean) {\n  changeSets(routerId: $routerId, status: $status, includeCompleted: $includeCompleted) {\n    ...ChangeSetSummary\n  }\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"useactivechangesets",children:(0,r.jsx)(n.code,{children:"useActiveChangeSets"})}),"\n",(0,r.jsxs)(n.p,{children:["Convenience wrapper that always sets ",(0,r.jsx)(n.code,{children:"includeCompleted: false"})," and adds a ",(0,r.jsx)(n.code,{children:"hasActive"})," boolean."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"function useActiveChangeSets(\n  routerId: string | undefined,\n  options?: { skip?: boolean; pollInterval?: number }\n): {\n  changeSets: ChangeSetSummary[];\n  hasActive: boolean;\n  loading: boolean;\n  error: ApolloError | undefined;\n}\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:'const { hasActive } = useActiveChangeSets(routerId);\n// Drive a "Pending changes" indicator in the nav bar\n'})}),"\n",(0,r.jsx)(n.h3,{id:"usependingchangesetscount",children:(0,r.jsx)(n.code,{children:"usePendingChangeSetsCount"})}),"\n",(0,r.jsx)(n.p,{children:"Returns only the count of change sets in DRAFT or READY state. Designed for badge indicators."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"function usePendingChangeSetsCount(routerId: string | undefined): {\n  count: number;\n  isLoading: boolean;\n}\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"const { count } = usePendingChangeSetsCount(routerId);\nreturn <NavItem badge={count > 0 ? count : undefined}>Change Sets</NavItem>;\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"mutation-hooks",children:"Mutation Hooks"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Source file:"})," ",(0,r.jsx)(n.code,{children:"libs/api-client/queries/src/change-set/useChangeSetMutations.ts"})]}),"\n",(0,r.jsx)(n.p,{children:"All mutation hooks follow the same return shape:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"interface MutationResult<TData, TVariables> {\n  mutate: (variables: TVariables) => Promise<TData>;\n  loading: boolean;\n  error: ApolloError | undefined;\n  reset: () => void;\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"usecreatechangeset",children:(0,r.jsx)(n.code,{children:"useCreateChangeSet"})}),"\n",(0,r.jsx)(n.p,{children:"Creates a new empty change set in DRAFT status."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"function useCreateChangeSet(): {\n  mutate: (input: CreateChangeSetInput) => Promise<ChangeSet>;\n  loading: boolean; error: ApolloError | undefined; reset: () => void;\n}\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"interface CreateChangeSetInput {\n  routerId: string;\n  name: string;\n  description?: string;\n  source?: string;  // e.g. 'guest-network-wizard', 'import', 'manual'\n}\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:"mutation CreateChangeSet($input: CreateChangeSetInput!) {\n  createChangeSet(input: $input) {\n    changeSet { ...ChangeSetFull }\n    errors { message code field }\n  }\n}\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"const cs = await createChangeSet.mutate({\n  routerId: 'r-abc',\n  name: 'Setup Guest Network',\n  description: 'Bridge + DHCP + firewall',\n  source: 'guest-network-wizard',\n});\nnavigate(`/change-sets/${cs.id}`);\n"})}),"\n",(0,r.jsx)(n.h3,{id:"useaddchangesetitem",children:(0,r.jsx)(n.code,{children:"useAddChangeSetItem"})}),"\n",(0,r.jsx)(n.p,{children:"Adds one resource operation to a change set."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"function useAddChangeSetItem(): {\n  mutate: (changeSetId: string, input: ChangeSetItemInput) =>\n    Promise<{ changeSet: ChangeSet; itemId: string }>;\n  ...\n}\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"interface ChangeSetItemInput {\n  resourceType: string;\n  resourceCategory: ResourceCategory;\n  resourceUuid?: string;        // Required for UPDATE and DELETE operations\n  name: string;\n  description?: string;\n  operation: ChangeOperation;   // 'CREATE' | 'UPDATE' | 'DELETE'\n  configuration: Record<string, unknown>;\n  previousState?: Record<string, unknown>;  // Snapshot for rollback\n  dependencies?: string[];      // Item IDs this item depends on\n}\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:"mutation AddChangeSetItem($changeSetId: ID!, $input: ChangeSetItemInput!) {\n  addChangeSetItem(changeSetId: $changeSetId, input: $input) {\n    changeSet { ...ChangeSetFull }\n    itemId\n    errors { message code field }\n  }\n}\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"const { changeSet, itemId } = await addItem.mutate(cs.id, {\n  resourceType: 'interface-bridge',\n  resourceCategory: 'NETWORKING',\n  name: 'guest-bridge',\n  operation: 'CREATE',\n  configuration: { name: 'guest-bridge', comment: 'Guest network bridge' },\n});\n"})}),"\n",(0,r.jsx)(n.h3,{id:"useupdatechangesetitem",children:(0,r.jsx)(n.code,{children:"useUpdateChangeSetItem"})}),"\n",(0,r.jsx)(n.p,{children:"Modifies the configuration or metadata of an existing item before the change set is applied."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"function useUpdateChangeSetItem(): {\n  mutate: (changeSetId: string, itemId: string, input: UpdateChangeSetItemInput) =>\n    Promise<ChangeSet>;\n  ...\n}\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"interface UpdateChangeSetItemInput {\n  name?: string;\n  description?: string;\n  configuration?: Record<string, unknown>;\n  dependencies?: string[];\n}\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:"mutation UpdateChangeSetItem($changeSetId: ID!, $itemId: ID!, $input: UpdateChangeSetItemInput!) {\n  updateChangeSetItem(changeSetId: $changeSetId, itemId: $itemId, input: $input) {\n    changeSet { ...ChangeSetFull }\n    errors { message code field }\n  }\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"useremovechangesetitem",children:(0,r.jsx)(n.code,{children:"useRemoveChangeSetItem"})}),"\n",(0,r.jsx)(n.p,{children:"Removes an item from a change set."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"function useRemoveChangeSetItem(): {\n  mutate: (changeSetId: string, itemId: string) => Promise<ChangeSet>;\n  ...\n}\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:"mutation RemoveChangeSetItem($changeSetId: ID!, $itemId: ID!) {\n  removeChangeSetItem(changeSetId: $changeSetId, itemId: $itemId) {\n    changeSet { ...ChangeSetFull }\n    errors { message code field }\n  }\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"usevalidatechangeset",children:(0,r.jsx)(n.code,{children:"useValidateChangeSet"})}),"\n",(0,r.jsxs)(n.p,{children:["Runs the full validation pipeline on all items. Returns both the updated ",(0,r.jsx)(n.code,{children:"ChangeSet"})," and a standalone ",(0,r.jsx)(n.code,{children:"ChangeSetValidationResult"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"function useValidateChangeSet(): {\n  mutate: (changeSetId: string) =>\n    Promise<{ changeSet: ChangeSet; validation: ChangeSetValidationResult }>;\n  ...\n}\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:"mutation ValidateChangeSet($changeSetId: ID!) {\n  validateChangeSet(changeSetId: $changeSetId) {\n    changeSet   { ...ChangeSetFull }\n    validation  { ...ChangeSetValidationResult }\n    errors { message code field }\n  }\n}\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"const { validation } = await validateChangeSet.mutate(cs.id);\nif (validation.canApply) {\n  setReadyToApply(true);\n} else {\n  const blocking = validation.errors.filter(e => e.severity === 'ERROR');\n  showValidationErrors(blocking);\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"useapplychangeset",children:(0,r.jsx)(n.code,{children:"useApplyChangeSet"})}),"\n",(0,r.jsxs)(n.p,{children:["Initiates the apply operation. The mutation returns quickly with the initial ",(0,r.jsx)(n.code,{children:"{ changeSetId, status }"})," \u2014 the actual per-item progress streams via ",(0,r.jsx)(n.code,{children:"useChangeSetProgressSubscription"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"function useApplyChangeSet(): {\n  mutate: (changeSetId: string, options?: ApplyChangeSetOptions) =>\n    Promise<{ changeSetId: string; status: ChangeSetStatus }>;\n  ...\n}\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"interface ApplyChangeSetOptions {\n  onStart?: () => void;\n  onSuccess?: () => void;\n  onError?: (error: ApolloError) => void;\n}\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:"mutation ApplyChangeSet($changeSetId: ID!) {\n  applyChangeSet(changeSetId: $changeSetId) {\n    changeSetId\n    status\n    errors { message code field }\n  }\n}\n"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["The apply mutation does not return ",(0,r.jsx)(n.code,{children:"ChangeSetFull"})," \u2014 it only returns the initial status. Subscribe to ",(0,r.jsx)(n.code,{children:"useChangeSetProgressSubscription"})," for real-time item-by-item updates."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"await applyChangeSet.mutate(cs.id, {\n  onStart: () => setIsApplying(true),\n  onSuccess: () => toast.info('Apply started \u2014 watching progress\u2026'),\n  onError: (e) => toast.error(`Apply failed: ${e.message}`),\n});\n"})}),"\n",(0,r.jsx)(n.h3,{id:"usecancelchangeset",children:(0,r.jsx)(n.code,{children:"useCancelChangeSet"})}),"\n",(0,r.jsx)(n.p,{children:"Cancels a change set that has not yet started applying."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"function useCancelChangeSet(): {\n  mutate: (changeSetId: string) => Promise<{ changeSet: ChangeSet; success: boolean }>;\n  ...\n}\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:"mutation CancelChangeSet($changeSetId: ID!) {\n  cancelChangeSet(changeSetId: $changeSetId) {\n    changeSet { ...ChangeSetFull }\n    success\n    errors { message code field }\n  }\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"userollbackchangeset",children:(0,r.jsx)(n.code,{children:"useRollbackChangeSet"})}),"\n",(0,r.jsxs)(n.p,{children:["Rolls back a failed or partially-applied change set. Executes the ",(0,r.jsx)(n.code,{children:"rollbackPlan"})," steps in reverse ",(0,r.jsx)(n.code,{children:"rollbackOrder"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"function useRollbackChangeSet(): {\n  mutate: (changeSetId: string) =>\n    Promise<{ changeSet: ChangeSet; success: boolean; failedItems: string[] }>;\n  ...\n}\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:"mutation RollbackChangeSet($changeSetId: ID!) {\n  rollbackChangeSet(changeSetId: $changeSetId) {\n    changeSet { ...ChangeSetFull }\n    success\n    failedItems\n    errors { message code field }\n  }\n}\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"const { success, failedItems } = await rollbackChangeSet.mutate(cs.id);\nif (!success) {\n  toast.warning(`Partial rollback. ${failedItems.length} item(s) need manual intervention`);\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"usedeletechangeset",children:(0,r.jsx)(n.code,{children:"useDeleteChangeSet"})}),"\n",(0,r.jsx)(n.p,{children:"Permanently deletes a change set and evicts it from the Apollo cache. Cannot delete a change set that is currently APPLYING."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"function useDeleteChangeSet(): {\n  mutate: (changeSetId: string) => Promise<{ success: boolean }>;\n  ...\n}\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:"mutation DeleteChangeSet($changeSetId: ID!) {\n  deleteChangeSet(changeSetId: $changeSetId) {\n    success\n    errors { message code field }\n  }\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Cache eviction happens in the Apollo ",(0,r.jsx)(n.code,{children:"update"})," callback (see ",(0,r.jsx)(n.a,{href:"#cache-eviction-on-delete",children:"Cache Eviction on Delete"}),")."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"usechangesetoperations--combined-hook",children:"useChangeSetOperations \u2014 Combined Hook"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Source file:"})," ",(0,r.jsx)(n.code,{children:"libs/api-client/queries/src/change-set/useChangeSetMutations.ts:630"})]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"useChangeSetOperations"})," composes all nine mutation hooks into a single ergonomic object. It also exposes a unified ",(0,r.jsx)(n.code,{children:"isLoading"})," flag that is ",(0,r.jsx)(n.code,{children:"true"})," if any individual mutation is in flight."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"function useChangeSetOperations(): {\n  create:      (input: CreateChangeSetInput) => Promise<ChangeSet>;\n  addItem:     (changeSetId: string, input: ChangeSetItemInput) => Promise<{ changeSet: ChangeSet; itemId: string }>;\n  updateItem:  (changeSetId: string, itemId: string, input: UpdateChangeSetItemInput) => Promise<ChangeSet>;\n  removeItem:  (changeSetId: string, itemId: string) => Promise<ChangeSet>;\n  validate:    (changeSetId: string) => Promise<{ changeSet: ChangeSet; validation: ChangeSetValidationResult }>;\n  apply:       (changeSetId: string, options?: ApplyChangeSetOptions) => Promise<{ changeSetId: string; status: ChangeSetStatus }>;\n  cancel:      (changeSetId: string) => Promise<{ changeSet: ChangeSet; success: boolean }>;\n  rollback:    (changeSetId: string) => Promise<{ changeSet: ChangeSet; success: boolean; failedItems: string[] }>;\n  delete:      (changeSetId: string) => Promise<{ success: boolean }>;\n  isLoading:   boolean;\n}\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"const ops = useChangeSetOperations();\n\nconst handleSetupGuestNetwork = async () => {\n  // 1. Create the change set\n  const cs = await ops.create({\n    routerId,\n    name: 'Guest Network Setup',\n    source: 'setup-wizard',\n  });\n\n  // 2. Add items\n  const { itemId: bridgeItemId } = await ops.addItem(cs.id, {\n    resourceType: 'interface-bridge',\n    resourceCategory: 'NETWORKING',\n    name: 'guest-bridge',\n    operation: 'CREATE',\n    configuration: { name: 'guest-bridge', comment: 'Guest bridge' },\n  });\n\n  await ops.addItem(cs.id, {\n    resourceType: 'dhcp-server',\n    resourceCategory: 'NETWORKING',\n    name: 'guest-dhcp',\n    operation: 'CREATE',\n    configuration: { interface: 'guest-bridge', addressPool: '192.168.10.0/24' },\n    dependencies: [bridgeItemId], // Ensures bridge is created first\n  });\n\n  // 3. Validate\n  const { validation } = await ops.validate(cs.id);\n  if (!validation.canApply) {\n    toast.error('Validation failed');\n    return;\n  }\n\n  // 4. Apply (progress streams via subscription)\n  await ops.apply(cs.id);\n};\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"subscription-hooks",children:"Subscription Hooks"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Source file:"})," ",(0,r.jsx)(n.code,{children:"libs/api-client/queries/src/change-set/useChangeSetSubscription.ts"})]}),"\n",(0,r.jsx)(n.p,{children:"All subscription hooks return:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"interface SubscriptionResult<T> {\n  data: T | undefined;\n  loading: boolean;         // true until first event received\n  error: ApolloError | undefined;\n  isConnected: boolean;     // false if skip, no ID, or error\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"usechangesetprogresssubscription",children:(0,r.jsx)(n.code,{children:"useChangeSetProgressSubscription"})}),"\n",(0,r.jsx)(n.p,{children:"Streams per-item progress during a change set apply operation. Each event carries the current item, a percentage, and an estimated time to completion."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"function useChangeSetProgressSubscription(\n  changeSetId: string | undefined,\n  options?: UseChangeSetProgressOptions\n): SubscriptionResult<ChangeSetProgressEvent>\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"interface UseChangeSetProgressOptions {\n  skip?: boolean;\n  onProgress?: (event: ChangeSetProgressEvent) => void;   // Every event\n  onComplete?: (event: ChangeSetProgressEvent) => void;   // status === 'COMPLETED'\n  onError?: (event: ChangeSetProgressEvent) => void;      // status === 'FAILED' | 'PARTIAL_FAILURE' | 'ROLLED_BACK'\n  onSubscriptionError?: (error: ApolloError) => void;     // WebSocket error\n}\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"interface ChangeSetProgressEvent {\n  changeSetId: string;\n  status: ChangeSetStatus;\n  currentItem: CurrentItemInfo | null;\n  appliedCount: number;\n  totalCount: number;\n  progressPercent: number;          // 0\u2013100\n  estimatedRemainingMs: number | null;\n  error: ChangeSetError | null;\n  timestamp: string;\n}\n\ninterface CurrentItemInfo {\n  id: string;\n  name: string;\n  operation: ChangeOperation;     // 'CREATE' | 'UPDATE' | 'DELETE'\n  status: ChangeSetItemStatus;    // 'PENDING' | 'APPLYING' | 'APPLIED' | 'FAILED'\n}\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:"subscription ChangeSetProgress($changeSetId: ID!) {\n  changeSetProgress(changeSetId: $changeSetId) {\n    ...ChangeSetProgressEvent\n  }\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["The hook tracks a ",(0,r.jsx)(n.code,{children:"completedRef"})," to fire ",(0,r.jsx)(n.code,{children:"onComplete"})," and ",(0,r.jsx)(n.code,{children:"onError"})," callbacks exactly once, preventing duplicate calls if the subscription delivers an additional event after completion."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"const { data, isConnected } = useChangeSetProgressSubscription(cs.id, {\n  onProgress: (event) => {\n    setProgress(event.progressPercent);\n    setCurrentItem(event.currentItem?.name ?? null);\n  },\n  onComplete: () => {\n    toast.success('All changes applied!');\n    navigate('/dashboard');\n  },\n  onError: (event) => {\n    toast.error(`Apply failed at: ${event.currentItem?.name}`);\n    setShowRollbackButton(true);\n  },\n});\n\nreturn (\n  <ApplyProgressBar\n    percent={data?.progressPercent ?? 0}\n    currentItem={data?.currentItem}\n    isConnected={isConnected}\n  />\n);\n"})}),"\n",(0,r.jsx)(n.h3,{id:"usechangesetstatussubscription",children:(0,r.jsx)(n.code,{children:"useChangeSetStatusSubscription"})}),"\n",(0,r.jsx)(n.p,{children:"Subscribes to status transitions for any change set on a given router. Useful for global notifications (e.g. top-level toast) when changes complete in a background tab."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"function useChangeSetStatusSubscription(\n  routerId: string | undefined,\n  options?: UseChangeSetStatusOptions\n): SubscriptionResult<ChangeSetStatusEvent>\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"interface UseChangeSetStatusOptions {\n  skip?: boolean;\n  onStatusChange?: (event: ChangeSetStatusEvent) => void;\n  onSubscriptionError?: (error: ApolloError) => void;\n}\n\ninterface ChangeSetStatusEvent {\n  changeSetId: string;\n  previousStatus: ChangeSetStatus;\n  newStatus: ChangeSetStatus;\n  error: ChangeSetError | null;\n  timestamp: string;\n}\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:"subscription ChangeSetStatusChanged($routerId: ID!) {\n  changeSetStatusChanged(routerId: $routerId) {\n    ...ChangeSetStatusEvent\n  }\n}\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"useChangeSetStatusSubscription(routerId, {\n  onStatusChange: (event) => {\n    if (event.newStatus === 'COMPLETED') {\n      toast.success('Change set applied successfully');\n      refetchChangeSets();\n    } else if (event.newStatus === 'FAILED') {\n      toast.error('Change set failed \u2014 view for details');\n    }\n  },\n});\n"})}),"\n",(0,r.jsxs)(n.h3,{id:"usechangesetsubscriptions--combined",children:[(0,r.jsx)(n.code,{children:"useChangeSetSubscriptions"})," \u2014 Combined"]}),"\n",(0,r.jsx)(n.p,{children:"Composes both subscription hooks with individual enable flags."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"function useChangeSetSubscriptions(\n  changeSetId: string | undefined,\n  routerId: string | undefined,\n  options?: UseChangeSetSubscriptionsOptions\n): {\n  progress: SubscriptionResult<ChangeSetProgressEvent>;\n  statusChange: SubscriptionResult<ChangeSetStatusEvent>;\n  isConnected: boolean;\n}\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"interface UseChangeSetSubscriptionsOptions {\n  progress?: boolean;         // Subscribe to apply progress (default: true)\n  statusChanges?: boolean;    // Subscribe to router-level status events (default: false)\n  skip?: boolean;\n  onProgress?: (event: ChangeSetProgressEvent) => void;\n  onComplete?: (event: ChangeSetProgressEvent) => void;\n  onError?: (event: ChangeSetProgressEvent) => void;\n  onStatusChange?: (event: ChangeSetStatusEvent) => void;\n}\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"const { progress, isConnected } = useChangeSetSubscriptions(cs.id, routerId, {\n  progress: isApplying,\n  statusChanges: true,\n  onComplete: () => refetchChangeSets(),\n  onStatusChange: (e) => console.log('Status:', e.newStatus),\n});\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"useapplywithprogress--complete-apply-workflow",children:"useApplyWithProgress \u2014 Complete Apply Workflow"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Source file:"})," ",(0,r.jsx)(n.code,{children:"libs/api-client/queries/src/change-set/useChangeSetSubscription.ts:381"})]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"useApplyWithProgress"})," is a utility hook that combines ",(0,r.jsx)(n.code,{children:"useApplyChangeSet"})," and ",(0,r.jsx)(n.code,{children:"useChangeSetProgressSubscription"})," into a single interface for components that want the complete apply workflow with minimal wiring."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"function useApplyWithProgress(\n  changeSetId: string | undefined,\n  options?: {\n    onComplete?: () => void;\n    onError?: (error: ChangeSetError | ApolloError) => void;\n  }\n): {\n  apply: () => Promise<void>;\n  progress: ChangeSetProgressEvent | undefined;\n  isApplying: boolean;\n  isComplete: boolean;\n  error: ChangeSetError | ApolloError | undefined;\n  reset: () => void;\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Internal implementation:"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"apply()"})," sets ",(0,r.jsx)(n.code,{children:"isApplyingRef.current = true"})," then calls the apply mutation"]}),"\n",(0,r.jsxs)(n.li,{children:["The progress subscription activates only when ",(0,r.jsx)(n.code,{children:"isApplyingRef.current"})," is true (via ",(0,r.jsx)(n.code,{children:"skip: !isApplyingRef.current"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:["On ",(0,r.jsx)(n.code,{children:"onComplete"})," or ",(0,r.jsx)(n.code,{children:"onError"})," from the subscription, ",(0,r.jsx)(n.code,{children:"isApplyingRef.current"})," is cleared"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"reset()"})," clears all local state for re-use"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"const { apply, progress, isApplying, isComplete, error } =\n  useApplyWithProgress(cs.id, {\n    onComplete: () => {\n      toast.success('All changes applied!');\n      navigate('/dashboard');\n    },\n    onError: (err) => {\n      toast.error('Apply failed');\n    },\n  });\n\nreturn (\n  <div>\n    <Button\n      onClick={apply}\n      disabled={isApplying || isComplete}\n    >\n      {isApplying ? 'Applying\u2026' : isComplete ? 'Applied' : 'Apply Changes'}\n    </Button>\n\n    {isApplying && (\n      <ProgressBar\n        value={progress?.progressPercent ?? 0}\n        label={`${progress?.currentItem?.name ?? '\u2026'} (${progress?.appliedCount}/${progress?.totalCount})`}\n        eta={progress?.estimatedRemainingMs}\n      />\n    )}\n\n    {error && <ErrorBanner message={(error as Error).message} />}\n  </div>\n);\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"cache-eviction-on-delete",children:"Cache Eviction on Delete"}),"\n",(0,r.jsxs)(n.p,{children:["When ",(0,r.jsx)(n.code,{children:"useDeleteChangeSet"})," executes successfully, the Apollo ",(0,r.jsx)(n.code,{children:"update"})," callback removes the ",(0,r.jsx)(n.code,{children:"ChangeSet"})," object from the in-memory cache and runs garbage collection:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"// useChangeSetMutations.ts:586\nconst [mutation] = useMutation(DELETE_CHANGE_SET_MUTATION, {\n  update(cache, { data }, { variables }) {\n    if (data?.deleteChangeSet?.success) {\n      cache.evict({\n        id: cache.identify({\n          __typename: 'ChangeSet',\n          id: variables?.changeSetId,\n        }),\n      });\n      cache.gc();\n    }\n  },\n});\n"})}),"\n",(0,r.jsx)(n.p,{children:"This ensures:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["The deleted change set disappears from every ",(0,r.jsx)(n.code,{children:"useChangeSets"})," result immediately without waiting for a refetch."]}),"\n",(0,r.jsxs)(n.li,{children:["Any component currently rendering that change set will receive ",(0,r.jsx)(n.code,{children:"undefined"})," and should handle it (e.g. redirect to the list page)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"cache.gc()"})," removes any dangling ",(0,r.jsx)(n.code,{children:"ChangeSetItem"}),", ",(0,r.jsx)(n.code,{children:"ChangeSetError"}),", and ",(0,r.jsx)(n.code,{children:"RollbackStep"})," objects that were only referenced by the now-evicted change set."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["The analogous pattern exists in ",(0,r.jsx)(n.code,{children:"useDeleteResource"})," in the resource mutations module (see ",(0,r.jsx)(n.code,{children:"libs/api-client/queries/src/resources/useResourceMutations.ts:308"}),")."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"cross-references",children:"Cross-References"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"./intro.md"})})," \u2014 Library overview and import aliases"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"./apollo-client.md"})})," \u2014 Apollo Client setup, InMemoryCache, type policies referenced by change set queries"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"./websocket-subscriptions.md"})})," \u2014 WebSocket transport that powers ",(0,r.jsx)(n.code,{children:"useChangeSetProgressSubscription"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"./universal-state-resource-model.md"})})," \u2014 The ",(0,r.jsx)(n.code,{children:"Resource"})," model and ",(0,r.jsx)(n.code,{children:"useResourceMutations"})," that Change Sets operate on"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"./domain-query-hooks.md"})})," \u2014 Domain hooks that compose Change Sets for specific workflows (e.g. VPN setup wizard)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"./service-lifecycle.md"})})," \u2014 Service install/uninstall flows that use Change Sets for atomic feature provisioning"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);