"use strict";(globalThis.webpackChunk_nas_net_docs=globalThis.webpackChunk_nas_net_docs||[]).push([[26572],{34250:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"guides/error-handling-patterns","title":"Error Handling Patterns","description":"Reference: libs/core/forms/src/ | Universal State v2 Layer 2 (Validation & Error Processing)","source":"@site/../../libs/core/docs/guides/error-handling-patterns.md","sourceDirName":"guides","slug":"/guides/error-handling-patterns","permalink":"/docs/core/guides/error-handling-patterns","draft":false,"unlisted":false,"editUrl":"https://github.com/nasnet-community/nasnet-panel/tree/main/../../libs/core/docs/guides/error-handling-patterns.md","tags":[],"version":"current","sidebarPosition":8,"frontMatter":{"sidebar_position":8,"title":"Error Handling Patterns"},"sidebar":"sidebar","previous":{"title":"Introduction","permalink":"/docs/core/intro"},"next":{"title":"GraphQL Integration Guide","permalink":"/docs/core/guides/graphql-integration-guide"}}');var i=n(31085),t=n(71184);const a={sidebar_position:8,title:"Error Handling Patterns"},o="Error Handling Patterns in NasNetConnect",l={},d=[{value:"Table of Contents",id:"table-of-contents",level:2},{value:"Error Type Hierarchy",id:"error-type-hierarchy",level:2},{value:"ValidationError",id:"validationerror",level:3},{value:"ValidationWarning",id:"validationwarning",level:3},{value:"ResourceConflict",id:"resourceconflict",level:3},{value:"ValidationStageResult",id:"validationstageresult",level:3},{value:"ValidationResult",id:"validationresult",level:3},{value:"Backend Error to Form Error Mapping",id:"backend-error-to-form-error-mapping",level:2},{value:"mapBackendErrorsToForm()",id:"mapbackenderrorstoform",level:3},{value:"clearServerErrors()",id:"clearservererrors",level:3},{value:"toFormError()",id:"toformerror",level:3},{value:"groupErrorsByField()",id:"grouperrorsbyfield",level:3},{value:"combineFieldErrors()",id:"combinefielderrors",level:3},{value:"i18n Error Messages",id:"i18n-error-messages",level:2},{value:"createZodErrorMap()",id:"createzoderrormap",level:3},{value:"DEFAULT_ERROR_MESSAGES",id:"default_error_messages",level:3},{value:"setGlobalErrorMap()",id:"setglobalerrormap",level:3},{value:"formatValidationError()",id:"formatvalidationerror",level:3},{value:"Error Flow Through Validation Pipeline",id:"error-flow-through-validation-pipeline",level:2},{value:"Stage 1: Schema (Client-Side)",id:"stage-1-schema-client-side",level:3},{value:"Stage 2: Syntax (Client-Side)",id:"stage-2-syntax-client-side",level:3},{value:"Stage 3: Cross-Resource (Backend)",id:"stage-3-cross-resource-backend",level:3},{value:"Stage 4: Dependencies (Backend)",id:"stage-4-dependencies-backend",level:3},{value:"Stage 5: Network (Backend)",id:"stage-5-network-backend",level:3},{value:"Stage 6: Platform (Backend)",id:"stage-6-platform-backend",level:3},{value:"Stage 7: Dry-Run (Backend)",id:"stage-7-dry-run-backend",level:3},{value:"Error Display Patterns",id:"error-display-patterns",level:2},{value:"Pattern 1: Field-Level Errors",id:"pattern-1-field-level-errors",level:3},{value:"Pattern 2: Form-Level Error Summary",id:"pattern-2-form-level-error-summary",level:3},{value:"Pattern 3: Suggested Fixes",id:"pattern-3-suggested-fixes",level:3},{value:"Pattern 4: Resource Conflict Display",id:"pattern-4-resource-conflict-display",level:3},{value:"Pattern 5: Warning Display",id:"pattern-5-warning-display",level:3},{value:"Pattern 6: Clearing Errors on Field Edit",id:"pattern-6-clearing-errors-on-field-edit",level:3},{value:"Code Examples",id:"code-examples",level:2},{value:"Complete Form with Error Handling",id:"complete-form-with-error-handling",level:3},{value:"Using with Validation Pipeline",id:"using-with-validation-pipeline",level:3},{value:"Testing Error Scenarios",id:"testing-error-scenarios",level:2},{value:"Unit Test Example",id:"unit-test-example",level:3},{value:"Integration Test Example",id:"integration-test-example",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Related Documentation",id:"related-documentation",level:2}];function c(e){const r={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.header,{children:(0,i.jsx)(r.h1,{id:"error-handling-patterns-in-nasnetconnect",children:"Error Handling Patterns in NasNetConnect"})}),"\n",(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.strong,{children:"Reference:"})," ",(0,i.jsx)(r.code,{children:"libs/core/forms/src/"})," | Universal State v2 Layer 2 (Validation & Error Processing)"]}),"\n",(0,i.jsx)(r.p,{children:"Error handling in NasNetConnect follows a multi-layered approach that bridges backend validation errors with frontend form field errors. This guide documents the error type hierarchy, mapping patterns, and best practices for displaying errors to users."}),"\n",(0,i.jsx)(r.h2,{id:"table-of-contents",children:"Table of Contents"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.a,{href:"#error-type-hierarchy",children:"Error Type Hierarchy"})}),"\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.a,{href:"#backend-error-to-form-error-mapping",children:"Backend Error to Form Error Mapping"})}),"\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.a,{href:"#i18n-error-messages",children:"i18n Error Messages"})}),"\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.a,{href:"#error-flow-through-validation-pipeline",children:"Error Flow Through Validation Pipeline"})}),"\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.a,{href:"#error-display-patterns",children:"Error Display Patterns"})}),"\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.a,{href:"#code-examples",children:"Code Examples"})}),"\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.a,{href:"#testing-error-scenarios",children:"Testing Error Scenarios"})}),"\n"]}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"error-type-hierarchy",children:"Error Type Hierarchy"}),"\n",(0,i.jsxs)(r.p,{children:["NasNetConnect uses a structured error type system to handle validation failures at different levels. All error types are defined in ",(0,i.jsx)(r.code,{children:"libs/core/forms/src/types.ts"}),"."]}),"\n",(0,i.jsx)(r.h3,{id:"validationerror",children:"ValidationError"}),"\n",(0,i.jsx)(r.p,{children:"The primary error type for validation failures. Represents a single validation error that occurred during any stage of the validation pipeline."}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-typescript",children:"interface ValidationError {\n  code: string;           // Machine-readable error code (e.g., 'PORT_CONFLICT')\n  message: string;        // Human-readable error message for display\n  fieldPath?: string;     // Nested field path (e.g., 'peers.0.endpoint', 'ipConfig.address')\n  resourceUuid?: string;  // UUID of conflicting/related resource\n  suggestedFix?: string;  // Optional suggestion for how to resolve the error\n}\n"})}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Common Error Codes:"})}),"\n",(0,i.jsxs)(r.table,{children:[(0,i.jsx)(r.thead,{children:(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.th,{children:"Code"}),(0,i.jsx)(r.th,{children:"Description"}),(0,i.jsx)(r.th,{children:"Example"})]})}),(0,i.jsxs)(r.tbody,{children:[(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"PORT_IN_USE"})}),(0,i.jsx)(r.td,{children:"Port is already allocated"}),(0,i.jsx)(r.td,{children:"Port 22 is in use by SSH service"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"IP_CONFLICT"})}),(0,i.jsx)(r.td,{children:"IP address already assigned"}),(0,i.jsx)(r.td,{children:"192.168.1.1 is assigned to WAN interface"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"VLAN_OVERLAP"})}),(0,i.jsx)(r.td,{children:"VLAN range overlaps with another"}),(0,i.jsx)(r.td,{children:"VLAN 100-110 overlaps with existing 105-115"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"NAME_DUPLICATE"})}),(0,i.jsx)(r.td,{children:"Resource name already exists"}),(0,i.jsx)(r.td,{children:'Bridge named "br-main" already exists'})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"INVALID_FORMAT"})}),(0,i.jsx)(r.td,{children:"Value doesn't match expected format"}),(0,i.jsx)(r.td,{children:"Email must contain @ symbol"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"MISSING_DEPENDENCY"})}),(0,i.jsx)(r.td,{children:"Required dependency missing"}),(0,i.jsx)(r.td,{children:"VPN requires active WAN connection"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"ROUTER_UNSUPPORTED"})}),(0,i.jsx)(r.td,{children:"Feature not supported on this router"}),(0,i.jsx)(r.td,{children:"Feature requires RouterOS v6.48+"})]})]})]}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Example:"})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-typescript",children:"const error: ValidationError = {\n  code: 'PORT_IN_USE',\n  message: 'Port 22 is already in use by the SSH service',\n  fieldPath: 'port',\n  resourceUuid: 'ssh-service-uuid',\n  suggestedFix: 'Change to port 2222 or disable the SSH service'\n};\n"})}),"\n",(0,i.jsx)(r.h3,{id:"validationwarning",children:"ValidationWarning"}),"\n",(0,i.jsx)(r.p,{children:"Non-blocking warnings that indicate potential issues but don't prevent validation from passing. Warnings are raised when something might be problematic but is technically valid."}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-typescript",children:"interface ValidationWarning {\n  code: string;      // Machine-readable warning code\n  message: string;   // Human-readable message\n  fieldPath?: string; // Optional field path\n}\n"})}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Common Warning Codes:"})}),"\n",(0,i.jsxs)(r.table,{children:[(0,i.jsx)(r.thead,{children:(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.th,{children:"Code"}),(0,i.jsx)(r.th,{children:"Description"})]})}),(0,i.jsxs)(r.tbody,{children:[(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"RISKY_SETTING"})}),(0,i.jsx)(r.td,{children:"Configuration could cause issues (e.g., disabling firewall)"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"PERFORMANCE_IMPACT"})}),(0,i.jsx)(r.td,{children:"Change may impact performance (e.g., enabling packet inspection)"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"DEPRECATION"})}),(0,i.jsx)(r.td,{children:"Feature is deprecated but still works"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"UNUSUAL_VALUE"})}),(0,i.jsx)(r.td,{children:"Setting deviates significantly from common patterns"})]})]})]}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Example:"})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-typescript",children:"const warning: ValidationWarning = {\n  code: 'RISKY_SETTING',\n  message: 'Disabling the firewall will expose your network to threats',\n  fieldPath: 'firewall.enabled'\n};\n"})}),"\n",(0,i.jsx)(r.h3,{id:"resourceconflict",children:"ResourceConflict"}),"\n",(0,i.jsx)(r.p,{children:"Detailed information about conflicts with other resources in the network. Provides context about what resource is conflicting and how."}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-typescript",children:"interface ResourceConflict {\n  type: ConflictType;                    // Type of conflict: 'ip' | 'port' | 'vlan' | 'name' | 'other'\n  fieldPath: string;                     // Field that has the conflict\n  conflictingResourceUuid: string;        // UUID of the conflicting resource\n  conflictingResourceName: string;        // Human-readable name of conflicting resource\n  currentValue: string;                  // Value causing conflict\n  conflictingValue: string;               // Value it conflicts with\n  suggestedFix?: string;                  // How to resolve conflict\n}\n"})}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Example:"})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-typescript",children:"const conflict: ResourceConflict = {\n  type: 'port',\n  fieldPath: 'port',\n  conflictingResourceUuid: 'service-123',\n  conflictingResourceName: 'VPN Service',\n  currentValue: '1194',\n  conflictingValue: '1194',\n  suggestedFix: 'Use port 1195 or higher'\n};\n"})}),"\n",(0,i.jsx)(r.h3,{id:"validationstageresult",children:"ValidationStageResult"}),"\n",(0,i.jsx)(r.p,{children:"Result object from a single validation stage. Contains all errors, warnings, and metadata about that stage's execution."}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-typescript",children:"interface ValidationStageResult {\n  stage: ValidationStage;        // Which stage: 'schema' | 'syntax' | 'cross-resource' | etc.\n  status: ValidationStageStatus; // Status: 'pending' | 'running' | 'passed' | 'failed' | 'skipped'\n  readonly errors: readonly ValidationError[];     // Errors from this stage\n  readonly warnings: readonly ValidationWarning[];  // Warnings from this stage\n  durationMs?: number;           // Time taken to execute this stage (ms)\n}\n"})}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Example:"})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-typescript",children:"const stageResult: ValidationStageResult = {\n  stage: 'cross-resource',\n  status: 'failed',\n  errors: [\n    {\n      code: 'PORT_IN_USE',\n      message: 'Port 1194 is already in use',\n      fieldPath: 'port'\n    }\n  ],\n  warnings: [],\n  durationMs: 245\n};\n"})}),"\n",(0,i.jsx)(r.h3,{id:"validationresult",children:"ValidationResult"}),"\n",(0,i.jsx)(r.p,{children:"The complete validation result after all applicable stages have executed. This is what's returned from the validation pipeline."}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-typescript",children:"interface ValidationResult {\n  isValid: boolean;                    // true if no errors occurred\n  stages: ValidationStageResult[];      // Results from all executed stages\n  errors: ValidationError[];            // Flattened list of all errors\n  conflicts: ResourceConflict[];        // All cross-resource conflicts detected\n}\n"})}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Example:"})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-typescript",children:"const result: ValidationResult = {\n  isValid: false,\n  stages: [\n    { stage: 'schema', status: 'passed', errors: [], warnings: [] },\n    { stage: 'syntax', status: 'passed', errors: [], warnings: [] },\n    {\n      stage: 'cross-resource',\n      status: 'failed',\n      errors: [{ code: 'PORT_IN_USE', message: 'Port is in use', fieldPath: 'port' }],\n      warnings: []\n    }\n  ],\n  errors: [{ code: 'PORT_IN_USE', message: 'Port is in use', fieldPath: 'port' }],\n  conflicts: [{ type: 'port', fieldPath: 'port', conflictingResourceUuid: '...', ... }]\n};\n"})}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"backend-error-to-form-error-mapping",children:"Backend Error to Form Error Mapping"}),"\n",(0,i.jsxs)(r.p,{children:["The ",(0,i.jsx)(r.code,{children:"mapBackendErrors.ts"})," module provides utilities to convert backend validation errors into React Hook Form field errors. This bridges the gap between server-side validation and client-side form state."]}),"\n",(0,i.jsx)(r.h3,{id:"mapbackenderrorstoform",children:"mapBackendErrorsToForm()"}),"\n",(0,i.jsxs)(r.p,{children:["Maps an array of backend ",(0,i.jsx)(r.code,{children:"ValidationError"})," objects to React Hook Form field errors."]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-typescript",children:"function mapBackendErrorsToForm<T extends FieldValues>(\n  errors: ValidationError[],\n  setError: UseFormSetError<T>\n): void\n"})}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"What it does:"})}),"\n",(0,i.jsxs)(r.ol,{children:["\n",(0,i.jsx)(r.li,{children:"Iterates through each backend error"}),"\n",(0,i.jsxs)(r.li,{children:["If the error has a ",(0,i.jsx)(r.code,{children:"fieldPath"}),", sets that field as having a server-type error"]}),"\n",(0,i.jsx)(r.li,{children:"Associates the error message with the field"}),"\n",(0,i.jsxs)(r.li,{children:["Handles nested paths (e.g., ",(0,i.jsx)(r.code,{children:"peers.0.endpoint"}),")"]}),"\n"]}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Usage:"})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-typescript",children:"import { mapBackendErrorsToForm } from '@nasnet/core/forms';\n\nfunction CreateVPNForm() {\n  const form = useForm({ schema: vpnSchema });\n\n  async function onSubmit(data) {\n    const result = await createVPNMutation({ variables: { data } });\n\n    // If validation failed on backend\n    if (!result.isValid) {\n      // Map backend errors to form fields\n      mapBackendErrorsToForm(result.errors, form.setError);\n      return;\n    }\n\n    // Success handling\n  }\n\n  return <form onSubmit={form.handleSubmit(onSubmit)}>...</form>;\n}\n"})}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Key Points:"})}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:["Only errors with a ",(0,i.jsx)(r.code,{children:"fieldPath"})," are set on the form (root errors are logged separately)"]}),"\n",(0,i.jsxs)(r.li,{children:["Error type is always ",(0,i.jsx)(r.code,{children:"'server'"})," to distinguish from client-side validation"]}),"\n",(0,i.jsx)(r.li,{children:"Works with nested field paths automatically"}),"\n",(0,i.jsx)(r.li,{children:"Non-destructive: doesn't clear existing field errors"}),"\n"]}),"\n",(0,i.jsx)(r.h3,{id:"clearservererrors",children:"clearServerErrors()"}),"\n",(0,i.jsx)(r.p,{children:"Clears all server-type errors from the form before re-validation. Call this before making a new API call to prevent stale server errors."}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-typescript",children:"function clearServerErrors<T extends FieldValues>(\n  errors: Record<string, { type?: string }>,\n  clearErrors: UseFormClearErrors<T>\n): void\n"})}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Usage:"})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-typescript",children:"import { clearServerErrors } from '@nasnet/core/forms';\n\nasync function onFieldChange(field: string) {\n  // Clear previous server errors before revalidating\n  clearServerErrors(form.formState.errors, form.clearErrors);\n\n  // Re-validate with backend\n  const result = await validateFieldMutation({ variables: { field, value } });\n\n  if (!result.isValid) {\n    mapBackendErrorsToForm(result.errors, form.setError);\n  }\n}\n"})}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Key Points:"})}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:["Only clears errors with ",(0,i.jsx)(r.code,{children:"type: 'server'"})]}),"\n",(0,i.jsx)(r.li,{children:"Preserves client-side validation errors"}),"\n",(0,i.jsx)(r.li,{children:"Useful when user is actively editing a field with previous server errors"}),"\n",(0,i.jsx)(r.li,{children:"Prevents stale errors from appearing after successful corrections"}),"\n"]}),"\n",(0,i.jsx)(r.h3,{id:"toformerror",children:"toFormError()"}),"\n",(0,i.jsxs)(r.p,{children:["Converts a single ",(0,i.jsx)(r.code,{children:"ValidationError"})," to a React Hook Form error object."]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-typescript",children:"function toFormError(error: ValidationError): {\n  type: string;\n  message: string;\n}\n"})}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Usage:"})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-typescript",children:"const backendError: ValidationError = {\n  code: 'EMAIL_EXISTS',\n  message: 'Email already registered'\n};\n\nconst formError = toFormError(backendError);\n// { type: 'server', message: 'Email already registered' }\n"})}),"\n",(0,i.jsx)(r.h3,{id:"grouperrorsbyfield",children:"groupErrorsByField()"}),"\n",(0,i.jsxs)(r.p,{children:["Groups errors by their ",(0,i.jsx)(r.code,{children:"fieldPath"})," for batch processing or display."]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-typescript",children:"function groupErrorsByField(\n  errors: ValidationError[]\n): Map<string, ValidationError[]>\n"})}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Usage:"})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-typescript",children:"import { groupErrorsByField } from '@nasnet/core/forms';\n\nconst errors = [\n  { fieldPath: 'email', message: 'Already exists' },\n  { fieldPath: 'email', message: 'Invalid domain' },\n  { fieldPath: 'name', message: 'Too short' }\n];\n\nconst grouped = groupErrorsByField(errors);\n// Map {\n//   'email' => [error1, error2],\n//   'name' => [error3]\n// }\n\n// Now display all errors for a field\ngrouped.get('email')?.forEach(err => console.log(err.message));\n// \"Already exists\"\n// \"Invalid domain\"\n"})}),"\n",(0,i.jsx)(r.h3,{id:"combinefielderrors",children:"combineFieldErrors()"}),"\n",(0,i.jsx)(r.p,{children:"Creates a single formatted error message from multiple errors on the same field."}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-typescript",children:"function combineFieldErrors(errors: ValidationError[]): string\n"})}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Usage:"})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-typescript",children:"import { combineFieldErrors } from '@nasnet/core/forms';\n\nconst errors = [\n  { fieldPath: 'email', message: 'Already registered' },\n  { fieldPath: 'email', message: 'Blocked domain' }\n];\n\nconst message = combineFieldErrors(errors);\n// \"Already registered. Blocked domain\"\n"})}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Key Points:"})}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"Empty array returns empty string"}),"\n",(0,i.jsx)(r.li,{children:"Single error returns just that message"}),"\n",(0,i.jsx)(r.li,{children:"Multiple errors joined with periods and spaces"}),"\n",(0,i.jsx)(r.li,{children:"Useful for display in error messages or tooltips"}),"\n"]}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"i18n-error-messages",children:"i18n Error Messages"}),"\n",(0,i.jsxs)(r.p,{children:["Error messages support internationalization through the ",(0,i.jsx)(r.code,{children:"error-messages.ts"})," module. Validation error codes map to translation keys for multi-language support."]}),"\n",(0,i.jsx)(r.h3,{id:"createzoderrormap",children:"createZodErrorMap()"}),"\n",(0,i.jsx)(r.p,{children:"Creates a custom Zod error map that integrates with i18n. Maps Zod issue codes to translation keys."}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-typescript",children:"function createZodErrorMap(\n  t: TranslateFunction = defaultTranslate\n): ZodErrorMap\n"})}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"The Translation Function:"})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-typescript",children:"type TranslateFunction = (\n  key: string,\n  params?: Record<string, string | number>\n) => string;\n"})}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Usage with react-i18next:"})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-typescript",children:"import { useTranslation } from 'react-i18next';\nimport { createZodErrorMap } from '@nasnet/core/forms';\n\nfunction MyForm() {\n  const { t } = useTranslation('validation');\n\n  // Option 1: Use locally\n  const schema = z.string().email().parse(input, { errorMap: createZodErrorMap(t) });\n\n  // Option 2: Set globally\n  setGlobalErrorMap(t);\n  const schema = z.string().email();\n  schema.parse(input); // Uses the global error map\n}\n"})}),"\n",(0,i.jsx)(r.h3,{id:"default_error_messages",children:"DEFAULT_ERROR_MESSAGES"}),"\n",(0,i.jsx)(r.p,{children:"Pre-defined English error messages. Maps validation codes to human-readable strings."}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-typescript",children:"const DEFAULT_ERROR_MESSAGES: Record<string, string> = {\n  'validation.required': 'This field is required',\n  'validation.string.min': 'Must be at least {{min}} characters',\n  'validation.string.max': 'Must be at most {{max}} characters',\n  'validation.number.min': 'Must be at least {{min}}',\n  'validation.number.max': 'Must be at most {{max}}',\n  'validation.email.invalid': 'Please enter a valid email address',\n  'validation.url.invalid': 'Please enter a valid URL',\n  // ... 18 total default messages\n};\n"})}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Template Variables:"})}),"\n",(0,i.jsxs)(r.p,{children:["Messages support template interpolation using ",(0,i.jsx)(r.code,{children:"{{variableName}}"})," syntax:"]}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"{{min}}"}),", ",(0,i.jsx)(r.code,{children:"{{max}}"})," - for length/value constraints"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"{{length}}"})," - for exact length requirements"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"{{expected}}"})," - for type mismatch messages"]}),"\n"]}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Example:"})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-typescript",children:"defaultTranslate('validation.string.min', { min: 5 });\n// \"Must be at least 5 characters\"\n"})}),"\n",(0,i.jsx)(r.h3,{id:"setglobalerrormap",children:"setGlobalErrorMap()"}),"\n",(0,i.jsx)(r.p,{children:"Sets the global Zod error map for all future schemas. Useful when you want all validation errors to use i18n."}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-typescript",children:"function setGlobalErrorMap(t?: TranslateFunction): void\n"})}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Usage:"})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-typescript",children:"import { setGlobalErrorMap } from '@nasnet/core/forms';\nimport { useTranslation } from 'react-i18next';\n\n// In your app initialization\nfunction App() {\n  const { t } = useTranslation('validation');\n\n  // Set once at app startup\n  setGlobalErrorMap(t);\n\n  return <Router>...</Router>;\n}\n"})}),"\n",(0,i.jsx)(r.h3,{id:"formatvalidationerror",children:"formatValidationError()"}),"\n",(0,i.jsx)(r.p,{children:"Utility function to safely format error objects for display. Handles various input types."}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-typescript",children:"function formatValidationError(\n  error: string | { message: string } | undefined\n): string\n"})}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Usage:"})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-typescript",children:"import { formatValidationError } from '@nasnet/core/forms';\n\n// From string\nformatValidationError('Email is invalid');\n// \"Email is invalid\"\n\n// From error object\nformatValidationError({ message: 'Email is invalid' });\n// \"Email is invalid\"\n\n// From undefined/null\nformatValidationError(undefined);\n// \"\"\n"})}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"error-flow-through-validation-pipeline",children:"Error Flow Through Validation Pipeline"}),"\n",(0,i.jsx)(r.p,{children:"Errors flow through the 7-stage validation pipeline, with different error types being generated at each stage:"}),"\n",(0,i.jsx)(r.h3,{id:"stage-1-schema-client-side",children:"Stage 1: Schema (Client-Side)"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Error Type:"})," Zod schema violations"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Examples:"})," Type mismatches, missing required fields"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Mapping:"})," Zod errors \u2192 ValidationError"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Message Source:"})," i18n or default messages"]}),"\n"]}),"\n",(0,i.jsx)(r.h3,{id:"stage-2-syntax-client-side",children:"Stage 2: Syntax (Client-Side)"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Error Type:"})," Format violations"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Examples:"})," Invalid IP addresses, malformed email, bad CIDR notation"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Mapping:"})," Syntax validators \u2192 ValidationError"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Message Source:"})," Custom validators"]}),"\n"]}),"\n",(0,i.jsx)(r.h3,{id:"stage-3-cross-resource-backend",children:"Stage 3: Cross-Resource (Backend)"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Error Type:"})," Resource conflicts"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Examples:"})," Duplicate IPs, port conflicts, name collisions"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Mapping:"})," Backend conflict detection \u2192 ValidationError + ResourceConflict"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Message Source:"})," Backend API"]}),"\n"]}),"\n",(0,i.jsx)(r.h3,{id:"stage-4-dependencies-backend",children:"Stage 4: Dependencies (Backend)"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Error Type:"})," Missing or invalid dependencies"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Examples:"})," WAN interface required but not active"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Mapping:"})," Dependency graph analysis \u2192 ValidationError"]}),"\n"]}),"\n",(0,i.jsx)(r.h3,{id:"stage-5-network-backend",children:"Stage 5: Network (Backend)"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Error Type:"})," Network-level validation"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Examples:"})," IP unreachable, VLAN unavailable"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Mapping:"})," Network tests \u2192 ValidationError"]}),"\n"]}),"\n",(0,i.jsx)(r.h3,{id:"stage-6-platform-backend",children:"Stage 6: Platform (Backend)"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Error Type:"})," Router capability issues"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Examples:"})," Feature not supported on RouterOS version"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Mapping:"})," Capability check \u2192 ValidationError"]}),"\n"]}),"\n",(0,i.jsx)(r.h3,{id:"stage-7-dry-run-backend",children:"Stage 7: Dry-Run (Backend)"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Error Type:"})," Simulation failures"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Examples:"})," Configuration would fail if applied"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Mapping:"})," Dry-run results \u2192 ValidationError"]}),"\n"]}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Error Propagation:"})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"Frontend Form\n     \u2193\n[User Input]\n     \u2193\nStage 1-2: Client Validation\n     \u251c\u2500 Zod Errors \u2192 mapZodErrors()\n     \u2514\u2500 \u2192 ValidationError[]\n          \u2193\n[Display field errors]\n     \u2193\nUser submits\n     \u2193\nStage 3-7: Backend Validation\n     \u251c\u2500 GraphQL Response with errors\n     \u2514\u2500 \u2192 mapBackendErrorsToForm()\n          \u2193\n[Display server errors on fields]\n     \u2193\nUser corrects and resubmits\n     \u251c\u2500 clearServerErrors() called first\n     \u2514\u2500 Cycle repeats\n"})}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"error-display-patterns",children:"Error Display Patterns"}),"\n",(0,i.jsx)(r.h3,{id:"pattern-1-field-level-errors",children:"Pattern 1: Field-Level Errors"}),"\n",(0,i.jsx)(r.p,{children:"Display errors directly on the form field where they occurred."}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-tsx",children:"function EmailField({ form }) {\n  const error = form.formState.errors.email;\n\n  return (\n    <div>\n      <input\n        {...form.register('email')}\n        aria-invalid={!!error}\n        className={error ? 'border-red-500' : ''}\n      />\n      {error && (\n        <span className=\"text-red-500 text-sm\" role=\"alert\">\n          {error.message}\n        </span>\n      )}\n    </div>\n  );\n}\n"})}),"\n",(0,i.jsx)(r.h3,{id:"pattern-2-form-level-error-summary",children:"Pattern 2: Form-Level Error Summary"}),"\n",(0,i.jsx)(r.p,{children:"Show all errors at the top of the form for critical failures."}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-tsx",children:'function ValidationErrorSummary({ result }) {\n  if (result.isValid) return null;\n\n  return (\n    <div className="bg-red-50 border border-red-200 rounded p-4 mb-4">\n      <h3 className="font-bold text-red-900 mb-2">Validation Failed</h3>\n      <ul className="space-y-1">\n        {result.errors.map((err, i) => (\n          <li key={i} className="text-red-700 text-sm">\n            {err.fieldPath && <strong>{err.fieldPath}: </strong>}\n            {err.message}\n          </li>\n        ))}\n      </ul>\n    </div>\n  );\n}\n'})}),"\n",(0,i.jsx)(r.h3,{id:"pattern-3-suggested-fixes",children:"Pattern 3: Suggested Fixes"}),"\n",(0,i.jsxs)(r.p,{children:["When an error has a ",(0,i.jsx)(r.code,{children:"suggestedFix"}),", display it as actionable help."]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-tsx",children:'function ErrorWithSuggestion({ error }) {\n  return (\n    <div className="border-l-4 border-red-500 p-3 bg-red-50">\n      <p className="font-semibold text-red-900">{error.message}</p>\n      {error.suggestedFix && (\n        <p className="text-sm text-red-700 mt-1">\n          \ud83d\udca1 Suggestion: {error.suggestedFix}\n        </p>\n      )}\n    </div>\n  );\n}\n'})}),"\n",(0,i.jsx)(r.h3,{id:"pattern-4-resource-conflict-display",children:"Pattern 4: Resource Conflict Display"}),"\n",(0,i.jsx)(r.p,{children:"When a conflict exists with another resource, show context."}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-tsx",children:"function ConflictDisplay({ conflict }) {\n  return (\n    <div className=\"border-l-4 border-amber-500 p-3 bg-amber-50\">\n      <p className=\"font-semibold text-amber-900\">\n        {conflict.type === 'port' && `Port ${conflict.currentValue}`}\n        {conflict.type === 'ip' && `IP ${conflict.currentValue}`}\n        {conflict.type === 'vlan' && `VLAN ${conflict.currentValue}`}\n        {' is already in use by '}\n        <strong>{conflict.conflictingResourceName}</strong>\n      </p>\n      <p className=\"text-sm text-amber-800 mt-1\">\n        Current value: {conflict.currentValue}\n        {' | Conflicting value: '}\n        {conflict.conflictingValue}\n      </p>\n      {conflict.suggestedFix && (\n        <p className=\"text-sm text-amber-700 mt-2\">\n          Suggested: {conflict.suggestedFix}\n        </p>\n      )}\n    </div>\n  );\n}\n"})}),"\n",(0,i.jsx)(r.h3,{id:"pattern-5-warning-display",children:"Pattern 5: Warning Display"}),"\n",(0,i.jsx)(r.p,{children:"Display warnings as non-blocking alerts."}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-tsx",children:'function WarningAlert({ warning }) {\n  return (\n    <div className="border-l-4 border-yellow-500 p-3 bg-yellow-50">\n      <p className="text-sm text-yellow-900">\n        <strong>Warning:</strong> {warning.message}\n      </p>\n    </div>\n  );\n}\n'})}),"\n",(0,i.jsx)(r.h3,{id:"pattern-6-clearing-errors-on-field-edit",children:"Pattern 6: Clearing Errors on Field Edit"}),"\n",(0,i.jsx)(r.p,{children:"Clear server errors when user starts editing a field."}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-tsx",children:"function FieldWithErrorClearance({ form, fieldPath }) {\n  return (\n    <input\n      {...form.register(fieldPath)}\n      onFocus={() => {\n        clearServerErrors(form.formState.errors, form.clearErrors);\n      }}\n    />\n  );\n}\n"})}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"code-examples",children:"Code Examples"}),"\n",(0,i.jsx)(r.h3,{id:"complete-form-with-error-handling",children:"Complete Form with Error Handling"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-tsx",children:"import { useForm } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport { z } from 'zod';\nimport { mapBackendErrorsToForm, clearServerErrors } from '@nasnet/core/forms';\n\nconst schema = z.object({\n  email: z.string().email('Invalid email'),\n  port: z.number().min(1).max(65535),\n  vpnName: z.string().min(1, 'Name required')\n});\n\nfunction CreateVPNForm() {\n  const form = useForm({\n    resolver: zodResolver(schema),\n    mode: 'onBlur'\n  });\n\n  async function onSubmit(data) {\n    try {\n      const result = await createVPNMutation({ variables: { data } });\n\n      if (!result.isValid) {\n        mapBackendErrorsToForm(result.errors, form.setError);\n        return;\n      }\n\n      // Success\n      navigate('/vpn-list');\n    } catch (error) {\n      // Handle network errors\n      form.setError('root', { message: 'Failed to create VPN' });\n    }\n  }\n\n  return (\n    <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n      {/* Server errors summary */}\n      {form.formState.errors.root && (\n        <div className=\"bg-red-50 p-3 rounded border border-red-200\">\n          {form.formState.errors.root.message}\n        </div>\n      )}\n\n      {/* Email field */}\n      <div>\n        <label htmlFor=\"email\">Email</label>\n        <input\n          {...form.register('email')}\n          id=\"email\"\n          onFocus={() => clearServerErrors(form.formState.errors, form.clearErrors)}\n        />\n        {form.formState.errors.email && (\n          <span className=\"text-red-500 text-sm\">\n            {form.formState.errors.email.message}\n          </span>\n        )}\n      </div>\n\n      {/* Port field */}\n      <div>\n        <label htmlFor=\"port\">Port</label>\n        <input\n          {...form.register('port', { valueAsNumber: true })}\n          id=\"port\"\n          type=\"number\"\n          onFocus={() => clearServerErrors(form.formState.errors, form.clearErrors)}\n        />\n        {form.formState.errors.port && (\n          <span className=\"text-red-500 text-sm\">\n            {form.formState.errors.port.message}\n          </span>\n        )}\n      </div>\n\n      {/* VPN name */}\n      <div>\n        <label htmlFor=\"vpnName\">VPN Name</label>\n        <input\n          {...form.register('vpnName')}\n          id=\"vpnName\"\n          onFocus={() => clearServerErrors(form.formState.errors, form.clearErrors)}\n        />\n        {form.formState.errors.vpnName && (\n          <span className=\"text-red-500 text-sm\">\n            {form.formState.errors.vpnName.message}\n          </span>\n        )}\n      </div>\n\n      <button type=\"submit\" disabled={form.formState.isSubmitting}>\n        {form.formState.isSubmitting ? 'Creating...' : 'Create VPN'}\n      </button>\n    </form>\n  );\n}\n"})}),"\n",(0,i.jsx)(r.h3,{id:"using-with-validation-pipeline",children:"Using with Validation Pipeline"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-tsx",children:"import { useValidationPipeline } from '@nasnet/core/forms';\nimport type { ValidationResult } from '@nasnet/core/forms';\n\nfunction WANConfigForm() {\n  const form = useForm({ schema: wanSchema });\n  const [validationResult, setValidationResult] = useState<ValidationResult | null>(null);\n\n  const pipeline = useValidationPipeline({\n    schema: wanSchema,\n    strategy: 'high', // Full 7-stage validation for high-risk WAN changes\n    resourceUuid: routerId,\n    enabled: form.formState.isDirty\n  });\n\n  async function onValidate() {\n    const result = await pipeline.validate(form.getValues());\n    setValidationResult(result);\n\n    if (!result.isValid) {\n      // Display all errors\n      result.errors.forEach(err => {\n        if (err.fieldPath) {\n          form.setError(err.fieldPath as any, {\n            type: 'server',\n            message: err.message\n          });\n        }\n      });\n\n      // Display conflicts\n      if (result.conflicts.length > 0) {\n        form.setError('root', {\n          message: `${result.conflicts.length} conflicts detected`\n        });\n      }\n    }\n  }\n\n  return (\n    <form>\n      {/* Validation progress */}\n      <div className=\"space-y-1\">\n        {pipeline.stages.map(stage => (\n          <div key={stage.stage} className=\"flex items-center gap-2\">\n            <span className=\"w-24 text-sm font-mono\">{stage.stage}</span>\n            <span className=\"text-xs text-gray-600\">\n              {stage.status === 'failed' ? '\u2717' : stage.status === 'passed' ? '\u2713' : '...'}\n            </span>\n            {stage.durationMs && (\n              <span className=\"text-xs text-gray-500\">({stage.durationMs}ms)</span>\n            )}\n          </div>\n        ))}\n      </div>\n\n      {/* Fields */}\n      {/* ... form fields ... */}\n\n      <button\n        type=\"button\"\n        onClick={onValidate}\n        disabled={pipeline.isValidating}\n      >\n        Validate Configuration\n      </button>\n\n      {validationResult && (\n        <div className={validationResult.isValid ? 'bg-green-50' : 'bg-red-50'} className=\"p-4 rounded mt-4\">\n          {validationResult.isValid ? (\n            <p className=\"text-green-900\">All validations passed!</p>\n          ) : (\n            <div>\n              <p className=\"font-bold text-red-900 mb-2\">Validation failed:</p>\n              <ul className=\"space-y-1\">\n                {validationResult.errors.map((err, i) => (\n                  <li key={i} className=\"text-red-700 text-sm\">\n                    {err.message}\n                  </li>\n                ))}\n              </ul>\n            </div>\n          )}\n        </div>\n      )}\n    </form>\n  );\n}\n"})}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"testing-error-scenarios",children:"Testing Error Scenarios"}),"\n",(0,i.jsx)(r.h3,{id:"unit-test-example",children:"Unit Test Example"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-typescript",children:"import { describe, it, expect } from 'vitest';\nimport {\n  mapBackendErrorsToForm,\n  groupErrorsByField,\n  combineFieldErrors\n} from '@nasnet/core/forms';\nimport type { ValidationError } from '@nasnet/core/forms';\n\ndescribe('Error Mapping', () => {\n  it('should group errors by field', () => {\n    const errors: ValidationError[] = [\n      { fieldPath: 'email', message: 'Already exists', code: 'DUPLICATE' },\n      { fieldPath: 'email', message: 'Invalid domain', code: 'INVALID_FORMAT' },\n      { fieldPath: 'port', message: 'In use', code: 'PORT_IN_USE' }\n    ];\n\n    const grouped = groupErrorsByField(errors);\n\n    expect(grouped.get('email')).toHaveLength(2);\n    expect(grouped.get('port')).toHaveLength(1);\n  });\n\n  it('should combine multiple errors for same field', () => {\n    const errors: ValidationError[] = [\n      { fieldPath: 'email', message: 'Already exists', code: 'DUPLICATE' },\n      { fieldPath: 'email', message: 'Invalid domain', code: 'INVALID_FORMAT' }\n    ];\n\n    const combined = combineFieldErrors(errors);\n\n    expect(combined).toBe('Already exists. Invalid domain');\n  });\n\n  it('should handle nested field paths', () => {\n    const errors: ValidationError[] = [\n      { fieldPath: 'peers.0.endpoint', message: 'Invalid endpoint', code: 'INVALID_FORMAT' }\n    ];\n\n    const grouped = groupErrorsByField(errors);\n\n    expect(grouped.has('peers.0.endpoint')).toBe(true);\n  });\n});\n"})}),"\n",(0,i.jsx)(r.h3,{id:"integration-test-example",children:"Integration Test Example"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-typescript",children:"describe('Form Error Handling', () => {\n  it('should map backend errors to form fields', async () => {\n    const { result } = renderHook(() => useForm({ schema: testSchema }));\n\n    const backendErrors: ValidationError[] = [\n      { fieldPath: 'email', message: 'Email already registered', code: 'DUPLICATE' },\n      { fieldPath: 'port', message: 'Port in use', code: 'PORT_IN_USE' }\n    ];\n\n    mapBackendErrorsToForm(backendErrors, result.current.setError);\n\n    await waitFor(() => {\n      expect(result.current.formState.errors.email?.message).toBe('Email already registered');\n      expect(result.current.formState.errors.port?.message).toBe('Port in use');\n    });\n  });\n});\n"})}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,i.jsxs)(r.ol,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Always provide fieldPath"})," - Errors without ",(0,i.jsx)(r.code,{children:"fieldPath"})," should be displayed as form-level errors, not field-level"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Use suggestedFix generously"})," - Help users understand how to resolve conflicts"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Clear server errors on field edit"})," - Users expect errors to disappear when they start typing"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Group similar errors"})," - Use ",(0,i.jsx)(r.code,{children:"groupErrorsByField()"})," when displaying multiple errors per field"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Distinguish error types"})," - Show conflicts differently from validation errors"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Localize messages"})," - Use i18n for user-facing error messages"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Handle nested paths"})," - Test with deeply nested field errors (e.g., ",(0,i.jsx)(r.code,{children:"peers.0.endpoint"}),")"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Don't repeat errors"})," - Use ",(0,i.jsx)(r.code,{children:"combineFieldErrors()"})," to avoid duplicate messages"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Display warnings prominently"})," - Don't bury non-blocking warnings in the UI"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Test error scenarios"})," - Include error cases in component tests"]}),"\n"]}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.a,{href:"/docs/core/guides/validation-pipeline",children:"Validation Pipeline"})," - Complete 7-stage validation flow"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.a,{href:"/docs/core/sub-libraries/forms",children:"Form Architecture"})," - Core forms library overview"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.a,{href:"/docs/core/guides/internationalization-flow",children:"i18n Flow"})," - Internationalization patterns"]}),"\n"]})]})}function h(e={}){const{wrapper:r}={...(0,t.R)(),...e.components};return r?(0,i.jsx)(r,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},71184:(e,r,n)=>{n.d(r,{R:()=>a,x:()=>o});var s=n(14041);const i={},t=s.createContext(i);function a(e){const r=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function o(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(t.Provider,{value:r},e.children)}}}]);