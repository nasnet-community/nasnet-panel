"use strict";(globalThis.webpackChunk_nas_net_docs=globalThis.webpackChunk_nas_net_docs||[]).push([[27409],{71184:(e,n,i)=>{i.d(n,{R:()=>l,x:()=>d});var r=i(14041);const s={},t=r.createContext(s);function l(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),r.createElement(t.Provider,{value:n},e.children)}},95282:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>d,default:()=>h,frontMatter:()=>l,metadata:()=>r,toc:()=>o});const r=JSON.parse('{"id":"operations/performance","title":"Performance Guide","description":"The apps/connect frontend operates under strict resource constraints driven by its deployment environment: a single Docker container running on a MikroTik router with limited CPU, RAM, and flash storage.","source":"@site/../connect/docs/operations/performance.md","sourceDirName":"operations","slug":"/operations/performance","permalink":"/docs/frontend/operations/performance","draft":false,"unlisted":false,"editUrl":"https://github.com/nasnet-community/nasnet-panel/tree/main/../connect/docs/operations/performance.md","tags":[],"version":"current","frontMatter":{},"sidebar":"sidebar","previous":{"title":"Development Workflow","permalink":"/docs/frontend/operations/development-workflow"},"next":{"title":"Storybook Guide","permalink":"/docs/frontend/operations/storybook"}}');var s=i(31085),t=i(71184);const l={},d="Performance Guide",a={},o=[{value:"Hard Constraints",id:"hard-constraints",level:2},{value:"Bundle Size Budget",id:"bundle-size-budget",level:2},{value:"Checking the Budget",id:"checking-the-budget",level:3},{value:"Adding Dependencies",id:"adding-dependencies",level:3},{value:"Manual Chunk Splitting",id:"manual-chunk-splitting",level:2},{value:"Route-Based Lazy Loading",id:"route-based-lazy-loading",level:2},{value:"Pattern",id:"pattern",level:3},{value:"Currently Lazy-Loaded Tabs",id:"currently-lazy-loaded-tabs",level:3},{value:"Preloading on Hover",id:"preloading-on-hover",level:3},{value:"Background Preload on Router Panel Entry",id:"background-preload-on-router-panel-entry",level:3},{value:"Skeleton Fallbacks",id:"skeleton-fallbacks",level:3},{value:"Virtualization for Large Lists",id:"virtualization-for-large-lists",level:2},{value:"<code>VirtualizedList</code>",id:"virtualizedlist",level:3},{value:"<code>VirtualizedTable</code>",id:"virtualizedtable",level:3},{value:"When to Use Virtualization",id:"when-to-use-virtualization",level:3},{value:"Memoization Patterns",id:"memoization-patterns",level:2},{value:"<code>React.memo</code>",id:"reactmemo",level:3},{value:"<code>useCallback</code> and <code>useMemo</code>",id:"usecallback-and-usememo",level:3},{value:"Apollo Client Cache Optimisation",id:"apollo-client-cache-optimisation",level:2},{value:"Field Key Arguments",id:"field-key-arguments",level:3},{value:"Cache Reads over Network Requests",id:"cache-reads-over-network-requests",level:3},{value:"Avoiding Over-Fetching",id:"avoiding-over-fetching",level:3},{value:"WebSocket Connection Management",id:"websocket-connection-management",level:2},{value:"Image and Asset Optimisation",id:"image-and-asset-optimisation",level:2},{value:"Production Build Settings",id:"production-build-settings",level:2},{value:"Measuring Performance",id:"measuring-performance",level:2},{value:"Bundle Analysis",id:"bundle-analysis",level:3},{value:"Runtime Performance",id:"runtime-performance",level:3},{value:"Core Web Vitals Targets",id:"core-web-vitals-targets",level:3}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"performance-guide",children:"Performance Guide"})}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"apps/connect"})," frontend operates under strict resource constraints driven by its deployment environment: a single Docker container running on a MikroTik router with limited CPU, RAM, and flash storage."]}),"\n",(0,s.jsx)(n.p,{children:"See also:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/frontend/architecture/build-system",children:"Build System"})," \u2014 Vite chunk splitting configuration"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/frontend/ui-system/overview",children:"UI System Overview"})," \u2014 component architecture"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/frontend/getting-started/key-commands",children:"Key Commands"})," \u2014 build and check commands"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"hard-constraints",children:"Hard Constraints"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Constraint"}),(0,s.jsx)(n.th,{children:"Target"}),(0,s.jsx)(n.th,{children:"Enforcer"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Docker image size"}),(0,s.jsx)(n.td,{children:"< 10 MB compressed"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"npm run docker:check-size"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Runtime RAM"}),(0,s.jsx)(n.td,{children:"< 50 MB"}),(0,s.jsx)(n.td,{children:"Manual monitoring"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Frontend bundle"}),(0,s.jsx)(n.td,{children:"< 3 MB gzipped"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"npm run build:check"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Cold start"}),(0,s.jsx)(n.td,{children:"< 5 s"}),(0,s.jsx)(n.td,{children:"Manual profiling"})]})]})]}),"\n",(0,s.jsxs)(n.p,{children:["The frontend bundle is embedded into the Go binary via ",(0,s.jsx)(n.code,{children:"go:embed"}),". Exceeding the 3 MB bundle budget makes it impossible to stay under the 10 MB Docker image target. These are not soft guidelines \u2014 CI enforces the bundle limit."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"bundle-size-budget",children:"Bundle Size Budget"}),"\n",(0,s.jsx)(n.h3,{id:"checking-the-budget",children:"Checking the Budget"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Build and report compressed sizes\nnpm run build:check\n# Equivalent to:\nnpx nx build connect && node scripts/check-bundle-size.mjs\n\n# Build with visual treemap (opens in browser)\nnpm run build:analyze\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Vite's ",(0,s.jsx)(n.code,{children:"reportCompressedSize: true"})," prints gzipped sizes for every chunk after each build. Review this output whenever adding a new dependency."]}),"\n",(0,s.jsx)(n.h3,{id:"adding-dependencies",children:"Adding Dependencies"}),"\n",(0,s.jsxs)(n.p,{children:["Before adding a ",(0,s.jsx)(n.code,{children:"npm install <package>"}),":"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Check the package size on ",(0,s.jsx)(n.a,{href:"https://bundlephobia.com",children:"bundlephobia.com"})]}),"\n",(0,s.jsx)(n.li,{children:"Consider whether the functionality already exists in a library already in the bundle"}),"\n",(0,s.jsxs)(n.li,{children:["Prefer smaller alternatives (e.g., ",(0,s.jsx)(n.code,{children:"date-fns"})," functions over full ",(0,s.jsx)(n.code,{children:"moment.js"}),")"]}),"\n",(0,s.jsxs)(n.li,{children:["If the package is only needed on one page, use dynamic ",(0,s.jsx)(n.code,{children:"import()"})," to keep it out of the initial bundle"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"manual-chunk-splitting",children:"Manual Chunk Splitting"}),"\n",(0,s.jsxs)(n.p,{children:["Vite's ",(0,s.jsx)(n.code,{children:"manualChunks"})," in ",(0,s.jsx)(n.code,{children:"apps/connect/vite.config.ts"})," splits vendor code into stable named chunks. Stable chunk names maximise browser cache hit rates \u2014 when app code changes, vendor chunks remain cached."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"// apps/connect/vite.config.ts\nrollupOptions: {\n  output: {\n    manualChunks: {\n      'vendor-react':     ['react', 'react-dom', 'scheduler'],\n      'vendor-router':    ['@tanstack/react-router'],\n      'vendor-graphql':   ['@apollo/client', 'graphql'],\n      'vendor-state':     ['zustand', 'xstate', '@xstate/react'],\n      'vendor-animation': ['framer-motion'],\n      'vendor-ui': [\n        '@radix-ui/react-dialog',\n        '@radix-ui/react-tabs',\n        '@radix-ui/react-toast',\n        '@radix-ui/react-switch',\n        '@radix-ui/react-select',\n        '@radix-ui/react-dropdown-menu',\n        '@radix-ui/react-popover',\n      ],\n      'vendor-table': ['@tanstack/react-table', '@tanstack/react-virtual'],\n      'vendor-forms': ['react-hook-form', '@hookform/resolvers', 'zod'],\n      'vendor-i18n':  ['i18next', 'react-i18next', 'i18next-http-backend', 'i18next-browser-languagedetector'],\n    },\n  },\n},\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Strategy:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"vendor-react"})," loads first and never changes \u2014 always cached after first visit"]}),"\n",(0,s.jsxs)(n.li,{children:["Heavy libraries like ",(0,s.jsx)(n.code,{children:"framer-motion"})," are isolated so they are not invalidated when app code changes"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"vendor-table"})," and ",(0,s.jsx)(n.code,{children:"vendor-forms"})," are only needed on specific pages \u2014 they benefit from lazy loading too"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"When adding a substantial new library, add it to an appropriate manual chunk (or create a new one) rather than letting it land in the catch-all app chunk."}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"route-based-lazy-loading",children:"Route-Based Lazy Loading"}),"\n",(0,s.jsxs)(n.p,{children:["Heavy tabs and pages are code-split at the route level using TanStack Router's file-based routing combined with ",(0,s.jsx)(n.code,{children:"createLazyWithPreload"}),"."]}),"\n",(0,s.jsx)(n.h3,{id:"pattern",children:"Pattern"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"// apps/connect/src/app/routes/router-panel/tabs/lazy.ts\nimport { createLazyWithPreload } from '@nasnet/ui/patterns';\n\nexport const [LazyFirewallTab, preloadFirewallTab] = createLazyWithPreload(\n  () => import('./FirewallTab').then((m) => ({ default: m.FirewallTab }))\n);\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:"// apps/connect/src/routes/router/$id/firewall.tsx\nimport { LazyBoundary } from '@nasnet/ui/patterns';\nimport { LazyFirewallTab } from '@/app/routes/router-panel/tabs/lazy';\n\nexport const Route = createFileRoute('/router/$id/firewall')({\n  component: () => (\n    <LazyBoundary fallback={<FirewallTabSkeleton />}>\n      <LazyFirewallTab />\n    </LazyBoundary>\n  ),\n});\n"})}),"\n",(0,s.jsx)(n.h3,{id:"currently-lazy-loaded-tabs",children:"Currently Lazy-Loaded Tabs"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Tab"}),(0,s.jsx)(n.th,{children:"Estimated Chunk"}),(0,s.jsx)(n.th,{children:"Reason"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"FirewallTab"}),(0,s.jsx)(n.td,{children:"~50 KB"}),(0,s.jsx)(n.td,{children:"Large rule tables with filtering"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"VPNTab"}),(0,s.jsx)(n.td,{children:"~45 KB"}),(0,s.jsx)(n.td,{children:"Protocol-specific form variants"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"LogsTab"}),(0,s.jsx)(n.td,{children:"~40 KB"}),(0,s.jsx)(n.td,{children:"Virtualization + log processing"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"DHCPTab"}),(0,s.jsx)(n.td,{children:"~35 KB"}),(0,s.jsx)(n.td,{children:"Lease table + pool management"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"DnsTab"}),(0,s.jsx)(n.td,{children:"~30 KB"}),(0,s.jsx)(n.td,{children:"Server list + static entries table"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"PluginStoreTab"}),(0,s.jsx)(n.td,{children:"~30 KB"}),(0,s.jsx)(n.td,{children:"Plugin marketplace UI"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"NetworkTab"}),(0,s.jsx)(n.td,{children:"~25 KB"}),(0,s.jsx)(n.td,{children:"Medium complexity"})]})]})]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Eagerly loaded"})," (lightweight, most-visited):"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"OverviewTab"})," \u2014 entry point for every router panel visit"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"WiFiTab"})," \u2014 simple interface list"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"preloading-on-hover",children:"Preloading on Hover"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"createLazyWithPreload"})," returns a ",(0,s.jsx)(n.code,{children:"[LazyComponent, preloadFn]"})," pair. The preload function can be called in ",(0,s.jsx)(n.code,{children:"onMouseEnter"})," on navigation links so the chunk is already in-flight before the user clicks:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:'<NavLink\n  to="/router/$id/firewall"\n  onMouseEnter={preloadFirewallTab}\n>\n  Firewall\n</NavLink>\n'})}),"\n",(0,s.jsx)(n.h3,{id:"background-preload-on-router-panel-entry",children:"Background Preload on Router Panel Entry"}),"\n",(0,s.jsxs)(n.p,{children:["When the user navigates into any router panel, all heavy tabs are preloaded in the background using ",(0,s.jsx)(n.code,{children:"requestIdleCallback"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"// apps/connect/src/app/routes/router-panel/tabs/lazy.ts\nexport function preloadAllHeavyTabs(): void {\n  const preload = () => {\n    preloadFirewallTab();\n    preloadLogsTab();\n    preloadDHCPTab();\n    preloadDnsTab();\n    preloadVPNTab();\n  };\n\n  if ('requestIdleCallback' in window) {\n    window.requestIdleCallback(preload, { timeout: 3000 });\n  } else {\n    setTimeout(preload, 1000);\n  }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"This ensures subsequent tab switches feel instant even on slow connections."}),"\n",(0,s.jsx)(n.h3,{id:"skeleton-fallbacks",children:"Skeleton Fallbacks"}),"\n",(0,s.jsxs)(n.p,{children:["Every lazy route provides an accurate skeleton component as the ",(0,s.jsx)(n.code,{children:"LazyBoundary"})," fallback. Skeletons mirror the real layout (header, grid structure, table placeholders) to minimise layout shift. See the ",(0,s.jsx)(n.a,{href:"/docs/frontend/operations/storybook",children:"Storybook Guide"})," for conventions on documenting skeletons."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"virtualization-for-large-lists",children:"Virtualization for Large Lists"}),"\n",(0,s.jsxs)(n.p,{children:["The project uses ",(0,s.jsx)(n.strong,{children:"TanStack Virtual"})," (",(0,s.jsx)(n.code,{children:"@tanstack/react-virtual"}),") for rendering large data sets. It is exposed via two pattern components in ",(0,s.jsx)(n.code,{children:"libs/ui/patterns/src/virtualization/"}),":"]}),"\n",(0,s.jsx)(n.h3,{id:"virtualizedlist",children:(0,s.jsx)(n.code,{children:"VirtualizedList"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:"import { VirtualizedList } from '@nasnet/ui/patterns';\n\n<VirtualizedList\n  items={firewallRules}        // array of any type\n  estimateSize={48}            // estimated row height in px\n  height=\"600px\"               // container height (required)\n  renderItem={({ item, virtualItem, measureRef }) => (\n    <FirewallRuleRow\n      key={virtualItem.key}\n      rule={item}\n      ref={measureRef}          // enables variable-height measurement\n    />\n  )}\n/>\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Automatic threshold:"})," Virtualization is enabled when ",(0,s.jsx)(n.code,{children:"items.length > 20"})," (the ",(0,s.jsx)(n.code,{children:"VIRTUALIZATION_THRESHOLD"})," constant). Below this threshold the component renders all items normally, avoiding the overhead of virtualization for small lists."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Features:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Variable-height items via ",(0,s.jsx)(n.code,{children:"measureElement"})," ref"]}),"\n",(0,s.jsx)(n.li,{children:"Scroll position restoration on navigation"}),"\n",(0,s.jsx)(n.li,{children:"Keyboard navigation (arrow keys, Home/End, PageUp/Down)"}),"\n",(0,s.jsx)(n.li,{children:"Platform-aware minimum row height (44 px on mobile for touch targets)"}),"\n",(0,s.jsxs)(n.li,{children:["WCAG AAA accessible (full keyboard + ARIA ",(0,s.jsx)(n.code,{children:"listbox"}),"/",(0,s.jsx)(n.code,{children:"option"})," roles)"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"virtualizedtable",children:(0,s.jsx)(n.code,{children:"VirtualizedTable"})}),"\n",(0,s.jsxs)(n.p,{children:["Similar API to ",(0,s.jsx)(n.code,{children:"VirtualizedList"})," but renders as a table with sticky headers. Used in the Logs tab and ARP table."]}),"\n",(0,s.jsx)(n.h3,{id:"when-to-use-virtualization",children:"When to Use Virtualization"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"List size"}),(0,s.jsx)(n.th,{children:"Approach"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"< 20 items"}),(0,s.jsx)(n.td,{children:"Render directly \u2014 no virtualization"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"20\u2013200 items"}),(0,s.jsxs)(n.td,{children:["Use ",(0,s.jsx)(n.code,{children:"VirtualizedList"})," or ",(0,s.jsx)(n.code,{children:"VirtualizedTable"})]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"> 200 items"}),(0,s.jsx)(n.td,{children:"Use virtualization; consider pagination too"})]})]})]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"memoization-patterns",children:"Memoization Patterns"}),"\n",(0,s.jsx)(n.h3,{id:"reactmemo",children:(0,s.jsx)(n.code,{children:"React.memo"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"React.memo"})," is used on inner virtualized row components and on list items that receive stable props:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:"// libs/ui/patterns/src/virtualization/VirtualizedList.tsx\nexport const VirtualizedList = React.memo(VirtualizedListInner) as VirtualizedListComponent;\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Apply ",(0,s.jsx)(n.code,{children:"React.memo"})," when:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"The component re-renders frequently (e.g., inside a virtualized list)"}),"\n",(0,s.jsx)(n.li,{children:"Props are simple and stable (primitives, stable object references)"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Avoid ",(0,s.jsx)(n.code,{children:"React.memo"})," on components that always receive new prop objects on each parent render \u2014 it adds comparison overhead without benefit."]}),"\n",(0,s.jsxs)(n.h3,{id:"usecallback-and-usememo",children:[(0,s.jsx)(n.code,{children:"useCallback"})," and ",(0,s.jsx)(n.code,{children:"useMemo"})]}),"\n",(0,s.jsxs)(n.p,{children:["Use ",(0,s.jsx)(n.code,{children:"useCallback"})," for event handlers passed as props to memoized children:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:"const handleRuleDelete = useCallback(\n  (ruleId: string) => deleteRule({ variables: { id: ruleId } }),\n  [deleteRule]\n);\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Use ",(0,s.jsx)(n.code,{children:"useMemo"})," for expensive derived data, not for simple object creation:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:"// Good \u2014 expensive computation\nconst sortedRules = useMemo(\n  () => [...rules].sort((a, b) => a.priority - b.priority),\n  [rules]\n);\n\n// Bad \u2014 not expensive, memo adds overhead for no gain\nconst style = useMemo(() => ({ color: 'red' }), []);\n// Just write:\nconst style = { color: 'red' };\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"apollo-client-cache-optimisation",children:"Apollo Client Cache Optimisation"}),"\n",(0,s.jsxs)(n.p,{children:["The Apollo ",(0,s.jsx)(n.code,{children:"InMemoryCache"})," is configured with type policies in ",(0,s.jsx)(n.code,{children:"libs/api-client/core/src/"}),". Key practices:"]}),"\n",(0,s.jsx)(n.h3,{id:"field-key-arguments",children:"Field Key Arguments"}),"\n",(0,s.jsxs)(n.p,{children:["Specify ",(0,s.jsx)(n.code,{children:"keyArgs"})," to prevent cache collisions between queries with different variables:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"typePolicies: {\n  Query: {\n    fields: {\n      firewallRules: {\n        keyArgs: ['routerId', 'chain'],  // separate cache entry per routerId+chain\n      },\n    },\n  },\n},\n"})}),"\n",(0,s.jsx)(n.h3,{id:"cache-reads-over-network-requests",children:"Cache Reads over Network Requests"}),"\n",(0,s.jsxs)(n.p,{children:["Prefer ",(0,s.jsx)(n.code,{children:"cache-first"})," fetch policy (Apollo's default) for stable data. Use ",(0,s.jsx)(n.code,{children:"network-only"})," only for data that must always be fresh (e.g., live traffic counters)."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"useQuery(GET_INTERFACES, {\n  variables: { routerId },\n  fetchPolicy: 'cache-and-network', // show cached immediately, update in background\n});\n"})}),"\n",(0,s.jsx)(n.h3,{id:"avoiding-over-fetching",children:"Avoiding Over-Fetching"}),"\n",(0,s.jsx)(n.p,{children:"Use fragments to request only the fields a component needs. The codegen pipeline generates typed fragment hooks alongside operation hooks:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:"fragment InterfaceListItem on Interface {\n  id\n  name\n  status\n  type\n}\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"websocket-connection-management",children:"WebSocket Connection Management"}),"\n",(0,s.jsxs)(n.p,{children:["GraphQL subscriptions use ",(0,s.jsx)(n.code,{children:"graphql-ws"})," over WebSocket. Key points for performance:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Only one WebSocket connection is maintained per router session (multiplexed subscriptions)"}),"\n",(0,s.jsx)(n.li,{children:"Subscriptions are cleaned up automatically when the subscribing component unmounts"}),"\n",(0,s.jsxs)(n.li,{children:["Reconnect logic is handled by the Apollo link in ",(0,s.jsx)(n.code,{children:"libs/api-client/core/src/"})]}),"\n",(0,s.jsx)(n.li,{children:"Avoid subscribing to high-frequency events (e.g., raw traffic counters every 100 ms) \u2014 use polling intervals of at least 5 s for live metrics"}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"image-and-asset-optimisation",children:"Image and Asset Optimisation"}),"\n",(0,s.jsxs)(n.p,{children:["The app uses very few raster images (most UI is CSS + SVG icons from ",(0,s.jsx)(n.code,{children:"lucide-react"}),"). When raster images are needed:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Use WebP format"}),"\n",(0,s.jsxs)(n.li,{children:["Specify explicit ",(0,s.jsx)(n.code,{children:"width"})," and ",(0,s.jsx)(n.code,{children:"height"})," attributes to avoid layout shift"]}),"\n",(0,s.jsxs)(n.li,{children:["Use the ",(0,s.jsx)(n.code,{children:'loading="lazy"'})," attribute for below-the-fold images"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["SVG icons from ",(0,s.jsx)(n.code,{children:"lucide-react"})," are tree-shaken \u2014 import only the icons you use:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"// Good \u2014 tree-shaken\nimport { Shield, Wifi, Router } from 'lucide-react';\n\n// Bad \u2014 imports the entire library\nimport * as Icons from 'lucide-react';\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"production-build-settings",children:"Production Build Settings"}),"\n",(0,s.jsxs)(n.p,{children:["The following production-specific settings are active in ",(0,s.jsx)(n.code,{children:"apps/connect/vite.config.ts"})," when ",(0,s.jsx)(n.code,{children:"mode === 'production'"}),":"]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Setting"}),(0,s.jsx)(n.th,{children:"Value"}),(0,s.jsx)(n.th,{children:"Effect"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"minify"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"'terser'"})}),(0,s.jsx)(n.td,{children:"Aggressive minification"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"compress.drop_console"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"true"})}),(0,s.jsxs)(n.td,{children:["Removes all ",(0,s.jsx)(n.code,{children:"console.log"})," calls"]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"compress.drop_debugger"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"true"})}),(0,s.jsxs)(n.td,{children:["Removes ",(0,s.jsx)(n.code,{children:"debugger"})," statements"]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"sourcemap"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"false"})}),(0,s.jsx)(n.td,{children:"No source maps in production bundle"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"designTokensHMR"})}),(0,s.jsx)(n.td,{children:"disabled"}),(0,s.jsx)(n.td,{children:"Token watcher not loaded"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"vite-plugin-checker"})}),(0,s.jsx)(n.td,{children:"disabled"}),(0,s.jsx)(n.td,{children:"TypeScript checking omitted (CI runs tsc separately)"})]})]})]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"measuring-performance",children:"Measuring Performance"}),"\n",(0,s.jsx)(n.h3,{id:"bundle-analysis",children:"Bundle Analysis"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"npm run build:analyze\n# Opens a visual treemap of the bundle in the browser\n"})}),"\n",(0,s.jsx)(n.p,{children:"Look for:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Unexpectedly large chunks"}),"\n",(0,s.jsx)(n.li,{children:"Duplicate modules across chunks"}),"\n",(0,s.jsx)(n.li,{children:"Libraries that should be in manual chunks but are not"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"runtime-performance",children:"Runtime Performance"}),"\n",(0,s.jsx)(n.p,{children:"Use the browser Performance tab (Chrome DevTools) to record a trace:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Open DevTools \u2192 Performance"}),"\n",(0,s.jsx)(n.li,{children:"Click Record"}),"\n",(0,s.jsx)(n.li,{children:"Perform the action you want to measure (e.g., navigate to the Firewall tab)"}),"\n",(0,s.jsx)(n.li,{children:"Stop recording"}),"\n",(0,s.jsx)(n.li,{children:"Look for long tasks (> 50 ms) in the flame chart"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"For component-level profiling, use the React DevTools Profiler tab:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Open React DevTools \u2192 Profiler"}),"\n",(0,s.jsx)(n.li,{children:"Click Record"}),"\n",(0,s.jsx)(n.li,{children:"Interact with the UI"}),"\n",(0,s.jsx)(n.li,{children:"Stop \u2014 examine which components re-rendered and why"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"core-web-vitals-targets",children:"Core Web Vitals Targets"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Metric"}),(0,s.jsx)(n.th,{children:"Target"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"LCP (Largest Contentful Paint)"}),(0,s.jsx)(n.td,{children:"< 2.5 s"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"FID / INP (Interaction to Next Paint)"}),(0,s.jsx)(n.td,{children:"< 200 ms"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"CLS (Cumulative Layout Shift)"}),(0,s.jsx)(n.td,{children:"< 0.1"})]})]})]}),"\n",(0,s.jsx)(n.p,{children:"Skeleton loading states (accurate layout placeholders) directly reduce CLS. Always provide skeletons for lazy-loaded routes and data-fetching components."})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}}}]);