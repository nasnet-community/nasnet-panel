"use strict";(globalThis.webpackChunk_nas_net_docs=globalThis.webpackChunk_nas_net_docs||[]).push([[71764],{29206:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>c,metadata:()=>n,toc:()=>a});const n=JSON.parse('{"id":"data-fetching/rest-client","title":"REST Client","description":"The frontend includes two distinct REST mechanisms. This document describes both.","source":"@site/../connect/docs/data-fetching/rest-client.md","sourceDirName":"data-fetching","slug":"/data-fetching/rest-client","permalink":"/docs/frontend/data-fetching/rest-client","draft":false,"unlisted":false,"editUrl":"https://github.com/nasnet-community/nasnet-panel/tree/main/../connect/docs/data-fetching/rest-client.md","tags":[],"version":"current","frontMatter":{},"sidebar":"sidebar","previous":{"title":"Data Fetching Overview","permalink":"/docs/frontend/data-fetching/overview"},"next":{"title":"Dashboard Feature","permalink":"/docs/frontend/feature-modules/dashboard"}}');var s=r(31085),i=r(71184);const c={},o="REST Client",d={},a=[{value:"1. Router Proxy (Primary REST Path)",id:"1-router-proxy-primary-rest-path",level:2},{value:"Architecture",id:"architecture",level:3},{value:"Core Function",id:"core-function",level:3},{value:"Retry Behaviour",id:"retry-behaviour",level:3},{value:"Authentication",id:"authentication",level:3},{value:"Response Normalisation",id:"response-normalisation",level:3},{value:"TanStack Query Integration",id:"tanstack-query-integration",level:3},{value:"2. Axios Client (Legacy / Interceptors)",id:"2-axios-client-legacy--interceptors",level:2},{value:"Interceptors",id:"interceptors",level:3},{value:"Auth Interceptor (<code>interceptors/auth.ts</code>)",id:"auth-interceptor-interceptorsauthts",level:4},{value:"Error Interceptor (<code>interceptors/error.ts</code>)",id:"error-interceptor-interceptorserrorts",level:4},{value:"Retry Interceptor (<code>interceptors/retry.ts</code>)",id:"retry-interceptor-interceptorsretryts",level:4},{value:"When to Use Each",id:"when-to-use-each",level:2}];function l(e){const t={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"rest-client",children:"REST Client"})}),"\n",(0,s.jsx)(t.p,{children:"The frontend includes two distinct REST mechanisms. This document describes both."}),"\n",(0,s.jsx)(t.h2,{id:"1-router-proxy-primary-rest-path",children:"1. Router Proxy (Primary REST Path)"}),"\n",(0,s.jsxs)(t.p,{children:["File: ",(0,s.jsx)(t.code,{children:"libs/api-client/core/src/router-proxy.ts"})]}),"\n",(0,s.jsx)(t.p,{children:"The router proxy sends RouterOS REST API calls to the Go backend which forwards them to the device. It exists because the browser cannot contact the router directly due to CORS and authentication constraints."}),"\n",(0,s.jsx)(t.h3,{id:"architecture",children:"Architecture"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{children:"Frontend\n  \u2192 fetch POST /api/router/proxy\n  \u2192 Go backend\n  \u2192 RouterOS REST API (http://<router>/rest/<endpoint>)\n  \u2192 Response converted to camelCase and returned\n"})}),"\n",(0,s.jsx)(t.h3,{id:"core-function",children:"Core Function"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-typescript",children:"import { makeRouterOSRequest } from '@nasnet/api-client/core';\n\n// GET example\nconst result = await makeRouterOSRequest<SystemResource>(\n  '192.168.88.1',\n  'system/resource'\n);\n\nif (result.success) {\n  console.log(result.data); // camelCase-converted data\n} else {\n  console.error(result.error);\n}\n\n// POST with body\nconst result = await makeRouterOSRequest<void>(\n  '192.168.88.1',\n  'interface/set',\n  {\n    method: 'POST',\n    body: { '.id': '*1', disabled: 'false' },\n  }\n);\n"})}),"\n",(0,s.jsx)(t.h3,{id:"retry-behaviour",children:"Retry Behaviour"}),"\n",(0,s.jsx)(t.p,{children:"The proxy retries up to 3 times with a 1-second delay between attempts. AbortController is used for request timeouts (default: 30 seconds)."}),"\n",(0,s.jsx)(t.h3,{id:"authentication",children:"Authentication"}),"\n",(0,s.jsxs)(t.p,{children:["Credentials are read from ",(0,s.jsx)(t.code,{children:"localStorage"})," at ",(0,s.jsx)(t.code,{children:"nasnet:api:credentials"}),". They are Base64-encoded into a ",(0,s.jsx)(t.code,{children:"Basic"})," header and sent in the proxy request body so the backend can authenticate with the router."]}),"\n",(0,s.jsx)(t.h3,{id:"response-normalisation",children:"Response Normalisation"}),"\n",(0,s.jsxs)(t.p,{children:["RouterOS returns keys in ",(0,s.jsx)(t.code,{children:"kebab-case"})," (e.g., ",(0,s.jsx)(t.code,{children:"mac-address"}),", ",(0,s.jsx)(t.code,{children:"default-name"}),"). The proxy automatically converts these to ",(0,s.jsx)(t.code,{children:"camelCase"})," (",(0,s.jsx)(t.code,{children:"macAddress"}),", ",(0,s.jsx)(t.code,{children:"defaultName"}),") using a recursive converter."]}),"\n",(0,s.jsx)(t.h3,{id:"tanstack-query-integration",children:"TanStack Query Integration"}),"\n",(0,s.jsx)(t.p,{children:"Two factory functions wrap the proxy for use with TanStack Query:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-typescript",children:"import { createProxyQueryFn, createProxyMutationFn } from '@nasnet/api-client/core';\n\n// Query\nconst { data } = useQuery({\n  queryKey: ['interfaces', routerIp],\n  queryFn: createProxyQueryFn<Interface[]>(routerIp, 'interface'),\n});\n\n// Mutation\nconst { mutate } = useMutation({\n  mutationFn: createProxyMutationFn<void, InterfaceUpdate>(\n    routerIp,\n    'interface/set',\n    'POST'\n  ),\n});\n"})}),"\n",(0,s.jsx)(t.h2,{id:"2-axios-client-legacy--interceptors",children:"2. Axios Client (Legacy / Interceptors)"}),"\n",(0,s.jsxs)(t.p,{children:["File: ",(0,s.jsx)(t.code,{children:"libs/api-client/core/src/interceptors/"})]}),"\n",(0,s.jsx)(t.p,{children:"An Axios-based client exists for use cases that predate the GraphQL migration or that need to call Go backend REST endpoints directly (not RouterOS)."}),"\n",(0,s.jsx)(t.h3,{id:"interceptors",children:"Interceptors"}),"\n",(0,s.jsxs)(t.h4,{id:"auth-interceptor-interceptorsauthts",children:["Auth Interceptor (",(0,s.jsx)(t.code,{children:"interceptors/auth.ts"}),")"]}),"\n",(0,s.jsxs)(t.p,{children:["Reads credentials from ",(0,s.jsx)(t.code,{children:"localStorage"})," at ",(0,s.jsx)(t.code,{children:"nasnet:api:credentials"})," and injects a ",(0,s.jsx)(t.code,{children:"Basic"})," header:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{children:"Authorization: Basic <base64(username:password)>\n"})}),"\n",(0,s.jsx)(t.p,{children:"Helper functions:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:"storeCredentials(credentials)"})," \u2014 persists to localStorage"]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:"clearCredentials()"})," \u2014 removes from localStorage"]}),"\n"]}),"\n",(0,s.jsxs)(t.h4,{id:"error-interceptor-interceptorserrorts",children:["Error Interceptor (",(0,s.jsx)(t.code,{children:"interceptors/error.ts"}),")"]}),"\n",(0,s.jsxs)(t.p,{children:["Transforms Axios errors into typed ",(0,s.jsx)(t.code,{children:"ApiError"})," objects with user-friendly messages:"]}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"Condition"}),(0,s.jsx)(t.th,{children:"Message"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"No response (ECONNABORTED)"}),(0,s.jsx)(t.td,{children:"Request timeout. The server took too long to respond."})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"No response (Network Error)"}),(0,s.jsx)(t.td,{children:"Network error. Check your connection."})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"HTTP 400"}),(0,s.jsx)(t.td,{children:"Bad request. Please check your input."})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"HTTP 401"}),(0,s.jsx)(t.td,{children:"Authentication failed. Check your credentials."})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"HTTP 403"}),(0,s.jsx)(t.td,{children:"Permission denied. You do not have access."})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"HTTP 404"}),(0,s.jsx)(t.td,{children:"Resource not found."})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"HTTP 409"}),(0,s.jsx)(t.td,{children:"Conflict. The resource may have changed."})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"HTTP 429"}),(0,s.jsx)(t.td,{children:"Too many requests. Please try again later."})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"HTTP 5xx"}),(0,s.jsx)(t.td,{children:"Server error. Please try again."})]})]})]}),"\n",(0,s.jsxs)(t.h4,{id:"retry-interceptor-interceptorsretryts",children:["Retry Interceptor (",(0,s.jsx)(t.code,{children:"interceptors/retry.ts"}),")"]}),"\n",(0,s.jsx)(t.p,{children:"Provides configurable retry logic for transient Axios failures."}),"\n",(0,s.jsx)(t.h2,{id:"when-to-use-each",children:"When to Use Each"}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"Use case"}),(0,s.jsx)(t.th,{children:"Tool"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Router configuration data (VPN, firewall, etc.)"}),(0,s.jsx)(t.td,{children:"Apollo GraphQL hooks"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Real-time updates (service status, alerts)"}),(0,s.jsx)(t.td,{children:"Apollo subscriptions"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Low-level RouterOS API calls not in GraphQL"}),(0,s.jsxs)(t.td,{children:[(0,s.jsx)(t.code,{children:"makeRouterOSRequest"})," / router proxy"]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Calling Go backend REST endpoints directly"}),(0,s.jsx)(t.td,{children:"Axios with interceptors"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Wrapping proxy calls with cache/loading state"}),(0,s.jsxs)(t.td,{children:[(0,s.jsx)(t.code,{children:"createProxyQueryFn"})," with TanStack Query"]})]})]})]})]})}function h(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},71184:(e,t,r)=>{r.d(t,{R:()=>c,x:()=>o});var n=r(14041);const s={},i=n.createContext(s);function c(e){const t=n.useContext(i);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),n.createElement(i.Provider,{value:t},e.children)}}}]);