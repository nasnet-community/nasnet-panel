"use strict";(globalThis.webpackChunk_nas_net_docs=globalThis.webpackChunk_nas_net_docs||[]).push([[50066],{51407:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>u,frontMatter:()=>o,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"testing/unit-testing","title":"Unit Testing","description":"Unit tests cover pure functions, custom hooks, and utilities in isolation. They are the fastest tier \u2014 each test runs in milliseconds \u2014 and form the base of the testing pyramid. The test runner is Vitest, chosen for its native ESM support and Vite-native speed.","source":"@site/../connect/docs/testing/unit-testing.md","sourceDirName":"testing","slug":"/testing/unit-testing","permalink":"/docs/frontend/testing/unit-testing","draft":false,"unlisted":false,"editUrl":"https://github.com/nasnet-community/nasnet-panel/tree/main/../connect/docs/testing/unit-testing.md","tags":[],"version":"current","frontMatter":{},"sidebar":"sidebar","previous":{"title":"Testing Overview","permalink":"/docs/frontend/testing/overview"},"next":{"title":"Design Tokens","permalink":"/docs/frontend/ui-system/design-tokens"}}');var i=t(31085),r=t(71184);const o={},c="Unit Testing",a={},l=[{value:"Vitest Configuration",id:"vitest-configuration",level:2},{value:"Key settings",id:"key-settings",level:3},{value:"Global Test Setup",id:"global-test-setup",level:2},{value:"Testing Pure Functions",id:"testing-pure-functions",level:2},{value:"Testing Custom Hooks",id:"testing-custom-hooks",level:2},{value:"Testing Components",id:"testing-components",level:2},{value:"Simple Component Tests",id:"simple-component-tests",level:3},{value:"Components with External Hook Dependencies",id:"components-with-external-hook-dependencies",level:3},{value:"Mocking Strategies",id:"mocking-strategies",level:2},{value:"vi.fn() \u2014 Mock a function",id:"vifn--mock-a-function",level:3},{value:"vi.mock() \u2014 Mock an entire module",id:"vimock--mock-an-entire-module",level:3},{value:"vi.spyOn() \u2014 Spy on an existing method",id:"vispyon--spy-on-an-existing-method",level:3},{value:"server.use() \u2014 Override MSW handlers in specific tests",id:"serveruse--override-msw-handlers-in-specific-tests",level:3},{value:"Testing Async Operations",id:"testing-async-operations",level:2},{value:"waitFor",id:"waitfor",level:3},{value:"findBy queries",id:"findby-queries",level:3},{value:"Test Data Factories",id:"test-data-factories",level:2},{value:"Import Aliases in Tests",id:"import-aliases-in-tests",level:2},{value:"Common Matchers",id:"common-matchers",level:2},{value:"See Also",id:"see-also",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"unit-testing",children:"Unit Testing"})}),"\n",(0,i.jsxs)(n.p,{children:["Unit tests cover pure functions, custom hooks, and utilities in isolation. They are the fastest tier \u2014 each test runs in milliseconds \u2014 and form the base of the testing pyramid. The test runner is ",(0,i.jsx)(n.strong,{children:"Vitest"}),", chosen for its native ESM support and Vite-native speed."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"vitest-configuration",children:"Vitest Configuration"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"apps/connect/vitest.config.ts"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"export default defineConfig({\n  plugins: [react()],\n  test: {\n    globals: true,           // describe/it/expect available without import\n    environment: 'jsdom',    // Browser-like DOM in Node.js\n    setupFiles: [\n      '@testing-library/jest-dom/vitest',  // DOM matchers\n      './src/test/setup.ts',               // MSW + browser API mocks\n    ],\n    include: ['src/**/*.{test,spec}.{ts,tsx}'],\n    exclude: ['node_modules/', 'dist/', 'e2e/'],\n\n    coverage: {\n      provider: 'v8',\n      reporter: ['text', 'json', 'html', 'lcov'],\n      reportsDirectory: './coverage',\n      thresholds: {\n        lines: 80,\n        branches: 75,\n        functions: 75,\n        statements: 80,\n      },\n    },\n\n    pool: 'forks',\n    poolOptions: {\n      forks: { singleFork: true },\n    },\n  },\n  resolve: {\n    alias: {\n      '@': path.resolve(__dirname, './src'),\n      '@nasnet/core/types': path.resolve(__dirname, '../../libs/core/types/src'),\n      // ... all library aliases mirror vite.config.ts\n    },\n  },\n});\n"})}),"\n",(0,i.jsx)(n.h3,{id:"key-settings",children:"Key settings"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"globals: true"})})," \u2014 ",(0,i.jsx)(n.code,{children:"describe"}),", ",(0,i.jsx)(n.code,{children:"it"}),", ",(0,i.jsx)(n.code,{children:"expect"}),", ",(0,i.jsx)(n.code,{children:"vi"}),", ",(0,i.jsx)(n.code,{children:"beforeEach"}),", etc. are available without importing from ",(0,i.jsx)(n.code,{children:"vitest"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"environment: 'jsdom'"})})," \u2014 DOM APIs available, but no real browser rendering"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"setupFiles"})})," \u2014 MSW server is started before each test file; ",(0,i.jsx)(n.code,{children:"matchMedia"}),", ",(0,i.jsx)(n.code,{children:"ResizeObserver"}),", ",(0,i.jsx)(n.code,{children:"IntersectionObserver"})," are mocked"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"pool: 'forks'"})})," with ",(0,i.jsx)(n.code,{children:"singleFork: true"})," \u2014 runs all tests in one worker process, avoids test isolation overhead for this codebase size"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"global-test-setup",children:"Global Test Setup"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"apps/connect/src/test/setup.ts"})," runs before every test file:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import { server } from '../mocks/server';\n\n// MSW lifecycle\nbeforeAll(() => server.listen({ onUnhandledRequest: 'warn' }));\nafterEach(() => {\n  cleanup();           // Unmount React components\n  vi.clearAllMocks();  // Reset all vi.fn() and vi.spyOn() calls\n  server.resetHandlers(); // Remove test-specific handler overrides\n});\nafterAll(() => server.close());\n\n// Browser API stubs (jsdom doesn't implement these)\nObject.defineProperty(window, 'matchMedia', {\n  value: vi.fn().mockImplementation(query => ({\n    matches: false, media: query, onchange: null,\n    addListener: vi.fn(), removeListener: vi.fn(),\n    addEventListener: vi.fn(), removeEventListener: vi.fn(),\n    dispatchEvent: vi.fn(),\n  })),\n});\n\nglobal.ResizeObserver = vi.fn().mockImplementation(() => ({\n  observe: vi.fn(), unobserve: vi.fn(), disconnect: vi.fn(),\n}));\n\nglobal.IntersectionObserver = vi.fn().mockImplementation(() => ({\n  observe: vi.fn(), unobserve: vi.fn(), disconnect: vi.fn(),\n}));\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"testing-pure-functions",children:"Testing Pure Functions"}),"\n",(0,i.jsx)(n.p,{children:"Pure utility functions are the simplest case \u2014 no DOM, no React, just input \u2192 output."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// libs/core/i18n/src/i18n.test.ts\nimport { describe, it, expect } from 'vitest';\nimport { isRTLLanguage, getLanguageDirection } from './i18n';\n\ndescribe('isRTLLanguage', () => {\n  it('should return true for Persian', () => {\n    expect(isRTLLanguage('fa')).toBe(true);\n  });\n\n  it('should return false for English', () => {\n    expect(isRTLLanguage('en')).toBe(false);\n  });\n\n  it('should return false for unknown languages', () => {\n    expect(isRTLLanguage('unknown')).toBe(false);\n  });\n});\n\ndescribe('getLanguageDirection', () => {\n  it('should return rtl for Persian', () => {\n    expect(getLanguageDirection('fa')).toBe('rtl');\n  });\n\n  it('should return ltr for English', () => {\n    expect(getLanguageDirection('en')).toBe('ltr');\n  });\n});\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"testing-custom-hooks",children:"Testing Custom Hooks"}),"\n",(0,i.jsxs)(n.p,{children:["Use ",(0,i.jsx)(n.code,{children:"renderHook"})," from React Testing Library to test hooks in isolation. Wrap with providers when the hook depends on context."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import { renderHook } from '@testing-library/react';\nimport { useReducedMotion } from '@nasnet/core/utils';\n\ndescribe('useReducedMotion', () => {\n  it('should return false when matchMedia is not available', () => {\n    // jsdom doesn't implement matchMedia \u2014 it's mocked to return { matches: false }\n    const { result } = renderHook(() => useReducedMotion());\n    expect(result.current).toBe(false);\n  });\n\n  it('should return true when user prefers reduced motion', () => {\n    // Override the mock to simulate reduced motion preference\n    vi.mocked(window.matchMedia).mockImplementation(query => ({\n      matches: query === '(prefers-reduced-motion: reduce)',\n      media: query,\n      onchange: null,\n      addListener: vi.fn(),\n      removeListener: vi.fn(),\n      addEventListener: vi.fn(),\n      removeEventListener: vi.fn(),\n      dispatchEvent: vi.fn(),\n    }));\n\n    const { result } = renderHook(() => useReducedMotion());\n    expect(result.current).toBe(true);\n  });\n});\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"testing-components",children:"Testing Components"}),"\n",(0,i.jsx)(n.h3,{id:"simple-component-tests",children:"Simple Component Tests"}),"\n",(0,i.jsxs)(n.p,{children:["Components without external dependencies can be tested directly with ",(0,i.jsx)(n.code,{children:"render"})," from ",(0,i.jsx)(n.code,{children:"@testing-library/react"}),". No custom wrapper needed."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",children:"// apps/connect/src/app/pages/network/components/StatusBadge.test.tsx\nimport { render, screen } from '@testing-library/react';\nimport { StatusBadge } from './StatusBadge';\n\ndescribe('StatusBadge', () => {\n  it('should render \"Running\" for running status', () => {\n    render(<StatusBadge status=\"running\" />);\n    expect(screen.getByText('Running')).toBeInTheDocument();\n  });\n\n  it('should apply green styles for running status', () => {\n    const { container } = render(<StatusBadge status=\"running\" />);\n    expect(container.firstChild).toHaveClass('bg-success/20');\n  });\n\n  it('should apply gray styles for disabled status', () => {\n    const { container } = render(<StatusBadge status=\"disabled\" />);\n    expect(container.firstChild).toHaveClass('bg-muted/20');\n  });\n});\n"})}),"\n",(0,i.jsx)(n.h3,{id:"components-with-external-hook-dependencies",children:"Components with External Hook Dependencies"}),"\n",(0,i.jsxs)(n.p,{children:["When a component calls hooks from ",(0,i.jsx)(n.code,{children:"@nasnet/api-client/queries"})," or other external packages, mock those hooks with ",(0,i.jsx)(n.code,{children:"vi.mock"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",children:"// apps/connect/src/app/pages/network/components/InterfaceCard.test.tsx\nimport * as queries from '@nasnet/api-client/queries';\nimport { InterfaceCard } from './InterfaceCard';\n\n// Partial mock \u2014 only mock the hooks we need, keep the rest real\nvi.mock('@nasnet/api-client/queries', async () => {\n  const actual = await vi.importActual('@nasnet/api-client/queries');\n  return {\n    ...actual,\n    useInterfaceTraffic: vi.fn(),\n  };\n});\n\ndescribe('InterfaceCard', () => {\n  beforeEach(() => {\n    vi.clearAllMocks();\n    (queries.useInterfaceTraffic as ReturnType<typeof vi.fn>).mockReturnValue({\n      data: undefined,\n      isLoading: false,\n      error: null,\n    });\n  });\n\n  it('should render interface name', () => {\n    render(<InterfaceCard interface={mockInterface} />);\n    expect(screen.getByText('ether1')).toBeInTheDocument();\n  });\n\n  it('should show traffic statistics when expanded', async () => {\n    const user = userEvent.setup();\n    (queries.useInterfaceTraffic as ReturnType<typeof vi.fn>).mockReturnValue({\n      data: mockTrafficStats,\n      isLoading: false,\n      error: null,\n    });\n\n    render(<InterfaceCard interface={mockInterface} />);\n    await user.click(screen.getByRole('button'));\n\n    await waitFor(() => {\n      expect(screen.getByText('Traffic Statistics')).toBeInTheDocument();\n    });\n  });\n});\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"mocking-strategies",children:"Mocking Strategies"}),"\n",(0,i.jsx)(n.h3,{id:"vifn--mock-a-function",children:"vi.fn() \u2014 Mock a function"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const mockFn = vi.fn();\nmockFn.mockReturnValue(42);\nmockFn.mockResolvedValue({ data: [] }); // For async\n"})}),"\n",(0,i.jsx)(n.h3,{id:"vimock--mock-an-entire-module",children:"vi.mock() \u2014 Mock an entire module"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"vi.mock('@nasnet/api-client/queries', () => ({\n  useRouters: vi.fn().mockReturnValue({\n    data: { routers: [] },\n    loading: false,\n    error: null,\n  }),\n}));\n"})}),"\n",(0,i.jsx)(n.p,{children:"Partial mocks preserve the real implementation for unmocked exports:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"vi.mock('@nasnet/api-client/queries', async () => {\n  const actual = await vi.importActual('@nasnet/api-client/queries');\n  return { ...actual, useInterfaceTraffic: vi.fn() };\n});\n"})}),"\n",(0,i.jsx)(n.h3,{id:"vispyon--spy-on-an-existing-method",children:"vi.spyOn() \u2014 Spy on an existing method"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const spy = vi.spyOn(console, 'warn').mockImplementation(() => {});\n// ... test code that should call console.warn\nexpect(spy).toHaveBeenCalledWith(expect.stringContaining('Missing translation'));\nspy.mockRestore();\n"})}),"\n",(0,i.jsx)(n.h3,{id:"serveruse--override-msw-handlers-in-specific-tests",children:"server.use() \u2014 Override MSW handlers in specific tests"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"it('should show error state when API fails', async () => {\n  server.use(errorHandler); // Override default success handler for this test\n  render(<RouterPanel routerId=\"r1\" />);\n  expect(await screen.findByText(/connection failed/i)).toBeInTheDocument();\n});\n// Handler resets automatically after the test via server.resetHandlers()\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"testing-async-operations",children:"Testing Async Operations"}),"\n",(0,i.jsx)(n.h3,{id:"waitfor",children:"waitFor"}),"\n",(0,i.jsxs)(n.p,{children:["Use ",(0,i.jsx)(n.code,{children:"waitFor"})," for assertions that depend on async state updates:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import { waitFor } from '@testing-library/react';\n\nit('should load traffic data on expand', async () => {\n  const user = userEvent.setup();\n  render(<InterfaceCard interface={mockInterface} />);\n\n  await user.click(screen.getByRole('button'));\n\n  await waitFor(() => {\n    expect(screen.getByText('Traffic Statistics')).toBeInTheDocument();\n  });\n});\n"})}),"\n",(0,i.jsx)(n.h3,{id:"findby-queries",children:"findBy queries"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"findBy*"})," queries are async versions of ",(0,i.jsx)(n.code,{children:"getBy*"})," \u2014 they wait up to 1 second:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// Equivalent to waitFor + getByText\nconst element = await screen.findByText('Traffic Statistics');\nexpect(element).toBeInTheDocument();\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"test-data-factories",children:"Test Data Factories"}),"\n",(0,i.jsxs)(n.p,{children:["Create typed fixtures with ",(0,i.jsx)(n.code,{children:"Partial<T>"})," overrides to keep tests concise:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import { type NetworkInterface } from '@nasnet/core/types';\n\nfunction makeInterface(overrides: Partial<NetworkInterface> = {}): NetworkInterface {\n  return {\n    id: 'ether1',\n    name: 'ether1',\n    type: 'ether',\n    status: 'running',\n    macAddress: 'AA:BB:CC:DD:EE:FF',\n    linkStatus: 'up',\n    mtu: 1500,\n    comment: undefined,\n    ...overrides,\n  };\n}\n\n// In tests\nconst disabledInterface = makeInterface({ status: 'disabled', linkStatus: 'down' });\nconst wirelessInterface = makeInterface({ type: 'wireless', name: 'wlan1' });\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"import-aliases-in-tests",children:"Import Aliases in Tests"}),"\n",(0,i.jsxs)(n.p,{children:["The vitest config mirrors the Vite aliases from ",(0,i.jsx)(n.code,{children:"vite.config.ts"}),". Use the same import paths in test files:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import { type NetworkInterface } from '@nasnet/core/types';\nimport { useInterfaceTraffic } from '@nasnet/api-client/queries';\nimport { useConnectionStore } from '@nasnet/state/stores';\nimport { StatusBadge } from '@nasnet/ui/patterns';\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"common-matchers",children:"Common Matchers"}),"\n",(0,i.jsxs)(n.p,{children:["From ",(0,i.jsx)(n.code,{children:"@testing-library/jest-dom"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"expect(element).toBeInTheDocument();\nexpect(element).toBeVisible();\nexpect(element).toBeDisabled();\nexpect(element).toHaveClass('bg-success/20');\nexpect(element).toHaveAttribute('aria-label', 'Close');\nexpect(element).toHaveTextContent('Running');\nexpect(element).toHaveFocus();\nexpect(input).toHaveValue('ether1');\n"})}),"\n",(0,i.jsx)(n.p,{children:"From Vitest:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"expect(fn).toHaveBeenCalled();\nexpect(fn).toHaveBeenCalledWith('fa');\nexpect(fn).toHaveBeenCalledTimes(1);\nexpect(promise).resolves.toBe(42);\nexpect(promise).rejects.toThrow('error');\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"see-also",children:"See Also"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"apps/connect/vitest.config.ts"})," \u2014 Full Vitest configuration"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"apps/connect/src/test/setup.ts"})," \u2014 Global setup (MSW, browser mocks)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"10-testing/component-testing.md"})," \u2014 Testing with providers via ",(0,i.jsx)(n.code,{children:"test-utils.tsx"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"10-testing/mocking.md"})," \u2014 MSW handler patterns"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},71184:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>c});var s=t(14041);const i={},r=s.createContext(i);function o(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);