"use strict";(globalThis.webpackChunk_nas_net_docs=globalThis.webpackChunk_nas_net_docs||[]).push([[21229],{71184:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>l});var s=t(14041);const r={},i=s.createContext(r);function o(e){const n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),s.createElement(i.Provider,{value:n},e.children)}},79396:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>d,frontMatter:()=>o,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"stores/auth","title":"Authentication Store (useAuthStore)","description":"Deep-dive into JWT token management, user session state, and authentication lifecycle.","source":"@site/../../libs/state/docs/stores/auth.md","sourceDirName":"stores","slug":"/stores/auth","permalink":"/docs/state/stores/auth","draft":false,"unlisted":false,"editUrl":"https://github.com/nasnet-community/nasnet-panel/tree/main/../../libs/state/docs/stores/auth.md","tags":[],"version":"current","frontMatter":{},"sidebar":"sidebar","previous":{"title":"Selectors Reference","permalink":"/docs/state/stores/selectors-reference"},"next":{"title":"Change Set Store","permalink":"/docs/state/stores/change-set"}}');var r=t(31085),i=t(71184);const o={},l="Authentication Store (useAuthStore)",c={},a=[{value:"State Shape",id:"state-shape",level:2},{value:"User Profile",id:"user-profile",level:3},{value:"Actions API",id:"actions-api",level:2},{value:"Authentication Actions",id:"authentication-actions",level:3},{value:"Token Refresh State",id:"token-refresh-state",level:3},{value:"Activity Tracking",id:"activity-tracking",level:3},{value:"Token State Queries",id:"token-state-queries",level:3},{value:"Selectors",id:"selectors",level:2},{value:"Helper Functions",id:"helper-functions",level:2},{value:"Out-of-React Usage",id:"out-of-react-usage",level:3},{value:"Token Refresh Flow",id:"token-refresh-flow",level:2},{value:"Integration with Apollo Client",id:"integration-with-apollo-client",level:3},{value:"Custom Persistence Storage",id:"custom-persistence-storage",level:2},{value:"Partialize Configuration",id:"partialize-configuration",level:3},{value:"Login/Logout Flow",id:"loginlogout-flow",level:2},{value:"Login Flow",id:"login-flow",level:3},{value:"Logout Flow",id:"logout-flow",level:3},{value:"Security Considerations",id:"security-considerations",level:2},{value:"Token Expiry",id:"token-expiry",level:3},{value:"Token Storage",id:"token-storage",level:3},{value:"Refresh Token Security",id:"refresh-token-security",level:3},{value:"Activity Tracking",id:"activity-tracking-1",level:3},{value:"Token Constants",id:"token-constants",level:2},{value:"DevTools Integration",id:"devtools-integration",level:2},{value:"Performance Tips",id:"performance-tips",level:2}];function h(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"authentication-store-useauthstore",children:"Authentication Store (useAuthStore)"})}),"\n",(0,r.jsx)(n.p,{children:"Deep-dive into JWT token management, user session state, and authentication lifecycle."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Source:"})," ",(0,r.jsx)(n.code,{children:"libs/state/stores/src/auth/auth.store.ts"})]}),"\n",(0,r.jsx)(n.h2,{id:"state-shape",children:"State Shape"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"interface AuthState {\n  // Token State\n  token: string | null;              // JWT access token\n  tokenExpiry: Date | null;           // Expiration timestamp\n  refreshToken: string | null;        // Refresh token for new access tokens\n\n  // User State\n  user: User | null;                  // Current user profile\n  isAuthenticated: boolean;           // Whether user is logged in\n\n  // Session State\n  isRefreshing: boolean;              // Token refresh in progress\n  refreshAttempts: number;            // Number of refresh attempts (max 3)\n  lastActivity: Date | null;          // Last user activity timestamp\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"user-profile",children:"User Profile"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"interface User {\n  id: string;                         // Unique identifier\n  username: string;                   // Display name\n  email: string | null;               // Email address (optional)\n  permissions: string[];              // Permission array\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"actions-api",children:"Actions API"}),"\n",(0,r.jsx)(n.h3,{id:"authentication-actions",children:"Authentication Actions"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"setAuth(token, user, expiresAt, refreshToken?)"})})," - Set authentication state after login"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"const { setAuth } = useAuthStore();\n\nsetAuth(\n  'eyJhbGc...',                       // JWT token\n  {\n    id: 'user-123',\n    username: 'admin',\n    email: 'admin@router.local',\n    permissions: ['admin', 'read', 'write']\n  },\n  new Date(Date.now() + 3600000),    // Expires in 1 hour\n  'refresh-token-xyz'                 // Optional refresh token\n);\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"clearAuth()"})})," - Clear all authentication state (logout)"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"const { clearAuth } = useAuthStore();\nclearAuth();\n"})}),"\n",(0,r.jsx)(n.h3,{id:"token-refresh-state",children:"Token Refresh State"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"setRefreshing(isRefreshing)"})})," - Set refreshing state during token renewal"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"const { setRefreshing } = useAuthStore();\nsetRefreshing(true);  // Start refresh\nsetRefreshing(false); // Refresh complete\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"incrementRefreshAttempts()"})})," - Increment refresh attempt counter"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"const { incrementRefreshAttempts } = useAuthStore();\nincrementRefreshAttempts(); // Calls on each failed refresh\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"resetRefreshAttempts()"})})," - Reset attempt counter on successful refresh"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"const { resetRefreshAttempts } = useAuthStore();\nresetRefreshAttempts(); // Call on refresh success\n"})}),"\n",(0,r.jsx)(n.h3,{id:"activity-tracking",children:"Activity Tracking"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"updateLastActivity()"})})," - Update last activity timestamp"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"const { updateLastActivity } = useAuthStore();\nupdateLastActivity(); // Called on user interaction\n"})}),"\n",(0,r.jsx)(n.h3,{id:"token-state-queries",children:"Token State Queries"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"isTokenExpiringSoon(): boolean"})})," - Check if token expires within 5 minutes"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"const { isTokenExpiringSoon } = useAuthStore();\n\nif (isTokenExpiringSoon()) {\n  // Refresh token proactively\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"getTimeUntilExpiry(): number | null"})})," - Get milliseconds until token expiry"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"const { getTimeUntilExpiry } = useAuthStore();\n\nconst msUntilExpiry = getTimeUntilExpiry();\nif (msUntilExpiry && msUntilExpiry < 300000) {\n  // Less than 5 minutes remaining\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"shouldAttemptRefresh(): boolean"})})," - Check if refresh should be attempted"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"const { shouldAttemptRefresh } = useAuthStore();\n\n// Considers:\n// - Has valid refresh token\n// - Not already refreshing\n// - Haven't exceeded max attempts (3)\nif (shouldAttemptRefresh()) {\n  const newToken = await refreshTokenAPI();\n  setAuth(newToken.token, user, newToken.expiresAt);\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"selectors",children:"Selectors"}),"\n",(0,r.jsx)(n.p,{children:"Optimized selectors for minimal re-renders:"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Selector"}),(0,r.jsx)(n.th,{children:"Returns"}),(0,r.jsx)(n.th,{children:"Usage"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"selectIsAuthenticated"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"boolean"})}),(0,r.jsx)(n.td,{children:"Check if user is logged in"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"selectUser"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"User | null"})}),(0,r.jsx)(n.td,{children:"Get current user profile"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"selectToken"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"string | null"})}),(0,r.jsx)(n.td,{children:"Get access token"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"selectIsRefreshing"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"boolean"})}),(0,r.jsx)(n.td,{children:"Check if refresh in progress"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"selectRefreshAttempts"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"number"})}),(0,r.jsx)(n.td,{children:"Get current refresh attempt count"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"selectMaxRefreshExceeded"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"boolean"})}),(0,r.jsx)(n.td,{children:"Check if max attempts (3) exceeded"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"selectPermissions"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"string[]"})}),(0,r.jsx)(n.td,{children:"Get user permissions array"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"selectHasPermission(perm)"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"boolean"})}),(0,r.jsx)(n.td,{children:"Check if user has permission"})]})]})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Example:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"import { shallow } from 'zustand/shallow';\n\n// \u2705 Good: Only re-renders on user change\nconst user = useAuthStore(state => state.user);\n\n// \u2705 Good: Multiple fields with shallow comparison\nconst { user, token } = useAuthStore(\n  state => ({ user: state.user, token: state.token }),\n  shallow\n);\n\n// \u274c Bad: Re-renders on any auth store change\nconst { user, token, isRefreshing } = useAuthStore();\n"})}),"\n",(0,r.jsx)(n.h2,{id:"helper-functions",children:"Helper Functions"}),"\n",(0,r.jsx)(n.h3,{id:"out-of-react-usage",children:"Out-of-React Usage"}),"\n",(0,r.jsx)(n.p,{children:"For access outside React components:"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"getAuthState(): AuthState & AuthActions"})})," - Get current store state"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"const { token, isAuthenticated } = getAuthState();\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"subscribeAuthState(listener)"})})," - Subscribe to store changes"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"const unsubscribe = subscribeAuthState((state) => {\n  console.log('Auth changed:', state.isAuthenticated);\n});\n// Later: unsubscribe();\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"isAuthenticated(): boolean"})})," - Check if currently authenticated (faster)"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// Used in route guards and Apollo auth links\nif (isAuthenticated()) {\n  // Allow request\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"getAuthToken(): string | null"})})," - Get current valid token"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// Used in Apollo auth link to get token for requests\nconst token = getAuthToken();\nif (token) {\n  headers.authorization = `Bearer ${token}`;\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"token-refresh-flow",children:"Token Refresh Flow"}),"\n",(0,r.jsxs)(n.p,{children:["The complete refresh flow with ",(0,r.jsx)(n.code,{children:"useTokenRefresh"})," hook:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"1. Hook checks token expiry every 60 seconds\n         \u2193\n2. If expiring within 5 minutes AND shouldAttemptRefresh() \u2192 start refresh\n         \u2193\n3. Set isRefreshing(true), increment refreshAttempts\n         \u2193\n4. Call refreshTokenFn() (GraphQL mutation)\n         \u2193\n5a. SUCCESS:                           5b. FAILURE:\n    \u251c\u2500 setAuth() with new token       \u251c\u2500 incrementRefreshAttempts()\n    \u251c\u2500 resetRefreshAttempts()         \u251c\u2500 Check if attempts >= 3\n    \u251c\u2500 setRefreshing(false)           \u251c\u2500 If yes: show notification\n    \u2514\u2500 Token valid for next hour      \u2514\u2500 If yes: call onReauthRequired()\n"})}),"\n",(0,r.jsx)(n.h3,{id:"integration-with-apollo-client",children:"Integration with Apollo Client"}),"\n",(0,r.jsx)(n.p,{children:"The auth store integrates with Apollo Client via auth link:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// In Apollo setup\nconst authLink = setContext((_, { headers }) => {\n  // Apollo reads token from store\n  const token = getAuthToken();\n\n  return {\n    headers: {\n      ...headers,\n      authorization: token ? `Bearer ${token}` : '',\n    },\n  };\n});\n"})}),"\n",(0,r.jsx)(n.h2,{id:"custom-persistence-storage",children:"Custom Persistence Storage"}),"\n",(0,r.jsx)(n.p,{children:"The store uses a custom storage handler to properly serialize/deserialize Date objects:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"const authStorage: StateStorage = {\n  getItem: (name: string): string | null => {\n    const str = localStorage.getItem(name);\n    if (!str) return null;\n\n    const parsed = JSON.parse(str);\n\n    // Rehydrate Date objects from ISO strings\n    if (parsed.state?.tokenExpiry) {\n      parsed.state.tokenExpiry = new Date(parsed.state.tokenExpiry);\n    }\n    if (parsed.state?.lastActivity) {\n      parsed.state.lastActivity = new Date(parsed.state.lastActivity);\n    }\n\n    return JSON.stringify(parsed);\n  },\n\n  setItem: (name: string, value: string): void => {\n    localStorage.setItem(name, value);\n  },\n\n  removeItem: (name: string): void => {\n    localStorage.removeItem(name);\n  },\n};\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Why custom handler?"})," Default JSON serialization converts Date to ISO strings, which breaks expiry comparison logic. Custom handler rehydrates Date objects on load."]}),"\n",(0,r.jsx)(n.h3,{id:"partialize-configuration",children:"Partialize Configuration"}),"\n",(0,r.jsx)(n.p,{children:"Only essential auth state persists across sessions:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"partialize: (state) => ({\n  token: state.token,\n  tokenExpiry: state.tokenExpiry,\n  refreshToken: state.refreshToken,\n  user: state.user,\n  isAuthenticated: state.isAuthenticated,\n}),\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"NOT persisted (reset on reload):"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"isRefreshing"})," - Session state"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"refreshAttempts"})," - Session state"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"lastActivity"})," - Ephemeral"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"loginlogout-flow",children:"Login/Logout Flow"}),"\n",(0,r.jsx)(n.h3,{id:"login-flow",children:"Login Flow"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"async function login(username: string, password: string) {\n  try {\n    const response = await api.post('/auth/login', {\n      username,\n      password,\n    });\n\n    const { setAuth } = useAuthStore.getState();\n    setAuth(\n      response.data.token,\n      response.data.user,\n      new Date(response.data.expiresAt),\n      response.data.refreshToken\n    );\n\n    // Token refresh hook starts monitoring automatically\n    navigate('/dashboard');\n  } catch (error) {\n    showError('Login failed', error.message);\n  }\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"logout-flow",children:"Logout Flow"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"function logout() {\n  const { clearAuth } = useAuthStore.getState();\n  clearAuth();\n\n  // Clear Apollo cache\n  apolloClient.clearStore();\n\n  // Redirect to login\n  navigate('/login');\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"security-considerations",children:"Security Considerations"}),"\n",(0,r.jsx)(n.h3,{id:"token-expiry",children:"Token Expiry"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Access token"}),": Typically 1 hour (customizable)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Refresh threshold"}),": 5 minutes before expiry"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Max refresh attempts"}),": 3 (protects against refresh token issues)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"After max attempts"}),": User must re-authenticate"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"token-storage",children:"Token Storage"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Storage method"}),": localStorage (via custom handler)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Serialization"}),": Proper Date object handling"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Sensitive fields"}),": Token NOT included in Redux DevTools"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"refresh-token-security",children:"Refresh Token Security"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Refresh token"}),": Stored in auth state, persisted"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Single use"}),": Typically consumed after use"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Rotation"}),": New refresh token returned on refresh"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Validation"}),": Backend validates refresh token for each request"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"activity-tracking-1",children:"Activity Tracking"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"lastActivity"}),": Tracked but not currently used for session timeout"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Future enhancement"}),": Can implement idle timeout policy"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"token-constants",children:"Token Constants"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// Token expiry warning threshold (5 minutes)\nconst TOKEN_EXPIRY_THRESHOLD_MS = 5 * 60 * 1000;\n\n// Maximum refresh attempts before re-auth required\nconst MAX_REFRESH_ATTEMPTS = 3;\n"})}),"\n",(0,r.jsx)(n.h2,{id:"devtools-integration",children:"DevTools Integration"}),"\n",(0,r.jsx)(n.p,{children:"In development mode, Redux DevTools shows all auth actions:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Actions:\n- setAuth\n- clearAuth\n- setRefreshing\n- incrementRefreshAttempts\n- resetRefreshAttempts\n- updateLastActivity\n\nTime-travel debugging: Step through auth state changes\n"})}),"\n",(0,r.jsx)(n.h2,{id:"performance-tips",children:"Performance Tips"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Always use selectors"}),", never subscribe to whole store:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// \u2705 Good\nconst isAuth = useAuthStore(s => s.isAuthenticated);\n\n// \u274c Bad\nconst { isAuthenticated } = useAuthStore();\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Use out-of-React access"})," in non-component code:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// In route guards, Apollo links, utilities\nif (isAuthenticated()) {\n  // ...\n}\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Batch token updates"})," during refresh:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// Call setAuth once (not multiple separate actions)\nsetAuth(token, user, expiresAt, refreshToken);\n// NOT: setToken(), setUser(), setExpiry() separately\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["See ",(0,r.jsx)(n.code,{children:"libs/state/stores/src/hooks/useTokenRefresh.ts"})," for the auto-refresh implementation."]})]})}function d(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}}}]);