"use strict";(globalThis.webpackChunk_nas_net_docs=globalThis.webpackChunk_nas_net_docs||[]).push([[21485],{63563:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>c,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"axios-http-client","title":"Axios HTTP Client","description":"This document covers the Axios-based HTTP client infrastructure in libs/api-client/core/src/. The Axios layer serves two purposes: a general-purpose REST API client for the NasNet backend (/api/v1), and a router proxy client that tunnels RouterOS REST API calls through the Go backend to avoid browser CORS restrictions.","source":"@site/../../libs/api-client/docs/axios-http-client.md","sourceDirName":".","slug":"/axios-http-client","permalink":"/docs/api-client/axios-http-client","draft":false,"unlisted":false,"editUrl":"https://github.com/nasnet-community/nasnet-panel/tree/main/../../libs/api-client/docs/axios-http-client.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"title":"Axios HTTP Client"},"sidebar":"sidebar","previous":{"title":"Apollo Client","permalink":"/docs/api-client/apollo-client"},"next":{"title":"Authentication","permalink":"/docs/api-client/authentication"}}');var t=n(31085),i=n(71184);const c={sidebar_position:3,title:"Axios HTTP Client"},o="Axios HTTP Client",d={},l=[{value:"Table of Contents",id:"table-of-contents",level:2},{value:"Architecture Overview",id:"architecture-overview",level:2},{value:"API Client Factory",id:"api-client-factory",level:2},{value:"createApiClient",id:"createapiclient",level:3},{value:"apiClient Singleton",id:"apiclient-singleton",level:3},{value:"ApiClientConfig",id:"apiclientconfig",level:3},{value:"Interceptors",id:"interceptors",level:2},{value:"Auth Interceptor",id:"auth-interceptor",level:3},{value:"Retry Interceptor",id:"retry-interceptor",level:3},{value:"Error Interceptor",id:"error-interceptor",level:3},{value:"Interceptor Execution Order",id:"interceptor-execution-order",level:3},{value:"Router Proxy Client",id:"router-proxy-client",level:2},{value:"makeRouterOSRequest",id:"makerouterosrequest",level:3},{value:"createProxyQueryFn",id:"createproxyqueryfn",level:3},{value:"createProxyMutationFn",id:"createproxymutationfn",level:3},{value:"Proxy Request Pipeline",id:"proxy-request-pipeline",level:3},{value:"Shared Types",id:"shared-types",level:2},{value:"Error Model",id:"error-model",level:2},{value:"Exports Reference",id:"exports-reference",level:2},{value:"Fetch-Based Router Proxy",id:"fetch-based-router-proxy",level:2},{value:"Helper Functions",id:"helper-functions",level:3},{value:"<code>buildRouterOSEndpoint(endpoint)</code>",id:"buildrouterosendpointendpoint",level:4},{value:"<code>convertRouterOSResponse&lt;T&gt;(data)</code>",id:"convertrouterosresponsetdata",level:4},{value:"TanStack Query Factories",id:"tanstack-query-factories",level:3},{value:"<code>createProxyQueryFn&lt;T&gt;(routerIp, endpoint, options?)</code>",id:"createproxyqueryfntrouterip-endpoint-options",level:4},{value:"<code>createProxyMutationFn&lt;TData, TVariables&gt;(routerIp, endpoint, method?)</code>",id:"createproxymutationfntdata-tvariablesrouterip-endpoint-method",level:4},{value:"ProxyConfig Interface",id:"proxyconfig-interface",level:3},{value:"Decision: When to Use Axios vs. Apollo",id:"decision-when-to-use-axios-vs-apollo",level:2},{value:"Cross-References",id:"cross-references",level:2}];function a(e){const r={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.header,{children:(0,t.jsx)(r.h1,{id:"axios-http-client",children:"Axios HTTP Client"})}),"\n",(0,t.jsxs)(r.p,{children:["This document covers the Axios-based HTTP client infrastructure in ",(0,t.jsx)(r.code,{children:"libs/api-client/core/src/"}),". The Axios layer serves two purposes: a general-purpose REST API client for the NasNet backend (",(0,t.jsx)(r.code,{children:"/api/v1"}),"), and a router proxy client that tunnels RouterOS REST API calls through the Go backend to avoid browser CORS restrictions."]}),"\n",(0,t.jsx)(r.hr,{}),"\n",(0,t.jsx)(r.h2,{id:"table-of-contents",children:"Table of Contents"}),"\n",(0,t.jsxs)(r.ol,{children:["\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"#architecture-overview",children:"Architecture Overview"})}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.a,{href:"#api-client-factory",children:"API Client Factory"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"#createapiclient",children:"createApiClient"})}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"#apiclient-singleton",children:"apiClient Singleton"})}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"#apiclientconfig",children:"ApiClientConfig"})}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.a,{href:"#interceptors",children:"Interceptors"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"#auth-interceptor",children:"Auth Interceptor"})}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"#retry-interceptor",children:"Retry Interceptor"})}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"#error-interceptor",children:"Error Interceptor"})}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"#interceptor-execution-order",children:"Interceptor Execution Order"})}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.a,{href:"#router-proxy-client",children:"Router Proxy Client"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"#makerouterosrequest",children:"makeRouterOSRequest"})}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"#createproxyqueryfn",children:"createProxyQueryFn"})}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"#createproxymutationfn",children:"createProxyMutationFn"})}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"#proxy-request-pipeline",children:"Proxy Request Pipeline"})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"#shared-types",children:"Shared Types"})}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"#error-model",children:"Error Model"})}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"#exports-reference",children:"Exports Reference"})}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"#decision-when-to-use-axios-vs-apollo",children:"Decision: When to Use Axios vs. Apollo"})}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"#cross-references",children:"Cross-References"})}),"\n"]}),"\n",(0,t.jsx)(r.hr,{}),"\n",(0,t.jsx)(r.h2,{id:"architecture-overview",children:"Architecture Overview"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{children:"React Component / Feature Hook\n          |\n          |  REST calls (e.g., auth, health, scanner)\n          v\n  createApiClient() \u2192 AxiosInstance\n          |\n    +-----------+\n    | Interceptors (request \u2192 response pipeline)\n    |  1. authInterceptor     (request)   \u2014 adds Basic Auth header\n    |  2. retryInterceptor    (response)  \u2014 exponential backoff retry\n    |  3. errorInterceptor    (response)  \u2014 maps to ApiError\n    +-----------+\n          |\n          v\n    GET/POST /api/v1/*\n    (NasNet Go backend)\n\n\n  makeRouterOSRequest(routerIp, endpoint, options)\n          |\n          v\n    POST /api/router/proxy        (NasNet Go backend)\n          |\n          v\n    RouterOS REST API             (MikroTik router)\n    /rest/<endpoint>\n"})}),"\n",(0,t.jsx)(r.p,{children:"The Axios client communicates exclusively with the NasNet Go backend. The router proxy pattern means the browser never talks directly to the MikroTik router \u2014 the backend handles the actual RouterOS HTTP calls, credential management, and CORS."}),"\n",(0,t.jsx)(r.hr,{}),"\n",(0,t.jsx)(r.h2,{id:"api-client-factory",children:"API Client Factory"}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Source:"})," ",(0,t.jsx)(r.code,{children:"core/src/client.ts"})]}),"\n",(0,t.jsx)(r.h3,{id:"createapiclient",children:"createApiClient"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",children:"export function createApiClient(config?: ApiClientConfig): AxiosInstance\n"})}),"\n",(0,t.jsxs)(r.p,{children:["Creates and returns a fully configured ",(0,t.jsx)(r.code,{children:"AxiosInstance"})," with all three interceptors registered. The base URL is resolved in priority order:"]}),"\n",(0,t.jsxs)(r.ol,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"config.baseURL"})," (explicit override)"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"import.meta.env.VITE_API_URL"})," (from ",(0,t.jsx)(r.code,{children:".env.development"}),")"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"/api/v1"})," (same-origin default for production)"]}),"\n"]}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.strong,{children:"Full implementation:"})}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",children:"export function createApiClient(config?: ApiClientConfig): AxiosInstance {\n  const baseURL =\n    config?.baseURL ||\n    (import.meta.env.VITE_API_URL as string | undefined) ||\n    '/api/v1';\n\n  const client = axios.create({\n    baseURL,\n    timeout: config?.timeout ?? 30000,  // 30s default\n    headers: {\n      'Content-Type': 'application/json',\n      ...config?.headers,\n    },\n  });\n\n  // Registration order matters for LIFO response interceptor execution\n  client.interceptors.request.use(authInterceptor);\n  client.interceptors.response.use((r) => r, retryInterceptor);  // executes second\n  client.interceptors.response.use((r) => r, errorInterceptor);  // executes first\n  return client;\n}\n"})}),"\n",(0,t.jsx)(r.h3,{id:"apiclient-singleton",children:"apiClient Singleton"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",children:"export const apiClient: AxiosInstance = createApiClient();\n"})}),"\n",(0,t.jsx)(r.p,{children:"The default instance uses environment-driven base URL with 30s timeout. Import it wherever you need to make REST calls to the backend:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",children:"import { apiClient } from '@nasnet/api-client/core';\n\nconst response = await apiClient.get('/health');\nconst data = await apiClient.post('/auth/login', { username, password });\n"})}),"\n",(0,t.jsx)(r.h3,{id:"apiclientconfig",children:"ApiClientConfig"}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Source:"})," ",(0,t.jsx)(r.code,{children:"core/src/types.ts"})]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",children:"export interface ApiClientConfig {\n  baseURL?: string;\n  timeout?: number;\n  headers?: Record<string, string>;\n}\n"})}),"\n",(0,t.jsx)(r.p,{children:"All fields are optional. Unspecified fields fall back to the defaults described above."}),"\n",(0,t.jsx)(r.hr,{}),"\n",(0,t.jsx)(r.h2,{id:"interceptors",children:"Interceptors"}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Source:"})," ",(0,t.jsx)(r.code,{children:"core/src/interceptors/"})]}),"\n",(0,t.jsx)(r.h3,{id:"auth-interceptor",children:"Auth Interceptor"}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Source:"})," ",(0,t.jsx)(r.code,{children:"core/src/interceptors/auth.ts"})]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",children:"export function authInterceptor(\n  config: InternalAxiosRequestConfig\n): InternalAxiosRequestConfig\n\nexport function storeCredentials(credentials: StoredCredentials): void\nexport function clearCredentials(): void\n"})}),"\n",(0,t.jsxs)(r.p,{children:["A ",(0,t.jsx)(r.strong,{children:"request"})," interceptor that reads credentials from ",(0,t.jsx)(r.code,{children:"localStorage"})," at key ",(0,t.jsx)(r.code,{children:"nasnet:api:credentials"})," and adds an HTTP Basic Authorization header:"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{children:"Authorization: Basic base64(username:password)\n"})}),"\n",(0,t.jsxs)(r.p,{children:["If no credentials are stored the request proceeds without an ",(0,t.jsx)(r.code,{children:"Authorization"})," header \u2014 this is by design for public endpoints such as health checks."]}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.strong,{children:"Credential storage:"})}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",children:"// Store credentials after successful login\nimport { storeCredentials } from '@nasnet/api-client/core';\nstoreCredentials({ username: 'admin', password: 'secret' });\n\n// Clear on logout\nimport { clearCredentials } from '@nasnet/api-client/core';\nclearCredentials();\n"})}),"\n",(0,t.jsxs)(r.p,{children:["Note: The Axios auth interceptor uses ",(0,t.jsx)(r.code,{children:"localStorage"})," (persistent across page reloads). The Apollo auth link uses ",(0,t.jsx)(r.code,{children:"sessionStorage"})," for per-router credentials (cleared when the tab closes). This distinction is intentional \u2014 the Axios client is used for global backend authentication while Apollo handles per-router isolation."]}),"\n",(0,t.jsx)(r.hr,{}),"\n",(0,t.jsx)(r.h3,{id:"retry-interceptor",children:"Retry Interceptor"}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Source:"})," ",(0,t.jsx)(r.code,{children:"core/src/interceptors/retry.ts"})]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",children:"export async function retryInterceptor(error: AxiosError): Promise<never | unknown>\n"})}),"\n",(0,t.jsxs)(r.p,{children:["A ",(0,t.jsx)(r.strong,{children:"response error"})," interceptor that implements exponential backoff retry for transient failures."]}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.strong,{children:"Constants:"})}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",children:"const MAX_RETRIES = 3;\nconst INITIAL_DELAY_MS = 1000;  // 1 second base\n"})}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Backoff formula:"})," ",(0,t.jsx)(r.code,{children:"2^retryCount \xd7 1000ms"})]}),"\n",(0,t.jsxs)(r.table,{children:[(0,t.jsx)(r.thead,{children:(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.th,{children:"Attempt"}),(0,t.jsx)(r.th,{children:"Delay"})]})}),(0,t.jsxs)(r.tbody,{children:[(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"1"}),(0,t.jsx)(r.td,{children:"2s"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"2"}),(0,t.jsx)(r.td,{children:"4s"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"3"}),(0,t.jsx)(r.td,{children:"8s"})]})]})]}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.strong,{children:"What gets retried:"})}),"\n",(0,t.jsxs)(r.table,{children:[(0,t.jsx)(r.thead,{children:(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.th,{children:"Condition"}),(0,t.jsx)(r.th,{children:"Retried?"})]})}),(0,t.jsxs)(r.tbody,{children:[(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"Network error (no response)"}),(0,t.jsx)(r.td,{children:"Yes"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"HTTP 5xx (server error)"}),(0,t.jsx)(r.td,{children:"Yes"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"HTTP 4xx (client error)"}),(0,t.jsx)(r.td,{children:"No"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"HTTP 2xx\u20133xx"}),(0,t.jsx)(r.td,{children:"N/A (success path)"})]})]})]}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.strong,{children:"Connection store integration:"})}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:["On the first retry: calls ",(0,t.jsx)(r.code,{children:"useConnectionStore.getState().setReconnecting()"})," to update global connection status."]}),"\n",(0,t.jsxs)(r.li,{children:["After all retries exhausted: calls ",(0,t.jsx)(r.code,{children:"useConnectionStore.getState().setDisconnected()"}),"."]}),"\n",(0,t.jsxs)(r.li,{children:["On successful retry: calls ",(0,t.jsx)(r.code,{children:"useConnectionStore.getState().setConnected()"}),"."]}),"\n"]}),"\n",(0,t.jsx)(r.p,{children:'This allows the application UI to show "Reconnecting..." status banners automatically when the backend is temporarily unreachable.'}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Internal retry tracking"})," uses an extended config type:"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",children:"interface RetryableConfig extends InternalAxiosRequestConfig {\n  retryCount?: number;\n}\n"})}),"\n",(0,t.jsx)(r.p,{children:"The retry count is stored on the request config object itself so each unique request has its own counter."}),"\n",(0,t.jsx)(r.hr,{}),"\n",(0,t.jsx)(r.h3,{id:"error-interceptor",children:"Error Interceptor"}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Source:"})," ",(0,t.jsx)(r.code,{children:"core/src/interceptors/error.ts"})]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",children:"export function errorInterceptor(error: AxiosError): Promise<never>\n"})}),"\n",(0,t.jsxs)(r.p,{children:["A ",(0,t.jsx)(r.strong,{children:"response error"})," interceptor that transforms ",(0,t.jsx)(r.code,{children:"AxiosError"})," into ",(0,t.jsx)(r.code,{children:"ApiError"})," with user-friendly messages. It runs ",(0,t.jsx)(r.strong,{children:"after"})," the retry interceptor has given up."]}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.strong,{children:"Status code \u2192 message mapping:"})}),"\n",(0,t.jsxs)(r.table,{children:[(0,t.jsx)(r.thead,{children:(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.th,{children:"Status"}),(0,t.jsx)(r.th,{children:"Message"})]})}),(0,t.jsxs)(r.tbody,{children:[(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"400"}),(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"'Bad request. Please check your input.'"})})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"401"}),(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"'Authentication failed. Check your credentials.'"})})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"403"}),(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"'Permission denied. You do not have access.'"})})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"404"}),(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"'Resource not found.'"})})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"409"}),(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"'Conflict. The resource may have changed.'"})})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"429"}),(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"'Too many requests. Please try again later.'"})})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"500"}),(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"'Server error. Please try again.'"})})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"502"}),(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"'Gateway error. The server is temporarily unavailable.'"})})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"503"}),(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"'Service unavailable. Please try again later.'"})})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"504"}),(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"'Gateway timeout. The server is not responding.'"})})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"Network"}),(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"'Network error. Check your connection.'"})})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"Timeout"}),(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"'Request timeout. The server took too long to respond.'"})})]})]})]}),"\n",(0,t.jsx)(r.p,{children:"Every error is also logged to console with structured context:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",children:"console.error('[API Error]', {\n  url: error.config?.url,\n  method: error.config?.method,\n  status: statusCode,\n  message: error.message,\n  timestamp: new Date().toISOString(),\n});\n"})}),"\n",(0,t.jsxs)(r.p,{children:["The interceptor always rejects with an ",(0,t.jsx)(r.code,{children:"ApiError"}),":"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",children:"return Promise.reject(\n  new ApiError(message, error, statusCode, `HTTP_${statusCode}`)\n);\n"})}),"\n",(0,t.jsx)(r.h3,{id:"interceptor-execution-order",children:"Interceptor Execution Order"}),"\n",(0,t.jsxs)(r.p,{children:["Axios response interceptors execute in ",(0,t.jsx)(r.strong,{children:"LIFO order"})," (last registered, first executed for errors). The registration order in ",(0,t.jsx)(r.code,{children:"createApiClient"})," is intentional:"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{children:"Registration order:        Execution order (errors):\n1. retryInterceptor       2. retryInterceptor  \u2190 tries to recover\n2. errorInterceptor       1. errorInterceptor  \u2190 transforms final error\n\nFlow for a 503 error:\n  AxiosError \u2192 errorInterceptor (skips \u2014 re-throws) \u2192 retryInterceptor\n      [wait 2s] \u2192 retry request\n      [wait 4s] \u2192 retry request\n      [wait 8s] \u2192 retry request exhausted\n  AxiosError \u2192 errorInterceptor \u2192 ApiError (user-friendly message)\n"})}),"\n",(0,t.jsxs)(r.p,{children:["The ",(0,t.jsx)(r.code,{children:"retryInterceptor"})," re-throws the original ",(0,t.jsx)(r.code,{children:"AxiosError"})," if it has been retried to exhaustion or is not retryable, at which point ",(0,t.jsx)(r.code,{children:"errorInterceptor"})," converts it to an ",(0,t.jsx)(r.code,{children:"ApiError"}),"."]}),"\n",(0,t.jsx)(r.hr,{}),"\n",(0,t.jsx)(r.h2,{id:"router-proxy-client",children:"Router Proxy Client"}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Source:"})," ",(0,t.jsx)(r.code,{children:"core/src/router-proxy.ts"})]}),"\n",(0,t.jsx)(r.p,{children:"The router proxy bypasses CORS restrictions by routing all RouterOS REST API calls through the NasNet Go backend. The browser never connects directly to the MikroTik router."}),"\n",(0,t.jsx)(r.h3,{id:"makerouterosrequest",children:"makeRouterOSRequest"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",children:"export async function makeRouterOSRequest<T>(\n  routerIp: string,\n  endpoint: string,\n  options?: RouterOSRequestOptions,\n  config?: Partial<ProxyConfig>\n): Promise<RouterOSResponse<T>>\n"})}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.strong,{children:"Parameters:"})}),"\n",(0,t.jsxs)(r.table,{children:[(0,t.jsx)(r.thead,{children:(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.th,{children:"Parameter"}),(0,t.jsx)(r.th,{children:"Type"}),(0,t.jsx)(r.th,{children:"Description"})]})}),(0,t.jsxs)(r.tbody,{children:[(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"routerIp"})}),(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"string"})}),(0,t.jsxs)(r.td,{children:["Target router IP address (e.g., ",(0,t.jsx)(r.code,{children:"'192.168.88.1'"}),")"]})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"endpoint"})}),(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"string"})}),(0,t.jsxs)(r.td,{children:["RouterOS REST path (e.g., ",(0,t.jsx)(r.code,{children:"'interface'"}),", ",(0,t.jsx)(r.code,{children:"'system/resource'"}),")"]})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"options"})}),(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"RouterOSRequestOptions"})}),(0,t.jsx)(r.td,{children:"Optional method, body, headers, params"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"config"})}),(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"Partial<ProxyConfig>"})}),(0,t.jsx)(r.td,{children:"Optional timeout/retry overrides"})]})]})]}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsxs)(r.strong,{children:[(0,t.jsx)(r.code,{children:"RouterOSRequestOptions"}),":"]})}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",children:"export interface RouterOSRequestOptions {\n  method?: 'GET' | 'POST' | 'PUT' | 'PATCH' | 'DELETE';  // default: 'GET'\n  body?: unknown;\n  headers?: Record<string, string>;\n  params?: Record<string, string>;\n}\n"})}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsxs)(r.strong,{children:[(0,t.jsx)(r.code,{children:"RouterOSResponse<T>"}),":"]})}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",children:"export interface RouterOSResponse<T> {\n  success: boolean;\n  data?: T;\n  error?: string;\n  timestamp: number;\n}\n"})}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.strong,{children:"Default proxy configuration:"})}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",children:"const defaultConfig: ProxyConfig = {\n  timeout: 30000,   // 30s\n  retries: 3,\n  retryDelay: 1000, // 1s between retries\n  baseUrl: '',      // relative to current origin\n};\n"})}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Endpoint normalization"})," \u2014 ",(0,t.jsx)(r.code,{children:"buildRouterOSEndpoint"}),":"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{children:"Input: 'interface'         \u2192  Output: '/rest/interface'\nInput: '/interface'        \u2192  Output: '/rest/interface'\nInput: 'rest/interface'    \u2192  Output: '/rest/interface'\nInput: '/rest/interface'   \u2192  Output: '/rest/interface'\n"})}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Response transformation"})," \u2014 ",(0,t.jsx)(r.code,{children:"convertRouterOSResponse"}),":"]}),"\n",(0,t.jsxs)(r.p,{children:["RouterOS uses kebab-case field names (e.g., ",(0,t.jsx)(r.code,{children:"max-l2mtu"}),", ",(0,t.jsx)(r.code,{children:"running-user"}),"). The proxy client automatically converts all response keys to camelCase:"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{children:'RouterOS:  { "max-l2mtu": "1500", "is-running": "true" }\nConverted: { maxL2Mtu: "1500",    isRunning: "true" }\n'})}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.strong,{children:"RouterOS error handling:"})}),"\n",(0,t.jsxs)(r.table,{children:[(0,t.jsx)(r.thead,{children:(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.th,{children:"RouterOS Status"}),(0,t.jsxs)(r.th,{children:["Returned ",(0,t.jsx)(r.code,{children:"RouterOSResponse"})]})]})}),(0,t.jsxs)(r.tbody,{children:[(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"401"}),(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"{ success: false, error: 'Authentication failed...' }"})})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"403"}),(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"{ success: false, error: 'Access denied...' }"})})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"404"}),(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"{ success: false, error: 'Resource not found...' }"})})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"Other non-2xx"}),(0,t.jsxs)(r.td,{children:["Throw \u2192 retry \u2192 ",(0,t.jsx)(r.code,{children:"{ success: false, error: '...' }"})]})]})]})]}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Pre-condition:"})," credentials must be stored in ",(0,t.jsx)(r.code,{children:"localStorage"})," at key ",(0,t.jsx)(r.code,{children:"nasnet:api:credentials"}),". If no credentials are found, the function returns immediately:"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",children:"{ success: false, error: 'No valid authentication credentials found', timestamp }\n"})}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.strong,{children:"Usage example:"})}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",children:"import { makeRouterOSRequest } from '@nasnet/api-client/core';\n\n// Read router interfaces\nconst result = await makeRouterOSRequest<Interface[]>('192.168.88.1', 'interface');\nif (result.success) {\n  console.log(result.data); // Interface[] with camelCase keys\n} else {\n  console.error(result.error);\n}\n\n// Write \u2014 enable an interface\nconst result = await makeRouterOSRequest('192.168.88.1', 'interface/set', {\n  method: 'POST',\n  body: { '.id': '*1', disabled: 'false' },\n});\n"})}),"\n",(0,t.jsx)(r.hr,{}),"\n",(0,t.jsx)(r.h3,{id:"createproxyqueryfn",children:"createProxyQueryFn"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",children:"export function createProxyQueryFn<T>(\n  routerIp: string,\n  endpoint: string,\n  options?: RouterOSRequestOptions\n): () => Promise<T>\n"})}),"\n",(0,t.jsxs)(r.p,{children:["Creates a TanStack Query ",(0,t.jsx)(r.code,{children:"queryFn"})," that wraps ",(0,t.jsx)(r.code,{children:"makeRouterOSRequest"}),". On failure it throws an ",(0,t.jsx)(r.code,{children:"Error"})," (instead of returning a ",(0,t.jsx)(r.code,{children:"RouterOSResponse"})," with ",(0,t.jsx)(r.code,{children:"success: false"}),"), which is the contract TanStack Query expects."]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",children:"import { useQuery } from '@tanstack/react-query';\nimport { createProxyQueryFn } from '@nasnet/api-client/core';\n\nconst { data } = useQuery({\n  queryKey: ['interfaces', routerIp],\n  queryFn: createProxyQueryFn<Interface[]>(routerIp, 'interface'),\n});\n"})}),"\n",(0,t.jsx)(r.hr,{}),"\n",(0,t.jsx)(r.h3,{id:"createproxymutationfn",children:"createProxyMutationFn"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",children:"export function createProxyMutationFn<TData, TVariables>(\n  routerIp: string,\n  endpoint: string,\n  method?: 'POST' | 'PUT' | 'PATCH' | 'DELETE'\n): (variables: TVariables) => Promise<TData>\n"})}),"\n",(0,t.jsxs)(r.p,{children:["Creates a TanStack Query ",(0,t.jsx)(r.code,{children:"mutationFn"})," that passes the mutation variables as the request body. Default method is ",(0,t.jsx)(r.code,{children:"POST"}),"."]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",children:"import { useMutation } from '@tanstack/react-query';\nimport { createProxyMutationFn } from '@nasnet/api-client/core';\n\nconst { mutate } = useMutation({\n  mutationFn: createProxyMutationFn<void, DisablePayload>(\n    routerIp,\n    'interface/set',\n    'POST'\n  ),\n});\n\nmutate({ '.id': '*2', disabled: 'true' });\n"})}),"\n",(0,t.jsx)(r.hr,{}),"\n",(0,t.jsx)(r.h3,{id:"proxy-request-pipeline",children:"Proxy Request Pipeline"}),"\n",(0,t.jsxs)(r.p,{children:["The full lifecycle of a ",(0,t.jsx)(r.code,{children:"makeRouterOSRequest"})," call:"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{children:"makeRouterOSRequest('192.168.88.1', 'interface', { method: 'GET' })\n      |\n      v\n1. Check credentials in localStorage\n      |  (no credentials) \u2192 return { success: false, error: 'No credentials' }\n      |  (credentials found) \u2192 build Basic auth header\n      v\n2. Build proxy request body:\n   {\n     router_ip: '192.168.88.1',\n     endpoint: '/rest/interface',\n     method: 'GET',\n     headers: { Authorization: 'Basic ...', Content-Type: 'application/json' }\n   }\n      |\n      v\n3. POST /api/router/proxy  (to NasNet Go backend)\n      |\n      |  (timeout: 30s, AbortController)\n      |  (retry: up to 3 attempts, 1s delay)\n      v\n4. NasNet backend \u2192 MikroTik RouterOS REST API\n   GET /rest/interface\n      |\n      v\n5. RouterProxyResponse { status, status_text, headers, body }\n      |\n      v\n6. Check RouterOS status code (401, 403, 404, non-2xx)\n      |\n      v\n7. convertRouterOSResponse(body) \u2192 camelCase keys\n      |\n      v\n8. Return { success: true, data: <converted>, timestamp }\n"})}),"\n",(0,t.jsx)(r.hr,{}),"\n",(0,t.jsx)(r.h2,{id:"shared-types",children:"Shared Types"}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Source:"})," ",(0,t.jsx)(r.code,{children:"core/src/types.ts"})]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",children:"// Success response wrapper (used by REST endpoints)\nexport interface ApiResponse<T> {\n  success: true;\n  data: T;\n  meta?: {\n    page?: number;\n    total?: number;\n    [key: string]: unknown;\n  };\n}\n\n// Error response wrapper\nexport interface ApiErrorResponse {\n  success: false;\n  error: {\n    code: string;\n    message: string;\n    details?: Record<string, unknown>;\n  };\n}\n\n// Type-safe error class\nexport class ApiError extends Error {\n  public originalError?: unknown;\n  public statusCode?: number;\n  public code?: string;\n\n  constructor(\n    message: string,\n    originalError?: unknown,\n    statusCode?: number,\n    code?: string\n  )\n}\n\n// Credential storage shape (used by both auth interceptor and router proxy)\nexport interface StoredCredentials {\n  username: string;\n  password: string;\n}\n\n// Client configuration\nexport interface ApiClientConfig {\n  baseURL?: string;\n  timeout?: number;\n  headers?: Record<string, string>;\n}\n\n// Internal retry tracking (extends Axios config)\nexport interface RetryConfig {\n  retryCount?: number;\n  [key: string]: unknown;\n}\n"})}),"\n",(0,t.jsx)(r.hr,{}),"\n",(0,t.jsx)(r.h2,{id:"error-model",children:"Error Model"}),"\n",(0,t.jsxs)(r.p,{children:["The Axios layer uses ",(0,t.jsx)(r.code,{children:"ApiError"})," for type-safe error handling. ",(0,t.jsx)(r.code,{children:"ApiError"})," extends native ",(0,t.jsx)(r.code,{children:"Error"})," and adds:"]}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"statusCode"})," \u2014 the HTTP status code (or ",(0,t.jsx)(r.code,{children:"undefined"})," for network errors)."]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"code"})," \u2014 a string code in the format ",(0,t.jsx)(r.code,{children:"HTTP_<status>"})," (e.g., ",(0,t.jsx)(r.code,{children:"HTTP_401"}),", ",(0,t.jsx)(r.code,{children:"HTTP_503"}),")."]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"originalError"})," \u2014 the original ",(0,t.jsx)(r.code,{children:"AxiosError"})," for debugging."]}),"\n"]}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.strong,{children:"Catching errors in feature code:"})}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",children:"import { apiClient, ApiError } from '@nasnet/api-client/core';\n\ntry {\n  const response = await apiClient.get('/routers');\n} catch (error) {\n  if (error instanceof ApiError) {\n    if (error.statusCode === 401) {\n      // Handle unauthorized\n    } else if (error.statusCode === 503) {\n      // Handle service unavailable\n    }\n    // Show user-facing message from error.message\n    toast.error(error.message);\n  }\n}\n"})}),"\n",(0,t.jsxs)(r.p,{children:["See ",(0,t.jsx)(r.code,{children:"./error-handling.md"})," for the complete error handling architecture, including the GraphQL error code taxonomy (",(0,t.jsx)(r.code,{children:"P1xx"}),", ",(0,t.jsx)(r.code,{children:"R2xx"}),", ",(0,t.jsx)(r.code,{children:"N3xx"}),", ",(0,t.jsx)(r.code,{children:"V4xx"}),", ",(0,t.jsx)(r.code,{children:"A5xx"}),", ",(0,t.jsx)(r.code,{children:"S6xx"}),")."]}),"\n",(0,t.jsx)(r.hr,{}),"\n",(0,t.jsx)(r.h2,{id:"exports-reference",children:"Exports Reference"}),"\n",(0,t.jsxs)(r.p,{children:["All symbols are re-exported from ",(0,t.jsx)(r.code,{children:"@nasnet/api-client/core"}),"."]}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsxs)(r.strong,{children:["From ",(0,t.jsx)(r.code,{children:"core/src/client.ts"}),":"]})}),"\n",(0,t.jsxs)(r.table,{children:[(0,t.jsx)(r.thead,{children:(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.th,{children:"Export"}),(0,t.jsx)(r.th,{children:"Type"}),(0,t.jsx)(r.th,{children:"Description"})]})}),(0,t.jsxs)(r.tbody,{children:[(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"createApiClient"})}),(0,t.jsx)(r.td,{children:"function"}),(0,t.jsx)(r.td,{children:"Factory that creates a new Axios instance"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"apiClient"})}),(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"AxiosInstance"})}),(0,t.jsx)(r.td,{children:"Default pre-configured Axios instance"})]})]})]}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsxs)(r.strong,{children:["From ",(0,t.jsx)(r.code,{children:"core/src/router-proxy.ts"}),":"]})}),"\n",(0,t.jsxs)(r.table,{children:[(0,t.jsx)(r.thead,{children:(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.th,{children:"Export"}),(0,t.jsx)(r.th,{children:"Type"}),(0,t.jsx)(r.th,{children:"Description"})]})}),(0,t.jsxs)(r.tbody,{children:[(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"makeRouterOSRequest<T>"})}),(0,t.jsx)(r.td,{children:"async function"}),(0,t.jsx)(r.td,{children:"Direct RouterOS REST call via backend proxy"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"createProxyQueryFn<T>"})}),(0,t.jsx)(r.td,{children:"function"}),(0,t.jsxs)(r.td,{children:["Creates TanStack Query ",(0,t.jsx)(r.code,{children:"queryFn"})]})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"createProxyMutationFn<TData, TVariables>"})}),(0,t.jsx)(r.td,{children:"function"}),(0,t.jsxs)(r.td,{children:["Creates TanStack Query ",(0,t.jsx)(r.code,{children:"mutationFn"})]})]})]})]}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsxs)(r.strong,{children:["From ",(0,t.jsx)(r.code,{children:"core/src/interceptors/"}),":"]})}),"\n",(0,t.jsxs)(r.table,{children:[(0,t.jsx)(r.thead,{children:(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.th,{children:"Export"}),(0,t.jsx)(r.th,{children:"Type"}),(0,t.jsx)(r.th,{children:"Description"})]})}),(0,t.jsxs)(r.tbody,{children:[(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"authInterceptor"})}),(0,t.jsx)(r.td,{children:"request interceptor"}),(0,t.jsx)(r.td,{children:"Adds Basic Auth header"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"storeCredentials"})}),(0,t.jsx)(r.td,{children:"function"}),(0,t.jsx)(r.td,{children:"Persists credentials to localStorage"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"clearCredentials"})}),(0,t.jsx)(r.td,{children:"function"}),(0,t.jsx)(r.td,{children:"Removes credentials from localStorage"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"retryInterceptor"})}),(0,t.jsx)(r.td,{children:"error interceptor"}),(0,t.jsx)(r.td,{children:"Exponential backoff retry"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"errorInterceptor"})}),(0,t.jsx)(r.td,{children:"error interceptor"}),(0,t.jsxs)(r.td,{children:["Maps to ",(0,t.jsx)(r.code,{children:"ApiError"})]})]})]})]}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsxs)(r.strong,{children:["From ",(0,t.jsx)(r.code,{children:"core/src/types.ts"}),":"]})}),"\n",(0,t.jsxs)(r.table,{children:[(0,t.jsx)(r.thead,{children:(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.th,{children:"Export"}),(0,t.jsx)(r.th,{children:"Kind"}),(0,t.jsx)(r.th,{children:"Description"})]})}),(0,t.jsxs)(r.tbody,{children:[(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"ApiResponse<T>"})}),(0,t.jsx)(r.td,{children:"interface"}),(0,t.jsx)(r.td,{children:"Success response shape"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"ApiErrorResponse"})}),(0,t.jsx)(r.td,{children:"interface"}),(0,t.jsx)(r.td,{children:"Error response shape"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"ApiError"})}),(0,t.jsx)(r.td,{children:"class"}),(0,t.jsxs)(r.td,{children:["Type-safe error with ",(0,t.jsx)(r.code,{children:"statusCode"})," and ",(0,t.jsx)(r.code,{children:"code"})]})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"StoredCredentials"})}),(0,t.jsx)(r.td,{children:"interface"}),(0,t.jsxs)(r.td,{children:[(0,t.jsx)(r.code,{children:"{ username, password }"})," shape"]})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"ApiClientConfig"})}),(0,t.jsx)(r.td,{children:"interface"}),(0,t.jsxs)(r.td,{children:[(0,t.jsx)(r.code,{children:"createApiClient"})," options"]})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"RetryConfig"})}),(0,t.jsx)(r.td,{children:"interface"}),(0,t.jsx)(r.td,{children:"Internal retry tracking shape"})]})]})]}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsxs)(r.strong,{children:["From ",(0,t.jsx)(r.code,{children:"core/src/router-proxy.ts"})," (types):"]})}),"\n",(0,t.jsxs)(r.table,{children:[(0,t.jsx)(r.thead,{children:(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.th,{children:"Export"}),(0,t.jsx)(r.th,{children:"Kind"}),(0,t.jsx)(r.th,{children:"Description"})]})}),(0,t.jsxs)(r.tbody,{children:[(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"RouterOSRequestOptions"})}),(0,t.jsx)(r.td,{children:"interface"}),(0,t.jsxs)(r.td,{children:[(0,t.jsx)(r.code,{children:"method"}),", ",(0,t.jsx)(r.code,{children:"body"}),", ",(0,t.jsx)(r.code,{children:"headers"}),", ",(0,t.jsx)(r.code,{children:"params"})]})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"RouterOSResponse<T>"})}),(0,t.jsx)(r.td,{children:"interface"}),(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"{ success, data?, error?, timestamp }"})})]})]})]}),"\n",(0,t.jsx)(r.hr,{}),"\n",(0,t.jsx)(r.h2,{id:"fetch-based-router-proxy",children:"Fetch-Based Router Proxy"}),"\n",(0,t.jsxs)(r.p,{children:["The router proxy is a separate ",(0,t.jsx)(r.code,{children:"fetch"}),"-based client (not Axios) that directly handles RouterOS REST API tunneling through the NasNet backend. While Axios handles general REST endpoints (",(0,t.jsx)(r.code,{children:"/api/v1/*"}),"), the router proxy is optimized for the specific pattern of proxying RouterOS requests with credential management and response transformation."]}),"\n",(0,t.jsx)(r.h3,{id:"helper-functions",children:"Helper Functions"}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Source:"})," ",(0,t.jsx)(r.code,{children:"core/src/router-proxy.ts:87\u2013121"})]}),"\n",(0,t.jsx)(r.h4,{id:"buildrouterosendpointendpoint",children:(0,t.jsx)(r.code,{children:"buildRouterOSEndpoint(endpoint)"})}),"\n",(0,t.jsxs)(r.p,{children:["Normalizes RouterOS REST API endpoint paths to ensure they start with ",(0,t.jsx)(r.code,{children:"/rest/"}),":"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",children:"function buildRouterOSEndpoint(endpoint: string): string {\n  const cleanEndpoint = endpoint.startsWith('/') ? endpoint.substring(1) : endpoint;\n  if (cleanEndpoint.startsWith('rest/')) {\n    return `/${cleanEndpoint}`;\n  }\n  return `/rest/${cleanEndpoint}`;\n}\n"})}),"\n",(0,t.jsxs)(r.table,{children:[(0,t.jsx)(r.thead,{children:(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.th,{children:"Input"}),(0,t.jsx)(r.th,{children:"Output"}),(0,t.jsx)(r.th,{children:"Notes"})]})}),(0,t.jsxs)(r.tbody,{children:[(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"'interface'"})}),(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"/rest/interface"})}),(0,t.jsx)(r.td,{children:"Common case"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"'/interface'"})}),(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"/rest/interface"})}),(0,t.jsx)(r.td,{children:"Leading slash removed"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"'rest/interface'"})}),(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"/rest/interface"})}),(0,t.jsx)(r.td,{children:"Already prefixed"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"'/rest/interface'"})}),(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"/rest/interface"})}),(0,t.jsx)(r.td,{children:"Already complete"})]})]})]}),"\n",(0,t.jsx)(r.h4,{id:"convertrouterosresponsetdata",children:(0,t.jsx)(r.code,{children:"convertRouterOSResponse<T>(data)"})}),"\n",(0,t.jsxs)(r.p,{children:["Recursively converts all object keys from kebab-case to camelCase. RouterOS uses field names like ",(0,t.jsx)(r.code,{children:"max-l2mtu"}),", ",(0,t.jsx)(r.code,{children:"running-user"}),", etc.; the browser expects camelCase for consistency with JavaScript conventions."]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",children:"function convertRouterOSResponse<T>(data: unknown): T {\n  if (Array.isArray(data)) {\n    return data.map(item => convertRouterOSResponse(item)) as T;\n  }\n\n  if (data && typeof data === 'object') {\n    const converted: Record<string, unknown> = {};\n    for (const [key, value] of Object.entries(data)) {\n      const camelKey = key.replace(/-([a-z])/g, (_, letter) => letter.toUpperCase());\n      converted[camelKey] = convertRouterOSResponse(value);\n    }\n    return converted as T;\n  }\n\n  return data as T;\n}\n"})}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.strong,{children:"Example:"})}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{children:'Input:  { "max-l2mtu": "1500", "is-running": "true" }\nOutput: { maxL2Mtu: "1500",    isRunning:   "true" }\n'})}),"\n",(0,t.jsx)(r.h3,{id:"tanstack-query-factories",children:"TanStack Query Factories"}),"\n",(0,t.jsxs)(r.p,{children:["These factory functions wrap ",(0,t.jsx)(r.code,{children:"makeRouterOSRequest"})," for use with TanStack Query's ",(0,t.jsx)(r.code,{children:"useQuery"})," and ",(0,t.jsx)(r.code,{children:"useMutation"})," hooks. They bridge the gap between the raw Promise-based router proxy API and TanStack Query's error-handling contract (throwing on failure instead of returning error objects)."]}),"\n",(0,t.jsx)(r.h4,{id:"createproxyqueryfntrouterip-endpoint-options",children:(0,t.jsx)(r.code,{children:"createProxyQueryFn<T>(routerIp, endpoint, options?)"})}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Source:"})," ",(0,t.jsx)(r.code,{children:"core/src/router-proxy.ts"})," (lines from reading session)"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",children:"export function createProxyQueryFn<T>(\n  routerIp: string,\n  endpoint: string,\n  options?: RouterOSRequestOptions\n): () => Promise<T>\n"})}),"\n",(0,t.jsxs)(r.p,{children:["Creates a TanStack Query ",(0,t.jsx)(r.code,{children:"queryFn"})," that ",(0,t.jsx)(r.strong,{children:"throws"})," on failure (the contract TanStack Query expects) instead of returning a ",(0,t.jsx)(r.code,{children:"RouterOSResponse"})," with ",(0,t.jsx)(r.code,{children:"success: false"}),"."]}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsxs)(r.strong,{children:["Usage with ",(0,t.jsx)(r.code,{children:"useQuery"}),":"]})}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",children:"import { useQuery } from '@tanstack/react-query';\nimport { createProxyQueryFn } from '@nasnet/api-client/core';\n\ninterface Interface {\n  name: string;\n  running: boolean;\n  disabled: boolean;\n}\n\nfunction InterfaceList({ routerIp }: { routerIp: string }) {\n  const { data, isLoading, error } = useQuery({\n    queryKey: ['interfaces', routerIp],\n    queryFn: createProxyQueryFn<Interface[]>(routerIp, 'interface'),\n  });\n\n  return data ? <Table data={data} /> : <Spinner />;\n}\n"})}),"\n",(0,t.jsx)(r.h4,{id:"createproxymutationfntdata-tvariablesrouterip-endpoint-method",children:(0,t.jsx)(r.code,{children:"createProxyMutationFn<TData, TVariables>(routerIp, endpoint, method?)"})}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Source:"})," ",(0,t.jsx)(r.code,{children:"core/src/router-proxy.ts"})," (lines from reading session)"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",children:"export function createProxyMutationFn<TData, TVariables>(\n  routerIp: string,\n  endpoint: string,\n  method?: 'POST' | 'PUT' | 'PATCH' | 'DELETE'\n): (variables: TVariables) => Promise<TData>\n"})}),"\n",(0,t.jsxs)(r.p,{children:["Creates a TanStack Query ",(0,t.jsx)(r.code,{children:"mutationFn"}),". The ",(0,t.jsx)(r.code,{children:"variables"})," parameter is passed as the request body. Default method is ",(0,t.jsx)(r.code,{children:"POST"}),"."]}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsxs)(r.strong,{children:["Usage with ",(0,t.jsx)(r.code,{children:"useMutation"}),":"]})}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",children:"import { useMutation } from '@tanstack/react-query';\nimport { createProxyMutationFn } from '@nasnet/api-client/core';\n\ninterface DisableInterfacePayload {\n  '.id': string;\n  disabled: 'true' | 'false';\n}\n\nfunction InterfaceToggle({ routerIp, interfaceId }: Props) {\n  const { mutate, isPending } = useMutation({\n    mutationFn: createProxyMutationFn<void, DisableInterfacePayload>(\n      routerIp,\n      'interface/set',\n      'POST'\n    ),\n  });\n\n  const handleDisable = () => {\n    mutate({\n      '.id': interfaceId,\n      disabled: 'true',\n    });\n  };\n\n  return <Button onClick={handleDisable} disabled={isPending}>Disable</Button>;\n}\n"})}),"\n",(0,t.jsx)(r.h3,{id:"proxyconfig-interface",children:"ProxyConfig Interface"}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Source:"})," ",(0,t.jsx)(r.code,{children:"core/src/router-proxy.ts:11\u201317"})]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",children:"interface ProxyConfig {\n  readonly timeout: number;       // Default: 30000 (30 seconds)\n  readonly retries: number;       // Default: 3\n  readonly retryDelay: number;    // Default: 1000 (1 second)\n  readonly baseUrl: string;       // Default: '' (relative to current origin)\n}\n"})}),"\n",(0,t.jsx)(r.p,{children:"These defaults apply to all router proxy requests. Override on a per-request basis:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",children:"const result = await makeRouterOSRequest(routerIp, endpoint, options, {\n  timeout: 60000,    // 60s timeout for slow queries\n  retries: 5,        // More retries for unreliable links\n});\n"})}),"\n",(0,t.jsx)(r.hr,{}),"\n",(0,t.jsx)(r.h2,{id:"decision-when-to-use-axios-vs-apollo",children:"Decision: When to Use Axios vs. Apollo"}),"\n",(0,t.jsx)(r.p,{children:"The library provides three HTTP mechanisms. Choose based on the data source and operation type:"}),"\n",(0,t.jsxs)(r.table,{children:[(0,t.jsx)(r.thead,{children:(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.th,{children:"Scenario"}),(0,t.jsx)(r.th,{children:"Use"}),(0,t.jsx)(r.th,{children:"Notes"})]})}),(0,t.jsxs)(r.tbody,{children:[(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"Reading/writing GraphQL data from the NasNet backend"}),(0,t.jsxs)(r.td,{children:["Apollo Client (",(0,t.jsx)(r.code,{children:"useQuery"}),", ",(0,t.jsx)(r.code,{children:"useMutation"}),", ",(0,t.jsx)(r.code,{children:"useSubscription"}),")"]}),(0,t.jsx)(r.td,{children:"Normalized cache, subscriptions, real-time"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"Direct RouterOS REST API calls (non-GraphQL)"}),(0,t.jsxs)(r.td,{children:[(0,t.jsx)(r.code,{children:"makeRouterOSRequest"})," or ",(0,t.jsx)(r.code,{children:"createProxyQueryFn"})]}),(0,t.jsx)(r.td,{children:"Fetch-based; bypasses CORS via backend proxy"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsxs)(r.td,{children:["Backend REST endpoints (",(0,t.jsx)(r.code,{children:"/api/v1/*"}),")"]}),(0,t.jsxs)(r.td,{children:[(0,t.jsx)(r.code,{children:"apiClient"})," (Axios)"]}),(0,t.jsx)(r.td,{children:"General REST client; auth, health, etc."})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"Form submissions that don't map to GraphQL"}),(0,t.jsxs)(r.td,{children:[(0,t.jsx)(r.code,{children:"apiClient"})," (Axios)"]}),(0,t.jsx)(r.td,{children:"Pre-validation bootstrap calls"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"Real-time data streams"}),(0,t.jsx)(r.td,{children:"Apollo subscriptions via WebSocket"}),(0,t.jsx)(r.td,{children:"Subscriptions, live updates"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"File uploads"}),(0,t.jsxs)(r.td,{children:[(0,t.jsx)(r.code,{children:"apiClient"})," (Axios) with ",(0,t.jsx)(r.code,{children:"multipart/form-data"})]}),(0,t.jsx)(r.td,{children:"Axios handles multipart encoding"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"Authentication (login, token refresh)"}),(0,t.jsxs)(r.td,{children:[(0,t.jsx)(r.code,{children:"apiClient"})," (Axios)"]}),(0,t.jsx)(r.td,{children:"Runs before Apollo is configured"})]})]})]}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.strong,{children:"Rule of thumb:"})}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsxs)(r.strong,{children:["If the data has a GraphQL type in ",(0,t.jsx)(r.code,{children:"schema/"})]})," \u2192 Use Apollo."]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"If you need raw RouterOS REST access"})," \u2192 Use ",(0,t.jsx)(r.code,{children:"makeRouterOSRequest"})," / ",(0,t.jsx)(r.code,{children:"createProxyQueryFn"}),"."]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsxs)(r.strong,{children:["If you're calling ",(0,t.jsx)(r.code,{children:"/api/v1/*"})," backend endpoints"]})," \u2192 Use ",(0,t.jsx)(r.code,{children:"apiClient"})," (Axios)."]}),"\n"]}),"\n",(0,t.jsxs)(r.p,{children:["See ",(0,t.jsx)(r.code,{children:"./intro.md"})," for the full decision matrix."]}),"\n",(0,t.jsx)(r.hr,{}),"\n",(0,t.jsx)(r.h2,{id:"cross-references",children:"Cross-References"}),"\n",(0,t.jsxs)(r.table,{children:[(0,t.jsx)(r.thead,{children:(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.th,{children:"Topic"}),(0,t.jsx)(r.th,{children:"Document"})]})}),(0,t.jsxs)(r.tbody,{children:[(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"Library overview and decision matrix"}),(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"./intro.md"})})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"Apollo Client setup and link chain"}),(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"./apollo-client.md"})})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"Authentication architecture"}),(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"./authentication.md"})})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"Error handling and ApiError taxonomy"}),(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"./error-handling.md"})})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"Domain query hooks built on Apollo"}),(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"./domain-query-hooks.md"})})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"Testing strategies and mock clients"}),(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"./testing-and-codegen.md"})})]})]})]})]})}function h(e={}){const{wrapper:r}={...(0,i.R)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},71184:(e,r,n)=>{n.d(r,{R:()=>c,x:()=>o});var s=n(14041);const t={},i=s.createContext(t);function c(e){const r=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function o(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:c(e.components),s.createElement(i.Provider,{value:r},e.children)}}}]);