"use strict";(globalThis.webpackChunk_nas_net_docs=globalThis.webpackChunk_nas_net_docs||[]).push([[39068],{71184:(e,s,t)=>{t.d(s,{R:()=>i,x:()=>a});var n=t(14041);const d={},r=n.createContext(d);function i(e){const s=n.useContext(r);return n.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:i(e.components),n.createElement(r.Provider,{value:s},e.children)}},85775:(e,s,t)=>{t.r(s),t.d(s,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>i,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"forms-validation/wizard-forms","title":"Wizard Forms","description":"Multi-step forms in NasNetConnect use useWizardPersistence to manage step navigation, data collection, and state persistence across page reloads.","source":"@site/../connect/docs/forms-validation/wizard-forms.md","sourceDirName":"forms-validation","slug":"/forms-validation/wizard-forms","permalink":"/docs/frontend/forms-validation/wizard-forms","draft":false,"unlisted":false,"editUrl":"https://github.com/nasnet-community/nasnet-panel/tree/main/../connect/docs/forms-validation/wizard-forms.md","tags":[],"version":"current","frontMatter":{},"sidebar":"sidebar","previous":{"title":"Validation Pipeline","permalink":"/docs/frontend/forms-validation/validation-pipeline"},"next":{"title":"Overview","permalink":"/docs/frontend/getting-started/overview"}}');var d=t(31085),r=t(71184);const i={},a="Wizard Forms",l={},c=[{value:"Design Goals",id:"design-goals",level:2},{value:"useWizardPersistence",id:"usewizardpersistence",level:2},{value:"Signature",id:"signature",level:3},{value:"Options",id:"options",level:3},{value:"Full Example",id:"full-example",level:3},{value:"Returned Values and Methods",id:"returned-values-and-methods",level:2},{value:"Navigation State",id:"navigation-state",level:3},{value:"Data Methods",id:"data-methods",level:3},{value:"Navigation Methods",id:"navigation-methods",level:3},{value:"Lifecycle Methods",id:"lifecycle-methods",level:3},{value:"Navigation Rules",id:"navigation-rules",level:2},{value:"Individual Step Forms",id:"individual-step-forms",level:2},{value:"TTL and Expiry",id:"ttl-and-expiry",level:2},{value:"Combining With useFormPersistence",id:"combining-with-useformpersistence",level:2}];function o(e){const s={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(s.header,{children:(0,d.jsx)(s.h1,{id:"wizard-forms",children:"Wizard Forms"})}),"\n",(0,d.jsxs)(s.p,{children:["Multi-step forms in NasNetConnect use ",(0,d.jsx)(s.code,{children:"useWizardPersistence"})," to manage step navigation, data collection, and state persistence across page reloads."]}),"\n",(0,d.jsxs)(s.p,{children:["File: ",(0,d.jsx)(s.code,{children:"libs/core/forms/src/useWizardPersistence.ts"})]}),"\n",(0,d.jsx)(s.h2,{id:"design-goals",children:"Design Goals"}),"\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsx)(s.li,{children:"Each wizard step is an independent React Hook Form instance"}),"\n",(0,d.jsx)(s.li,{children:"Data is accumulated across steps and submitted as one payload at the end"}),"\n",(0,d.jsxs)(s.li,{children:["State survives page refresh via ",(0,d.jsx)(s.code,{children:"sessionStorage"})," with a configurable TTL"]}),"\n",(0,d.jsx)(s.li,{children:"Navigation is enforced: users can only go to completed steps or the next available step"}),"\n",(0,d.jsx)(s.li,{children:"Progress is calculable at any point"}),"\n"]}),"\n",(0,d.jsx)(s.h2,{id:"usewizardpersistence",children:"useWizardPersistence"}),"\n",(0,d.jsx)(s.h3,{id:"signature",children:"Signature"}),"\n",(0,d.jsx)(s.pre,{children:(0,d.jsx)(s.code,{className:"language-typescript",children:"function useWizardPersistence<TStepData extends Record<string, FieldValues>>(\n  options: UseWizardPersistenceOptions<TStepData>\n): UseWizardPersistenceReturn<TStepData>\n"})}),"\n",(0,d.jsx)(s.h3,{id:"options",children:"Options"}),"\n",(0,d.jsxs)(s.table,{children:[(0,d.jsx)(s.thead,{children:(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.th,{children:"Option"}),(0,d.jsx)(s.th,{children:"Type"}),(0,d.jsx)(s.th,{children:"Default"}),(0,d.jsx)(s.th,{children:"Description"})]})}),(0,d.jsxs)(s.tbody,{children:[(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"storageKey"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"string"})}),(0,d.jsx)(s.td,{children:"required"}),(0,d.jsx)(s.td,{children:"Unique key for this wizard in storage"})]}),(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"stepIds"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"string[]"})}),(0,d.jsx)(s.td,{children:"required"}),(0,d.jsx)(s.td,{children:"Ordered list of step identifiers"})]}),(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"initialStep"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"string | number"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"stepIds[0]"})}),(0,d.jsx)(s.td,{children:"Starting step"})]}),(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"storage"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"Storage"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"sessionStorage"})}),(0,d.jsx)(s.td,{children:"Storage backend"})]}),(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"ttlMs"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"number"})}),(0,d.jsxs)(s.td,{children:[(0,d.jsx)(s.code,{children:"86400000"})," (24 h)"]}),(0,d.jsx)(s.td,{children:"How long before saved state expires"})]}),(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"onRestore"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"(state) => void"})}),(0,d.jsx)(s.td,{children:"\u2014"}),(0,d.jsx)(s.td,{children:"Called when saved state is restored"})]}),(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"onExpire"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"() => void"})}),(0,d.jsx)(s.td,{children:"\u2014"}),(0,d.jsx)(s.td,{children:"Called when saved state expires"})]})]})]}),"\n",(0,d.jsx)(s.h3,{id:"full-example",children:"Full Example"}),"\n",(0,d.jsx)(s.pre,{children:(0,d.jsx)(s.code,{className:"language-typescript",children:"import { useWizardPersistence, useZodForm } from '@nasnet/core/forms';\n\n// Type the data shape for each step\ntype WPNSetupData = {\n  basic: { name: string; description: string };\n  network: { address: string; listenPort: number };\n  peers: { peers: PeerConfig[] };\n  review: Record<string, never>;\n};\n\nfunction WireGuardSetupWizard() {\n  const wizard = useWizardPersistence<WPNSetupData>({\n    storageKey: 'wireguard-setup-wizard',\n    stepIds: ['basic', 'network', 'peers', 'review'],\n    ttlMs: 60 * 60 * 1000,  // 1 hour\n    onRestore: (state) => {\n      console.log('Restored from step:', state.currentStep);\n    },\n  });\n\n  return (\n    <div>\n      {wizard.wasRestored && (\n        <Alert>Your previous progress has been restored.</Alert>\n      )}\n\n      {/* Progress indicator */}\n      <ProgressBar value={wizard.progress} max={100} />\n      <span>{wizard.currentStepIndex + 1} / {wizard.stepIds.length}</span>\n\n      {/* Step rendering */}\n      {wizard.currentStep === 'basic' && (\n        <BasicStep\n          defaultValues={wizard.getStepData('basic')}\n          onComplete={(data) => {\n            wizard.setStepData('basic', data);\n            wizard.completeStep('basic');\n            wizard.nextStep();\n          }}\n        />\n      )}\n\n      {wizard.currentStep === 'network' && (\n        <NetworkStep\n          defaultValues={wizard.getStepData('network')}\n          onComplete={(data) => {\n            wizard.setStepData('network', data);\n            wizard.completeStep('network');\n            wizard.nextStep();\n          }}\n          onBack={wizard.prevStep}\n        />\n      )}\n\n      {wizard.currentStep === 'review' && (\n        <ReviewStep\n          allData={wizard.getAllStepData()}\n          onSubmit={async () => {\n            await createWireGuardTunnel(wizard.getAllStepData());\n            wizard.clearPersistence();\n          }}\n          onBack={wizard.prevStep}\n        />\n      )}\n\n      {/* Step navigation (breadcrumbs) */}\n      <StepList>\n        {wizard.stepIds.map((id) => (\n          <StepItem\n            key={id}\n            label={id}\n            completed={wizard.isStepCompleted(id)}\n            active={wizard.currentStep === id}\n            disabled={!wizard.canGoToStep(id)}\n            onClick={() => wizard.goToStep(id)}\n          />\n        ))}\n      </StepList>\n    </div>\n  );\n}\n"})}),"\n",(0,d.jsx)(s.h2,{id:"returned-values-and-methods",children:"Returned Values and Methods"}),"\n",(0,d.jsx)(s.h3,{id:"navigation-state",children:"Navigation State"}),"\n",(0,d.jsxs)(s.table,{children:[(0,d.jsx)(s.thead,{children:(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.th,{children:"Property"}),(0,d.jsx)(s.th,{children:"Type"}),(0,d.jsx)(s.th,{children:"Description"})]})}),(0,d.jsxs)(s.tbody,{children:[(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"currentStep"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"string"})}),(0,d.jsx)(s.td,{children:"Current step ID"})]}),(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"currentStepIndex"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"number"})}),(0,d.jsx)(s.td,{children:"0-based index"})]}),(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"completedSteps"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"string[]"})}),(0,d.jsx)(s.td,{children:"IDs of completed steps"})]}),(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"progress"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"number"})}),(0,d.jsx)(s.td,{children:"0\u2013100 based on completed / total"})]}),(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"isFirstStep"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"boolean"})}),(0,d.jsx)(s.td,{children:"On the first step"})]}),(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"isLastStep"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"boolean"})}),(0,d.jsx)(s.td,{children:"On the last step"})]}),(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"wasRestored"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"boolean"})}),(0,d.jsxs)(s.td,{children:[(0,d.jsx)(s.code,{children:"true"})," if state was loaded from storage"]})]})]})]}),"\n",(0,d.jsx)(s.h3,{id:"data-methods",children:"Data Methods"}),"\n",(0,d.jsxs)(s.table,{children:[(0,d.jsx)(s.thead,{children:(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.th,{children:"Method"}),(0,d.jsx)(s.th,{children:"Description"})]})}),(0,d.jsxs)(s.tbody,{children:[(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"getStepData(stepId)"})}),(0,d.jsx)(s.td,{children:"Get saved data for a step (typed)"})]}),(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"setStepData(stepId, data)"})}),(0,d.jsx)(s.td,{children:"Save data for a step (typed)"})]}),(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"getAllStepData()"})}),(0,d.jsxs)(s.td,{children:["Returns ",(0,d.jsx)(s.code,{children:"Partial<TStepData>"})," with all step data"]})]}),(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"setMetadata(meta)"})}),(0,d.jsx)(s.td,{children:"Store arbitrary wizard metadata"})]})]})]}),"\n",(0,d.jsx)(s.h3,{id:"navigation-methods",children:"Navigation Methods"}),"\n",(0,d.jsxs)(s.table,{children:[(0,d.jsx)(s.thead,{children:(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.th,{children:"Method"}),(0,d.jsx)(s.th,{children:"Description"})]})}),(0,d.jsxs)(s.tbody,{children:[(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"goToStep(stepId | index)"})}),(0,d.jsxs)(s.td,{children:["Navigate to a specific step (enforces ",(0,d.jsx)(s.code,{children:"canGoToStep"}),")"]})]}),(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"nextStep()"})}),(0,d.jsx)(s.td,{children:"Advance to the next step"})]}),(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"prevStep()"})}),(0,d.jsx)(s.td,{children:"Go back to the previous step"})]}),(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"completeStep(stepId)"})}),(0,d.jsx)(s.td,{children:"Mark a step as completed"})]}),(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"isStepCompleted(stepId)"})}),(0,d.jsx)(s.td,{children:"Check if a step is completed"})]}),(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"canGoToStep(stepId)"})}),(0,d.jsxs)(s.td,{children:["Returns ",(0,d.jsx)(s.code,{children:"true"})," if navigation is allowed"]})]})]})]}),"\n",(0,d.jsx)(s.h3,{id:"lifecycle-methods",children:"Lifecycle Methods"}),"\n",(0,d.jsxs)(s.table,{children:[(0,d.jsx)(s.thead,{children:(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.th,{children:"Method"}),(0,d.jsx)(s.th,{children:"Description"})]})}),(0,d.jsxs)(s.tbody,{children:[(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"reset()"})}),(0,d.jsx)(s.td,{children:"Reset to initial state and persist"})]}),(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"clearPersistence()"})}),(0,d.jsx)(s.td,{children:"Delete saved state and reset to initial state"})]})]})]}),"\n",(0,d.jsx)(s.h2,{id:"navigation-rules",children:"Navigation Rules"}),"\n",(0,d.jsxs)(s.p,{children:[(0,d.jsx)(s.code,{children:"canGoToStep"})," enforces these rules:"]}),"\n",(0,d.jsxs)(s.ol,{children:["\n",(0,d.jsx)(s.li,{children:"Always allowed: completed steps"}),"\n",(0,d.jsx)(s.li,{children:"Always allowed: the current step"}),"\n",(0,d.jsx)(s.li,{children:"Allowed: the next step, if the current step is completed"}),"\n",(0,d.jsx)(s.li,{children:"Not allowed: steps beyond the next step (prevents skipping)"}),"\n"]}),"\n",(0,d.jsx)(s.h2,{id:"individual-step-forms",children:"Individual Step Forms"}),"\n",(0,d.jsxs)(s.p,{children:["Each step should have its own ",(0,d.jsx)(s.code,{children:"useZodForm"})," instance. Pass saved data as default values:"]}),"\n",(0,d.jsx)(s.pre,{children:(0,d.jsx)(s.code,{className:"language-typescript",children:"function NetworkStep({ defaultValues, onComplete, onBack }) {\n  const form = useZodForm({\n    schema: networkStepSchema,\n    defaultValues: defaultValues ?? { address: '', listenPort: 51820 },\n  });\n\n  const onSubmit = form.handleSubmit((data) => {\n    onComplete(data);\n  });\n\n  return (\n    <form onSubmit={onSubmit}>\n      <input {...form.register('address')} />\n      <input type=\"number\" {...form.register('listenPort')} />\n      <div>\n        <Button type=\"button\" onClick={onBack}>Back</Button>\n        <Button type=\"submit\">Next</Button>\n      </div>\n    </form>\n  );\n}\n"})}),"\n",(0,d.jsx)(s.h2,{id:"ttl-and-expiry",children:"TTL and Expiry"}),"\n",(0,d.jsxs)(s.p,{children:["State older than ",(0,d.jsx)(s.code,{children:"ttlMs"})," is automatically discarded when the wizard mounts. The ",(0,d.jsx)(s.code,{children:"onExpire"})," callback fires in this case so you can show a notification:"]}),"\n",(0,d.jsx)(s.pre,{children:(0,d.jsx)(s.code,{className:"language-typescript",children:"const wizard = useWizardPersistence({\n  storageKey: 'setup-wizard',\n  stepIds: ['step1', 'step2', 'step3'],\n  ttlMs: 30 * 60 * 1000,  // 30 minutes\n  onExpire: () => {\n    toast.info('Your wizard session expired. Starting fresh.');\n  },\n});\n"})}),"\n",(0,d.jsx)(s.h2,{id:"combining-with-useformpersistence",children:"Combining With useFormPersistence"}),"\n",(0,d.jsxs)(s.p,{children:[(0,d.jsx)(s.code,{children:"useWizardPersistence"})," handles wizard-level state (current step, completed steps, step data). For within-step persistence (user mid-step when they refresh), you can additionally use ",(0,d.jsx)(s.code,{children:"useFormPersistence"})," on individual step forms:"]}),"\n",(0,d.jsx)(s.pre,{children:(0,d.jsx)(s.code,{className:"language-typescript",children:"function BasicStep({ defaultValues, onComplete }) {\n  const form = useZodForm({ schema, defaultValues });\n\n  // Also persist the in-progress form state within this step\n  const persistence = useFormPersistence({\n    form,\n    storageKey: 'wireguard-wizard-basic-draft',\n  });\n\n  const onSubmit = form.handleSubmit((data) => {\n    persistence.clearPersistence();\n    onComplete(data);\n  });\n}\n"})})]})}function h(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,d.jsx)(s,{...e,children:(0,d.jsx)(o,{...e})}):o(e)}}}]);