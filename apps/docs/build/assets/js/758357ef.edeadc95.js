"use strict";(globalThis.webpackChunk_nas_net_docs=globalThis.webpackChunk_nas_net_docs||[]).push([[72809],{15709:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>u,frontMatter:()=>a,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"service-lifecycle","title":"Service Lifecycle","description":"This document covers the complete lifecycle of a Feature Marketplace service instance \u2014 from discovery and installation through boot, health monitoring, configuration, networking/isolation, dependency management, traffic control, logging, updates, rollback, sharing/templates, device routing, scheduling, and system resource budgeting. All hooks live under libs/api-client/queries/src/services/.","source":"@site/../../libs/api-client/docs/service-lifecycle.md","sourceDirName":".","slug":"/service-lifecycle","permalink":"/docs/api-client/service-lifecycle","draft":false,"unlisted":false,"editUrl":"https://github.com/nasnet-community/nasnet-panel/tree/main/../../libs/api-client/docs/service-lifecycle.md","tags":[],"version":"current","frontMatter":{},"sidebar":"sidebar","previous":{"title":"Domain Query Hooks","permalink":"/docs/api-client/domain-query-hooks"},"next":{"title":"Testing and Code Generation","permalink":"/docs/api-client/testing-and-codegen"}}');var t=s(31085),r=s(71184);const a={},c="Service Lifecycle",l={},d=[{value:"Table of Contents",id:"table-of-contents",level:2},{value:"1. Lifecycle Overview",id:"1-lifecycle-overview",level:2},{value:"2. Stage 1 \u2014 Discovery: Browsing the Catalog",id:"2-stage-1--discovery-browsing-the-catalog",level:2},{value:"useAvailableServices",id:"useavailableservices",level:3},{value:"useServiceInstances / useServiceInstance",id:"useserviceinstances--useserviceinstance",level:3},{value:"3. Stage 2 \u2014 Installation",id:"3-stage-2--installation",level:2},{value:"useInstallService",id:"useinstallservice",level:3},{value:"useInstallProgress (subscription)",id:"useinstallprogress-subscription",level:3},{value:"useInstanceStatusChanged (subscription)",id:"useinstancestatuschanged-subscription",level:3},{value:"useInstanceMonitoring (combined)",id:"useinstancemonitoring-combined",level:3},{value:"useFeatureVerification / useInstanceVerificationStatus",id:"usefeatureverification--useinstanceverificationstatus",level:3},{value:"useReverifyFeature",id:"usereverifyfeature",level:3},{value:"4. Stage 3 \u2014 Boot Sequence",id:"4-stage-3--boot-sequence",level:2},{value:"useBootSequenceProgress (subscription)",id:"usebootsequenceprogress-subscription",level:3},{value:"5. Stage 4 \u2014 Health Monitoring",id:"5-stage-4--health-monitoring",level:2},{value:"useInstanceHealth",id:"useinstancehealth",level:3},{value:"useInstanceHealthSubscription",id:"useinstancehealthsubscription",level:3},{value:"useConfigureHealthCheck",id:"useconfigurehealthcheck",level:3},{value:"6. Stage 5 \u2014 Configuration",id:"6-stage-5--configuration",level:2},{value:"useServiceConfigSchema",id:"useserviceconfigschema",level:3},{value:"useInstanceConfig",id:"useinstanceconfig",level:3},{value:"useValidateServiceConfig",id:"usevalidateserviceconfig",level:3},{value:"useApplyServiceConfig",id:"useapplyserviceconfig",level:3},{value:"useServiceConfigOperations (compound)",id:"useserviceconfigoperations-compound",level:3},{value:"7. Stage 6 \u2014 Networking and Isolation",id:"7-stage-6--networking-and-isolation",level:2},{value:"useVirtualInterfaces / useVirtualInterface",id:"usevirtualinterfaces--usevirtualinterface",level:3},{value:"useBridgeStatus",id:"usebridgestatus",level:3},{value:"useInstanceIsolation",id:"useinstanceisolation",level:3},{value:"useGatewayStatus",id:"usegatewaystatus",level:3},{value:"useKillSwitchStatus / useSetKillSwitch / useKillSwitchSubscription",id:"usekillswitchstatus--usesetkillswitch--usekillswitchsubscription",level:3},{value:"usePortAllocations / useCheckPortAvailability / useOrphanedPorts",id:"useportallocations--usecheckportavailability--useorphanedports",level:3},{value:"VLAN Management",id:"vlan-management",level:3},{value:"8. Stage 7 \u2014 Dependency Management",id:"8-stage-7--dependency-management",level:2},{value:"useDependencies / useDependents / useDependencyGraph",id:"usedependencies--usedependents--usedependencygraph",level:3},{value:"useDependencyMutations",id:"usedependencymutations",level:3},{value:"9. Stage 8 \u2014 Traffic Management",id:"9-stage-8--traffic-management",level:2},{value:"useServiceTrafficStats",id:"useservicetrafficstats",level:3},{value:"useServiceDeviceBreakdown",id:"useservicedevicebreakdown",level:3},{value:"Quota Management",id:"quota-management",level:3},{value:"useServiceTrafficSubscription (real-time)",id:"useservicetrafficsubscription-real-time",level:3},{value:"useTrafficMonitoring (compound)",id:"usetrafficmonitoring-compound",level:3},{value:"10. Stage 9 \u2014 Logs and Diagnostics",id:"10-stage-9--logs-and-diagnostics",level:2},{value:"useServiceLogs (compound)",id:"useservicelogs-compound",level:3},{value:"useServiceLogFile",id:"useservicelogfile",level:3},{value:"useServiceLogsSubscription (streaming)",id:"useservicelogssubscription-streaming",level:3},{value:"Diagnostics",id:"diagnostics",level:3},{value:"11. Stage 10 \u2014 Updates and Rollback",id:"11-stage-10--updates-and-rollback",level:2},{value:"useAvailableUpdates",id:"useavailableupdates",level:3},{value:"useCheckForUpdates",id:"usecheckforupdates",level:3},{value:"useUpdateInstance / useUpdateAllInstances",id:"useupdateinstance--useupdateallinstances",level:3},{value:"useUpdateProgress (subscription)",id:"useupdateprogress-subscription",level:3},{value:"useRollbackInstance",id:"userollbackinstance",level:3},{value:"12. Stage 11 \u2014 Sharing and Templates",id:"12-stage-11--sharing-and-templates",level:2},{value:"Service Sharing",id:"service-sharing",level:3},{value:"Service Templates",id:"service-templates",level:3},{value:"13. Stage 12 \u2014 Device Routing",id:"13-stage-12--device-routing",level:2},{value:"14. Stage 13 \u2014 Scheduling",id:"14-stage-13--scheduling",level:2},{value:"15. Stage 14 \u2014 System Resources",id:"15-stage-14--system-resources",level:2},{value:"16. Stage 15 \u2014 Alerts",id:"16-stage-15--alerts",level:2},{value:"17. Lifecycle Mutations Summary",id:"17-lifecycle-mutations-summary",level:2},{value:"18. queryKeys Reference",id:"18-querykeys-reference",level:2}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"service-lifecycle",children:"Service Lifecycle"})}),"\n",(0,t.jsxs)(n.p,{children:["This document covers the complete lifecycle of a Feature Marketplace service instance \u2014 from discovery and installation through boot, health monitoring, configuration, networking/isolation, dependency management, traffic control, logging, updates, rollback, sharing/templates, device routing, scheduling, and system resource budgeting. All hooks live under ",(0,t.jsx)(n.code,{children:"libs/api-client/queries/src/services/"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["Related docs: ",(0,t.jsx)(n.a,{href:"/docs/api-client/domain-query-hooks",children:"./domain-query-hooks.md"})," (domain inventory), ",(0,t.jsx)(n.a,{href:"/docs/api-client/universal-state-resource-model",children:"./universal-state-resource-model.md"})," (resource layers), ",(0,t.jsx)(n.a,{href:"/docs/api-client/change-set-pattern",children:"./change-set-pattern.md"})," (apply/confirm), ",(0,t.jsx)(n.a,{href:"/docs/api-client/websocket-subscriptions",children:"./websocket-subscriptions.md"})," (subscription transport)."]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"table-of-contents",children:"Table of Contents"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#1-lifecycle-overview",children:"Lifecycle Overview"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#2-stage-1--discovery-browsing-the-catalog",children:"Stage 1 \u2014 Discovery: Browsing the Catalog"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#3-stage-2--installation",children:"Stage 2 \u2014 Installation"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#4-stage-3--boot-sequence",children:"Stage 3 \u2014 Boot Sequence"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#5-stage-4--health-monitoring",children:"Stage 4 \u2014 Health Monitoring"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#6-stage-5--configuration",children:"Stage 5 \u2014 Configuration"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#7-stage-6--networking-and-isolation",children:"Stage 6 \u2014 Networking and Isolation"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#8-stage-7--dependency-management",children:"Stage 7 \u2014 Dependency Management"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#9-stage-8--traffic-management",children:"Stage 8 \u2014 Traffic Management"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#10-stage-9--logs-and-diagnostics",children:"Stage 9 \u2014 Logs and Diagnostics"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#11-stage-10--updates-and-rollback",children:"Stage 10 \u2014 Updates and Rollback"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#12-stage-11--sharing-and-templates",children:"Stage 11 \u2014 Sharing and Templates"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#13-stage-12--device-routing",children:"Stage 12 \u2014 Device Routing"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#14-stage-13--scheduling",children:"Stage 13 \u2014 Scheduling"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#15-stage-14--system-resources",children:"Stage 14 \u2014 System Resources"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#16-stage-15--alerts",children:"Stage 15 \u2014 Alerts"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#17-lifecycle-mutations-summary",children:"Lifecycle Mutations Summary"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#18-querykeys-reference",children:"queryKeys Reference"})}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"1-lifecycle-overview",children:"1. Lifecycle Overview"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Catalog (browse)\n      |\n      v\nInstall \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba useInstallService()\n      |                                               useInstallProgress (subscription)\n      v\nBoot Sequence \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba useBootSequenceProgress (subscription)\n      |\n      v\nHealth \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba useInstanceHealth()\n      |                                               useInstanceHealthSubscription (subscription)\n      v\nConfigure \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba useServiceConfigSchema()\n      |                                               useInstanceConfig()\n      |                                               useValidateServiceConfig()\n      |                                               useApplyServiceConfig()\n      v\nNetwork / Isolation \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba useVirtualInterfaces()\n      |                                               useInstanceIsolation()\n      |                                               useGatewayStatus()\n      |                                               useKillSwitchStatus()\n      v\nDependencies \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba useDependencies()\n      |                                               useDependencyGraph()\n      v\nTraffic \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba useServiceTrafficStats()\n      |                                               useSetTrafficQuota()\n      v\nLogs / Diagnostics \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba useServiceLogs()\n      |                                               useRunDiagnostics()\n      v\nUpdates \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba useAvailableUpdates()\n      |                                               useUpdateInstance()\n      v\nRollback \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba useRollbackInstance()\n      |\n      v\nSharing / Templates \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba useExportService()\n      |                                               useServiceTemplates()\n      v\nDevice Routing \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba useDeviceRoutingMatrix()\n      |                                               useAssignDeviceRouting()\n      v\nSchedules \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba useRoutingSchedules()\n      |                                               useCreateSchedule()\n      v\nSystem Resources \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba useSystemResources()\n                                                      useSetResourceLimits()\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"2-stage-1--discovery-browsing-the-catalog",children:"2. Stage 1 \u2014 Discovery: Browsing the Catalog"}),"\n",(0,t.jsx)(n.h3,{id:"useavailableservices",children:"useAvailableServices"}),"\n",(0,t.jsxs)(n.p,{children:["Source: ",(0,t.jsx)(n.code,{children:"libs/api-client/queries/src/services/useAvailableServices.ts"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const { services, loading, error } = useAvailableServices();\n"})}),"\n",(0,t.jsx)(n.p,{children:"Returns the list of features available in the marketplace. Each entry includes:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"interface AvailableService {\n  featureID: string;    // e.g. 'tor', 'singbox', 'xray', 'mtproxy', 'psiphon', 'adguard'\n  name: string;\n  description: string;\n  version: string;\n  architecture: string[];\n  category: string;\n  size: number;\n  requiresVLAN: boolean;\n  requiresIPBinding: boolean;\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"useserviceinstances--useserviceinstance",children:"useServiceInstances / useServiceInstance"}),"\n",(0,t.jsxs)(n.p,{children:["Source: ",(0,t.jsx)(n.code,{children:"libs/api-client/queries/src/services/useServiceInstances.ts"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// All instances on a router\nconst { data: instances } = useServiceInstances({ routerId });\n\n// One specific instance\nconst { data: instance } = useServiceInstance({ routerId, instanceId });\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"type ServiceStatus =\n  | 'INSTALLING' | 'INSTALLED' | 'RUNNING'\n  | 'STOPPED' | 'FAILED' | 'UPDATING' | 'UNINSTALLING';\n\ninterface ServiceInstance {\n  id: string;\n  featureID: string;\n  instanceName: string;\n  routerID: string;\n  status: ServiceStatus;\n  vlanID: number | null;\n  bindIP: string | null;\n  ports: number[];\n  config: unknown | null;\n  binaryVersion: string | null;\n  binaryChecksum: string | null;\n  createdAt: string;\n  updatedAt: string;\n}\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"3-stage-2--installation",children:"3. Stage 2 \u2014 Installation"}),"\n",(0,t.jsx)(n.h3,{id:"useinstallservice",children:"useInstallService"}),"\n",(0,t.jsxs)(n.p,{children:["Source: ",(0,t.jsx)(n.code,{children:"libs/api-client/queries/src/services/useInstallService.ts:54"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const [installService, { loading, error }] = useInstallService();\n\nawait installService({\n  variables: {\n    input: {\n      routerID: 'router-1',\n      featureID: 'tor',\n      instanceName: 'Tor Exit Node',\n      config: { exitPolicy: 'accept *:80' },\n      vlanID: 100,\n      bindIP: '10.0.0.1',      // optional IP binding for isolation\n    },\n  },\n});\n"})}),"\n",(0,t.jsxs)(n.p,{children:["The mutation provides an ",(0,t.jsx)(n.strong,{children:"optimistic response"})," that immediately adds a ",(0,t.jsx)(n.code,{children:"INSTALLING"})," instance to the cache (",(0,t.jsx)(n.code,{children:"status: 'INSTALLING'"}),", temporary ",(0,t.jsx)(n.code,{children:"id: 'temp-${Date.now()}'"}),"). On success, the cache is updated with the real instance and ",(0,t.jsx)(n.code,{children:"GET_SERVICE_INSTANCES"})," is refetched."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"export interface InstallServiceInput {\n  routerID: string;\n  featureID: string;\n  instanceName: string;\n  config?: unknown;\n  vlanID?: number;\n  bindIP?: string;\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"useinstallprogress-subscription",children:"useInstallProgress (subscription)"}),"\n",(0,t.jsxs)(n.p,{children:["Source: ",(0,t.jsx)(n.code,{children:"libs/api-client/queries/src/services/useInstanceSubscriptions.ts:55"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const { progress, loading, error } = useInstallProgress('router-1');\n\n// progress: InstallProgress | undefined\ninterface InstallProgress {\n  routerID: string;\n  featureID: string;\n  instanceID: string;\n  status: string;        // 'downloading' | 'verifying' | 'installing' | 'completed' | 'failed'\n  percent: number;\n  bytesDownloaded: number;\n  totalBytes: number;\n  errorMessage?: string | null;\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:["The subscription fires events for each phase: download progress, GPG verification, binary extraction, and container setup. When ",(0,t.jsx)(n.code,{children:"status === 'completed'"}),", a log entry is emitted. When ",(0,t.jsx)(n.code,{children:"status === 'failed'"}),", ",(0,t.jsx)(n.code,{children:"errorMessage"})," contains the reason."]}),"\n",(0,t.jsx)(n.h3,{id:"useinstancestatuschanged-subscription",children:"useInstanceStatusChanged (subscription)"}),"\n",(0,t.jsxs)(n.p,{children:["Source: ",(0,t.jsx)(n.code,{children:"libs/api-client/queries/src/services/useInstanceSubscriptions.ts:103"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const { statusChange } = useInstanceStatusChanged('router-1');\n\nuseEffect(() => {\n  if (statusChange) {\n    toast.info(`${statusChange.instanceID}: ${statusChange.oldStatus} \u2192 ${statusChange.newStatus}`);\n  }\n}, [statusChange]);\n"})}),"\n",(0,t.jsx)(n.h3,{id:"useinstancemonitoring-combined",children:"useInstanceMonitoring (combined)"}),"\n",(0,t.jsxs)(n.p,{children:["Source: ",(0,t.jsx)(n.code,{children:"libs/api-client/queries/src/services/useInstanceSubscriptions.ts:163"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const { installProgress, statusChange, loading, error } = useInstanceMonitoring('router-1');\n"})}),"\n",(0,t.jsx)(n.p,{children:"Combines both subscriptions into a single hook for dashboard-style monitoring panels."}),"\n",(0,t.jsx)(n.h3,{id:"usefeatureverification--useinstanceverificationstatus",children:"useFeatureVerification / useInstanceVerificationStatus"}),"\n",(0,t.jsxs)(n.p,{children:["Source: ",(0,t.jsx)(n.code,{children:"libs/api-client/queries/src/services/useFeatureVerification.ts"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// Check if a feature binary passes GPG verification\nconst { data } = useFeatureVerification({ featureID: 'tor', version: '0.4.8' });\n\n// Check verification status of an existing instance\nconst { data } = useInstanceVerificationStatus({ routerId, instanceId });\n"})}),"\n",(0,t.jsx)(n.h3,{id:"usereverifyfeature",children:"useReverifyFeature"}),"\n",(0,t.jsxs)(n.p,{children:["Source: ",(0,t.jsx)(n.code,{children:"libs/api-client/queries/src/services/useReverifyFeature.ts"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const [reverify] = useReverifyFeature();\n\nawait reverify({ variables: { instanceID: 'instance-123' } });\n"})}),"\n",(0,t.jsx)(n.p,{children:"Triggers a re-verification of the installed binary against the stored checksum and GPG signature."}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"4-stage-3--boot-sequence",children:"4. Stage 3 \u2014 Boot Sequence"}),"\n",(0,t.jsx)(n.h3,{id:"usebootsequenceprogress-subscription",children:"useBootSequenceProgress (subscription)"}),"\n",(0,t.jsxs)(n.p,{children:["Source: ",(0,t.jsx)(n.code,{children:"libs/api-client/queries/src/services/useBootSequenceProgress.ts"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const { data, loading } = useBootSequenceProgress({ routerId });\n\n// data: BootSequenceProgress\ninterface BootSequenceProgress {\n  routerId: string;\n  phase: string;\n  events: BootSequenceEvent[];\n  isComplete: boolean;\n  hasErrors: boolean;\n}\n\ninterface BootSequenceEvent {\n  type: BootSequenceEventType;\n  instanceId: string;\n  instanceName: string;\n  message: string;\n  timestamp: string;\n  isSuccess: boolean;\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:["The boot sequence is the ordered startup of all service instances honoring dependency chains (see Stage 7). ",(0,t.jsx)(n.code,{children:"SUBSCRIBE_BOOT_SEQUENCE_EVENTS"})," carries each step's result in real time."]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"5-stage-4--health-monitoring",children:"5. Stage 4 \u2014 Health Monitoring"}),"\n",(0,t.jsx)(n.h3,{id:"useinstancehealth",children:"useInstanceHealth"}),"\n",(0,t.jsxs)(n.p,{children:["Source: ",(0,t.jsx)(n.code,{children:"libs/api-client/queries/src/services/useInstanceHealth.ts"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const { data } = useInstanceHealth({ routerId, instanceId });\n"})}),"\n",(0,t.jsx)(n.p,{children:"Queries the current health state (healthy / degraded / critical / unknown)."}),"\n",(0,t.jsx)(n.h3,{id:"useinstancehealthsubscription",children:"useInstanceHealthSubscription"}),"\n",(0,t.jsxs)(n.p,{children:["Source: ",(0,t.jsx)(n.code,{children:"libs/api-client/queries/src/services/useInstanceHealthSubscription.ts"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const { data } = useInstanceHealthSubscription({ routerId, instanceId });\n"})}),"\n",(0,t.jsx)(n.p,{children:"Real-time health updates pushed via WebSocket as the process monitor detects state changes."}),"\n",(0,t.jsx)(n.h3,{id:"useconfigurehealthcheck",children:"useConfigureHealthCheck"}),"\n",(0,t.jsxs)(n.p,{children:["Source: ",(0,t.jsx)(n.code,{children:"libs/api-client/queries/src/services/useConfigureHealthCheck.ts"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const [configure] = useConfigureHealthCheck();\n\nawait configure({\n  variables: {\n    instanceID: 'instance-123',\n    config: {\n      httpEndpoint: 'http://127.0.0.1:8388/health',\n      interval: '30s',\n      timeout: '5s',\n      unhealthyThreshold: 3,\n    },\n  },\n});\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Also exports ",(0,t.jsx)(n.code,{children:"validateHealthCheckConfig(config)"})," \u2014 a pure function that validates the config before sending."]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"6-stage-5--configuration",children:"6. Stage 5 \u2014 Configuration"}),"\n",(0,t.jsx)(n.h3,{id:"useserviceconfigschema",children:"useServiceConfigSchema"}),"\n",(0,t.jsxs)(n.p,{children:["Source: ",(0,t.jsx)(n.code,{children:"libs/api-client/queries/src/services/useServiceConfig.ts"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const { data: schema } = useServiceConfigSchema({ featureID: 'singbox' });\n// schema: JSON Schema object describing the configuration for this feature type\n"})}),"\n",(0,t.jsx)(n.h3,{id:"useinstanceconfig",children:"useInstanceConfig"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const { data: config } = useInstanceConfig({ routerId, instanceId });\n// config: current running configuration\n"})}),"\n",(0,t.jsx)(n.h3,{id:"usevalidateserviceconfig",children:"useValidateServiceConfig"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const [validate, { data: result }] = useValidateServiceConfig();\n\nawait validate({ variables: { instanceID, config: draftConfig } });\n// result.isValid, result.errors, result.warnings\n"})}),"\n",(0,t.jsx)(n.h3,{id:"useapplyserviceconfig",children:"useApplyServiceConfig"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const [apply] = useApplyServiceConfig();\n\nawait apply({ variables: { instanceID, config: validatedConfig } });\n// Triggers Apply-Confirm-Merge flow (restarts instance if needed)\n"})}),"\n",(0,t.jsx)(n.h3,{id:"useserviceconfigoperations-compound",children:"useServiceConfigOperations (compound)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const {\n  schema,\n  config,\n  validate,\n  apply,\n  isValidating,\n  isApplying,\n} = useServiceConfigOperations({ routerId, instanceId, featureID });\n"})}),"\n",(0,t.jsx)(n.p,{children:"Bundles all four operations with shared loading state for use in configuration forms."}),"\n",(0,t.jsxs)(n.p,{children:["GraphQL documents: ",(0,t.jsx)(n.code,{children:"service-config.graphql.ts"})," exports ",(0,t.jsx)(n.code,{children:"GET_SERVICE_CONFIG_SCHEMA"}),", ",(0,t.jsx)(n.code,{children:"GET_INSTANCE_CONFIG"}),", ",(0,t.jsx)(n.code,{children:"VALIDATE_SERVICE_CONFIG"}),", ",(0,t.jsx)(n.code,{children:"APPLY_SERVICE_CONFIG"}),"."]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"7-stage-6--networking-and-isolation",children:"7. Stage 6 \u2014 Networking and Isolation"}),"\n",(0,t.jsx)(n.h3,{id:"usevirtualinterfaces--usevirtualinterface",children:"useVirtualInterfaces / useVirtualInterface"}),"\n",(0,t.jsxs)(n.p,{children:["Source: ",(0,t.jsx)(n.code,{children:"libs/api-client/queries/src/services/useVirtualInterfaces.ts"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const { data: vifs } = useVirtualInterfaces({ routerId });\nconst { data: vif } = useVirtualInterface({ routerId, vifId });\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"interface VirtualInterface {\n  id: string;\n  instanceId: string;\n  name: string;\n  type: GatewayType;\n  status: VirtualInterfaceStatus;\n  gatewayStatus: GatewayStatus;\n  ipAddress: string | null;\n  vlanId: number | null;\n}\n\ntype GatewayType = 'BRIDGE' | 'VLAN' | 'TAP' | 'TUN' | 'VETH';\ntype GatewayStatus = 'UP' | 'DOWN' | 'UNKNOWN';\ntype VirtualInterfaceStatus = 'ACTIVE' | 'INACTIVE' | 'ERROR';\n"})}),"\n",(0,t.jsx)(n.h3,{id:"usebridgestatus",children:"useBridgeStatus"}),"\n",(0,t.jsxs)(n.p,{children:["Source: ",(0,t.jsx)(n.code,{children:"libs/api-client/queries/src/services/useBridgeStatus.ts"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const { data: bridge } = useBridgeStatus({ routerId, instanceId });\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"interface BridgeStatus {\n  bridgeName: string;\n  state: 'FORWARDING' | 'LEARNING' | 'BLOCKING' | 'DISABLED';\n  stpEnabled: boolean;\n  ports: string[];\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"useinstanceisolation",children:"useInstanceIsolation"}),"\n",(0,t.jsxs)(n.p,{children:["Source: ",(0,t.jsx)(n.code,{children:"libs/api-client/queries/src/services/useInstanceIsolation.ts"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const { data: isolation } = useInstanceIsolation({ routerId, instanceId });\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Returns the IP-binding isolation state for the instance (ADR-007). See ",(0,t.jsx)(n.code,{children:"Docs/architecture/adrs/007-ip-binding-isolation.md"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"interface GetInstanceIsolationResult {\n  instance: {\n    id: string;\n    isolationMode: 'STRICT' | 'PERMISSIVE' | 'DISABLED';\n    boundIP: string | null;\n    allowedEgressIPs: string[];\n  };\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"usegatewaystatus",children:"useGatewayStatus"}),"\n",(0,t.jsxs)(n.p,{children:["Source: ",(0,t.jsx)(n.code,{children:"libs/api-client/queries/src/services/useGatewayStatus.ts"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'const { gateway, isHealthy, latency } = useGatewayStatus({ routerId, instanceId });\n\n// Utility: format uptime for display\nformatUptime(seconds: number): string  // e.g. "2d 4h 30m"\n'})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const GatewayState = {\n  UP:         'UP',\n  DOWN:       'DOWN',\n  DEGRADED:   'DEGRADED',\n  UNKNOWN:    'UNKNOWN',\n} as const;\n"})}),"\n",(0,t.jsx)(n.h3,{id:"usekillswitchstatus--usesetkillswitch--usekillswitchsubscription",children:"useKillSwitchStatus / useSetKillSwitch / useKillSwitchSubscription"}),"\n",(0,t.jsxs)(n.p,{children:["Source: ",(0,t.jsx)(n.code,{children:"libs/api-client/queries/src/services/useKillSwitch.ts"}),"\nGraphQL: ",(0,t.jsx)(n.code,{children:"kill-switch.graphql.ts"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// Query current kill-switch state\nconst { data: ks } = useKillSwitchStatus({ routerId, instanceId });\n\n// Toggle kill switch\nconst [setKillSwitch] = useSetKillSwitch();\nawait setKillSwitch({ variables: { input: { instanceId, enabled: true } } });\n\n// Real-time kill-switch state changes\nconst { data: ksEvent } = useKillSwitchSubscription({ routerId, instanceId });\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"interface KillSwitchStatus {\n  instanceId: string;\n  enabled: boolean;\n  activatedAt: string | null;\n  reason: string | null;\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"useportallocations--usecheckportavailability--useorphanedports",children:"usePortAllocations / useCheckPortAvailability / useOrphanedPorts"}),"\n",(0,t.jsxs)(n.p,{children:["Source: ",(0,t.jsx)(n.code,{children:"libs/api-client/queries/src/services/usePortRegistry.ts"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const { data } = usePortAllocations(filters?: PortAllocationFilters, sort?: PortAllocationSort);\nconst { data: available } = useCheckPortAvailability({ port: 8388, protocol: 'TCP' });\nconst { data: orphaned } = useOrphanedPorts({ routerId });\n"})}),"\n",(0,t.jsxs)(n.p,{children:["GraphQL: ",(0,t.jsx)(n.code,{children:"GET_PORT_ALLOCATIONS"}),", ",(0,t.jsx)(n.code,{children:"CHECK_PORT_AVAILABILITY"}),", ",(0,t.jsx)(n.code,{children:"DETECT_ORPHANED_PORTS"}),", ",(0,t.jsx)(n.code,{children:"CLEANUP_ORPHANED_PORTS"}),"."]}),"\n",(0,t.jsx)(n.h3,{id:"vlan-management",children:"VLAN Management"}),"\n",(0,t.jsxs)(n.p,{children:["Source: ",(0,t.jsx)(n.code,{children:"libs/api-client/queries/src/services/useVLANAllocations.ts"})," et al."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const { data: allocs } = useVLANAllocations({ routerId });\nconst { data: pool } = useVLANPoolStatus({ routerId });\nconst [cleanup] = useCleanupOrphanedVLANs();\nconst [updatePool] = useUpdateVLANPoolConfig();\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"type VLANAllocationStatus = 'ACTIVE' | 'RESERVED' | 'ORPHANED';\n\ninterface VLANAllocation {\n  id: string;\n  vlanId: number;\n  status: VLANAllocationStatus;\n  instance: VLANServiceInstanceRef | null;\n  router: VLANRouterRef;\n  allocatedAt: string;\n}\n\ninterface VLANPoolStatus {\n  totalVLANs: number;\n  usedVLANs: number;\n  availableVLANs: number;\n  reservedVLANs: number;\n  orphanedVLANs: number;\n  rangeStart: number;\n  rangeEnd: number;\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:["GraphQL: ",(0,t.jsx)(n.code,{children:"vlan.graphql.ts"})," \u2014 ",(0,t.jsx)(n.code,{children:"GET_VLAN_ALLOCATIONS"}),", ",(0,t.jsx)(n.code,{children:"GET_VLAN_POOL_STATUS"}),", ",(0,t.jsx)(n.code,{children:"DETECT_ORPHANED_VLANS"}),", ",(0,t.jsx)(n.code,{children:"CLEANUP_ORPHANED_VLANS"}),", ",(0,t.jsx)(n.code,{children:"UPDATE_VLAN_POOL_CONFIG"}),"."]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"8-stage-7--dependency-management",children:"8. Stage 7 \u2014 Dependency Management"}),"\n",(0,t.jsx)(n.h3,{id:"usedependencies--usedependents--usedependencygraph",children:"useDependencies / useDependents / useDependencyGraph"}),"\n",(0,t.jsxs)(n.p,{children:["Source: ",(0,t.jsx)(n.code,{children:"libs/api-client/queries/src/services/useDependencies.ts"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// What does this instance depend on?\nconst { data: deps } = useDependencies({ routerId, instanceId });\n\n// What depends on this instance?\nconst { data: dependents } = useDependents({ routerId, instanceId });\n\n// Full dependency graph for visualization\nconst { data: graph } = useDependencyGraph({ routerId });\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"type DependencyType = 'REQUIRES' | 'OPTIONAL' | 'CONFLICTS';\n\ninterface ServiceDependency {\n  instanceId: string;\n  dependsOnInstanceId: string;\n  type: DependencyType;\n  status: 'SATISFIED' | 'UNSATISFIED' | 'CONFLICT';\n}\n\ninterface DependencyGraph {\n  nodes: DependencyGraphNode[];\n  edges: DependencyGraphEdge[];\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"usedependencymutations",children:"useDependencyMutations"}),"\n",(0,t.jsxs)(n.p,{children:["Source: ",(0,t.jsx)(n.code,{children:"libs/api-client/queries/src/services/useDependencyMutations.ts"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const { addDependency, removeDependency, loading, error } = useDependencyMutations();\n\nawait addDependency({ instanceId, dependsOnInstanceId, type: 'REQUIRES' });\nawait removeDependency({ instanceId, dependsOnInstanceId });\n"})}),"\n",(0,t.jsxs)(n.p,{children:["GraphQL: ",(0,t.jsx)(n.code,{children:"ADD_DEPENDENCY"}),", ",(0,t.jsx)(n.code,{children:"REMOVE_DEPENDENCY"})," from ",(0,t.jsx)(n.code,{children:"services.graphql.ts"}),"."]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"9-stage-8--traffic-management",children:"9. Stage 8 \u2014 Traffic Management"}),"\n",(0,t.jsx)(n.h3,{id:"useservicetrafficstats",children:"useServiceTrafficStats"}),"\n",(0,t.jsxs)(n.p,{children:["Source: ",(0,t.jsx)(n.code,{children:"libs/api-client/queries/src/services/useServiceTrafficStats.ts"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const { data: stats } = useServiceTrafficStats({ routerId, instanceId });\n"})}),"\n",(0,t.jsx)(n.p,{children:"Returns current session bandwidth, total bytes transferred, per-device breakdown, and quota usage."}),"\n",(0,t.jsx)(n.h3,{id:"useservicedevicebreakdown",children:"useServiceDeviceBreakdown"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const { data: breakdown } = useServiceDeviceBreakdown({ routerId, instanceId });\n// Returns per-IP traffic breakdown for all devices routing through this service\n"})}),"\n",(0,t.jsx)(n.h3,{id:"quota-management",children:"Quota Management"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const [setQuota] = useSetTrafficQuota();\nawait setQuota({ variables: { instanceId, limitBytes: 10_000_000_000 } }); // 10 GB\n\nconst [resetQuota] = useResetTrafficQuota();\nawait resetQuota({ variables: { instanceId } });\n"})}),"\n",(0,t.jsx)(n.h3,{id:"useservicetrafficsubscription-real-time",children:"useServiceTrafficSubscription (real-time)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const { data: trafficEvent } = useServiceTrafficSubscription({ routerId, instanceId });\n"})}),"\n",(0,t.jsx)(n.h3,{id:"usetrafficmonitoring-compound",children:"useTrafficMonitoring (compound)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const { stats, deviceBreakdown, trafficEvent, loading } = useTrafficMonitoring({\n  routerId,\n  instanceId,\n  enableSubscription: true,\n});\n"})}),"\n",(0,t.jsxs)(n.p,{children:["GraphQL: ",(0,t.jsx)(n.code,{children:"traffic-stats.graphql.ts"})," \u2014 ",(0,t.jsx)(n.code,{children:"GET_SERVICE_TRAFFIC_STATS"}),", ",(0,t.jsx)(n.code,{children:"GET_SERVICE_DEVICE_BREAKDOWN"}),", ",(0,t.jsx)(n.code,{children:"SET_TRAFFIC_QUOTA"}),", ",(0,t.jsx)(n.code,{children:"RESET_TRAFFIC_QUOTA"}),", ",(0,t.jsx)(n.code,{children:"SUBSCRIBE_SERVICE_TRAFFIC_UPDATED"}),"."]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"10-stage-9--logs-and-diagnostics",children:"10. Stage 9 \u2014 Logs and Diagnostics"}),"\n",(0,t.jsx)(n.h3,{id:"useservicelogs-compound",children:"useServiceLogs (compound)"}),"\n",(0,t.jsxs)(n.p,{children:["Source: ",(0,t.jsx)(n.code,{children:"libs/api-client/queries/src/services/useServiceLogs.ts"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const { logs, isStreaming, loadMore } = useServiceLogs({\n  routerId,\n  instanceId,\n  tail: 100,\n  level: 'INFO',\n  enableStreaming: true,\n});\n"})}),"\n",(0,t.jsx)(n.h3,{id:"useservicelogfile",children:"useServiceLogFile"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const { data: file } = useServiceLogFile({ routerId, instanceId, filename: 'service.log' });\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"interface ServiceLogFile {\n  filename: string;\n  sizeBytes: number;\n  modifiedAt: string;\n  entries: LogEntry[];\n}\n\ntype LogLevel = 'TRACE' | 'DEBUG' | 'INFO' | 'WARN' | 'ERROR' | 'FATAL';\n\ninterface LogEntry {\n  timestamp: string;\n  level: LogLevel;\n  message: string;\n  fields: Record<string, unknown>;\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"useservicelogssubscription-streaming",children:"useServiceLogsSubscription (streaming)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const { data: logEntry } = useServiceLogsSubscription({ routerId, instanceId });\n"})}),"\n",(0,t.jsx)(n.h3,{id:"diagnostics",children:"Diagnostics"}),"\n",(0,t.jsxs)(n.p,{children:["Source: ",(0,t.jsx)(n.code,{children:"libs/api-client/queries/src/services/useDiagnostics.ts"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// Query available diagnostic tests for this feature\nconst { data: available } = useAvailableDiagnostics({ featureID: 'tor' });\n\n// Run diagnostics\nconst [runDiagnostics] = useRunDiagnostics();\nawait runDiagnostics({ variables: { input: { instanceId, suites: ['network', 'config'] } } });\n\n// Historical results\nconst { data: history } = useDiagnosticHistory({ routerId, instanceId });\n\n// Live progress subscription\nconst { data: progress } = useDiagnosticsProgressSubscription({ routerId, instanceId });\n\n// Utility functions\nconst startup = getStartupDiagnostics(history);   // filter for boot-time results\nconst failed = hasFailures(history);              // boolean check\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"type DiagnosticStatus = 'PENDING' | 'RUNNING' | 'PASSED' | 'FAILED' | 'SKIPPED';\n\ninterface DiagnosticResult {\n  id: string;\n  testId: string;\n  status: DiagnosticStatus;\n  message: string | null;\n  duration: number;\n  timestamp: string;\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:["GraphQL: ",(0,t.jsx)(n.code,{children:"logs-diagnostics.graphql.ts"})," \u2014 ",(0,t.jsx)(n.code,{children:"GET_SERVICE_LOG_FILE"}),", ",(0,t.jsx)(n.code,{children:"GET_DIAGNOSTIC_HISTORY"}),", ",(0,t.jsx)(n.code,{children:"GET_AVAILABLE_DIAGNOSTICS"}),", ",(0,t.jsx)(n.code,{children:"RUN_SERVICE_DIAGNOSTICS"}),", ",(0,t.jsx)(n.code,{children:"SUBSCRIBE_SERVICE_LOGS"}),", ",(0,t.jsx)(n.code,{children:"SUBSCRIBE_DIAGNOSTICS_PROGRESS"}),"."]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"11-stage-10--updates-and-rollback",children:"11. Stage 10 \u2014 Updates and Rollback"}),"\n",(0,t.jsx)(n.h3,{id:"useavailableupdates",children:"useAvailableUpdates"}),"\n",(0,t.jsxs)(n.p,{children:["Source: ",(0,t.jsx)(n.code,{children:"libs/api-client/queries/src/services/useUpdates.ts"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const { data: updates } = useAvailableUpdates({ routerId });\n\ninterface AvailableUpdate {\n  instanceId: string;\n  featureID: string;\n  currentVersion: string;\n  newVersion: string;\n  severity: UpdateSeverity;        // 'SECURITY' | 'BUGFIX' | 'FEATURE' | 'MAJOR'\n  changelog: string;\n  releaseDate: string;\n  isCompatible: boolean;\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"usecheckforupdates",children:"useCheckForUpdates"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const [check, { data }] = useCheckForUpdates();\nawait check({ variables: { routerId } });\n// Triggers a fresh registry check, returns UpdateCheckResult\n"})}),"\n",(0,t.jsx)(n.h3,{id:"useupdateinstance--useupdateallinstances",children:"useUpdateInstance / useUpdateAllInstances"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const [update] = useUpdateInstance();\nawait update({ variables: { instanceId, targetVersion: '0.4.9' } });\n\nconst [updateAll] = useUpdateAllInstances();\nawait updateAll({ variables: { routerId, severity: 'SECURITY' } });\n"})}),"\n",(0,t.jsx)(n.h3,{id:"useupdateprogress-subscription",children:"useUpdateProgress (subscription)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const { data: event } = useUpdateProgress({ routerId, instanceId });\n\ninterface UpdateProgressEvent {\n  instanceId: string;\n  stage: UpdateStage;     // 'DOWNLOADING' | 'VERIFYING' | 'BACKING_UP' | 'APPLYING' | 'STARTING' | 'DONE'\n  percent: number;\n  message: string;\n  isComplete: boolean;\n  hasError: boolean;\n  errorMessage: string | null;\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"userollbackinstance",children:"useRollbackInstance"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const [rollback] = useRollbackInstance();\nawait rollback({ variables: { instanceId, targetVersion: '0.4.8' } });\n// Restores the backed-up binary and configuration snapshot\n"})}),"\n",(0,t.jsxs)(n.p,{children:["GraphQL: ",(0,t.jsx)(n.code,{children:"updates.graphql.ts"})," \u2014 ",(0,t.jsx)(n.code,{children:"GET_AVAILABLE_UPDATES"}),", ",(0,t.jsx)(n.code,{children:"CHECK_FOR_UPDATES"}),", ",(0,t.jsx)(n.code,{children:"UPDATE_INSTANCE"}),", ",(0,t.jsx)(n.code,{children:"UPDATE_ALL_INSTANCES"}),", ",(0,t.jsx)(n.code,{children:"ROLLBACK_INSTANCE"}),", ",(0,t.jsx)(n.code,{children:"UPDATE_PROGRESS"}),"."]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"12-stage-11--sharing-and-templates",children:"12. Stage 11 \u2014 Sharing and Templates"}),"\n",(0,t.jsx)(n.h3,{id:"service-sharing",children:"Service Sharing"}),"\n",(0,t.jsxs)(n.p,{children:["Source: ",(0,t.jsx)(n.code,{children:"libs/api-client/queries/src/services/useServiceSharing.ts"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// Export configuration as a shareable bundle\nconst [exportService, { data: exportResult }] = useExportService();\nawait exportService({ variables: { instanceId, includeSecrets: false } });\n\n// Generate a QR code of the configuration\nconst [generateQR, { data: qrResult }] = useGenerateConfigQR();\nawait generateQR({ variables: { instanceId } });\n\n// Import from a bundle URL or raw config\nconst [importService] = useImportService();\nawait importService({ variables: { routerId, configUrl: 'https://share.example/abc' } });\n\n// Compound hook\nconst { exportService, generateQR, importService, loading } = useServiceSharing();\n"})}),"\n",(0,t.jsxs)(n.p,{children:["GraphQL: ",(0,t.jsx)(n.code,{children:"service-sharing.graphql.ts"})," \u2014 ",(0,t.jsx)(n.code,{children:"EXPORT_SERVICE_CONFIG"}),", ",(0,t.jsx)(n.code,{children:"GENERATE_CONFIG_QR"}),", ",(0,t.jsx)(n.code,{children:"IMPORT_SERVICE_CONFIG"}),"."]}),"\n",(0,t.jsx)(n.h3,{id:"service-templates",children:"Service Templates"}),"\n",(0,t.jsxs)(n.p,{children:["Source: ",(0,t.jsx)(n.code,{children:"libs/api-client/queries/src/services/useServiceTemplates.ts"})," et al."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// Browse saved templates\nconst { data: templates } = useServiceTemplates({ featureID: 'singbox' });\n\n// Install a template as a new instance\nconst [installTemplate] = useInstallTemplate();\nawait installTemplate({ variables: { routerId, templateId: 'tmpl-123' } });\n\n// Save current instance as template\nconst [exportAsTemplate] = useExportAsTemplate();\nawait exportAsTemplate({ variables: { instanceId, name: 'My Singbox Config', description: '...' } });\n\n// Import a template from file/URL\nconst [importTemplate] = useImportTemplate();\nawait importTemplate({ variables: { routerId, source: templateJson } });\n\n// Delete a template\nconst [deleteTemplate] = useDeleteTemplate();\nawait deleteTemplate({ variables: { templateId: 'tmpl-123' } });\n\n// Template install progress (subscription)\nconst { data: progress } = useTemplateInstallProgress({ routerId });\n"})}),"\n",(0,t.jsxs)(n.p,{children:["GraphQL: ",(0,t.jsx)(n.code,{children:"templates.graphql.ts"})," \u2014 ",(0,t.jsx)(n.code,{children:"GET_SERVICE_TEMPLATES"}),", ",(0,t.jsx)(n.code,{children:"GET_SERVICE_TEMPLATE"}),", ",(0,t.jsx)(n.code,{children:"INSTALL_SERVICE_TEMPLATE"}),", ",(0,t.jsx)(n.code,{children:"EXPORT_AS_TEMPLATE"}),", ",(0,t.jsx)(n.code,{children:"IMPORT_SERVICE_TEMPLATE"}),", ",(0,t.jsx)(n.code,{children:"DELETE_SERVICE_TEMPLATE"}),", ",(0,t.jsx)(n.code,{children:"TEMPLATE_INSTALL_PROGRESS"}),"."]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"13-stage-12--device-routing",children:"13. Stage 12 \u2014 Device Routing"}),"\n",(0,t.jsxs)(n.p,{children:["Source: ",(0,t.jsx)(n.code,{children:"libs/api-client/queries/src/services/useDeviceRouting.ts"}),"\nGraphQL: ",(0,t.jsx)(n.code,{children:"device-routing.graphql.ts"})]}),"\n",(0,t.jsx)(n.p,{children:"Device routing controls which network devices (by IP) are routed through which service instance (ADR-007)."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// Full routing matrix (router-wide view)\nconst { data: matrix } = useDeviceRoutingMatrix({ routerId });\n\n// All routing assignments\nconst { data: routings } = useDeviceRoutings({ routerId, filters: { instanceId } });\n\n// Single routing assignment\nconst { data: routing } = useDeviceRouting({ routerId, deviceIp: '192.168.1.42' });\n\n// Assign a device to a service\nconst [assign] = useAssignDeviceRouting();\nawait assign({\n  variables: {\n    input: {\n      routerId,\n      deviceIp: '192.168.1.42',\n      instanceId: 'instance-123',\n      mode: 'FORCED',    // 'FORCED' | 'CONDITIONAL' | 'DEFAULT'\n    },\n  },\n});\n\n// Remove assignment (back to default)\nconst [remove] = useRemoveDeviceRouting();\nawait remove({ variables: { routerId, deviceIp: '192.168.1.42' } });\n\n// Assign multiple devices at once\nconst [bulkAssign] = useBulkAssignRouting();\nawait bulkAssign({ variables: { input: { routerId, assignments: [...] } } });\n\n// Real-time routing changes\nconst { data: event } = useDeviceRoutingSubscription({ routerId });\n"})}),"\n",(0,t.jsx)(n.p,{children:"Key types:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"type RoutingMode = 'FORCED' | 'CONDITIONAL' | 'DEFAULT';\n\ninterface DeviceRoutingMatrix {\n  routerId: string;\n  assignments: DeviceRouting[];\n  totalDevices: number;\n  assignedDevices: number;\n}\n\ninterface DeviceRoutingEvent {\n  routerId: string;\n  deviceIp: string;\n  instanceId: string | null;\n  changeType: 'ASSIGNED' | 'REMOVED' | 'CHANGED';\n  timestamp: string;\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:["GraphQL: ",(0,t.jsx)(n.code,{children:"GET_DEVICE_ROUTING_MATRIX"}),", ",(0,t.jsx)(n.code,{children:"GET_DEVICE_ROUTINGS"}),", ",(0,t.jsx)(n.code,{children:"GET_DEVICE_ROUTING"}),", ",(0,t.jsx)(n.code,{children:"ASSIGN_DEVICE_ROUTING"}),", ",(0,t.jsx)(n.code,{children:"REMOVE_DEVICE_ROUTING"}),", ",(0,t.jsx)(n.code,{children:"BULK_ASSIGN_ROUTING"}),", ",(0,t.jsx)(n.code,{children:"SUBSCRIBE_DEVICE_ROUTING_CHANGES"}),"."]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"14-stage-13--scheduling",children:"14. Stage 13 \u2014 Scheduling"}),"\n",(0,t.jsxs)(n.p,{children:["Source: ",(0,t.jsx)(n.code,{children:"libs/api-client/queries/src/services/useSchedules.ts"})]}),"\n",(0,t.jsx)(n.p,{children:"Time-based service scheduling allows service instances to be automatically started/stopped on a recurring schedule."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// List schedules for a router\nconst { data: schedules } = useRoutingSchedules({ routerId });\n\n// Single schedule\nconst { data: schedule } = useRoutingSchedule({ routerId, scheduleId: 'sched-123' });\n\n// Create a schedule\nconst [create] = useCreateSchedule();\nawait create({\n  variables: {\n    routerId,\n    instanceId: 'instance-123',\n    cronExpression: '0 22 * * *',    // Stop at 10pm\n    action: 'STOP',\n    timezone: 'America/New_York',\n  },\n});\n\n// Update an existing schedule\nconst [update] = useUpdateSchedule();\nawait update({ variables: { scheduleId: 'sched-123', cronExpression: '0 23 * * *' } });\n\n// Delete a schedule\nconst [deleteSchedule] = useDeleteSchedule();\nawait deleteSchedule({ variables: { scheduleId: 'sched-123' } });\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"15-stage-14--system-resources",children:"15. Stage 14 \u2014 System Resources"}),"\n",(0,t.jsxs)(n.p,{children:["Source: ",(0,t.jsx)(n.code,{children:"libs/api-client/queries/src/services/useSystemResources.ts"}),"\nGraphQL: ",(0,t.jsx)(n.code,{children:"GET_SYSTEM_RESOURCES"}),", ",(0,t.jsx)(n.code,{children:"SET_RESOURCE_LIMITS"}),", ",(0,t.jsx)(n.code,{children:"SUBSCRIBE_RESOURCE_USAGE"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// Current resource budget\nconst { data: resources } = useSystemResources({ routerId });\n\ninterface SystemResources {\n  routerId: string;\n  totalCPUPercent: number;\n  availableCPUPercent: number;\n  totalMemoryMB: number;\n  availableMemoryMB: number;\n  instances: InstanceResourceUsage[];\n}\n\ninterface InstanceResourceUsage {\n  instanceId: string;\n  cpuPercent: number;\n  memoryMB: number;\n  limits: ResourceLimits;\n  requirements: ResourceRequirements;\n  status: ResourceStatus;    // 'OK' | 'WARNING' | 'CRITICAL' | 'EXCEEDED'\n}\n\ninterface ResourceLimits {\n  maxCPUPercent: number | null;\n  maxMemoryMB: number | null;\n  maxDiskMB: number | null;\n}\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// Set resource limits (cgroups)\nconst [setLimits] = useSetResourceLimits();\nawait setLimits({\n  variables: {\n    input: {\n      instanceId: 'instance-123',\n      maxCPUPercent: 25,\n      maxMemoryMB: 64,\n    },\n  },\n});\n\n// Real-time resource usage subscription\nconst { data: usage } = useResourceUsageSubscription({ routerId });\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"16-stage-15--alerts",children:"16. Stage 15 \u2014 Alerts"}),"\n",(0,t.jsxs)(n.p,{children:["Source: ",(0,t.jsx)(n.code,{children:"libs/api-client/queries/src/services/useServiceAlerts.ts"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// Query alerts for a service instance\nconst { data } = useServiceAlerts({\n  routerId,\n  instanceId,\n  severity: 'CRITICAL',\n  unacknowledged: true,\n});\n\n// Real-time alert events subscription\nconst { data: event } = useServiceAlertSubscription({ routerId, instanceId });\n\n// Acknowledge single alert\nconst [ack] = useAcknowledgeAlert();\nawait ack({ variables: { alertId: 'alert-123', comment: 'Investigating...' } });\n\n// Acknowledge multiple alerts\nconst [ackMultiple] = useAcknowledgeAlerts();\nawait ackMultiple({ variables: { alertIds: ['alert-1', 'alert-2'] } });\n"})}),"\n",(0,t.jsx)(n.p,{children:"Key types:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"type AlertSeverity = 'INFO' | 'WARNING' | 'ERROR' | 'CRITICAL';\ntype AlertAction = 'NOTIFY' | 'STOP_SERVICE' | 'RESTART_SERVICE' | 'CUSTOM';\n\ninterface ServiceAlert {\n  id: string;\n  instanceId: string;\n  rule: AlertRule;\n  severity: AlertSeverity;\n  message: string;\n  firedAt: string;\n  acknowledgedAt: string | null;\n  escalation: AlertEscalation | null;\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:["GraphQL: ",(0,t.jsx)(n.code,{children:"GET_SERVICE_ALERTS"}),", ",(0,t.jsx)(n.code,{children:"SERVICE_ALERT_EVENTS"}),", ",(0,t.jsx)(n.code,{children:"ACKNOWLEDGE_ALERT"}),", ",(0,t.jsx)(n.code,{children:"ACKNOWLEDGE_ALERTS"}),"."]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"17-lifecycle-mutations-summary",children:"17. Lifecycle Mutations Summary"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Mutation"}),(0,t.jsx)(n.th,{children:"Hook"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Install"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"useInstallService()"})}),(0,t.jsx)(n.td,{children:"Download + install binary"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Start"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"useInstanceMutations().startInstance()"})}),(0,t.jsx)(n.td,{children:"Start process"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Stop"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"useInstanceMutations().stopInstance()"})}),(0,t.jsx)(n.td,{children:"Graceful stop"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Restart"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"useInstanceMutations().restartInstance()"})}),(0,t.jsx)(n.td,{children:"Stop + start"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Delete"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"useInstanceMutations().deleteInstance()"})}),(0,t.jsx)(n.td,{children:"Remove + clean up"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Configure"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"useApplyServiceConfig()"})}),(0,t.jsx)(n.td,{children:"Apply new config"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Verify"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"useReverifyFeature()"})}),(0,t.jsx)(n.td,{children:"Re-check GPG signature"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Update"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"useUpdateInstance()"})}),(0,t.jsx)(n.td,{children:"Upgrade binary"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Rollback"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"useRollbackInstance()"})}),(0,t.jsx)(n.td,{children:"Restore previous binary"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Kill switch on/off"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"useSetKillSwitch()"})}),(0,t.jsx)(n.td,{children:"Toggle network kill switch"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Assign routing"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"useAssignDeviceRouting()"})}),(0,t.jsx)(n.td,{children:"Route device through service"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Set quota"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"useSetTrafficQuota()"})}),(0,t.jsx)(n.td,{children:"Set bandwidth quota"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Set resource limits"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"useSetResourceLimits()"})}),(0,t.jsx)(n.td,{children:"Apply cgroup limits"})]})]})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"18-querykeys-reference",children:"18. queryKeys Reference"}),"\n",(0,t.jsxs)(n.p,{children:["Source: ",(0,t.jsx)(n.code,{children:"libs/api-client/queries/src/services/queryKeys.ts"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"export const serviceQueryKeys = {\n  all:              ['services'] as const,\n\n  // Catalog\n  catalog:          () => [...serviceQueryKeys.all, 'catalog'] as const,\n  catalogByCategory:(cat) => [...serviceQueryKeys.catalog(), cat] as const,\n  catalogFiltered:  (cat?, arch?) => [...serviceQueryKeys.catalog(), { category: cat, architecture: arch }] as const,\n\n  // Instances\n  instances:        (routerId) => [...serviceQueryKeys.all, 'instances', routerId] as const,\n  instancesByStatus:(routerId, status?) => [...serviceQueryKeys.instances(routerId), 'status', status] as const,\n  instancesByFeature:(routerId, fid?) => [...serviceQueryKeys.instances(routerId), 'feature', fid] as const,\n  instance:         (routerId, instanceId) => [...serviceQueryKeys.instances(routerId), instanceId] as const,\n\n  // Install progress\n  installProgress:          (routerId) => [...serviceQueryKeys.all, 'install-progress', routerId] as const,\n  installProgressByInstance:(routerId, instanceId) => [...serviceQueryKeys.installProgress(routerId), instanceId] as const,\n};\n\n// Also exported as:\nexport { serviceQueryKeys as serviceKeys };\n"})})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},71184:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>c});var i=s(14041);const t={},r=i.createContext(t);function a(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);