"use strict";(globalThis.webpackChunk_nas_net_docs=globalThis.webpackChunk_nas_net_docs||[]).push([[99582],{3603:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>a,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"graphql-schema-contracts","title":"GraphQL Schema Contracts \u2014 Scalars and Directives","description":"This document covers the custom scalars and GraphQL directives that define the schema contract between the NasNet backend and frontend. Understanding these types and directives is essential for writing type-safe queries and leveraging the code generation pipeline.","source":"@site/../../libs/api-client/docs/graphql-schema-contracts.md","sourceDirName":".","slug":"/graphql-schema-contracts","permalink":"/docs/api-client/graphql-schema-contracts","draft":false,"unlisted":false,"editUrl":"https://github.com/nasnet-community/nasnet-panel/tree/main/../../libs/api-client/docs/graphql-schema-contracts.md","tags":[],"version":"current","sidebarPosition":12,"frontMatter":{"sidebar_position":12,"title":"GraphQL Schema Contracts \u2014 Scalars and Directives"},"sidebar":"sidebar","previous":{"title":"Change Set Pattern","permalink":"/docs/api-client/change-set-pattern"},"next":{"title":"TanStack Query Modules \u2014 REST-Only Endpoints","permalink":"/docs/api-client/tanstack-query-modules"}}');var s=r(31085),t=r(71184);const a={sidebar_position:12,title:"GraphQL Schema Contracts \u2014 Scalars and Directives"},c="GraphQL Schema Contracts",d={},l=[{value:"Custom Scalars",id:"custom-scalars",level:2},{value:"Scalar Mapping to TypeScript",id:"scalar-mapping-to-typescript",level:3},{value:"DateTime Scalar",id:"datetime-scalar",level:3},{value:"IPv4 and IPv6 Scalars",id:"ipv4-and-ipv6-scalars",level:3},{value:"MAC Scalar",id:"mac-scalar",level:3},{value:"CIDR Scalar",id:"cidr-scalar",level:3},{value:"Port and PortRange Scalars",id:"port-and-portrange-scalars",level:3},{value:"Duration Scalar",id:"duration-scalar",level:3},{value:"Bandwidth and Size Scalars",id:"bandwidth-and-size-scalars",level:3},{value:"ULID Scalar",id:"ulid-scalar",level:3},{value:"GraphQL Directives",id:"graphql-directives",level:2},{value:"Platform Mapping Directives",id:"platform-mapping-directives",level:3},{value:"@mikrotik",id:"mikrotik",level:4},{value:"@openwrt, @vyos",id:"openwrt-vyos",level:4},{value:"@capability Directive",id:"capability-directive",level:3},{value:"@cache Directive",id:"cache-directive",level:3},{value:"@realtime Directive",id:"realtime-directive",level:3},{value:"@validate Directive",id:"validate-directive",level:3},{value:"@sensitive Directive",id:"sensitive-directive",level:3},{value:"@auth Directive",id:"auth-directive",level:3},{value:"@migrateFrom Directive",id:"migratefrom-directive",level:3},{value:"Code Generation Pipeline",id:"code-generation-pipeline",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"Scalars",id:"scalars",level:3},{value:"Directives",id:"directives",level:3},{value:"Cross-References",id:"cross-references",level:2}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"graphql-schema-contracts",children:"GraphQL Schema Contracts"})}),"\n",(0,s.jsx)(n.p,{children:"This document covers the custom scalars and GraphQL directives that define the schema contract between the NasNet backend and frontend. Understanding these types and directives is essential for writing type-safe queries and leveraging the code generation pipeline."}),"\n",(0,s.jsx)(n.h2,{id:"custom-scalars",children:"Custom Scalars"}),"\n",(0,s.jsxs)(n.p,{children:["Custom scalars in GraphQL allow you to define domain-specific types beyond the standard String, Int, Boolean, etc. NasNetConnect defines 12 custom scalars in ",(0,s.jsx)(n.code,{children:"schema/scalars.graphql"}),", all of which are code-generated into TypeScript types."]}),"\n",(0,s.jsx)(n.h3,{id:"scalar-mapping-to-typescript",children:"Scalar Mapping to TypeScript"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"GraphQL Scalar"}),(0,s.jsx)(n.th,{children:"TypeScript Type"}),(0,s.jsx)(n.th,{children:"Example"}),(0,s.jsx)(n.th,{children:"Usage"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"DateTime"})}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"string"})," (ISO 8601)"]}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:'"2024-01-15T10:30:00Z"'})}),(0,s.jsx)(n.td,{children:"Timestamps in resource metadata"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"JSON"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"Record<string, unknown>"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:'{ "key": "value" }'})}),(0,s.jsx)(n.td,{children:"Flexible configuration data"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"IPv4"})}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"string"})," (validated)"]}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:'"192.168.1.1"'})}),(0,s.jsx)(n.td,{children:"IP addresses"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"IPv6"})}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"string"})," (validated)"]}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:'"2001:0db8:85a3::8a2e:0370:7334"'})}),(0,s.jsx)(n.td,{children:"IPv6 addresses"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"MAC"})}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"string"})," (colon or dash)"]}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:'"00:1A:2B:3C:4D:5E"'})}),(0,s.jsx)(n.td,{children:"MAC addresses"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"CIDR"})}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"string"})," (prefix notation)"]}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:'"192.168.1.0/24"'})}),(0,s.jsx)(n.td,{children:"Network blocks"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"Port"})}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"number"})," (1\u201365535)"]}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"8080"})}),(0,s.jsx)(n.td,{children:"TCP/UDP port numbers"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"PortRange"})}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"string"})," (format: ",(0,s.jsx)(n.code,{children:'"80"'})," or ",(0,s.jsx)(n.code,{children:'"80-443"'}),")"]}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:'"80,443,8080"'})}),(0,s.jsx)(n.td,{children:"Multiple ports"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"Duration"})}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"string"})," (RouterOS format)"]}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:'"1d2h3m4s"'}),", ",(0,s.jsx)(n.code,{children:'"30s"'}),", ",(0,s.jsx)(n.code,{children:'"5m"'})]}),(0,s.jsx)(n.td,{children:"Time intervals"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"Bandwidth"})}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"string"})," (with unit)"]}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:'"10M"'}),", ",(0,s.jsx)(n.code,{children:'"1G"'}),", ",(0,s.jsx)(n.code,{children:'"100k"'})]}),(0,s.jsx)(n.td,{children:"Network rates"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"Size"})}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"string"})," (bytes + unit)"]}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:'"1024"'}),", ",(0,s.jsx)(n.code,{children:'"1M"'}),", ",(0,s.jsx)(n.code,{children:'"1G"'})]}),(0,s.jsx)(n.td,{children:"File/storage sizes"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"ULID"})}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"string"})," (26-char sortable ID)"]}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:'"01ARZ3NDEKTSV4RRFFQ69G5FAV"'})}),(0,s.jsx)(n.td,{children:"Unique resource IDs"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"datetime-scalar",children:"DateTime Scalar"}),"\n",(0,s.jsxs)(n.p,{children:["ISO 8601 formatted datetime strings, always in UTC with ",(0,s.jsx)(n.code,{children:"Z"})," suffix."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:"# In schema\nscalar DateTime\n\ntype Service {\n  id: ULID!\n  createdAt: DateTime!\n  updatedAt: DateTime!\n}\n\n# In TypeScript (generated)\ninterface Service {\n  id: string;  // ULID type\n  createdAt: string;  // ISO 8601 datetime\n  updatedAt: string;\n}\n\n# Usage in a component\nfunction ServiceDetail({ serviceId }: { serviceId: string }) {\n  const { data } = useGetService(serviceId);\n  const createdDate = new Date(data.service.createdAt);\n  return <p>Created: {createdDate.toLocaleString()}</p>;\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"ipv4-and-ipv6-scalars",children:"IPv4 and IPv6 Scalars"}),"\n",(0,s.jsx)(n.p,{children:"Network address validation happens both on the backend (gqlgen) and frontend (Zod codegen)."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:"# In schema\ninput CreateInterfaceInput {\n  address: IPv4!\n  gateway: IPv4!\n  ipv6Prefix: IPv6\n}\n\ntype Interface {\n  ipv4Address: IPv4!\n  ipv6Address: IPv6\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"Generated Zod schemas validate format automatically:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// Generated schema\nimport { CreateInterfaceInputSchema } from '@nasnet/api-client/generated';\n\n// Will validate IPv4/IPv6 format\nconst result = CreateInterfaceInputSchema.safeParse({\n  address: '192.168.1.1',  // \u2713 Valid\n  gateway: '256.256.256.256',  // \u2717 Invalid\n});\n"})}),"\n",(0,s.jsx)(n.h3,{id:"mac-scalar",children:"MAC Scalar"}),"\n",(0,s.jsxs)(n.p,{children:["MAC addresses are case-insensitive and accept both colon (",(0,s.jsx)(n.code,{children:":"}),") and dash (",(0,s.jsx)(n.code,{children:"-"}),") separators."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'// Both valid\nconst mac1 = "00:1A:2B:3C:4D:5E";\nconst mac2 = "00-1A-2B-3C-4D-5E";\n'})}),"\n",(0,s.jsx)(n.p,{children:"OUI (Organizationally Unique Identifier) lookups use the first 6 hex digits (3 octets):"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { useVendorLookup } from '@nasnet/api-client/queries';\n\nfunction ClientDetail({ macAddress }: { macAddress: string }) {\n  const vendor = useVendorLookup(macAddress);\n  return <p>Vendor: {vendor || 'Unknown'}</p>;\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"cidr-scalar",children:"CIDR Scalar"}),"\n",(0,s.jsxs)(n.p,{children:["CIDR (Classless Inter-Domain Routing) notation for subnets: ",(0,s.jsx)(n.code,{children:"<IP>/<prefix-length>"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:'# In schema\ninput CreateAddressBlockInput {\n  name: String!\n  cidr: CIDR!  # e.g., "10.0.0.0/8"\n}\n\ntype AddressBlock {\n  cidr: CIDR!\n  broadcastAddress: IPv4!\n  networkAddress: IPv4!\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"port-and-portrange-scalars",children:"Port and PortRange Scalars"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"Port"})," is a single number (1\u201365535); ",(0,s.jsx)(n.code,{children:"PortRange"})," is a comma-separated or dash-separated list."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:'# In schema\ninput FirewallRuleInput {\n  sourcePort: Port          # Single port: 80\n  destinationPorts: PortRange  # Multiple: "80", "80-443", "80,443,8080"\n}\n\ntype FirewallRule {\n  port: Port!\n  portRange: PortRange\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"duration-scalar",children:"Duration Scalar"}),"\n",(0,s.jsxs)(n.p,{children:["RouterOS duration format: ",(0,s.jsx)(n.code,{children:"<value><unit>"})," combinations like ",(0,s.jsx)(n.code,{children:"1d2h3m4s"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:'# In schema\ntype VPNService {\n  id: ULID!\n  reconnectTimeout: Duration!  # e.g., "5m", "30s", "1d"\n}\n\ninput UpdateVPNInput {\n  reconnectTimeout: Duration\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"Parsed on the backend and stored as canonical duration strings."}),"\n",(0,s.jsx)(n.h3,{id:"bandwidth-and-size-scalars",children:"Bandwidth and Size Scalars"}),"\n",(0,s.jsx)(n.p,{children:"Network rates and storage sizes with units:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:'# In schema\ntype QoSProfile {\n  maxDownlink: Bandwidth!  # e.g., "10M", "1G"\n  maxUplink: Bandwidth!\n}\n\ntype StorageQuota {\n  limitBytes: Size!  # e.g., "1G", "512M"\n  usedBytes: Size!\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"ulid-scalar",children:"ULID Scalar"}),"\n",(0,s.jsx)(n.p,{children:"Universally Unique Lexicographically Sortable Identifier. 26 characters, sortable by timestamp, globally unique."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// ULID format: 01ARZ3NDEKTSV4RRFFQ69G5FAV\n// Generated automatically on resource creation\n// Sortable: ULIDs created later have higher values\n\nimport type { ULID } from '@nasnet/api-client/generated';\n\nfunction ResourceCard({ resourceId }: { resourceId: string }) {\n  // resourceId is a ULID\n  return <div key={resourceId}>{resourceId}</div>;\n}\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"graphql-directives",children:"GraphQL Directives"}),"\n",(0,s.jsx)(n.p,{children:"Directives are metadata annotations that control behavior at query, field, or type level. NasNetConnect uses directives for caching, capability gating, validation, auth, and platform mapping."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Reference files:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"schema/core/core-directives-platform.graphql"})," \u2014 Platform mapping, capability gating, caching, realtime"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"schema/core/core-directives-validation.graphql"})," \u2014 Validation constraints, sensitive data markers"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"platform-mapping-directives",children:"Platform Mapping Directives"}),"\n",(0,s.jsxs)(n.p,{children:["These directives (used internally by the backend resolver layer) tell the system which MikroTik RouterOS paths or other platform APIs to call. They are ",(0,s.jsx)(n.strong,{children:"not relevant to frontend code"})," but documented for completeness."]}),"\n",(0,s.jsx)(n.h4,{id:"mikrotik",children:"@mikrotik"}),"\n",(0,s.jsx)(n.p,{children:"Maps GraphQL fields to MikroTik RouterOS API paths:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:'# In backend schema (not used in frontend queries)\ndirective @mikrotik(\n  path: String!        # RouterOS path: "/ip/address"\n  field: String        # Response field mapping\n  cmd: String          # print, add, set, remove\n) on FIELD_DEFINITION | OBJECT\n'})}),"\n",(0,s.jsx)(n.h4,{id:"openwrt-vyos",children:"@openwrt, @vyos"}),"\n",(0,s.jsx)(n.p,{children:"Similarly map to OpenWrt ubus calls and VyOS configuration paths (backend-only)."}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"capability-directive",children:"@capability Directive"}),"\n",(0,s.jsxs)(n.p,{children:["Gates field access based on router capabilities. If a router lacks the capability, the field returns a ",(0,s.jsx)(n.code,{children:"P1xx"})," platform error."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:'# In schema\ntype Interface {\n  id: ULID!\n  name: String!\n  # Only available on routers with wireguard capability\n  wireguardConfig: WireguardConfig @capability(requires: ["wireguard"])\n}\n\ntype RouterCapabilities {\n  wireguard: Boolean!\n  ipv6: Boolean!\n  adguard: Boolean!\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Frontend handling:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { useGetRouter } from '@nasnet/api-client/queries';\n\nfunction InterfaceDetail({ routerId, interfaceId }: Props) {\n  const { data } = useGetRouter(routerId);\n\n  // Check capability before rendering\n  if (!data.router.capabilities.wireguard) {\n    return <Alert>This router does not support WireGuard</Alert>;\n  }\n\n  // Safe to use wireguard fields\n  return <WireGuardForm routerId={routerId} />;\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"Error codes for capability failures:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"P100"}),": Platform feature not supported"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"P101"}),": Required capability not available"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"cache-directive",children:"@cache Directive"}),"\n",(0,s.jsx)(n.p,{children:"Controls Apollo cache staleTime and garbage collection strategy."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:"# In schema\ntype SystemInfo {\n  id: ULID!\n  identity: String!\n  uptime: Duration! @cache(maxAge: 60, scope: PUBLIC)\n  cpuLoad: Float! @cache(maxAge: 5, scope: PRIVATE)\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Directive parameters:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"maxAge: Int!"})," \u2014 Seconds before cache is stale (maps to Apollo ",(0,s.jsx)(n.code,{children:"staleTime"}),")"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"scope: CacheScope"})," \u2014 ",(0,s.jsx)(n.code,{children:"PRIVATE"})," (user-specific, cleared on logout) or ",(0,s.jsx)(n.code,{children:"PUBLIC"})," (shared)"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Frontend implications:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// Code generation creates optimal staleTime based on @cache directives\n// For SystemInfo:\n// - uptime: staleTime = 60000ms (1 minute), scope = PUBLIC\n// - cpuLoad: staleTime = 5000ms (5 seconds), scope = PRIVATE\n\nimport { useGetSystemInfo } from '@nasnet/api-client/queries';\n\nfunction Dashboard() {\n  // Automatically respects @cache(maxAge: 60) directive\n  const { data } = useGetSystemInfo();\n  // Will not refetch if called again within 60 seconds\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"CacheScope enum:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:"enum CacheScope {\n  PRIVATE   # User-specific data; evicted on logout\n  PUBLIC    # Shared data; persisted in IndexedDB\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"realtime-directive",children:"@realtime Directive"}),"\n",(0,s.jsx)(n.p,{children:"Marks fields that require subscription or high-frequency polling."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:'# In schema\ntype Service {\n  id: ULID!\n  status: ServiceStatus!\n  cpuPercent: Float! @realtime(interval: 1000, topic: "service:metrics")\n  memoryUsageMB: Int! @realtime(interval: 1000, topic: "service:metrics")\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Directive parameters:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"interval: Int"})," \u2014 Milliseconds between updates (1000 = 1 Hz)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"topic: String"})," \u2014 Pub/sub topic for subscriptions"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Frontend usage:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { useServiceMetrics } from '@nasnet/api-client/queries';\n\nfunction ServiceMonitor({ serviceId }: { serviceId: string }) {\n  // Subscription automatically polls at 1-second interval\n  const { data } = useServiceMetrics(serviceId);\n\n  return (\n    <div>\n      <p>CPU: {data.service.cpuPercent}%</p>\n      <p>Memory: {data.service.memoryUsageMB}MB</p>\n    </div>\n  );\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"validate-directive",children:"@validate Directive"}),"\n",(0,s.jsx)(n.p,{children:"Defines input validation constraints. The codegen automatically generates Zod schemas enforcing these rules."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:"# In schema\ninput CreateFirewallRuleInput {\n  name: String! @validate(minLength: 1, maxLength: 100)\n  description: String @validate(maxLength: 1000)\n  priority: Int! @validate(min: 0, max: 2147483647)\n  sourceIp: IPv4 @validate(format: IPV4)\n  email: String @validate(format: EMAIL)\n  hostname: String @validate(format: HOSTNAME)\n  apiUrl: String @validate(format: URL)\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Validation attributes:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"minLength: Int"})," \u2014 Minimum string length"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"maxLength: Int"})," \u2014 Maximum string length"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"min: Int"})," \u2014 Minimum numeric value"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"max: Int"})," \u2014 Maximum numeric value"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"pattern: String"})," \u2014 Regex pattern validation"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"format: ValidateFormat"})," \u2014 Predefined format (see below)"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"ValidateFormat enum:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:"enum ValidateFormat {\n  EMAIL\n  URL\n  UUID\n  IPV4\n  IPV6\n  MAC\n  CIDR\n  HOSTNAME\n  FQDN\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Frontend usage:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { CreateFirewallRuleInputSchema } from '@nasnet/api-client/generated/schemas';\n\nconst result = CreateFirewallRuleInputSchema.safeParse({\n  name: 'Block SSH',  // \u2713 1\u2013100 chars\n  description: 'A' * 1001,  // \u2717 Exceeds maxLength\n  priority: -1,  // \u2717 Below min: 0\n  email: 'invalid-email',  // \u2717 Invalid email format\n});\n\nif (!result.success) {\n  console.error(result.error.flatten());\n  // { fieldErrors: { ... }, formErrors: [] }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"React Hook Form integration:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { useForm } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\n\nfunction CreateRuleForm() {\n  const { register, formState: { errors } } = useForm({\n    resolver: zodResolver(CreateFirewallRuleInputSchema),\n  });\n\n  return (\n    <form>\n      <input\n        {...register('name')}\n      />\n      {errors.name && <p>{errors.name.message}</p>}\n    </form>\n  );\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"sensitive-directive",children:"@sensitive Directive"}),"\n",(0,s.jsx)(n.p,{children:"Marks fields containing secrets (passwords, tokens, API keys) for redaction in logs and error responses."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:"# In schema\ninput CredentialsInput {\n  username: String!\n  password: String! @sensitive\n  apiKey: String @sensitive\n}\n\ntype VPNCredentials {\n  id: ULID!\n  username: String!\n  password: String! @sensitive\n  privateKey: String @sensitive\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Backend behavior:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Sensitive fields are redacted in error logs (replaced with ",(0,s.jsx)(n.code,{children:"[REDACTED]"}),")"]}),"\n",(0,s.jsx)(n.li,{children:"In production, sensitive values are stripped from error responses sent to clients"}),"\n",(0,s.jsx)(n.li,{children:"Marked in Apollo cache with metadata to prevent accidental logging"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Frontend handling:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// Never log sensitive fields directly\nconst { data } = useGetVPNCredentials(vpnId);\n\n// Bad:\nconsole.log(data.credentials.password);  // Dangerous!\n\n// Good:\nconsole.log('Password length:', data.credentials.password?.length);\n"})}),"\n",(0,s.jsx)(n.h3,{id:"auth-directive",children:"@auth Directive"}),"\n",(0,s.jsx)(n.p,{children:"Requires authentication and optionally a specific role."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:'# In schema\ntype AdminOperations {\n  # Requires any authenticated user\n  updateSystemSettings(input: UpdateSystemInput!): SystemSettings!\n\n  # Requires admin role\n  resetPassword(userId: ULID!): Boolean! @auth(requires: "admin")\n\n  # Requires operator or admin\n  restartService(serviceId: ULID!): Boolean! @auth(requires: "operator|admin")\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Error codes for auth failures:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"A500"}),": Unauthenticated (missing JWT or Basic auth)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"A501"}),": Insufficient permissions (user lacks required role)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"A502"}),": Token expired (refresh needed)"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Frontend auth check:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { useAuthStore } from '@nasnet/state/stores';\n\nfunction AdminPanel() {\n  const { user } = useAuthStore();\n\n  if (!user) {\n    return <LoginForm />;\n  }\n\n  if (user.role !== 'admin') {\n    return <AccessDenied />;\n  }\n\n  return <AdminDashboard />;\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"migratefrom-directive",children:"@migrateFrom Directive"}),"\n",(0,s.jsx)(n.p,{children:"Marks deprecated fields with migration hints. Helps the frontend gracefully handle schema evolution."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:'# In schema\ntype Service {\n  id: ULID!\n  name: String!\n  # Deprecated: use \'status\' instead\n  state: String @migrateFrom(field: "status", removeInVersion: "2.0.0")\n  status: ServiceStatus!\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Frontend handling:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// Use the new field\nconst { status } = service;\n\n// Fallback for older schemas if needed\nconst effectiveStatus = service.status || service.state;\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"code-generation-pipeline",children:"Code Generation Pipeline"}),"\n",(0,s.jsxs)(n.p,{children:["When you modify any ",(0,s.jsx)(n.code,{children:".graphql"})," file with custom scalars or directives, regenerate TypeScript types and Zod schemas:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"npm run codegen:ts       # Generate TypeScript types + hooks + Zod schemas\nnpm run codegen:check    # Verify generated code is in sync with schema\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Generated artifacts:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"libs/api-client/generated/types.ts"})," \u2014 TypeScript interfaces for all types"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"libs/api-client/generated/operations.ts"})," \u2014 Apollo hooks (useQuery, useMutation, useSubscription)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"libs/api-client/generated/schemas/"})," \u2014 Zod validation schemas per input type"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"libs/api-client/generated/fragment-matcher.ts"})," \u2014 possibleTypes for InMemoryCache"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,s.jsx)(n.h3,{id:"scalars",children:"Scalars"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"DateTime validation:"})," Always parse with ",(0,s.jsx)(n.code,{children:"new Date()"})," and validate in the frontend before display."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Network scalars:"})," Use dedicated types (IPv4, IPv6, CIDR, MAC) instead of generic strings."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Bandwidth/Size:"})," Store values with units; parse server-side when doing math."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"ULID sorting:"})," ULIDs are naturally sortable; use them for time-series data."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"directives",children:"Directives"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"@cache:"})," Respect the directive's maxAge when making decisions about refetch."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"@capability:"})," Always check router capabilities before rendering fields that require them."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"@validate:"})," Trust generated Zod schemas; never override them with manual validation."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"@sensitive:"})," Never log or display sensitive fields; redact in error messages."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"@auth:"})," Check Zustand auth store before rendering restricted UI; let the GraphQL error handle server-side denials."]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"cross-references",children:"Cross-References"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/api-client/error-handling",children:"Error Handling"})," \u2014 P1xx, A5xx, V4xx error codes explained"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/api-client/domain-query-hooks",children:"Domain Query Hooks"})," \u2014 How scalars are used in specific domains"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/api-client/testing-and-codegen",children:"Testing and Codegen"})," \u2014 Regenerating types after schema changes"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},71184:(e,n,r)=>{r.d(n,{R:()=>a,x:()=>c});var i=r(14041);const s={},t=i.createContext(s);function a(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);