"use strict";(globalThis.webpackChunk_nas_net_docs=globalThis.webpackChunk_nas_net_docs||[]).push([[21028],{27565:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>i,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"tanstack-query-modules","title":"TanStack Query Modules \u2014 REST-Only Endpoints","description":"While the majority of NasNetConnect uses Apollo Client for GraphQL, there are three specialized domains that communicate with REST-only endpoints and require TanStack Query (React Query) instead: batch jobs, OUI/MAC vendor lookups, and connection testing. This document covers each module, their caching strategies, and when to use them.","source":"@site/../../libs/api-client/docs/tanstack-query-modules.md","sourceDirName":".","slug":"/tanstack-query-modules","permalink":"/docs/api-client/tanstack-query-modules","draft":false,"unlisted":false,"editUrl":"https://github.com/nasnet-community/nasnet-panel/tree/main/../../libs/api-client/docs/tanstack-query-modules.md","tags":[],"version":"current","sidebarPosition":13,"frontMatter":{"sidebar_position":13,"title":"TanStack Query Modules \u2014 REST-Only Endpoints"},"sidebar":"sidebar","previous":{"title":"GraphQL Schema Contracts \u2014 Scalars and Directives","permalink":"/docs/api-client/graphql-schema-contracts"},"next":{"title":"Notifications and Webhooks \u2014 Alert Delivery Integration","permalink":"/docs/api-client/notifications-webhooks"}}');var t=s(31085),o=s(71184);const i={sidebar_position:13,title:"TanStack Query Modules \u2014 REST-Only Endpoints"},c="TanStack Query Modules",l={},a=[{value:"Decision Boundary: GraphQL vs. REST",id:"decision-boundary-graphql-vs-rest",level:2},{value:"Batch Jobs Module",id:"batch-jobs-module",level:2},{value:"API Endpoints",id:"api-endpoints",level:3},{value:"Types",id:"types",level:3},{value:"Query Keys",id:"query-keys",level:3},{value:"useBatchJob Hook",id:"usebatchjob-hook",level:3},{value:"useCreateBatchJob Hook",id:"usecreatebatchjob-hook",level:3},{value:"useCancelBatchJob Hook",id:"usecancelbatchjob-hook",level:3},{value:"OUI / MAC Vendor Lookup Module",id:"oui--mac-vendor-lookup-module",level:2},{value:"API Endpoints",id:"api-endpoints-1",level:3},{value:"Types",id:"types-1",level:3},{value:"Query Keys",id:"query-keys-1",level:3},{value:"useVendorLookup Hook",id:"usevendorlookup-hook",level:3},{value:"useBatchVendorLookup Hook",id:"usebatchvendorlookup-hook",level:3},{value:"Performance Notes",id:"performance-notes",level:3},{value:"Connection Testing Module",id:"connection-testing-module",level:2},{value:"API / Types",id:"api--types",level:3},{value:"Query Keys",id:"query-keys-2",level:3},{value:"useTestConnection Hook",id:"usetestconnection-hook",level:3},{value:"Caching Strategy Comparison",id:"caching-strategy-comparison",level:2},{value:"Integration with Apollo",id:"integration-with-apollo",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"Batch Jobs",id:"batch-jobs",level:3},{value:"Vendor Lookup",id:"vendor-lookup",level:3},{value:"Connection Testing",id:"connection-testing",level:3},{value:"Cross-References",id:"cross-references",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"tanstack-query-modules",children:"TanStack Query Modules"})}),"\n",(0,t.jsxs)(n.p,{children:["While the majority of NasNetConnect uses Apollo Client for GraphQL, there are three specialized domains that communicate with REST-only endpoints and require TanStack Query (React Query) instead: ",(0,t.jsx)(n.strong,{children:"batch jobs"}),", ",(0,t.jsx)(n.strong,{children:"OUI/MAC vendor lookups"}),", and ",(0,t.jsx)(n.strong,{children:"connection testing"}),". This document covers each module, their caching strategies, and when to use them."]}),"\n",(0,t.jsx)(n.h2,{id:"decision-boundary-graphql-vs-rest",children:"Decision Boundary: GraphQL vs. REST"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Endpoint Type"}),(0,t.jsx)(n.th,{children:"Transport"}),(0,t.jsx)(n.th,{children:"Caching"}),(0,t.jsx)(n.th,{children:"Module"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Structured data (resources, config, state)"}),(0,t.jsx)(n.td,{children:"GraphQL via Apollo"}),(0,t.jsx)(n.td,{children:"Apollo cache + IndexedDB"}),(0,t.jsxs)(n.td,{children:["Apollo hooks in ",(0,t.jsx)(n.code,{children:"queries/src/"})]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Batch job operations"}),(0,t.jsx)(n.td,{children:"REST only"}),(0,t.jsx)(n.td,{children:"TanStack Query"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"batch/useBatchJob"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"MAC vendor lookup"}),(0,t.jsx)(n.td,{children:"REST only"}),(0,t.jsx)(n.td,{children:"TanStack Query (infinite staleTime)"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"oui/useVendorLookup"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Router connection test"}),(0,t.jsx)(n.td,{children:"REST only"}),(0,t.jsx)(n.td,{children:"TanStack Query"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"discovery/useTestConnection"})})]})]})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Rule:"})," If the backend exposes a GraphQL resolver, use Apollo. If it's a REST-only endpoint, use TanStack Query."]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"batch-jobs-module",children:"Batch Jobs Module"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Reference:"})," ",(0,t.jsx)(n.code,{children:"libs/api-client/queries/src/batch/useBatchJob.ts"})]}),"\n",(0,t.jsx)(n.p,{children:"Batch jobs allow you to submit multiple router configuration commands in a single transaction, with optional rollback on failure. The batch module polls the job status in real-time and automatically stops polling when the job reaches a terminal state (completed, failed, cancelled, rolled_back)."}),"\n",(0,t.jsx)(n.h3,{id:"api-endpoints",children:"API Endpoints"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"POST   /api/batch/jobs              # Create a batch job\nGET    /api/batch/jobs/{jobId}      # Fetch job status\nDELETE /api/batch/jobs/{jobId}      # Cancel a running job\n"})}),"\n",(0,t.jsx)(n.h3,{id:"types",children:"Types"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"export type BatchProtocol = 'api' | 'ssh' | 'telnet';\n\nexport type BatchJobStatus =\n  | 'pending'\n  | 'running'\n  | 'completed'\n  | 'failed'\n  | 'cancelled'\n  | 'rolled_back';\n\nexport interface BatchJob {\n  id: string;\n  routerIp: string;\n  protocol: BatchProtocol;\n  status: BatchJobStatus;\n  progress: BatchJobProgress;\n  currentCommand?: string;\n  errors: BatchJobError[];\n  createdAt: string;\n  startedAt?: string;\n  completedAt?: string;\n  dryRun: boolean;\n  rollbackEnabled: boolean;\n  rollbackCount?: number;\n}\n\nexport interface BatchJobProgress {\n  total: number;\n  current: number;\n  percent: number;\n  succeeded: number;\n  failed: number;\n  skipped: number;\n}\n\nexport interface BatchJobError {\n  lineNumber: number;\n  command: string;\n  error: string;\n  timestamp: string;\n}\n\nexport interface CreateBatchJobRequest {\n  routerIp: string;\n  username: string;\n  password: string;\n  protocol: BatchProtocol;\n  useTls?: boolean;\n  script?: string;\n  commands?: string[];\n  dryRun?: boolean;\n  rollbackEnabled?: boolean;\n}\n\nexport interface CreateBatchJobResponse {\n  jobId: string;\n  totalCommands: number;\n  status: BatchJobStatus;\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"query-keys",children:"Query Keys"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"export const batchKeys = {\n  all: ['batch'],                      // all batch queries\n  job: (jobId: string) => [...batchKeys.all, 'job', jobId],  // specific job\n};\n"})}),"\n",(0,t.jsx)(n.h3,{id:"usebatchjob-hook",children:"useBatchJob Hook"}),"\n",(0,t.jsx)(n.p,{children:"Fetches batch job status with automatic polling while the job is running."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"export function useBatchJob(\n  jobId: string | null,\n  options?: {\n    pollingInterval?: number;  // default: 1000ms\n  }\n): UseQueryResult<BatchJob, Error>\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Automatically polls while status is ",(0,t.jsx)(n.code,{children:"pending"})," or ",(0,t.jsx)(n.code,{children:"running"})]}),"\n",(0,t.jsxs)(n.li,{children:["Stops polling when status is ",(0,t.jsx)(n.code,{children:"completed"}),", ",(0,t.jsx)(n.code,{children:"failed"}),", ",(0,t.jsx)(n.code,{children:"cancelled"}),", or ",(0,t.jsx)(n.code,{children:"rolled_back"})]}),"\n",(0,t.jsxs)(n.li,{children:["Returns ",(0,t.jsx)(n.code,{children:"enabled: false"})," if ",(0,t.jsx)(n.code,{children:"jobId"})," is null"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"staleTime: 0"})," for real-time updates"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"retry: 2"})," on network errors"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Example:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"import { useBatchJob } from '@nasnet/api-client/queries';\n\nfunction JobProgress({ jobId }: { jobId: string }) {\n  const { data: job, isLoading, error } = useBatchJob(jobId);\n\n  if (isLoading) return <Spinner />;\n  if (error) return <ErrorAlert error={error} />;\n\n  const { progress, status } = job!;\n\n  return (\n    <div>\n      <ProgressBar value={progress.percent} />\n      <p>\n        {progress.current} of {progress.total} completed\n      </p>\n      <ul>\n        <li>Succeeded: {progress.succeeded}</li>\n        <li>Failed: {progress.failed}</li>\n        <li>Skipped: {progress.skipped}</li>\n      </ul>\n      {job.errors.length > 0 && (\n        <ErrorList errors={job.errors} />\n      )}\n      {status === 'completed' && <SuccessAlert />}\n      {status === 'failed' && <FailureAlert />}\n    </div>\n  );\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"usecreatebatchjob-hook",children:"useCreateBatchJob Hook"}),"\n",(0,t.jsx)(n.p,{children:"Creates a new batch job and automatically pre-populates the cache with initial state."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"export function useCreateBatchJob(): UseMutationResult<\n  CreateBatchJobResponse,\n  Error,\n  CreateBatchJobRequest\n>\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"On success: Invalidates all batch queries and pre-populates the job query cache"}),"\n",(0,t.jsx)(n.li,{children:"Transforms API response (snake_case) to camelCase"}),"\n",(0,t.jsx)(n.li,{children:"Throws error with message from API or statusText"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Example:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"import { useCreateBatchJob } from '@nasnet/api-client/queries';\n\nfunction ConfigurationApply() {\n  const createJob = useCreateBatchJob();\n\n  const handleApply = async (script: string) => {\n    try {\n      const result = await createJob.mutateAsync({\n        routerIp: '192.168.88.1',\n        username: 'admin',\n        password: 'password',\n        protocol: 'api',\n        script,\n        dryRun: false,\n        rollbackEnabled: true,\n      });\n\n      console.log(`Job ${result.jobId} created with ${result.totalCommands} commands`);\n      // Navigate to job progress page\n    } catch (error) {\n      console.error('Failed to create job:', error.message);\n    }\n  };\n\n  return (\n    <form onSubmit={(e) => {\n      e.preventDefault();\n      const script = e.currentTarget.script.value;\n      handleApply(script);\n    }}>\n      <textarea name=\"script\" placeholder=\"Enter configuration commands...\" />\n      <button type=\"submit\" disabled={createJob.isPending}>\n        {createJob.isPending ? 'Creating...' : 'Apply Configuration'}\n      </button>\n    </form>\n  );\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"usecancelbatchjob-hook",children:"useCancelBatchJob Hook"}),"\n",(0,t.jsx)(n.p,{children:"Cancels a running batch job."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"export function useCancelBatchJob(): UseMutationResult<\n  void,\n  Error,\n  string  // jobId\n>\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Sends DELETE request to ",(0,t.jsx)(n.code,{children:"/api/batch/jobs/{jobId}"})]}),"\n",(0,t.jsx)(n.li,{children:"On success: Invalidates the specific job's query cache to refetch updated status"}),"\n",(0,t.jsx)(n.li,{children:"No response body expected"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Example:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"import { useCancelBatchJob } from '@nasnet/api-client/queries';\n\nfunction CancelJobButton({ jobId }: { jobId: string }) {\n  const cancelJob = useCancelBatchJob();\n\n  return (\n    <button\n      onClick={() => {\n        if (confirm('Are you sure you want to cancel this job?')) {\n          cancelJob.mutate(jobId);\n        }\n      }}\n      disabled={cancelJob.isPending}\n    >\n      {cancelJob.isPending ? 'Cancelling...' : 'Cancel Job'}\n    </button>\n  );\n}\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"oui--mac-vendor-lookup-module",children:"OUI / MAC Vendor Lookup Module"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Reference:"})," ",(0,t.jsx)(n.code,{children:"libs/api-client/queries/src/oui/useVendorLookup.ts"})]}),"\n",(0,t.jsx)(n.p,{children:"OUI (Organizationally Unique Identifier) lookups translate MAC addresses to vendor names. Used in DHCP leases, ARP tables, and connected device lists. Vendor data is static and never changes, so we cache indefinitely."}),"\n",(0,t.jsx)(n.h3,{id:"api-endpoints-1",children:"API Endpoints"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"GET  /api/oui/{macAddress}       # Lookup single vendor\nPOST /api/oui/batch              # Lookup multiple vendors\n"})}),"\n",(0,t.jsx)(n.h3,{id:"types-1",children:"Types"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"interface VendorResponse {\n  mac: string;\n  vendor?: string;\n  found: boolean;\n}\n\ninterface BatchVendorResponse {\n  results: Record<string, string>;\n  count: number;\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"query-keys-1",children:"Query Keys"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"export const ouiKeys = {\n  all: ['oui'],\n  vendor: (mac: string) => [...ouiKeys.all, 'vendor', mac],\n  batch: (macs: string[]) => [...ouiKeys.all, 'batch', ...macs],\n};\n"})}),"\n",(0,t.jsx)(n.h3,{id:"usevendorlookup-hook",children:"useVendorLookup Hook"}),"\n",(0,t.jsx)(n.p,{children:"Looks up the vendor name for a single MAC address."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"export function useVendorLookup(macAddress: string): string | null\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"staleTime: Infinity"})," \u2014 Vendor data never changes; never refetch"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"gcTime: 24h"})," \u2014 Keep in cache for 24 hours, then garbage collect"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"enabled: false"})," if macAddress is falsy or less than 17 chars (AA:BB:CC:DD:EE",":FF",")"]}),"\n",(0,t.jsxs)(n.li,{children:["Returns ",(0,t.jsx)(n.code,{children:"null"})," if vendor not found or query is disabled"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Example:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"import { useVendorLookup } from '@nasnet/api-client/queries';\n\nfunction DHCPLeaseRow({ lease }: { lease: DHCPLease }) {\n  const vendor = useVendorLookup(lease.macAddress);\n\n  return (\n    <tr>\n      <td>{lease.ipAddress}</td>\n      <td>{lease.macAddress}</td>\n      <td>{vendor || <em>Unknown vendor</em>}</td>\n      <td>{lease.hostname}</td>\n    </tr>\n  );\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"usebatchvendorlookup-hook",children:"useBatchVendorLookup Hook"}),"\n",(0,t.jsxs)(n.p,{children:["Looks up vendors for multiple MAC addresses in a single request. More efficient than calling ",(0,t.jsx)(n.code,{children:"useVendorLookup"})," multiple times."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"export function useBatchVendorLookup(\n  macAddresses: string[]\n): Record<string, string>\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"staleTime: Infinity"})," \u2014 Vendor data never changes"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"gcTime: 24h"})," \u2014 Cache for 24 hours"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"enabled: false"})," if macAddresses is empty"]}),"\n",(0,t.jsxs)(n.li,{children:["Returns empty object ",(0,t.jsx)(n.code,{children:"{}"})," if query is disabled"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Example:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"import { useBatchVendorLookup } from '@nasnet/api-client/queries';\n\nfunction ConnectedDevicesTable({ devices }: { devices: Device[] }) {\n  const macs = devices.map((d) => d.macAddress);\n  const vendors = useBatchVendorLookup(macs);\n\n  return (\n    <table>\n      <tbody>\n        {devices.map((device) => (\n          <tr key={device.id}>\n            <td>{device.ipAddress}</td>\n            <td>{device.macAddress}</td>\n            <td>{vendors[device.macAddress] || 'Unknown'}</td>\n            <td>{device.hostname}</td>\n          </tr>\n        ))}\n      </tbody>\n    </table>\n  );\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"performance-notes",children:"Performance Notes"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"A single lookup is faster for one or two MACs"}),"\n",(0,t.jsx)(n.li,{children:"Batch lookups are more efficient for 5+ MACs"}),"\n",(0,t.jsx)(n.li,{children:"Consider batching if rendering a table with many devices"}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"connection-testing-module",children:"Connection Testing Module"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Reference:"})," ",(0,t.jsx)(n.code,{children:"libs/api-client/queries/src/discovery/useTestConnection.ts"})]}),"\n",(0,t.jsx)(n.p,{children:"Connection testing validates router credentials by attempting to connect and retrieve system information. Used during the router setup flow."}),"\n",(0,t.jsx)(n.h3,{id:"api--types",children:"API / Types"}),"\n",(0,t.jsxs)(n.p,{children:["The hook uses the ",(0,t.jsx)(n.code,{children:"validateCredentials"})," function from ",(0,t.jsx)(n.code,{children:"@nasnet/features/router-discovery"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"export interface TestConnectionInput {\n  ipAddress: string;\n  credentials: RouterCredentials;\n}\n\n// Returns from validateCredentials (from router-discovery feature)\ninterface CredentialValidationResult {\n  isValid: boolean;\n  routerInfo?: {\n    identity: string;\n    version: string;\n    architecture: string;\n  };\n  error?: string;\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"query-keys-2",children:"Query Keys"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"export const connectionKeys = {\n  all: ['connection'],\n  test: (ip: string) => [...connectionKeys.all, 'test', ip],\n};\n"})}),"\n",(0,t.jsx)(n.h3,{id:"usetestconnection-hook",children:"useTestConnection Hook"}),"\n",(0,t.jsx)(n.p,{children:"Validates credentials by attempting to connect to a router."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"export function useTestConnection(): UseMutationResult<\n  CredentialValidationResult,\n  Error,\n  TestConnectionInput\n>\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"retry: false"})," \u2014 Do not retry on network errors (immediate feedback for auth failures)"]}),"\n",(0,t.jsxs)(n.li,{children:["Calls ",(0,t.jsx)(n.code,{children:"validateCredentials"})," which performs SSH/API connection"]}),"\n",(0,t.jsx)(n.li,{children:"Does not cache results (each test is independent)"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Example:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"import { useTestConnection } from '@nasnet/api-client/queries';\n\nfunction RouterLoginForm({ routerIp }: { routerIp: string }) {\n  const testConnection = useTestConnection();\n\n  const handleSubmit = async (e: React.FormEvent<HTMLFormElement>) => {\n    e.preventDefault();\n    const formData = new FormData(e.currentTarget);\n\n    testConnection.mutate(\n      {\n        ipAddress: routerIp,\n        credentials: {\n          username: formData.get('username') as string,\n          password: formData.get('password') as string,\n        },\n      },\n      {\n        onSuccess: (result) => {\n          if (result.isValid) {\n            console.log(`Connected to ${result.routerInfo?.identity}`);\n            // Save router and navigate\n          } else {\n            console.error('Connection failed:', result.error);\n          }\n        },\n        onError: (error) => {\n          console.error('Test failed:', error.message);\n        },\n      }\n    );\n  };\n\n  return (\n    <form onSubmit={handleSubmit}>\n      <input\n        type=\"text\"\n        name=\"username\"\n        placeholder=\"Username\"\n        required\n      />\n      <input\n        type=\"password\"\n        name=\"password\"\n        placeholder=\"Password\"\n        required\n      />\n      <button type=\"submit\" disabled={testConnection.isPending}>\n        {testConnection.isPending ? 'Testing...' : 'Test Connection'}\n      </button>\n\n      {testConnection.data?.isValid && (\n        <SuccessAlert message={`Connected to ${testConnection.data.routerInfo?.identity}`} />\n      )}\n\n      {testConnection.data && !testConnection.data.isValid && (\n        <ErrorAlert message={testConnection.data.error} />\n      )}\n\n      {testConnection.isError && (\n        <ErrorAlert message={testConnection.error.message} />\n      )}\n    </form>\n  );\n}\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"caching-strategy-comparison",children:"Caching Strategy Comparison"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Module"}),(0,t.jsx)(n.th,{children:"Query Type"}),(0,t.jsx)(n.th,{children:"staleTime"}),(0,t.jsx)(n.th,{children:"gcTime"}),(0,t.jsx)(n.th,{children:"Refetch Trigger"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Batch Jobs"})}),(0,t.jsx)(n.td,{children:"Real-time polling"}),(0,t.jsx)(n.td,{children:"0ms"}),(0,t.jsx)(n.td,{children:"default"}),(0,t.jsx)(n.td,{children:"Auto-poll until terminal"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Vendor Lookup"})}),(0,t.jsx)(n.td,{children:"Static data"}),(0,t.jsx)(n.td,{children:"Infinity"}),(0,t.jsx)(n.td,{children:"24h"}),(0,t.jsx)(n.td,{children:"Manual (invalidate)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Connection Test"})}),(0,t.jsx)(n.td,{children:"One-time test"}),(0,t.jsx)(n.td,{children:"N/A (mutation)"}),(0,t.jsx)(n.td,{children:"N/A"}),(0,t.jsx)(n.td,{children:"User action"})]})]})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"integration-with-apollo",children:"Integration with Apollo"}),"\n",(0,t.jsxs)(n.p,{children:["These TanStack Query modules live alongside Apollo and do ",(0,t.jsx)(n.strong,{children:"not"})," conflict:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// Apollo query for router data\nconst { data: router } = useGetRouter(routerId);\n\n// TanStack Query for batch job\nconst { data: job } = useBatchJob(jobId);\n\n// TanStack Query for vendors\nconst vendors = useBatchVendorLookup(router.devices.map(d => d.mac));\n"})}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"QueryClient"})," is set up in the ApolloProvider and can be accessed from feature components."]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,t.jsx)(n.h3,{id:"batch-jobs",children:"Batch Jobs"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Always check terminal state:"})," Use the ",(0,t.jsx)(n.code,{children:"status"})," field to determine if polling should stop."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Display progress:"})," Show ",(0,t.jsx)(n.code,{children:"progress.percent"})," and command counts to keep users informed."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Handle errors:"})," Parse the ",(0,t.jsx)(n.code,{children:"errors"})," array to show which commands failed."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Rollback awareness:"})," Indicate ",(0,t.jsx)(n.code,{children:"rollbackCount"})," if rollback was triggered."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Timeout handling:"})," Set a reasonable timeout (e.g., 5 minutes) for hung jobs."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"vendor-lookup",children:"Vendor Lookup"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Batch when possible:"})," If rendering a list of 5+ devices, use ",(0,t.jsx)(n.code,{children:"useBatchVendorLookup"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Fallback UI:"})," Always provide a fallback for unknown vendors."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"No refetch:"})," Trust that vendor data is static; don't add manual invalidation."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Cache hit:"})," Subsequent lookups of the same MAC are instant from cache."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"connection-testing",children:"Connection Testing"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"No caching:"})," Test results are one-time; don't expect cached data."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Disable retry:"})," Let auth failures fail fast for immediate user feedback."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Display router info:"})," On success, show router identity/version for confirmation."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Error clarity:"}),' Map error messages to user-friendly text (e.g., "Incorrect password" vs. "Network unreachable").']}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"cross-references",children:"Cross-References"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/docs/api-client/domain-query-hooks",children:"Domain Query Hooks"})," \u2014 Full query hook catalog"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/docs/api-client/offline-first",children:"Offline First"})," \u2014 How offline detection affects REST calls"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/docs/api-client/testing-and-codegen",children:"Testing and Codegen"})," \u2014 Mocking REST endpoints in tests"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},71184:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>c});var r=s(14041);const t={},o=r.createContext(t);function i(e){const n=r.useContext(o);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),r.createElement(o.Provider,{value:n},e.children)}}}]);