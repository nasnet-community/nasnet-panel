"use strict";(globalThis.webpackChunk_nas_net_docs=globalThis.webpackChunk_nas_net_docs||[]).push([[23172],{71184:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>c});var i=r(14041);const t={},s=i.createContext(t);function o(e){const n=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),i.createElement(s.Provider,{value:n},e.children)}},84936:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"application-bootstrap","title":"Application Bootstrap","description":"How NasNet initializes from a blank slate to a fully-running system \u2014 the wiring of 13 service","source":"@site/../backend/docs/application-bootstrap.md","sourceDirName":".","slug":"/application-bootstrap","permalink":"/docs/backend/application-bootstrap","draft":false,"unlisted":false,"editUrl":"https://github.com/nasnet-community/nasnet-panel/tree/main/../backend/docs/application-bootstrap.md","tags":[],"version":"current","frontMatter":{},"sidebar":"sidebar","previous":{"title":"Alert System","permalink":"/docs/backend/alert-system"},"next":{"title":"Build and Deploy","permalink":"/docs/backend/build-and-deploy"}}');var t=r(31085),s=r(71184);const o={},c="Application Bootstrap",d={},a=[{value:"Overview",id:"overview",level:2},{value:"Architecture",id:"architecture",level:2},{value:"cmd/nnc/ Package",id:"cmdnnc-package",level:2},{value:"<code>main.go</code>",id:"maingo",level:3},{value:"<code>main_prod.go</code> (build tag: <code>!dev</code>)",id:"main_prodgo-build-tag-dev",level:3},{value:"<code>main_dev.go</code> (build tag: <code>dev</code>)",id:"main_devgo-build-tag-dev",level:3},{value:"<code>handlers.go</code>",id:"handlersgo",level:3},{value:"<code>routes_prod.go</code>",id:"routes_prodgo",level:3},{value:"<code>services_prod.go</code>",id:"services_prodgo",level:3},{value:"internal/bootstrap/ Package",id:"internalbootstrap-package",level:2},{value:"<code>config.go</code> \u2014 RuntimeConfig",id:"configgo--runtimeconfig",level:3},{value:"<code>database.go</code> \u2014 Database Initialization",id:"databasego--database-initialization",level:3},{value:"<code>events.go</code> \u2014 Event Bus",id:"eventsgo--event-bus",level:3},{value:"<code>alerts.go</code> \u2014 Alert System",id:"alertsgo--alert-system",level:3},{value:"<code>storage.go</code> \u2014 Storage Infrastructure",id:"storagego--storage-infrastructure",level:3},{value:"<code>vif.go</code> \u2014 Virtual Interface Factory",id:"vifgo--virtual-interface-factory",level:3},{value:"<code>orchestrator.go</code> \u2014 Service Orchestrator",id:"orchestratorgo--service-orchestrator",level:3},{value:"<code>routing.go</code> \u2014 Routing Engine",id:"routinggo--routing-engine",level:3},{value:"<code>core.go</code> \u2014 Core Services",id:"corego--core-services",level:3},{value:"<code>integration.go</code> \u2014 Integration Services",id:"integrationgo--integration-services",level:3},{value:"<code>shutdown.go</code> \u2014 Graceful Shutdown",id:"shutdowngo--graceful-shutdown",level:3},{value:"Service Initialization Order",id:"service-initialization-order",level:2},{value:"Dependency Injection Pattern",id:"dependency-injection-pattern",level:2},{value:"Configuration Loading",id:"configuration-loading",level:2},{value:"Error Handling",id:"error-handling",level:2},{value:"Testing",id:"testing",level:2},{value:"Cross-References",id:"cross-references",level:2}];function l(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"application-bootstrap",children:"Application Bootstrap"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"How NasNet initializes from a blank slate to a fully-running system \u2014 the wiring of 13 service\ngroups, dependency injection, and graceful shutdown."}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Packages:"})," ",(0,t.jsx)(n.code,{children:"cmd/nnc/"}),", ",(0,t.jsx)(n.code,{children:"internal/bootstrap/"})," ",(0,t.jsx)(n.strong,{children:"Key Files:"})," ",(0,t.jsx)(n.code,{children:"cmd/nnc/main_prod.go"}),",\n",(0,t.jsx)(n.code,{children:"cmd/nnc/services_prod.go"}),", ",(0,t.jsx)(n.code,{children:"internal/bootstrap/*.go"})," ",(0,t.jsx)(n.strong,{children:"Prerequisites:"}),"\n",(0,t.jsx)(n.a,{href:"/docs/backend/getting-started",children:"getting-started.md"})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsx)(n.p,{children:"Bootstrap is the layer that connects the domain services (auth, alerts, VIF, orchestrator, etc.) to\nthe HTTP server and to each other. It follows a deliberate initialization order to satisfy\ndependencies: the database must be ready before services that write to it, event bus before services\nthat publish events, storage before the orchestrator, etc."}),"\n",(0,t.jsx)(n.p,{children:"The bootstrap code lives in two places:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"cmd/nnc/"})," \u2014 the entry point and top-level wiring"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"internal/bootstrap/"})," \u2014 reusable initialization functions (one per subsystem)"]}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"architecture",children:"Architecture"}),"\n",(0,t.jsx)(n.mermaid,{value:'graph TD\n    A["main.go"] --\x3e|calls| B["run() (main_prod.go)"]\n    B --\x3e|ApplyRuntimeConfig| C["config.go"]\n    B --\x3e|InitializeEventBus| D["events.go"]\n    B --\x3e|InitializeDatabase| E["database.go"]\n    B --\x3e|Logger setup| F["zap.Logger"]\n    B --\x3e|NewMockAdapter| G["placeholder"]\n    B --\x3e|InitializeAlertSystem| H["alerts.go"]\n    H --\x3e|includes| H1["notifications"]\n    H --\x3e|includes| H2["dispatcher"]\n    H --\x3e|includes| H3["escalation"]\n    H --\x3e|includes| H4["digest"]\n    H --\x3e|includes| H5["alert engine"]\n    B --\x3e|initProdServices| I["services_prod.go"]\n    I --\x3e|initEncryptionService| I1["encryption"]\n    I --\x3e|initStorageAndVIF| I2["Storage + VIF"]\n    I2 --\x3e|InitializeStorage| I2A["storage.go"]\n    I2 --\x3e|InitializeVIF| I2B["vif.go"]\n    I --\x3e|initOrchestrator| I3["Orchestrator"]\n    I3 --\x3e|InitializeOrchestrator| I3A["orchestrator.go"]\n    I --\x3e|InitializeRouting| I4["routing.go"]\n    I --\x3e|initUpdateAndTemplates| I5["Updates + Templates"]\n    I5 --\x3e|InitializeUpdates| I5A["updates.go"]\n    I5 --\x3e|InitializeTemplates| I5B["templates.go"]\n    I --\x3e|initCoreAndDiagnostics| I6["Core + Diagnostics"]\n    I6 --\x3e|InitializeCoreServices| I6A["core.go"]\n    I6 --\x3e|InitializeDiagnostics| I6B["diagnostics.go"]\n    I --\x3e|initNetworkAndFirewall| I7["Network + Firewall"]\n    I7 --\x3e|InitializeNetwork| I7A["network.go"]\n    I7 --\x3e|InitializeFirewall| I7B["firewall.go"]\n    I --\x3e|initMonitoringAndTraffic| I8["Monitoring + Traffic"]\n    I8 --\x3e|InitializeMonitoring| I8A["monitoring.go"]\n    I8 --\x3e|InitializeTraffic| I8B["traffic.go"]\n    I8 --\x3e|InitializeScheduling| I8C["scheduling.go"]\n    I --\x3e|initIntegrationServices| I9["integration.go"]\n    B --\x3e|server.New| J["HTTP Server"]\n    B --\x3e|ApplyProdMiddleware| J\n    B --\x3e|NewFrontendHandler| J\n    B --\x3e|NewShutdownCoordinator| K["shutdown.go"]\n    B --\x3e|setupProdRoutes| L["routes_prod.go"]\n    B --\x3e|ExecuteBootSequence goroutine| M["Boot Sequence"]\n    B --\x3e|srv.Start| N["Listening"]\n    style B fill:#4a90e2\n    style M fill:#f5a623\n    style N fill:#7ed321'}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"cmdnnc-package",children:"cmd/nnc/ Package"}),"\n",(0,t.jsx)(n.p,{children:"The application entry point."}),"\n",(0,t.jsx)(n.h3,{id:"maingo",children:(0,t.jsx)(n.code,{children:"main.go"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:'func main() {\n    healthCheck := flag.Bool("healthcheck", false, "Perform health check and exit")\n    flag.Parse()\n    if *healthCheck {\n        performHealthCheck()\n        return\n    }\n    run()\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Parses the ",(0,t.jsx)(n.code,{children:"--healthcheck"})," flag (used by Docker's HEALTHCHECK directive) and delegates to ",(0,t.jsx)(n.code,{children:"run()"}),"."]}),"\n",(0,t.jsxs)(n.h3,{id:"main_prodgo-build-tag-dev",children:[(0,t.jsx)(n.code,{children:"main_prod.go"})," (build tag: ",(0,t.jsx)(n.code,{children:"!dev"}),")"]}),"\n",(0,t.jsxs)(n.p,{children:["The production ",(0,t.jsx)(n.code,{children:"run()"})," function. Initializes all 13 service groups in order and starts the HTTP\nserver. Key steps:"]}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Step"}),(0,t.jsx)(n.th,{children:"Code"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"1"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"bootstrap.DefaultProdRuntimeConfig()"})}),(0,t.jsx)(n.td,{children:"Load Go runtime tuning (GOMAXPROCS, GC, memory limit)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"2"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"bootstrap.InitializeEventBus()"})}),(0,t.jsx)(n.td,{children:"Create Watermill event bus (buffer=256)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"3"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"bootstrap.InitializeDatabase()"})}),(0,t.jsx)(n.td,{children:"Open SQLite system.db, run migrations"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"4"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"zap.NewProductionConfig().Build()"})}),(0,t.jsx)(n.td,{children:"Create structured JSON logger"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"5"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"router.NewMockAdapter()"})}),(0,t.jsx)(n.td,{children:"Placeholder router port (ClientFactory TODO)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"6"}),(0,t.jsx)(n.td,{children:"Basic services"}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"troubleshootPkg.NewService"}),", ",(0,t.jsx)(n.code,{children:"services.NewInterfaceService"})]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"7"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"bootstrap.InitializeAlertSystem()"})}),(0,t.jsx)(n.td,{children:"Full alert stack"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"8"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"initProdServices()"})}),(0,t.jsx)(n.td,{children:"All 13 service groups"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"9"}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"server.New()"})," + ",(0,t.jsx)(n.code,{children:"ApplyProdMiddleware()"})]}),(0,t.jsx)(n.td,{children:"HTTP server"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"10"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:'fs.Sub(frontendFiles, "dist")'})}),(0,t.jsx)(n.td,{children:"Embedded frontend"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"11-13"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"setupProdRoutes()"})}),(0,t.jsx)(n.td,{children:"Route registration"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"14"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"bootstrap.NewShutdownCoordinator()"})}),(0,t.jsx)(n.td,{children:"Graceful shutdown wiring"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"15"}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"BootSequenceManager.ExecuteBootSequence()"})," (goroutine)"]}),(0,t.jsx)(n.td,{children:"Auto-start services"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"16"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"srv.Start(...)"})}),(0,t.jsx)(n.td,{children:"Start serving (blocks)"})]})]})]}),"\n",(0,t.jsxs)(n.h3,{id:"main_devgo-build-tag-dev",children:[(0,t.jsx)(n.code,{children:"main_dev.go"})," (build tag: ",(0,t.jsx)(n.code,{children:"dev"}),")"]}),"\n",(0,t.jsxs)(n.p,{children:["Simpler, flatter initialization without the ",(0,t.jsx)(n.code,{children:"bootstrap.*"})," abstraction. Initializes fewer services,\nenables CORS, starts GraphQL Playground at ",(0,t.jsx)(n.code,{children:"/playground"}),", uses debug-level logging."]}),"\n",(0,t.jsx)(n.h3,{id:"handlersgo",children:(0,t.jsx)(n.code,{children:"handlers.go"})}),"\n",(0,t.jsx)(n.p,{children:"HTTP handlers for REST endpoints (not GraphQL):"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Handler"}),(0,t.jsx)(n.th,{children:"Route"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"echoHealthHandler"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"GET /health"})}),(0,t.jsx)(n.td,{children:"Memory stats, version, uptime"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"echoScanHandler"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"POST /api/scan"})}),(0,t.jsx)(n.td,{children:"Start subnet scan"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"echoAutoScanHandler"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"POST /api/scan/auto"})}),(0,t.jsx)(n.td,{children:"Auto-detect subnet and scan"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"echoScanStatusHandler"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"GET /api/scan/status"})}),(0,t.jsx)(n.td,{children:"Get scan progress"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"echoScanStopHandler"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"POST /api/scan/stop"})}),(0,t.jsx)(n.td,{children:"Cancel active scan"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"echoRouterProxyHandler"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"ANY /api/router/proxy"})}),(0,t.jsx)(n.td,{children:"Proxy REST calls to MikroTik"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"echoBatchJobsHandler"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"ANY /api/batch/jobs"})}),(0,t.jsx)(n.td,{children:"Batch command execution"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"echoOUILookupHandler"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"GET /api/oui/:mac"})}),(0,t.jsx)(n.td,{children:"Vendor lookup by MAC"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"echoOUIBatchHandler"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"POST /api/oui/batch"})}),(0,t.jsx)(n.td,{children:"Batch MAC vendor lookup"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"echoOUIStatsHandler"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"GET /api/oui/stats"})}),(0,t.jsx)(n.td,{children:"OUI database stats"})]})]})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"ScannerPool"})," manages concurrent scan tasks with a worker pool:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:"type ScannerPool struct {\n    maxWorkers  int\n    tasks       chan *ScanTask\n    mu          sync.RWMutex\n    activeTasks map[string]*ScanTask\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"routes_prodgo",children:(0,t.jsx)(n.code,{children:"routes_prod.go"})}),"\n",(0,t.jsxs)(n.p,{children:["Aggregates all service dependencies into ",(0,t.jsx)(n.code,{children:"prodRoutesDeps"})," (a struct with ~50 fields), creates the\n",(0,t.jsx)(n.code,{children:"Resolver"}),", builds the GraphQL schema, wraps it with DataLoaders, and registers routes:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:"// HTTP routes registered:\nGET  /health\nPOST /graphql   \u2190 DataLoader-wrapped GraphQL handler\nGET  /graphql\nGET  /query\nPOST /api/scan\nPOST /api/scan/auto\nGET  /api/scan/status\nPOST /api/scan/stop\nANY  /api/router/proxy\nANY  /api/batch/jobs\nANY  /api/batch/jobs/*\nGET  /api/oui/:mac\nPOST /api/oui/batch\nGET  /api/oui/stats\nGET  /*         \u2190 SPA catch-all (frontend)\n"})}),"\n",(0,t.jsx)(n.h3,{id:"services_prodgo",children:(0,t.jsx)(n.code,{children:"services_prod.go"})}),"\n",(0,t.jsxs)(n.p,{children:["Top-level orchestration of 13 service groups via ",(0,t.jsx)(n.code,{children:"initProdServices()"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:"type prodServices struct {\n    storage      *bootstrap.StorageComponents\n    vif          *bootstrap.VIFComponents\n    orchestrator *bootstrap.OrchestratorComponents\n    routing      *bootstrap.RoutingComponents\n    updates      *bootstrap.UpdateComponents\n    templates    *bootstrap.TemplateComponents\n    core         *bootstrap.CoreComponents\n    diagnostics  *bootstrap.DiagnosticsComponents\n    network      *bootstrap.NetworkComponents\n    firewall     *bootstrap.FirewallComponents\n    monitoring   *bootstrap.MonitoringComponents\n    traffic      *bootstrap.TrafficComponents\n    scheduling   *bootstrap.SchedulingComponents\n    integration  *bootstrap.IntegrationComponents\n}\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"internalbootstrap-package",children:"internal/bootstrap/ Package"}),"\n",(0,t.jsxs)(n.p,{children:["Each file in ",(0,t.jsx)(n.code,{children:"internal/bootstrap/"})," corresponds to one subsystem and follows a consistent pattern:"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Define a ",(0,t.jsx)(n.code,{children:"XxxComponents"})," struct with all initialized values"]}),"\n",(0,t.jsxs)(n.li,{children:["Define an ",(0,t.jsx)(n.code,{children:"InitializeXxx(deps...)"})," function that returns ",(0,t.jsx)(n.code,{children:"(*XxxComponents, error)"})]}),"\n"]}),"\n",(0,t.jsxs)(n.h3,{id:"configgo--runtimeconfig",children:[(0,t.jsx)(n.code,{children:"config.go"})," \u2014 RuntimeConfig"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:"type RuntimeConfig struct {\n    GoMaxProcs         int    // OS threads\n    GCPercent          int    // GC frequency (10=aggressive)\n    MemoryLimitMB      int64  // Soft memory limit\n    ScannerWorkers     int    // Concurrent scan workers\n    EventBusBufferSize int    // Event bus channel buffer\n}\n\nfunc DefaultProdRuntimeConfig() RuntimeConfig  // GOMAXPROCS=1, GC=10%, MEM=32MB\nfunc DefaultDevRuntimeConfig() RuntimeConfig   // GOMAXPROCS=2, GC=100%, MEM=128MB\nfunc ApplyRuntimeConfig(cfg RuntimeConfig, logger) error\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Applied in ",(0,t.jsx)(n.code,{children:"init()"})," before ",(0,t.jsx)(n.code,{children:"run()"})," to tune Go runtime for the constrained MikroTik environment\n(",(0,t.jsx)(n.code,{children:"<50MB"})," RAM)."]}),"\n",(0,t.jsxs)(n.h3,{id:"databasego--database-initialization",children:[(0,t.jsx)(n.code,{children:"database.go"})," \u2014 Database Initialization"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:"type DatabaseConfig struct {\n    DataDir     string\n    IdleTimeout time.Duration\n}\n\nfunc InitializeDatabase(ctx, cfg) (*database.Manager, *ent.Client, error)\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Opens ",(0,t.jsx)(n.code,{children:"system.db"})," in ",(0,t.jsx)(n.code,{children:"$NASNET_DATA_DIR"}),", runs migrations via ",(0,t.jsx)(n.code,{children:"client.Schema.Create(ctx)"}),", and\nvalidates integrity. Returns both the ",(0,t.jsx)(n.code,{children:"Manager"})," (for shutdown) and ",(0,t.jsx)(n.code,{children:"*ent.Client"})," (for service\ninjection)."]}),"\n",(0,t.jsx)(n.p,{children:"[See: data-layer.md \xa7Database Manager]"}),"\n",(0,t.jsxs)(n.h3,{id:"eventsgo--event-bus",children:[(0,t.jsx)(n.code,{children:"events.go"})," \u2014 Event Bus"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:"func InitializeEventBus(bufferSize int) (events.EventBus, error)\nfunc CreatePublisher(bus events.EventBus, component string) *events.Publisher\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Creates a Watermill in-process event bus. ",(0,t.jsx)(n.code,{children:"CreatePublisher"})," is a helper used throughout bootstrap to\ncreate typed publishers for each subsystem."]}),"\n",(0,t.jsx)(n.p,{children:"[See: event-system.md]"}),"\n",(0,t.jsxs)(n.h3,{id:"alertsgo--alert-system",children:[(0,t.jsx)(n.code,{children:"alerts.go"})," \u2014 Alert System"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:"type AlertComponents struct {\n    Dispatcher               *notifications.Dispatcher\n    EscalationEngine         *alerts.EscalationEngine\n    DigestService            *alerts.DigestService\n    DigestScheduler          *alerts.DigestScheduler\n    AlertService             *services.AlertService\n    AlertTemplateService     *services.AlertTemplateService\n    TemplateService          notifications.TemplateRenderer\n    AlertRuleTemplateService *alerts.AlertRuleTemplateService\n    AlertEngine              *alerts.Engine\n}\n\nfunc InitializeAlertSystem(ctx, systemDB, eventBus, logger) (*AlertComponents, error)\n"})}),"\n",(0,t.jsx)(n.p,{children:"Initializes the complete alert stack in sequence:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Notification channels (email, telegram, pushover, webhook, in-app)"}),"\n",(0,t.jsx)(n.li,{children:"Template service (notification message formatting)"}),"\n",(0,t.jsx)(n.li,{children:"Dispatcher (route alerts to channels, retry with backoff)"}),"\n",(0,t.jsx)(n.li,{children:"Escalation engine (auto-escalate unacknowledged alerts)"}),"\n",(0,t.jsx)(n.li,{children:"Digest service (batch notification delivery)"}),"\n",(0,t.jsx)(n.li,{children:"Digest scheduler (periodic digest delivery)"}),"\n",(0,t.jsx)(n.li,{children:"Alert service (CRUD + acknowledgement)"}),"\n",(0,t.jsx)(n.li,{children:"Alert rule template service (15 built-in rule templates)"}),"\n",(0,t.jsx)(n.li,{children:"Alert engine (evaluates rules against incoming events)"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"[See: alert-system.md]"}),"\n",(0,t.jsxs)(n.h3,{id:"storagego--storage-infrastructure",children:[(0,t.jsx)(n.code,{children:"storage.go"})," \u2014 Storage Infrastructure"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:"type StorageComponents struct {\n    Detector      *storage.StorageDetector\n    Service       *storage.StorageConfigService\n    PathResolver  storage.PathResolverPort\n    BootValidator *boot.BootValidator\n}\n\nfunc InitializeStorage(ctx, systemDB, eventBus, logger) (*StorageComponents, error)\n"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"StorageDetector"})," \u2014 monitors mount points (",(0,t.jsx)(n.code,{children:"/data"}),", ",(0,t.jsx)(n.code,{children:"/usb1"}),", ",(0,t.jsx)(n.code,{children:"/disk1"}),", ",(0,t.jsx)(n.code,{children:"/disk2"}),") for external\nstorage"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"StorageConfigService"})," \u2014 persists storage configuration in SQLite"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"PathResolver"})," \u2014 resolves binary/config/data file paths dynamically (flash vs external storage)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"BootValidator"})," \u2014 validates that all enabled service instance binaries exist before boot"]}),"\n"]}),"\n",(0,t.jsxs)(n.h3,{id:"vifgo--virtual-interface-factory",children:[(0,t.jsx)(n.code,{children:"vif.go"})," \u2014 Virtual Interface Factory"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:"type VIFComponents struct {\n    NetworkVLANAllocator *network.VLANAllocator\n    VLANAllocator        vif.VLANAllocator      // adapter\n    InterfaceFactory     *vif.InterfaceFactory\n    GatewayManager       lifecycle.GatewayPort\n    BridgeOrchestrator   *vif.BridgeOrchestrator\n    IngressService       *ingress.Service\n    KillSwitchManager    *isolation.KillSwitchManager\n}\n\nfunc InitializeVIF(ctx, systemDB, eventBus, pathResolver, routerPort, logger) (*VIFComponents, error)\n"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["DB-backed ",(0,t.jsx)(n.code,{children:"network.VLANAllocator"})," (shared with orchestrator to avoid double-allocation)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"vif.NewNetworkVLANAllocatorAdapter"})," \u2014 wraps it for the VIF package interface"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"InterfaceFactory"})," \u2014 creates VLAN interfaces on MikroTik router"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"GatewayManager"})," \u2014 manages ",(0,t.jsx)(n.code,{children:"hev-socks5-tunnel"})," processes"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"dhcp.Server"})," \u2014 DHCP server for isolated VLANs"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"ingress.Service"})," \u2014 ingress traffic routing"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"BridgeOrchestrator"})," \u2014 end-to-end VIF creation coordinator"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"KillSwitchManager"})," + ",(0,t.jsx)(n.code,{children:"KillSwitchListener"})," \u2014 isolation kill switch"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"[See: virtual-interface-factory.md]"}),"\n",(0,t.jsxs)(n.h3,{id:"orchestratorgo--service-orchestrator",children:[(0,t.jsx)(n.code,{children:"orchestrator.go"})," \u2014 Service Orchestrator"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:"type OrchestratorComponents struct {\n    FeatureRegistry     *features.FeatureRegistry\n    DownloadManager     *features.DownloadManager\n    ProcessSupervisor   *supervisor.ProcessSupervisor\n    PortRegistry        *network.PortRegistry\n    VLANAllocator       *network.VLANAllocator      // same instance as VIF\n    ConfigValidator     *isolation.ConfigValidatorAdapter\n    IsolationVerifier   *isolation.IsolationVerifier\n    ResourceLimiter     *resources.ResourceLimiter\n    ResourceManager     *resources.ResourceManager\n    ResourcePoller      *resources.ResourcePoller\n    InstanceManager     *lifecycle.InstanceManager\n    DependencyManager   *dependencies.DependencyManager\n    BootSequenceManager *boot.BootSequenceManager\n}\n\nfunc InitializeOrchestrator(systemDB, eventBus, pathResolver, gatewayManager,\n    bridgeOrchestrator, vlanAllocator, routerPort, logger) (*OrchestratorComponents, error)\n"})}),"\n",(0,t.jsx)(n.p,{children:"11-step initialization:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"FeatureRegistry"})," \u2014 loads 6 feature manifests (Tor, sing-box, Xray, MTProxy, Psiphon, AdGuard)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"DownloadManager"})," \u2014 binary download with GPG verification"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"ProcessSupervisor"})," \u2014 OS-level process management with auto-restart"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"PortRegistry"})," \u2014 prevents port conflicts (reserves 22, 53, 80, 443, 8080, 8291, 8728, 8729)"]}),"\n",(0,t.jsx)(n.li,{children:"VLAN allocator received (from VIF, not re-created)"}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"ConfigValidatorAdapter"})," \u2014 validates service-specific config bindings"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"IsolationVerifier"})," \u2014 4-layer isolation defense (IP/directory/port/process)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"ResourceLimiter"})," \u2014 cgroups v2 memory limits 8a. ",(0,t.jsx)(n.code,{children:"ResourceManager"})," \u2014 system resource detection +\npre-flight checks 8b. ",(0,t.jsx)(n.code,{children:"ResourcePoller"})," \u2014 resource usage monitoring 8c. GitHub client \u2014 for\nfetching release binaries 8d. ",(0,t.jsx)(n.code,{children:"IsolationStrategy"})," \u2014 detects best OS isolation strategy"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"InstanceManager"})," \u2014 orchestrates complete service instance lifecycle"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"DependencyManager"})," \u2014 manages service dependency relationships"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"BootSequenceManager"})," \u2014 ordered startup on system boot"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"[See: service-orchestrator.md]"}),"\n",(0,t.jsxs)(n.h3,{id:"routinggo--routing-engine",children:[(0,t.jsx)(n.code,{children:"routing.go"})," \u2014 Routing Engine"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:"type RoutingComponents struct {\n    ChainRouter          *routing.ChainRouter\n    PBREngine            *routing.PBREngine\n    RoutingMatrixSvc     *routing.RoutingMatrixService\n    ChainLatencyMeasurer *routing.ChainLatencyMeasurer\n}\n\nfunc InitializeRouting(systemDB, eventBus, routerPort, featureRegistry, logger) (*RoutingComponents, error)\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"ChainRouter"})," \u2014 multi-hop chain routing"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"PBREngine"})," \u2014 policy-based routing via MikroTik mangle rules"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"RoutingMatrixSvc"})," \u2014 device routing assignment view"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"ChainLatencyMeasurer"})," \u2014 latency probes for chain hops"]}),"\n"]}),"\n",(0,t.jsxs)(n.h3,{id:"corego--core-services",children:[(0,t.jsx)(n.code,{children:"core.go"})," \u2014 Core Services"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:"type CoreComponents struct {\n    AuthService       *auth.Service       // nil in prod (optional)\n    ScannerService    *scanner.ScannerService\n    CapabilityService *capability.Service\n    RouterService     *services.RouterService\n    CredentialService *credentials.Service\n}\n\nfunc InitializeCoreServices(systemDB, eventBus, routerPort, logger, encryptionService) (*CoreComponents, error)\n"})}),"\n",(0,t.jsxs)(n.h3,{id:"integrationgo--integration-services",children:[(0,t.jsx)(n.code,{children:"integration.go"})," \u2014 Integration Services"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:"type IntegrationComponents struct {\n    WebhookService    *integration.Service\n    SharingService    *sharing.Service\n    ConfigService     *config.Service\n    CredentialService *credentials.Service\n}\n\nfunc InitializeIntegrationServices(...) (*IntegrationComponents, error)\n"})}),"\n",(0,t.jsx)(n.p,{children:"Webhook service includes AES-256-GCM encryption for secrets and SSRF protection."}),"\n",(0,t.jsxs)(n.h3,{id:"shutdowngo--graceful-shutdown",children:[(0,t.jsx)(n.code,{children:"shutdown.go"})," \u2014 Graceful Shutdown"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:"type ShutdownCoordinator struct { ... }\n\nfunc NewShutdownCoordinator(dbManager, eventBus, alertEngine, digestScheduler,\n    updateScheduler, storageDetector, logger) *ShutdownCoordinator\n\nfunc (s *ShutdownCoordinator) WithTrafficAggregator(agg) *ShutdownCoordinator\nfunc (s *ShutdownCoordinator) Shutdown(ctx context.Context) error\n"})}),"\n",(0,t.jsx)(n.p,{children:"Shutdown runs in two phases with a 15-second timeout:"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Phase 1: Stop event sources"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Alert engine (prevents new evaluations)"}),"\n",(0,t.jsx)(n.li,{children:"Update scheduler (cancels pending version checks)"}),"\n",(0,t.jsx)(n.li,{children:"Storage detector (stops mount monitoring)"}),"\n",(0,t.jsx)(n.li,{children:"Digest scheduler (cancels notification timers)"}),"\n",(0,t.jsx)(n.li,{children:"Traffic aggregator (flushes buffered traffic to DB)"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Phase 2: Drain and close"})," 6. Event bus (flush all pending events) 7. Database (close all\nconnections)"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"service-initialization-order",children:"Service Initialization Order"}),"\n",(0,t.jsx)(n.p,{children:"The order matters \u2014 services are listed from first to last, with the reason for ordering:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"1.  RuntimeConfig       \u2190 Must run in init() before anything else\n2.  EventBus            \u2190 All services need to publish/subscribe\n3.  Database (SQLite)   \u2190 All services write to it; must be ready first\n4.  Logger (zap)        \u2190 Needed by all services for structured logging\n5.  MockRouterAdapter   \u2190 Placeholder; services accept it as RouterPort\n6.  AlertSystem         \u2190 Started early; needs eventBus + DB\n7.  EncryptionService   \u2190 Needed by credentials and integration\n8.  Storage + VIF       \u2190 VIF VLAN allocator shared with orchestrator\n9.  Orchestrator        \u2190 Depends on storage.PathResolver + vif.BridgeOrchestrator\n10. Routing             \u2190 Depends on orchestrator.FeatureRegistry\n11. Updates + Templates \u2190 Depends on storage.PathResolver\n12. Core + Diagnostics  \u2190 Auth, scanner, capability (relatively independent)\n13. Network + Firewall  \u2190 IP address, WAN, bridge, VLAN services\n14. Monitoring + Traffic + Scheduling \u2190 Depends on VIF traffic components\n15. Integration         \u2190 Webhook, sharing, config (depends on encryption + orchestrator)\n16. HTTP Server         \u2190 Started after all services are ready\n17. Boot Sequence       \u2190 Goroutine; auto-starts enabled service instances\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"dependency-injection-pattern",children:"Dependency Injection Pattern"}),"\n",(0,t.jsxs)(n.p,{children:["NasNet uses ",(0,t.jsx)(n.strong,{children:"manual dependency injection"})," (no DI framework). The pattern is:"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Each subsystem's ",(0,t.jsx)(n.code,{children:"InitializeXxx()"})," function accepts its dependencies as parameters"]}),"\n",(0,t.jsx)(n.li,{children:"Dependencies are initialized in order (parents before children)"}),"\n",(0,t.jsxs)(n.li,{children:["The ",(0,t.jsx)(n.code,{children:"prodRoutesDeps"})," struct aggregates everything before route registration"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:"// Example: Orchestrator receives pre-built dependencies\norchestrator, err := bootstrap.InitializeOrchestrator(\n    systemDB,            // from InitializeDatabase\n    eventBus,            // from InitializeEventBus\n    storage.PathResolver, // from InitializeStorage\n    vif.GatewayManager,  // from InitializeVIF\n    vif.BridgeOrchestrator,\n    vif.NetworkVLANAllocator, // shared VLAN allocator\n    routerPort,\n    logger,\n)\n"})}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"wire_*.go"})," files in ",(0,t.jsx)(n.code,{children:"internal/bootstrap/"})," are Wire-generated dependency injection helpers\n(Google Wire). They describe the dependency graph declaratively and can regenerate the wiring code."]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"configuration-loading",children:"Configuration Loading"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Config"}),(0,t.jsx)(n.th,{children:"Source"}),(0,t.jsx)(n.th,{children:"Default"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"PORT"})}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"$PORT"})," env var"]}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"80"})," (prod), ",(0,t.jsx)(n.code,{children:"8080"})," (dev)"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"NASNET_DATA_DIR"})}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"$NASNET_DATA_DIR"})," env var"]}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"/var/nasnet"})," (prod), ",(0,t.jsx)(n.code,{children:"./data"})," (dev)"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"DB_ENCRYPTION_KEY"})}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"$DB_ENCRYPTION_KEY"})," env var"]}),(0,t.jsx)(n.td,{children:"Auto dummy key (warns in log)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"GOMAXPROCS"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"RuntimeConfig.GoMaxProcs"})}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"1"})," (prod), ",(0,t.jsx)(n.code,{children:"2"})," (dev)"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"GCPercent"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"RuntimeConfig.GCPercent"})}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"10"})," (prod), ",(0,t.jsx)(n.code,{children:"100"})," (dev)"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"MemoryLimit"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"RuntimeConfig.MemoryLimitMB"})}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"32"})," MB (prod), ",(0,t.jsx)(n.code,{children:"128"})," MB (dev)"]})]})]})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,t.jsxs)(n.p,{children:["Bootstrap functions return ",(0,t.jsx)(n.code,{children:"error"})," for fatal conditions. Any error in ",(0,t.jsx)(n.code,{children:"run()"})," calls ",(0,t.jsx)(n.code,{children:"log.Fatalf()"}),"\nor ",(0,t.jsx)(n.code,{children:"sugar.Fatalw()"}),", which exits the process. Non-fatal issues (e.g., credential service failing due\nto missing key) are logged as warnings and the service starts with reduced functionality."]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"testing",children:"Testing"}),"\n",(0,t.jsx)(n.p,{children:"Bootstrap code is integration-tested. Unit tests for individual subsystems are in their respective\npackages. The bootstrap layer itself is tested via:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"go test -tags=dev ./internal/bootstrap/...\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Some bootstrap functions have testable initialization paths \u2014 for example, ",(0,t.jsx)(n.code,{children:"InitializeDatabase"})," can\nbe called with a temp directory in tests."]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"cross-references",children:"Cross-References"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"[See: getting-started.md \xa7Step-by-Step Startup Sequence]"}),"\n",(0,t.jsx)(n.li,{children:"[See: event-system.md \xa7EventBus] \u2014 How the event bus works internally"}),"\n",(0,t.jsx)(n.li,{children:"[See: service-orchestrator.md \xa7BootSequenceManager] \u2014 Auto-start service ordering"}),"\n",(0,t.jsx)(n.li,{children:"[See: virtual-interface-factory.md \xa7VIFComponents] \u2014 VIF subsystem details"}),"\n",(0,t.jsx)(n.li,{children:"[See: alert-system.md \xa7AlertComponents] \u2014 Alert stack components"}),"\n",(0,t.jsx)(n.li,{children:"[See: data-layer.md \xa7Database Manager] \u2014 SQLite manager and migrations"}),"\n",(0,t.jsx)(n.li,{children:"[See: security.md \xa7Encryption] \u2014 Credential encryption details"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}}}]);