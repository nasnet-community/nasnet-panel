"use strict";(globalThis.webpackChunk_nas_net_docs=globalThis.webpackChunk_nas_net_docs||[]).push([[90536],{36718:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>i,metadata:()=>o,toc:()=>l});const o=JSON.parse('{"id":"notifications-webhooks","title":"Notifications and Webhooks \u2014 Alert Delivery Integration","description":"This document covers the webhook management system that integrates with the alerts feature. Webhooks","source":"@site/../../libs/api-client/docs/notifications-webhooks.md","sourceDirName":".","slug":"/notifications-webhooks","permalink":"/docs/api-client/notifications-webhooks","draft":false,"unlisted":false,"editUrl":"https://github.com/nasnet-community/nasnet-panel/tree/main/../../libs/api-client/docs/notifications-webhooks.md","tags":[],"version":"current","sidebarPosition":14,"frontMatter":{"sidebar_position":14,"title":"Notifications and Webhooks \u2014 Alert Delivery Integration"},"sidebar":"sidebar","previous":{"title":"TanStack Query Modules \u2014 REST-Only Endpoints","permalink":"/docs/api-client/tanstack-query-modules"},"next":{"title":"Domain Query Hooks","permalink":"/docs/api-client/domain-query-hooks"}}');var s=t(31085),r=t(71184);const i={sidebar_position:14,title:"Notifications and Webhooks \u2014 Alert Delivery Integration"},a="Notifications and Webhooks",d={},l=[{value:"Overview",id:"overview",level:2},{value:"Types",id:"types",level:2},{value:"Webhook",id:"webhook",level:3},{value:"NotificationLog",id:"notificationlog",level:3},{value:"Webhook Input Types",id:"webhook-input-types",level:3},{value:"WebhookTestResult",id:"webhooktestresult",level:3},{value:"GraphQL Fragments",id:"graphql-fragments",level:2},{value:"WEBHOOK_FIELDS",id:"webhook_fields",level:3},{value:"NOTIFICATION_LOG_FIELDS",id:"notification_log_fields",level:3},{value:"Query Hooks",id:"query-hooks",level:2},{value:"useWebhooks",id:"usewebhooks",level:3},{value:"useWebhook",id:"usewebhook",level:3},{value:"useNotificationLogs",id:"usenotificationlogs",level:3},{value:"Mutation Hooks",id:"mutation-hooks",level:2},{value:"useCreateWebhook",id:"usecreatewebhook",level:3},{value:"useUpdateWebhook",id:"useupdatewebhook",level:3},{value:"useDeleteWebhook",id:"usedeletewebhook",level:3},{value:"useTestWebhook",id:"usetestwebhook",level:3},{value:"Cache Update Strategies",id:"cache-update-strategies",level:2},{value:"Add to List (on Create)",id:"add-to-list-on-create",level:3},{value:"In-Place Update (on Update)",id:"in-place-update-on-update",level:3},{value:"Evict + GC (on Delete)",id:"evict--gc-on-delete",level:3},{value:"Integration with Alerts",id:"integration-with-alerts",level:2},{value:"Template Types",id:"template-types",level:2},{value:"Error Codes",id:"error-codes",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"Cross-References",id:"cross-references",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"notifications-and-webhooks",children:"Notifications and Webhooks"})}),"\n",(0,s.jsx)(n.p,{children:"This document covers the webhook management system that integrates with the alerts feature. Webhooks\nallow NasNetConnect to deliver alert notifications to external services like Slack, Discord, custom\nHTTP endpoints, and email gateways via HTTP POST."}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Reference:"})," ",(0,s.jsx)(n.code,{children:"libs/api-client/queries/src/notifications/webhooks.ts"})]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsx)(n.p,{children:"The notification system has two layers:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Webhook Configuration"})," \u2014 CRUD operations on webhook endpoints, templates, auth, and retry\nsettings"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Notification Logs"})," \u2014 Audit trail of all webhook deliveries, including response times and\nerrors"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"types",children:"Types"}),"\n",(0,s.jsx)(n.h3,{id:"webhook",children:"Webhook"}),"\n",(0,s.jsx)(n.p,{children:"Core webhook definition with delivery statistics:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"export interface Webhook {\n  id: string;\n  name: string;\n  description?: string;\n  url: string;\n  method: string; // HTTP method: GET, POST, etc.\n  authType: 'NONE' | 'BASIC' | 'BEARER';\n  username?: string;\n  bearerToken?: string; // sensitive: redacted in logs\n  headers?: Record<string, string>;\n  template: 'GENERIC' | 'SLACK' | 'DISCORD' | 'TEAMS' | 'CUSTOM';\n  customTemplate?: string; // custom JSON payload template\n  signingSecretMasked?: string; // HMAC-SHA256 secret (masked)\n  timeoutSeconds: number;\n  retryEnabled: boolean;\n  maxRetries: number;\n  enabled: boolean;\n  createdAt: string; // ISO 8601 datetime\n  updatedAt: string;\n  lastDeliveredAt?: string;\n  deliveryStats?: WebhookDeliveryStats;\n}\n\nexport interface WebhookDeliveryStats {\n  totalAttempts: number;\n  successCount: number;\n  failureCount: number;\n  successRate: number; // 0.0\u20131.0\n  avgResponseTimeMs?: number;\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"notificationlog",children:"NotificationLog"}),"\n",(0,s.jsx)(n.p,{children:"Record of a single delivery attempt:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"export interface NotificationLog {\n  id: string;\n  alertId: string; // Alert that triggered this notification\n  channel: string; // e.g., 'webhook', 'email', 'sms'\n  webhookId?: string; // Reference to webhook if delivery via webhook\n  status: 'PENDING' | 'SENT' | 'FAILED' | 'RETRYING';\n  statusCode?: number; // HTTP status code\n  responseTimeMs?: number; // Response latency\n  errorMessage?: string;\n  retryCount: number; // Number of retries attempted\n  requestPayload?: Record<string, unknown>; // What was sent\n  responseBody?: string;\n  attemptedAt: string; // ISO 8601 timestamp\n  completedAt?: string; // When delivery completed (or failed finally)\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"webhook-input-types",children:"Webhook Input Types"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"CreateWebhookInput:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"export interface CreateWebhookInput {\n  name: string;\n  description?: string;\n  url: string;\n  method?: string; // default: 'POST'\n  authType?: 'NONE' | 'BASIC' | 'BEARER';\n  username?: string;\n  password?: string; // @sensitive\n  bearerToken?: string; // @sensitive\n  headers?: Record<string, string>;\n  template?: 'GENERIC' | 'SLACK' | 'DISCORD' | 'TEAMS' | 'CUSTOM';\n  customTemplate?: string;\n  signingSecret?: string; // @sensitive, for HMAC signing\n  timeoutSeconds?: number; // default: 10\n  retryEnabled?: boolean; // default: true\n  maxRetries?: number; // default: 3\n  enabled?: boolean; // default: true\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"UpdateWebhookInput:"})}),"\n",(0,s.jsx)(n.p,{children:"All fields from CreateWebhookInput are optional for updates."}),"\n",(0,s.jsx)(n.h3,{id:"webhooktestresult",children:"WebhookTestResult"}),"\n",(0,s.jsx)(n.p,{children:"Response from testing a webhook:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"export interface WebhookTestResult {\n  success: boolean;\n  statusCode?: number;\n  responseBody?: string;\n  responseTimeMs?: number;\n  errorMessage?: string;\n}\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"graphql-fragments",children:"GraphQL Fragments"}),"\n",(0,s.jsx)(n.h3,{id:"webhook_fields",children:"WEBHOOK_FIELDS"}),"\n",(0,s.jsx)(n.p,{children:"Reusable fragment selecting all webhook fields including delivery stats:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:"fragment WebhookFields on Webhook {\n  id\n  name\n  description\n  url\n  method\n  authType\n  username\n  bearerToken\n  headers\n  template\n  customTemplate\n  signingSecretMasked\n  timeoutSeconds\n  retryEnabled\n  maxRetries\n  enabled\n  createdAt\n  updatedAt\n  lastDeliveredAt\n  deliveryStats {\n    totalAttempts\n    successCount\n    failureCount\n    successRate\n    avgResponseTimeMs\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"notification_log_fields",children:"NOTIFICATION_LOG_FIELDS"}),"\n",(0,s.jsx)(n.p,{children:"Fragment for notification logs:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:"fragment NotificationLogFields on NotificationLog {\n  id\n  alertId\n  channel\n  webhookId\n  status\n  statusCode\n  responseTimeMs\n  errorMessage\n  retryCount\n  requestPayload\n  responseBody\n  attemptedAt\n  completedAt\n}\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"query-hooks",children:"Query Hooks"}),"\n",(0,s.jsx)(n.h3,{id:"usewebhooks",children:"useWebhooks"}),"\n",(0,s.jsx)(n.p,{children:"Fetch all webhooks for the current router/account:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"export function useWebhooks(\n  options?: QueryHookOptions<{ webhooks: Webhook[] }, Record<string, never>>\n): UseQueryResult<{ webhooks: Webhook[] }, ...>\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Example:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { useWebhooks } from '@nasnet/api-client/queries';\n\nfunction WebhookList() {\n  const { data, isLoading, error } = useWebhooks();\n\n  if (isLoading) return <Spinner />;\n  if (error) return <ErrorAlert error={error} />;\n\n  const { webhooks } = data!;\n\n  return (\n    <table>\n      <thead>\n        <tr>\n          <th>Name</th>\n          <th>Template</th>\n          <th>Status</th>\n          <th>Success Rate</th>\n          <th>Actions</th>\n        </tr>\n      </thead>\n      <tbody>\n        {webhooks.map((webhook) => (\n          <tr key={webhook.id}>\n            <td>{webhook.name}</td>\n            <td>{webhook.template}</td>\n            <td>\n              <Badge status={webhook.enabled ? 'success' : 'warning'}>\n                {webhook.enabled ? 'Enabled' : 'Disabled'}\n              </Badge>\n            </td>\n            <td>\n              {webhook.deliveryStats && (\n                `${(webhook.deliveryStats.successRate * 100).toFixed(1)}%`\n              )}\n            </td>\n            <td>\n              <EditButton webhookId={webhook.id} />\n              <DeleteButton webhookId={webhook.id} />\n            </td>\n          </tr>\n        ))}\n      </tbody>\n    </table>\n  );\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"usewebhook",children:"useWebhook"}),"\n",(0,s.jsx)(n.p,{children:"Fetch a single webhook by ID:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"export function useWebhook(\n  id: string,\n  options?: QueryHookOptions<{ webhook: Webhook | null }, { id: string }>\n): UseQueryResult<{ webhook: Webhook | null }, ...>\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Example:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { useWebhook } from '@nasnet/api-client/queries';\n\nfunction WebhookDetail({ webhookId }: { webhookId: string }) {\n  const { data, isLoading, error } = useWebhook(webhookId);\n\n  if (isLoading) return <Spinner />;\n  if (error) return <ErrorAlert error={error} />;\n\n  const { webhook } = data!;\n\n  return (\n    <form>\n      <h2>{webhook?.name}</h2>\n      <p>URL: {webhook?.url}</p>\n      <p>Template: {webhook?.template}</p>\n      <p>Success Rate: {webhook?.deliveryStats?.successRate.toFixed(2)}</p>\n      {webhook?.description && (\n        <p>Description: {webhook.description}</p>\n      )}\n    </form>\n  );\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"usenotificationlogs",children:"useNotificationLogs"}),"\n",(0,s.jsx)(n.p,{children:"Fetch notification logs with optional filtering:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"export function useNotificationLogs(\n  variables?: {\n    channel?: string;\n    webhookId?: string;\n    status?: 'PENDING' | 'SENT' | 'FAILED' | 'RETRYING';\n    limit?: number;\n  },\n  options?: Omit<QueryHookOptions, 'variables'>\n): UseQueryResult<{ notificationLogs: NotificationLog[] }, ...>\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Example:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { useNotificationLogs } from '@nasnet/api-client/queries';\n\nfunction WebhookDeliveryLog({ webhookId }: { webhookId: string }) {\n  const { data, isLoading } = useNotificationLogs(\n    { webhookId, limit: 50, status: 'FAILED' },  // Show last 50 failures\n    { refetchInterval: 10000 }  // Refetch every 10 seconds\n  );\n\n  if (isLoading) return <Spinner />;\n\n  const { notificationLogs } = data!;\n\n  return (\n    <table>\n      <thead>\n        <tr>\n          <th>Timestamp</th>\n          <th>Alert ID</th>\n          <th>Status</th>\n          <th>Response Time</th>\n          <th>Error</th>\n        </tr>\n      </thead>\n      <tbody>\n        {notificationLogs.map((log) => (\n          <tr key={log.id}>\n            <td>{new Date(log.attemptedAt).toLocaleString()}</td>\n            <td>{log.alertId}</td>\n            <td>\n              <Badge status={log.status === 'SENT' ? 'success' : 'error'}>\n                {log.status}\n              </Badge>\n            </td>\n            <td>{log.responseTimeMs}ms</td>\n            <td>{log.errorMessage || '\u2014'}</td>\n          </tr>\n        ))}\n      </tbody>\n    </table>\n  );\n}\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"mutation-hooks",children:"Mutation Hooks"}),"\n",(0,s.jsx)(n.h3,{id:"usecreatewebhook",children:"useCreateWebhook"}),"\n",(0,s.jsx)(n.p,{children:"Create a new webhook:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"export function useCreateWebhook(\n  options?: MutationHookOptions<\n    {\n      createWebhook: {\n        webhook: Webhook | null;\n        errors: FieldError[];\n      };\n    },\n    { input: CreateWebhookInput }\n  >\n): UseMutationResult<...>\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Cache behavior:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["On success, automatically adds the new webhook to the ",(0,s.jsx)(n.code,{children:"GET_WEBHOOKS"})," cache"]}),"\n",(0,s.jsxs)(n.li,{children:["Calls user-provided ",(0,s.jsx)(n.code,{children:"update"})," function if provided"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Example:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'import { useCreateWebhook } from \'@nasnet/api-client/queries\';\n\nfunction CreateWebhookForm() {\n  const { register, handleSubmit, formState: { errors } } = useForm<CreateWebhookInput>({\n    resolver: zodResolver(CreateWebhookInputSchema),\n  });\n\n  const createWebhook = useCreateWebhook({\n    onSuccess: (data) => {\n      if (data.createWebhook.errors.length > 0) {\n        showErrorToast(\'Validation errors\', data.createWebhook.errors);\n      } else {\n        showSuccessToast(`Webhook "${data.createWebhook.webhook?.name}" created`);\n        // Reset form or navigate\n      }\n    },\n  });\n\n  const onSubmit = (input: CreateWebhookInput) => {\n    createWebhook.mutate({ input });\n  };\n\n  return (\n    <form onSubmit={handleSubmit(onSubmit)}>\n      <input\n        {...register(\'name\')}\n        placeholder="Webhook name"\n      />\n      {errors.name && <p>{errors.name.message}</p>}\n\n      <input\n        {...register(\'url\')}\n        placeholder="https://hooks.slack.com/..."\n        type="url"\n      />\n      {errors.url && <p>{errors.url.message}</p>}\n\n      <select {...register(\'template\')}>\n        <option value="GENERIC">Generic</option>\n        <option value="SLACK">Slack</option>\n        <option value="DISCORD">Discord</option>\n        <option value="TEAMS">Microsoft Teams</option>\n        <option value="CUSTOM">Custom JSON</option>\n      </select>\n\n      <button type="submit" disabled={createWebhook.isPending}>\n        {createWebhook.isPending ? \'Creating...\' : \'Create Webhook\'}\n      </button>\n    </form>\n  );\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"useupdatewebhook",children:"useUpdateWebhook"}),"\n",(0,s.jsx)(n.p,{children:"Update an existing webhook:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"export function useUpdateWebhook(\n  options?: MutationHookOptions<\n    {\n      updateWebhook: {\n        webhook: Webhook | null;\n        errors: FieldError[];\n      };\n    },\n    { id: string; input: UpdateWebhookInput }\n  >\n): UseMutationResult<...>\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Cache behavior:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["On success, updates the specific webhook in cache via ",(0,s.jsx)(n.code,{children:"GET_WEBHOOK"})," query"]}),"\n",(0,s.jsxs)(n.li,{children:["Calls user-provided ",(0,s.jsx)(n.code,{children:"update"})," function if provided"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Example:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { useUpdateWebhook } from '@nasnet/api-client/queries';\n\nfunction EditWebhookForm({ webhookId }: { webhookId: string }) {\n  const { data } = useWebhook(webhookId);\n  const { register, handleSubmit, formState: { errors } } = useForm<UpdateWebhookInput>({\n    defaultValues: data?.webhook,\n  });\n\n  const updateWebhook = useUpdateWebhook({\n    onSuccess: (data) => {\n      if (data.updateWebhook.errors.length > 0) {\n        showErrorToast('Validation errors', data.updateWebhook.errors);\n      } else {\n        showSuccessToast(`Webhook updated`);\n      }\n    },\n  });\n\n  const onSubmit = (input: UpdateWebhookInput) => {\n    updateWebhook.mutate({ id: webhookId, input });\n  };\n\n  return (\n    <form onSubmit={handleSubmit(onSubmit)}>\n      {/* Form fields */}\n      <button type=\"submit\" disabled={updateWebhook.isPending}>\n        {updateWebhook.isPending ? 'Saving...' : 'Save'}\n      </button>\n    </form>\n  );\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"usedeletewebhook",children:"useDeleteWebhook"}),"\n",(0,s.jsx)(n.p,{children:"Delete a webhook:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"export function useDeleteWebhook(\n  options?: MutationHookOptions<\n    {\n      deleteWebhook: {\n        success: boolean;\n        deletedId: string | null;\n        errors: FieldError[];\n      };\n    },\n    { id: string }\n  >\n): UseMutationResult<...>\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Cache behavior:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["On success: Evicts the deleted webhook from cache via ",(0,s.jsx)(n.code,{children:"cache.evict()"})," and ",(0,s.jsx)(n.code,{children:"cache.gc()"})]}),"\n",(0,s.jsxs)(n.li,{children:["Updates the ",(0,s.jsx)(n.code,{children:"GET_WEBHOOKS"})," list to remove the deleted item"]}),"\n",(0,s.jsxs)(n.li,{children:["Calls user-provided ",(0,s.jsx)(n.code,{children:"update"})," function if provided"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Example:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { useDeleteWebhook } from '@nasnet/api-client/queries';\n\nfunction DeleteWebhookButton({ webhookId, webhookName }: Props) {\n  const [isOpen, setIsOpen] = useState(false);\n\n  const deleteWebhook = useDeleteWebhook({\n    onSuccess: (data) => {\n      if (data.deleteWebhook.success) {\n        showSuccessToast(`Webhook deleted`);\n        setIsOpen(false);\n        // Navigate back to list\n      } else {\n        showErrorToast('Failed to delete webhook');\n      }\n    },\n  });\n\n  return (\n    <>\n      <button onClick={() => setIsOpen(true)}>\n        Delete\n      </button>\n\n      <ConfirmDialog\n        isOpen={isOpen}\n        title=\"Delete Webhook?\"\n        message={`Are you sure you want to delete \"${webhookName}\"?`}\n        onConfirm={() => deleteWebhook.mutate({ id: webhookId })}\n        onCancel={() => setIsOpen(false)}\n        isLoading={deleteWebhook.isPending}\n      />\n    </>\n  );\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"usetestwebhook",children:"useTestWebhook"}),"\n",(0,s.jsx)(n.p,{children:"Test a webhook by sending a test notification:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"export function useTestWebhook(\n  options?: MutationHookOptions<\n    {\n      testWebhook: {\n        result: WebhookTestResult | null;\n        errors: FieldError[];\n      };\n    },\n    { id: string }\n  >\n): UseMutationResult<...>\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Example:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { useTestWebhook } from '@nasnet/api-client/queries';\n\nfunction TestWebhookButton({ webhookId }: { webhookId: string }) {\n  const testWebhook = useTestWebhook({\n    onSuccess: (data) => {\n      const { result, errors } = data.testWebhook;\n\n      if (errors.length > 0) {\n        showErrorToast('Validation error', errors[0].message);\n      } else if (result?.success) {\n        showSuccessToast(\n          `Webhook test successful (${result.responseTimeMs}ms, HTTP ${result.statusCode})`\n        );\n      } else {\n        showErrorToast(\n          `Webhook test failed: ${result?.errorMessage || 'Unknown error'}`\n        );\n      }\n    },\n  });\n\n  return (\n    <button\n      onClick={() => testWebhook.mutate({ id: webhookId })}\n      disabled={testWebhook.isPending}\n    >\n      {testWebhook.isPending ? 'Testing...' : 'Send Test'}\n    </button>\n  );\n}\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"cache-update-strategies",children:"Cache Update Strategies"}),"\n",(0,s.jsx)(n.h3,{id:"add-to-list-on-create",children:"Add to List (on Create)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// In useCreateWebhook mutation:\nupdate(cache, result) {\n  const data = result?.data;\n  if (data?.createWebhook.webhook) {\n    const existingWebhooks = cache.readQuery({\n      query: GET_WEBHOOKS,\n    }) as { webhooks: Webhook[] } | null;\n\n    if (existingWebhooks) {\n      cache.writeQuery({\n        query: GET_WEBHOOKS,\n        data: {\n          webhooks: [...existingWebhooks.webhooks, data.createWebhook.webhook],\n        },\n      });\n    }\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"in-place-update-on-update",children:"In-Place Update (on Update)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// In useUpdateWebhook mutation:\nupdate(cache, result) {\n  const data = result?.data;\n  if (data?.updateWebhook.webhook) {\n    cache.writeQuery({\n      query: GET_WEBHOOK,\n      variables: { id: data.updateWebhook.webhook.id },\n      data: { webhook: data.updateWebhook.webhook },\n    });\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"evict--gc-on-delete",children:"Evict + GC (on Delete)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// In useDeleteWebhook mutation:\nupdate(cache, result) {\n  const data = result?.data;\n  if (data?.deleteWebhook.success && data.deleteWebhook.deletedId) {\n    const deletedId = data.deleteWebhook.deletedId;\n\n    // Remove from cache\n    cache.evict({\n      id: cache.identify({ __typename: 'Webhook', id: deletedId })\n    });\n    cache.gc();  // Garbage collect orphaned references\n\n    // Update list\n    const existing = cache.readQuery({ query: GET_WEBHOOKS }) as\n      { webhooks: Webhook[] } | null;\n\n    if (existing) {\n      cache.writeQuery({\n        query: GET_WEBHOOKS,\n        data: {\n          webhooks: existing.webhooks.filter((w) => w.id !== deletedId),\n        },\n      });\n    }\n  }\n}\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"integration-with-alerts",children:"Integration with Alerts"}),"\n",(0,s.jsx)(n.p,{children:"Webhooks are linked to alert rules in the alerts domain. When an alert fires, the alert engine\nchecks which webhooks are enabled and attempts delivery:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Alert Rule \u2192 Evaluates \u2192 Matches Condition\n          \u2192 Finds Enabled Webhooks\n          \u2192 Sends Notification Log (PENDING)\n          \u2192 TanStack Query Polling\n          \u2192 Eventually: SENT or FAILED\n          \u2192 Retry if retryEnabled + attempt < maxRetries\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Reference:"})," ",(0,s.jsx)(n.a,{href:"/docs/api-client/domain-query-hooks#6-alerts-domain",children:"Alerts Domain"})]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"template-types",children:"Template Types"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Template"}),(0,s.jsx)(n.th,{children:"Format"}),(0,s.jsx)(n.th,{children:"Use Case"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"GENERIC"})}),(0,s.jsx)(n.td,{children:"JSON body with alert fields"}),(0,s.jsx)(n.td,{children:"Custom endpoints"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"SLACK"})}),(0,s.jsx)(n.td,{children:"Slack Block Kit JSON"}),(0,s.jsx)(n.td,{children:"Slack channels"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"DISCORD"})}),(0,s.jsx)(n.td,{children:"Discord Embed JSON"}),(0,s.jsx)(n.td,{children:"Discord servers"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"TEAMS"})}),(0,s.jsx)(n.td,{children:"Microsoft Teams Adaptive Card"}),(0,s.jsx)(n.td,{children:"Teams channels"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"CUSTOM"})}),(0,s.jsx)(n.td,{children:"User-defined JSON template"}),(0,s.jsx)(n.td,{children:"Advanced integrations"})]})]})]}),"\n",(0,s.jsxs)(n.p,{children:["For ",(0,s.jsx)(n.strong,{children:"CUSTOM"})," templates, use placeholders like ",(0,s.jsx)(n.code,{children:"{{alertName}}"}),", ",(0,s.jsx)(n.code,{children:"{{severity}}"}),", ",(0,s.jsx)(n.code,{children:"{{message}}"})," that\nthe backend substitutes."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"error-codes",children:"Error Codes"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Code"}),(0,s.jsx)(n.th,{children:"Meaning"}),(0,s.jsx)(n.th,{children:"Recovery"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"W1001"})}),(0,s.jsx)(n.td,{children:"Webhook URL invalid"}),(0,s.jsx)(n.td,{children:"User edits URL format"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"W1002"})}),(0,s.jsx)(n.td,{children:"Webhook timeout"}),(0,s.jsxs)(n.td,{children:["Increase ",(0,s.jsx)(n.code,{children:"timeoutSeconds"})]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"W1003"})}),(0,s.jsx)(n.td,{children:"Auth failed (401/403)"}),(0,s.jsx)(n.td,{children:"Check credentials, bearer token"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"W1004"})}),(0,s.jsx)(n.td,{children:"HTTP 5xx from endpoint"}),(0,s.jsx)(n.td,{children:"Retry (automatic or manual)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"W1005"})}),(0,s.jsx)(n.td,{children:"JSON parse error (request/response)"}),(0,s.jsx)(n.td,{children:"Check custom template syntax"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"W1006"})}),(0,s.jsx)(n.td,{children:"Network unreachable"}),(0,s.jsx)(n.td,{children:"Endpoint is down; add retry"})]})]})]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Test before enabling:"})," Always use ",(0,s.jsx)(n.code,{children:"useTestWebhook"})," before enabling a new webhook."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Monitor delivery logs:"})," Regularly check logs for patterns (consistent failures, timeouts)."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Set appropriate timeouts:"})," Slack/Discord usually respond in ",(0,s.jsx)(n.code,{children:"<2s"}),"; use ",(0,s.jsx)(n.code,{children:"timeoutSeconds: 10"}),"\nfor safety."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Use templates:"})," Prefer built-in templates (SLACK, DISCORD, TEAMS) over CUSTOM JSON when\npossible."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Retry settings:"})," Enable retries for important alerts; ",(0,s.jsx)(n.code,{children:"maxRetries: 3"})," is reasonable."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Auth security:"})," Never log bearer tokens or passwords; use ",(0,s.jsx)(n.code,{children:"@sensitive"})," directive."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Rate limiting:"})," Be aware of endpoint rate limits; batch alerts if needed."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Headers:"})," Add custom headers (e.g., ",(0,s.jsx)(n.code,{children:"X-Alert-Source: NasNetConnect"}),") for tracking."]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"cross-references",children:"Cross-References"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/api-client/domain-query-hooks#15-notifications-domain",children:"Domain Query Hooks"})," \u2014 Full notifications domain\nreference"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/api-client/domain-query-hooks#6-alerts-domain",children:"Alerts Domain"})," \u2014 Alert rules that trigger webhooks"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/api-client/error-handling",children:"Error Handling"})," \u2014 Error code taxonomy"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/api-client/graphql-schema-contracts",children:"GraphQL Schema Contracts"})," \u2014 @sensitive directive for redaction"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},71184:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>a});var o=t(14041);const s={},r=o.createContext(s);function i(e){const n=o.useContext(r);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),o.createElement(r.Provider,{value:n},e.children)}}}]);