"use strict";(globalThis.webpackChunk_nas_net_docs=globalThis.webpackChunk_nas_net_docs||[]).push([[16660],{11344:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>i,default:()=>h,frontMatter:()=>d,metadata:()=>l,toc:()=>o});const l=JSON.parse('{"id":"feature-firewall","title":"Feature Module: Firewall (libs/features/firewall)","description":"1. Overview","source":"@site/../../libs/features/docs/feature-firewall.md","sourceDirName":".","slug":"/feature-firewall","permalink":"/docs/features/feature-firewall","draft":false,"unlisted":false,"editUrl":"https://github.com/nasnet-community/nasnet-panel/tree/main/../../libs/features/docs/feature-firewall.md","tags":[],"version":"current","frontMatter":{},"sidebar":"sidebar","previous":{"title":"Feature: Diagnostics (libs/features/diagnostics)","permalink":"/docs/features/feature-diagnostics"},"next":{"title":"Feature: Logs (libs/features/logs)","permalink":"/docs/features/feature-logs"}}');var r=n(31085),t=n(71184);const d={},i="Feature Module: Firewall (libs/features/firewall)",c={},o=[{value:"1. Overview",id:"1-overview",level:2},{value:"Key architectural traits",id:"key-architectural-traits",level:3},{value:"Public import path",id:"public-import-path",level:3},{value:"2. Directory Tree",id:"2-directory-tree",level:2},{value:"3. Component Catalogue",id:"3-component-catalogue",level:2},{value:"3.1 Filter Rule Components",id:"31-filter-rule-components",level:3},{value:"3.2 Mangle Rule Components",id:"32-mangle-rule-components",level:3},{value:"3.3 RAW Rule Components",id:"33-raw-rule-components",level:3},{value:"3.4 NAT Components",id:"34-nat-components",level:3},{value:"3.5 Address List Components",id:"35-address-list-components",level:3},{value:"3.6 Dashboard / Status Components",id:"36-dashboard--status-components",level:3},{value:"3.7 Port Knocking Components (NAS-7.12)",id:"37-port-knocking-components-nas-712",level:3},{value:"3.8 Service Ports Components (NAS-7.8)",id:"38-service-ports-components-nas-78",level:3},{value:"3.9 Template Management Components (NAS-7.6)",id:"39-template-management-components-nas-76",level:3},{value:"3.10 Utility / Filter Components",id:"310-utility--filter-components",level:3},{value:"4. Page Catalogue",id:"4-page-catalogue",level:2},{value:"5. Firewall Template Safety Pipeline",id:"5-firewall-template-safety-pipeline",level:2},{value:"5.1 State Machine",id:"51-state-machine",level:3},{value:"5.2 UndoFloatingButton",id:"52-undofloatingbutton",level:3},{value:"5.3 Full Pipeline Flow (TemplatesPage \u2192 API)",id:"53-full-pipeline-flow-templatespage--api",level:3},{value:"6. Address List Import/Export Flow",id:"6-address-list-importexport-flow",level:2},{value:"Import",id:"import",level:3},{value:"Export",id:"export",level:3},{value:"7. Port Knocking Sequence Management",id:"7-port-knocking-sequence-management",level:2},{value:"8. Zustand Stores Used",id:"8-zustand-stores-used",level:2},{value:"9. Schemas and Validation",id:"9-schemas-and-validation",level:2},{value:"9.1 Template Schemas (<code>schemas/templateSchemas.ts</code>)",id:"91-template-schemas-schemastemplateschemasts",level:3},{value:"9.2 Core Type Definitions (<code>libs/core/types/src/firewall/</code>)",id:"92-core-type-definitions-libscoretypessrcfirewall",level:3},{value:"10. Key Pattern Details",id:"10-key-pattern-details",level:2},{value:"<code>ReadOnlyNotice</code>",id:"readonlynotice",level:3},{value:"<code>RuleSearchFilters</code>",id:"rulesearchfilters",level:3},{value:"<code>UndoFloatingButton</code>",id:"undofloatingbutton",level:3},{value:"11. Hooks",id:"11-hooks",level:2},{value:"12. Cross-References",id:"12-cross-references",level:2}];function a(e){const s={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.header,{children:(0,r.jsxs)(s.h1,{id:"feature-module-firewall-libsfeaturesfirewall",children:["Feature Module: Firewall (",(0,r.jsx)(s.code,{children:"libs/features/firewall"}),")"]})}),"\n",(0,r.jsx)(s.h2,{id:"1-overview",children:"1. Overview"}),"\n",(0,r.jsxs)(s.p,{children:["The ",(0,r.jsx)(s.code,{children:"@nasnet/features/firewall"})," library is a Layer 3 domain feature module (Epic 0.6: Firewall & Routing Viewer) that provides the complete UI surface for MikroTik firewall management. It covers viewing and editing filter rules, NAT rules, mangle rules, RAW rules, address lists, port knocking sequences, service ports, rate limiting, firewall templates, connection tracking, and firewall logs."]}),"\n",(0,r.jsx)(s.p,{children:"The module is architected around three concerns:"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Read-only viewing"})," of existing firewall rules via live GraphQL queries (Phase 0 behaviour, gated by ",(0,r.jsx)(s.code,{children:"ReadOnlyNotice"}),")."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Interactive editing"})," introduced progressively through the Safety Pipeline \u2014 a multi-step XState machine that enforces preview, conflict detection, optional high-risk acknowledgment, apply, and a 5-minute rollback window before changes are committed."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Template management"})," \u2014 a reusable template gallery that lets admins package, import, export, apply, and roll back firewall rule sets as named templates."]}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"key-architectural-traits",children:"Key architectural traits"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"All data comes from Apollo Client GraphQL queries/mutations; no REST calls."}),"\n",(0,r.jsxs)(s.li,{children:["XState v5 (",(0,r.jsx)(s.code,{children:"xstate"}),") governs the template apply workflow."]}),"\n",(0,r.jsx)(s.li,{children:"React Hook Form + Zod validate all forms; Zod schemas are exported and reused by the backend codegen pipeline."}),"\n",(0,r.jsxs)(s.li,{children:["Platform presenters (Desktop / Mobile) separate rendering logic from business logic throughout; the headless pattern from ",(0,r.jsx)(s.code,{children:"PLATFORM_PRESENTER_GUIDE.md"})," is applied consistently."]}),"\n",(0,r.jsxs)(s.li,{children:["Custom templates are persisted to the browser's IndexedDB via a ",(0,r.jsx)(s.code,{children:"useCustomTemplates"})," hook."]}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"public-import-path",children:"Public import path"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-ts",children:"import { FilterRulesTableDesktop, TemplateApplyFlow, AddressListView, ... } from '@nasnet/features/firewall';\n"})}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"2-directory-tree",children:"2. Directory Tree"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"libs/features/firewall/\n\u251c\u2500\u2500 src/\n\u2502   \u251c\u2500\u2500 index.ts                         # Public barrel export\n\u2502   \u251c\u2500\u2500 components/                      # Layer 3 domain components (~43 exports)\n\u2502   \u2502   \u251c\u2500\u2500 index.ts\n\u2502   \u2502   \u251c\u2500\u2500 FilterRulesTable.tsx\n\u2502   \u2502   \u251c\u2500\u2500 FilterRulesTableDesktop.tsx\n\u2502   \u2502   \u251c\u2500\u2500 FilterRulesTableMobile.tsx\n\u2502   \u2502   \u251c\u2500\u2500 NATRulesTable.tsx\n\u2502   \u2502   \u251c\u2500\u2500 NATRulesTableMobile.tsx\n\u2502   \u2502   \u251c\u2500\u2500 RoutingTable.tsx\n\u2502   \u2502   \u251c\u2500\u2500 ReadOnlyNotice.tsx\n\u2502   \u2502   \u251c\u2500\u2500 ServicesStatus.tsx\n\u2502   \u2502   \u251c\u2500\u2500 ChainSummaryCards.tsx\n\u2502   \u2502   \u251c\u2500\u2500 TrafficFlowDiagram.tsx\n\u2502   \u2502   \u251c\u2500\u2500 RuleSearchFilters.tsx\n\u2502   \u2502   \u251c\u2500\u2500 MangleRulesTable.tsx\n\u2502   \u2502   \u251c\u2500\u2500 MangleRulesTableDesktop.tsx\n\u2502   \u2502   \u251c\u2500\u2500 MangleRulesTableMobile.tsx\n\u2502   \u2502   \u251c\u2500\u2500 RawRulesTable.tsx\n\u2502   \u2502   \u251c\u2500\u2500 RawRulesTableDesktop.tsx\n\u2502   \u2502   \u251c\u2500\u2500 RawRulesTableMobile.tsx\n\u2502   \u2502   \u251c\u2500\u2500 AddressListEntryForm.tsx\n\u2502   \u2502   \u251c\u2500\u2500 AddressListImportDialog.tsx\n\u2502   \u2502   \u251c\u2500\u2500 AddressListExportDialog.tsx\n\u2502   \u2502   \u251c\u2500\u2500 IPAddressDisplay.tsx\n\u2502   \u2502   \u251c\u2500\u2500 AddToAddressListContextMenu.tsx\n\u2502   \u2502   \u251c\u2500\u2500 FirewallStatusHero.tsx\n\u2502   \u2502   \u251c\u2500\u2500 FirewallQuickStats.tsx\n\u2502   \u2502   \u251c\u2500\u2500 RecentFirewallActivity.tsx\n\u2502   \u2502   \u251c\u2500\u2500 FirewallDetailTabs.tsx\n\u2502   \u2502   \u251c\u2500\u2500 ConnectionsPage.tsx\n\u2502   \u2502   \u251c\u2500\u2500 PortForwardWizardDialog.tsx\n\u2502   \u2502   \u251c\u2500\u2500 MasqueradeQuickDialog.tsx\n\u2502   \u2502   \u251c\u2500\u2500 PortKnockingPage.tsx\n\u2502   \u2502   \u251c\u2500\u2500 PortKnockSequenceManager.tsx\n\u2502   \u2502   \u251c\u2500\u2500 PortKnockSequenceManagerDesktop.tsx\n\u2502   \u2502   \u251c\u2500\u2500 PortKnockSequenceManagerMobile.tsx\n\u2502   \u2502   \u251c\u2500\u2500 PortKnockLogViewer.tsx\n\u2502   \u2502   \u251c\u2500\u2500 ServicePortsTable.tsx\n\u2502   \u2502   \u251c\u2500\u2500 ServicePortsTableDesktop.tsx\n\u2502   \u2502   \u251c\u2500\u2500 ServicePortsTableMobile.tsx\n\u2502   \u2502   \u251c\u2500\u2500 AddServiceDialog.tsx\n\u2502   \u2502   \u251c\u2500\u2500 ServiceGroupDialog.tsx\n\u2502   \u2502   \u251c\u2500\u2500 SaveTemplateDialog.tsx\n\u2502   \u2502   \u251c\u2500\u2500 ImportTemplateDialog.tsx\n\u2502   \u2502   \u251c\u2500\u2500 TemplateApplyFlow.tsx\n\u2502   \u2502   \u2514\u2500\u2500 UndoFloatingButton.tsx\n\u2502   \u251c\u2500\u2500 pages/                           # Layer 3 page components (8 pages)\n\u2502   \u2502   \u251c\u2500\u2500 index.ts\n\u2502   \u2502   \u251c\u2500\u2500 AddressListView.tsx\n\u2502   \u2502   \u251c\u2500\u2500 FirewallLogsPage.tsx\n\u2502   \u2502   \u251c\u2500\u2500 ManglePage.tsx\n\u2502   \u2502   \u251c\u2500\u2500 NATRulesPage.tsx\n\u2502   \u2502   \u251c\u2500\u2500 RateLimitingPage.tsx\n\u2502   \u2502   \u251c\u2500\u2500 RawPage.tsx\n\u2502   \u2502   \u251c\u2500\u2500 ServicePortsPage.tsx\n\u2502   \u2502   \u2514\u2500\u2500 TemplatesPage.tsx\n\u2502   \u251c\u2500\u2500 machines/\n\u2502   \u2502   \u2514\u2500\u2500 template-apply.machine.ts    # XState v5 machine for Safety Pipeline\n\u2502   \u251c\u2500\u2500 hooks/\n\u2502   \u2502   \u251c\u2500\u2500 useCustomTemplates.ts        # IndexedDB persistence for custom templates\n\u2502   \u2502   \u2514\u2500\u2500 ...\n\u2502   \u251c\u2500\u2500 schemas/\n\u2502   \u2502   \u251c\u2500\u2500 templateSchemas.ts           # Zod schemas + validation helpers\n\u2502   \u2502   \u2514\u2500\u2500 addressListSchemas.ts\n\u2502   \u251c\u2500\u2500 services/\n\u2502   \u2502   \u2514\u2500\u2500 ...\n\u2502   \u2514\u2500\u2500 utils/\n\u2502       \u251c\u2500\u2500 addressListParsers.ts        # CSV/JSON/TXT parser + batch validator\n\u2502       \u2514\u2500\u2500 template-export.ts\n\u251c\u2500\u2500 __test-utils__/\n\u2502   \u2514\u2500\u2500 firewall-templates/\n\u2502       \u2514\u2500\u2500 template-fixtures.ts\n\u251c\u2500\u2500 package.json\n\u2514\u2500\u2500 project.json\n"})}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"3-component-catalogue",children:"3. Component Catalogue"}),"\n",(0,r.jsx)(s.h3,{id:"31-filter-rule-components",children:"3.1 Filter Rule Components"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Component"}),(0,r.jsx)(s.th,{children:"File"}),(0,r.jsx)(s.th,{children:"Platform"}),(0,r.jsx)(s.th,{children:"Purpose"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"FilterRulesTable"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"components/FilterRulesTable.tsx"})}),(0,r.jsx)(s.td,{children:"Shared (dispatcher)"}),(0,r.jsxs)(s.td,{children:["Auto-selects Desktop or Mobile presenter via ",(0,r.jsx)(s.code,{children:"usePlatform()"})]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"FilterRulesTableDesktop"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"components/FilterRulesTableDesktop.tsx"})}),(0,r.jsx)(s.td,{children:"Desktop"}),(0,r.jsx)(s.td,{children:"Dense data table with sortable columns, inline enable/disable toggle, row actions"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"FilterRulesTableMobile"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"components/FilterRulesTableMobile.tsx"})}),(0,r.jsx)(s.td,{children:"Mobile"}),(0,r.jsx)(s.td,{children:"Card-list view with 44px touch targets, swipe-to-reveal actions"})]})]})]}),"\n",(0,r.jsx)(s.h3,{id:"32-mangle-rule-components",children:"3.2 Mangle Rule Components"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Component"}),(0,r.jsx)(s.th,{children:"File"}),(0,r.jsx)(s.th,{children:"Platform"}),(0,r.jsx)(s.th,{children:"Purpose"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"MangleRulesTable"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"components/MangleRulesTable.tsx"})}),(0,r.jsx)(s.td,{children:"Shared"}),(0,r.jsx)(s.td,{children:"Dispatcher for mangle table"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"MangleRulesTableDesktop"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"components/MangleRulesTableDesktop.tsx"})}),(0,r.jsx)(s.td,{children:"Desktop"}),(0,r.jsx)(s.td,{children:"Table view with packet/byte counters, DSCP marks"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"MangleRulesTableMobile"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"components/MangleRulesTableMobile.tsx"})}),(0,r.jsx)(s.td,{children:"Mobile"}),(0,r.jsx)(s.td,{children:"Card layout for mangle rules"})]})]})]}),"\n",(0,r.jsx)(s.h3,{id:"33-raw-rule-components",children:"3.3 RAW Rule Components"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Component"}),(0,r.jsx)(s.th,{children:"File"}),(0,r.jsx)(s.th,{children:"Platform"}),(0,r.jsx)(s.th,{children:"Purpose"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"RawRulesTable"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"components/RawRulesTable.tsx"})}),(0,r.jsx)(s.td,{children:"Shared"}),(0,r.jsx)(s.td,{children:"Dispatcher for RAW table (NAS-7.X)"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"RawRulesTableDesktop"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"components/RawRulesTableDesktop.tsx"})}),(0,r.jsx)(s.td,{children:"Desktop"}),(0,r.jsx)(s.td,{children:"Dense desktop table for pre-connection-tracking rules"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"RawRulesTableMobile"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"components/RawRulesTableMobile.tsx"})}),(0,r.jsx)(s.td,{children:"Mobile"}),(0,r.jsx)(s.td,{children:"Mobile card view for RAW rules"})]})]})]}),"\n",(0,r.jsx)(s.h3,{id:"34-nat-components",children:"3.4 NAT Components"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Component"}),(0,r.jsx)(s.th,{children:"File"}),(0,r.jsx)(s.th,{children:"Platform"}),(0,r.jsx)(s.th,{children:"Purpose"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"NATRulesTable"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"components/NATRulesTable.tsx"})}),(0,r.jsx)(s.td,{children:"Desktop"}),(0,r.jsx)(s.td,{children:"Full NAT table with srcnat/dstnat chain tabs"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"NATRulesTableMobile"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"components/NATRulesTableMobile.tsx"})}),(0,r.jsx)(s.td,{children:"Mobile"}),(0,r.jsx)(s.td,{children:"Mobile NAT card list"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"PortForwardWizardDialog"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"components/PortForwardWizardDialog.tsx"})}),(0,r.jsx)(s.td,{children:"Shared"}),(0,r.jsx)(s.td,{children:"Step-by-step wizard for creating port-forward NAT rules"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"MasqueradeQuickDialog"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"components/MasqueradeQuickDialog.tsx"})}),(0,r.jsx)(s.td,{children:"Shared"}),(0,r.jsx)(s.td,{children:"One-click masquerade rule creation dialog"})]})]})]}),"\n",(0,r.jsx)(s.h3,{id:"35-address-list-components",children:"3.5 Address List Components"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Component"}),(0,r.jsx)(s.th,{children:"File"}),(0,r.jsx)(s.th,{children:"Platform"}),(0,r.jsx)(s.th,{children:"Purpose"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"AddressListEntryForm"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"components/AddressListEntryForm.tsx"})}),(0,r.jsx)(s.td,{children:"Shared"}),(0,r.jsx)(s.td,{children:"RHF+Zod form for single address list entry (IP, comment, timeout)"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"AddressListImportDialog"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"components/AddressListImportDialog.tsx"})}),(0,r.jsx)(s.td,{children:"Shared"}),(0,r.jsx)(s.td,{children:"Multi-step bulk import (CSV/JSON/TXT) with drag-and-drop and batch validation"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"AddressListExportDialog"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"components/AddressListExportDialog.tsx"})}),(0,r.jsx)(s.td,{children:"Shared"}),(0,r.jsx)(s.td,{children:"Export address lists to CSV/JSON/TXT with download"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"IPAddressDisplay"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"components/IPAddressDisplay.tsx"})}),(0,r.jsx)(s.td,{children:"Shared"}),(0,r.jsx)(s.td,{children:"Formatted display of IP/CIDR with copy-to-clipboard"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"AddToAddressListContextMenu"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"components/AddToAddressListContextMenu.tsx"})}),(0,r.jsx)(s.td,{children:"Shared"}),(0,r.jsx)(s.td,{children:"Right-click context menu to add an IP to any address list"})]})]})]}),"\n",(0,r.jsx)(s.h3,{id:"36-dashboard--status-components",children:"3.6 Dashboard / Status Components"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Component"}),(0,r.jsx)(s.th,{children:"File"}),(0,r.jsx)(s.th,{children:"Platform"}),(0,r.jsx)(s.th,{children:"Purpose"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"FirewallStatusHero"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"components/FirewallStatusHero.tsx"})}),(0,r.jsx)(s.td,{children:"Shared"}),(0,r.jsx)(s.td,{children:"Hero banner showing overall firewall status, rule counts, and last-modified time"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"FirewallQuickStats"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"components/FirewallQuickStats.tsx"})}),(0,r.jsx)(s.td,{children:"Shared"}),(0,r.jsx)(s.td,{children:"KPI cards: total rules, active rules, dropped packets (last 5 min), connections"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"RecentFirewallActivity"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"components/RecentFirewallActivity.tsx"})}),(0,r.jsx)(s.td,{children:"Shared"}),(0,r.jsx)(s.td,{children:"Mini log feed of recent drops, accepts, and security events"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"FirewallDetailTabs"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"components/FirewallDetailTabs.tsx"})}),(0,r.jsx)(s.td,{children:"Shared"}),(0,r.jsx)(s.td,{children:"Tabbed navigation across all firewall sub-pages"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"ChainSummaryCards"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"components/ChainSummaryCards.tsx"})}),(0,r.jsx)(s.td,{children:"Shared"}),(0,r.jsx)(s.td,{children:"Per-chain rule count cards (input / forward / output / prerouting / postrouting)"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"ServicesStatus"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"components/ServicesStatus.tsx"})}),(0,r.jsx)(s.td,{children:"Shared"}),(0,r.jsx)(s.td,{children:"Connection-tracking and firewall service health indicators"})]})]})]}),"\n",(0,r.jsx)(s.h3,{id:"37-port-knocking-components-nas-712",children:"3.7 Port Knocking Components (NAS-7.12)"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Component"}),(0,r.jsx)(s.th,{children:"File"}),(0,r.jsx)(s.th,{children:"Platform"}),(0,r.jsx)(s.th,{children:"Purpose"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"PortKnockingPage"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"components/PortKnockingPage.tsx"})}),(0,r.jsx)(s.td,{children:"Shared"}),(0,r.jsx)(s.td,{children:"Main port-knocking container; composes sequence manager and log viewer"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"PortKnockSequenceManager"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"components/PortKnockSequenceManager.tsx"})}),(0,r.jsx)(s.td,{children:"Shared"}),(0,r.jsx)(s.td,{children:"Dispatcher that selects Desktop or Mobile presenter"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"PortKnockSequenceManagerDesktop"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"components/PortKnockSequenceManagerDesktop.tsx"})}),(0,r.jsx)(s.td,{children:"Desktop"}),(0,r.jsx)(s.td,{children:"Table view with inline enable/disable switch, knock-port badges, timeout columns, edit/delete actions"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"PortKnockSequenceManagerMobile"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"components/PortKnockSequenceManagerMobile.tsx"})}),(0,r.jsx)(s.td,{children:"Mobile"}),(0,r.jsx)(s.td,{children:"Card list with 44px touch targets, sequence detail accordion"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"PortKnockLogViewer"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"components/PortKnockLogViewer.tsx"})}),(0,r.jsx)(s.td,{children:"Shared"}),(0,r.jsx)(s.td,{children:"Real-time log stream showing knock attempts, successes, and failures"})]})]})]}),"\n",(0,r.jsx)(s.h3,{id:"38-service-ports-components-nas-78",children:"3.8 Service Ports Components (NAS-7.8)"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Component"}),(0,r.jsx)(s.th,{children:"File"}),(0,r.jsx)(s.th,{children:"Platform"}),(0,r.jsx)(s.th,{children:"Purpose"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"ServicePortsTable"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"components/ServicePortsTable.tsx"})}),(0,r.jsx)(s.td,{children:"Shared"}),(0,r.jsx)(s.td,{children:"Dispatcher for service port table"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"ServicePortsTableDesktop"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"components/ServicePortsTableDesktop.tsx"})}),(0,r.jsx)(s.td,{children:"Desktop"}),(0,r.jsx)(s.td,{children:"Full table of RouterOS service ports (api, ftp, ssh, telnet, winbox, etc.) with enable/disable"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"ServicePortsTableMobile"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"components/ServicePortsTableMobile.tsx"})}),(0,r.jsx)(s.td,{children:"Mobile"}),(0,r.jsx)(s.td,{children:"Compact card list of service ports"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"AddServiceDialog"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"components/AddServiceDialog.tsx"})}),(0,r.jsx)(s.td,{children:"Shared"}),(0,r.jsx)(s.td,{children:"Dialog form to add a custom service port mapping"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"ServiceGroupDialog"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"components/ServiceGroupDialog.tsx"})}),(0,r.jsx)(s.td,{children:"Shared"}),(0,r.jsx)(s.td,{children:"Dialog to manage named service port groups"})]})]})]}),"\n",(0,r.jsx)(s.h3,{id:"39-template-management-components-nas-76",children:"3.9 Template Management Components (NAS-7.6)"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Component"}),(0,r.jsx)(s.th,{children:"File"}),(0,r.jsx)(s.th,{children:"Platform"}),(0,r.jsx)(s.th,{children:"Purpose"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"SaveTemplateDialog"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"components/SaveTemplateDialog.tsx"})}),(0,r.jsx)(s.td,{children:"Shared"}),(0,r.jsx)(s.td,{children:"Dialog to snapshot current filter rules as a named custom template (persisted to IndexedDB)"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"ImportTemplateDialog"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"components/ImportTemplateDialog.tsx"})}),(0,r.jsx)(s.td,{children:"Shared"}),(0,r.jsxs)(s.td,{children:["Dialog to import a template from JSON file or paste; validates against ",(0,r.jsx)(s.code,{children:"FirewallTemplateSchema"})]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"TemplateApplyFlow"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"components/TemplateApplyFlow.tsx"})}),(0,r.jsx)(s.td,{children:"Shared"}),(0,r.jsx)(s.td,{children:"XState-driven multi-step flow (configure \u2192 preview \u2192 confirm \u2192 apply \u2192 success/rollback)"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"UndoFloatingButton"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"components/UndoFloatingButton.tsx"})}),(0,r.jsx)(s.td,{children:"Shared"}),(0,r.jsx)(s.td,{children:"Floating bottom-right button with 5-minute countdown for post-apply rollback"})]})]})]}),"\n",(0,r.jsx)(s.h3,{id:"310-utility--filter-components",children:"3.10 Utility / Filter Components"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Component"}),(0,r.jsx)(s.th,{children:"File"}),(0,r.jsx)(s.th,{children:"Platform"}),(0,r.jsx)(s.th,{children:"Purpose"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"RuleSearchFilters"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"components/RuleSearchFilters.tsx"})}),(0,r.jsx)(s.td,{children:"Shared"}),(0,r.jsx)(s.td,{children:"Filter panel with 300ms debounced text search, chain/action/protocol/status dropdowns, active-filter badges, mobile collapse"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"ReadOnlyNotice"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"components/ReadOnlyNotice.tsx"})}),(0,r.jsx)(s.td,{children:"Shared"}),(0,r.jsx)(s.td,{children:"Dismissible info banner explaining Phase 0 read-only mode; state persisted to localStorage"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"RoutingTable"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"components/RoutingTable.tsx"})}),(0,r.jsx)(s.td,{children:"Shared"}),(0,r.jsx)(s.td,{children:"Static routing table viewer (destination, gateway, interface, distance)"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"TrafficFlowDiagram"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"components/TrafficFlowDiagram.tsx"})}),(0,r.jsx)(s.td,{children:"Shared"}),(0,r.jsx)(s.td,{children:"Visual diagram of packet traversal through firewall chains"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"ConnectionsPage"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"components/ConnectionsPage.tsx"})}),(0,r.jsx)(s.td,{children:"Shared"}),(0,r.jsx)(s.td,{children:"Connection tracking table showing active TCP/UDP/ICMP state entries"})]})]})]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"4-page-catalogue",children:"4. Page Catalogue"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Page"}),(0,r.jsx)(s.th,{children:"File"}),(0,r.jsx)(s.th,{children:"Description"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"AddressListView"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"pages/AddressListView.tsx"})}),(0,r.jsxs)(s.td,{children:["Full CRUD for all firewall address lists. Orchestrates ",(0,r.jsx)(s.code,{children:"AddressListManager"})," (Layer 2 pattern), ",(0,r.jsx)(s.code,{children:"AddressListEntryForm"}),", ",(0,r.jsx)(s.code,{children:"AddressListImportDialog"}),", and ",(0,r.jsx)(s.code,{children:"AddressListExportDialog"}),". Uses ",(0,r.jsx)(s.code,{children:"Sheet"})," for add-entry on mobile and ",(0,r.jsx)(s.code,{children:"Dialog"})," for desktop."]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"FirewallLogsPage"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"pages/FirewallLogsPage.tsx"})}),(0,r.jsxs)(s.td,{children:["Streams live firewall log events. Integrates ",(0,r.jsx)(s.code,{children:"RuleSearchFilters"})," for chain/action/IP filtering and a virtualized log list with time, source, destination, and action columns."]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"ManglePage"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"pages/ManglePage.tsx"})}),(0,r.jsxs)(s.td,{children:["Displays all mangle rules grouped by chain. Includes ",(0,r.jsx)(s.code,{children:"MangleRulesTable"})," and ",(0,r.jsx)(s.code,{children:"RuleSearchFilters"}),"."]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"NATRulesPage"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"pages/NATRulesPage.tsx"})}),(0,r.jsxs)(s.td,{children:["NAT management with chain tabs (All / srcnat / dstnat), ",(0,r.jsx)(s.code,{children:"NATRulesTable"}),", ",(0,r.jsx)(s.code,{children:"MasqueradeQuickDialog"}),", and ",(0,r.jsx)(s.code,{children:"PortForwardWizardDialog"}),"."]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"RateLimitingPage"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"pages/RateLimitingPage.tsx"})}),(0,r.jsx)(s.td,{children:"View and configure connection-rate and burst limits via queue trees and simple queues."})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"RawPage"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"pages/RawPage.tsx"})}),(0,r.jsxs)(s.td,{children:["Displays RAW chain rules (pre-connection-tracking) with ",(0,r.jsx)(s.code,{children:"RawRulesTable"})," and ",(0,r.jsx)(s.code,{children:"RuleSearchFilters"}),"."]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"ServicePortsPage"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"pages/ServicePortsPage.tsx"})}),(0,r.jsx)(s.td,{children:"Service port table with enable/disable toggles for all RouterOS services (api, ftp, ssh, telnet, www, winbox, api-ssl)."})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"TemplatesPage"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"pages/TemplatesPage.tsx"})}),(0,r.jsxs)(s.td,{children:["Template gallery with Browse and Apply tabs. Composes ",(0,r.jsx)(s.code,{children:"TemplateGallery"})," (Layer 2), ",(0,r.jsx)(s.code,{children:"TemplateApplyFlow"}),", ",(0,r.jsx)(s.code,{children:"SaveTemplateDialog"}),", and ",(0,r.jsx)(s.code,{children:"ImportTemplateDialog"}),"."]})]})]})]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"5-firewall-template-safety-pipeline",children:"5. Firewall Template Safety Pipeline"}),"\n",(0,r.jsxs)(s.p,{children:["The template application flow is the canonical example of NasNetConnect's ",(0,r.jsx)(s.strong,{children:"Safety Pipeline"})," architectural pattern. The entry point is ",(0,r.jsx)(s.code,{children:"TemplatesPage"}),", which mounts ",(0,r.jsx)(s.code,{children:"TemplateApplyFlow"})," after the user selects a template from the gallery. ",(0,r.jsx)(s.code,{children:"TemplateApplyFlow"})," instantiates the XState machine via ",(0,r.jsx)(s.code,{children:"createTemplateApplyMachine"})," and renders different UI for each state."]}),"\n",(0,r.jsx)(s.h3,{id:"51-state-machine",children:"5.1 State Machine"}),"\n",(0,r.jsxs)(s.p,{children:["File: ",(0,r.jsx)(s.code,{children:"libs/features/firewall/src/machines/template-apply.machine.ts"})]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"idle \u2192 configuring \u2192 previewing \u2192 reviewing \u2192 [confirming] \u2192 applying \u2192 success\n                                                \u2193                           \u2193\n                                            error \u2190\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2192 error\n                                                                        \u2193\n                                                              rollingBack \u2192 rolledBack\n"})}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"State"}),(0,r.jsx)(s.th,{children:"Description"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"idle"})}),(0,r.jsxs)(s.td,{children:["Waiting for ",(0,r.jsx)(s.code,{children:"SELECT_TEMPLATE"})," event"]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"configuring"})}),(0,r.jsxs)(s.td,{children:["User fills in template variables via ",(0,r.jsx)(s.code,{children:"TemplatePreview"})," form"]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"previewing"})}),(0,r.jsxs)(s.td,{children:["Async: calls ",(0,r.jsx)(s.code,{children:"previewTemplate"})," service; shows spinner"]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"reviewing"})}),(0,r.jsx)(s.td,{children:"User reviews impact analysis (rule count, chains, conflicts, warnings)"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"confirming"})}),(0,r.jsx)(s.td,{children:"High-risk gate: shown when rules > 10, chains > 3, or conflicts exist"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"applying"})}),(0,r.jsxs)(s.td,{children:["Async: calls ",(0,r.jsx)(s.code,{children:"applyTemplate"})," service; shows spinner with rule count"]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"success"})}),(0,r.jsxs)(s.td,{children:["Apply completed; rollback ID captured; ",(0,r.jsx)(s.code,{children:"UndoFloatingButton"})," rendered"]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"rollingBack"})}),(0,r.jsxs)(s.td,{children:["Async: calls ",(0,r.jsx)(s.code,{children:"executeRollback"})," service"]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"rolledBack"})}),(0,r.jsxs)(s.td,{children:["Rollback confirmed; ",(0,r.jsx)(s.code,{children:"notifyRolledBack"})," callback fired"]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"error"})}),(0,r.jsx)(s.td,{children:"Caught error; offers Retry, Rollback (if rollback ID exists), and Reset"})]})]})]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"High-risk thresholds"})," (constants in the machine file):"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-ts",children:"const HIGH_RISK_THRESHOLDS = {\n  MAX_LOW_RISK_RULES: 10,   // >10 new rules \u2192 confirming state\n  MAX_LOW_RISK_CHAINS: 3,   // >3 affected chains \u2192 confirming state\n} as const;\n// Plus: any conflicts or any warnings also trigger confirming\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Events accepted:"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-ts",children:"type TemplateApplyEvent =\n  | { type: 'SELECT_TEMPLATE'; template: FirewallTemplate; routerId: string }\n  | { type: 'UPDATE_VARIABLES'; variables: Record<string, string> }\n  | { type: 'PREVIEW' }\n  | { type: 'CONFIRM' }\n  | { type: 'APPLY' }\n  | { type: 'ACKNOWLEDGED' }   // user checked the acknowledgment checkbox\n  | { type: 'ROLLBACK' }\n  | { type: 'RETRY' }\n  | { type: 'CANCEL' }\n  | { type: 'RESET' };\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Context shape:"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-ts",children:"interface TemplateApplyContext {\n  routerId: string | null;\n  template: FirewallTemplate | null;\n  variables: Record<string, string>;\n  validationErrors: Array<{ field: string; message: string }>;\n  previewResult: TemplatePreviewResult | null;\n  applyResult: FirewallTemplateResult | null;\n  applyStartedAt: number | null;   // timestamp for rollback timer\n  errorMessage: string | null;\n}\n"})}),"\n",(0,r.jsx)(s.h3,{id:"52-undofloatingbutton",children:"5.2 UndoFloatingButton"}),"\n",(0,r.jsxs)(s.p,{children:["After a successful apply, ",(0,r.jsx)(s.code,{children:"TemplateApplyFlow"})," renders ",(0,r.jsx)(s.code,{children:"UndoFloatingButton"})," fixed to the bottom-right corner. This component:"]}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Starts a ",(0,r.jsx)(s.strong,{children:"5-minute (300-second) countdown"})," on mount."]}),"\n",(0,r.jsxs)(s.li,{children:["Displays time remaining with ",(0,r.jsx)(s.code,{children:"formatTime()"})," in MM",":SS","."]}),"\n",(0,r.jsxs)(s.li,{children:["Changes urgency styling: ",(0,r.jsx)(s.code,{children:"normal"})," (> 60s), ",(0,r.jsx)(s.code,{children:"warning"})," (31-60s), ",(0,r.jsx)(s.code,{children:"critical"})," (\u2264 30s)."]}),"\n",(0,r.jsx)(s.li,{children:"Shows a confirmation dialog before executing rollback."}),"\n",(0,r.jsxs)(s.li,{children:["Calls ",(0,r.jsx)(s.code,{children:"onRollback()"})," then hides on success, or auto-hides via ",(0,r.jsx)(s.code,{children:"onExpire()"})," when the countdown reaches zero."]}),"\n"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-ts",children:"const TOTAL_SECONDS = 300;  // 5 minutes\n"})}),"\n",(0,r.jsx)(s.h3,{id:"53-full-pipeline-flow-templatespage--api",children:"5.3 Full Pipeline Flow (TemplatesPage \u2192 API)"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"User clicks \"Apply Template\"\n  \u2514\u2500> TemplatesPage.handleApplyTemplate()\n        \u2514\u2500> setSelectedTemplate(template)\n              \u2514\u2500> setActiveTab('apply')\n                    \u2514\u2500> <TemplateApplyFlow\n                              routerId={routerId}\n                              template={selectedTemplate}\n                              onPreview={handlePreviewTemplate}\n                              onApply={handleApply}\n                              onRollback={handleRollback} />\n                          \u2514\u2500> createTemplateApplyMachine({ previewTemplate, applyTemplate, executeRollback })\n                                \u2514\u2500> useMachine(machine)\n                                      \u2502\n                                      \u251c\u2500> configuring state (user configures variables)\n                                      \u2502     \u2514\u2500> PREVIEW event\n                                      \u2502\n                                      \u251c\u2500> previewing state (async)\n                                      \u2502     \u2514\u2500> previewTemplate(routerId, template, variables)\n                                      \u2502           \u2514\u2500> usePreviewTemplate() Apollo mutation\n                                      \u2502\n                                      \u251c\u2500> reviewing state (impact analysis shown)\n                                      \u2502     \u2514\u2500> CONFIRM event\n                                      \u2502\n                                      \u251c\u2500> confirming state [only if high-risk]\n                                      \u2502     \u2514\u2500> user checks acknowledgment checkbox\n                                      \u2502           \u2514\u2500> ACKNOWLEDGED event\n                                      \u2502\n                                      \u251c\u2500> applying state (async)\n                                      \u2502     \u2514\u2500> applyTemplate(routerId, template, variables)\n                                      \u2502           \u2514\u2500> useApplyTemplate() Apollo mutation\n                                      \u2502\n                                      \u2514\u2500> success state\n                                            \u2514\u2500> <UndoFloatingButton countdown=5min />\n                                                  \u2514\u2500> ROLLBACK event \u2192 rollingBack \u2192 rolledBack\n"})}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"6-address-list-importexport-flow",children:"6. Address List Import/Export Flow"}),"\n",(0,r.jsx)(s.h3,{id:"import",children:"Import"}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.code,{children:"AddressListImportDialog"})," implements a 4-step wizard:"]}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"select"})," \u2014 User selects target list name, format (auto-detect / CSV / JSON / TXT), and provides content via drag-and-drop file upload or text paste."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"preview"})," \u2014 ",(0,r.jsx)(s.code,{children:"parseAddressList()"})," and ",(0,r.jsx)(s.code,{children:"validateInBatches()"})," are called. For >100 entries, validation runs in batches with a progress indicator. Valid entries and errors are shown in a scrollable preview. The user can import only the valid entries."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"importing"})," \u2014 Progress bar updated as entries are written to the GraphQL mutation ",(0,r.jsx)(s.code,{children:"useBulkCreateAddressListEntries"}),"."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"complete"}),' \u2014 Success confirmation with "Import More" or "Close" options.']}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"Supported input formats:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"CSV"}),": ",(0,r.jsx)(s.code,{children:"IP, comment, timeout"})," per line"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"JSON"}),": Array of ",(0,r.jsx)(s.code,{children:"{ address, comment?, timeout? }"})," objects"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"TXT"}),": One IP per line"]}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"export",children:"Export"}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.code,{children:"AddressListExportDialog"})," downloads the current address list in the user's chosen format (CSV / JSON / TXT) via the browser's download API."]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"7-port-knocking-sequence-management",children:"7. Port Knocking Sequence Management"}),"\n",(0,r.jsxs)(s.p,{children:["Port knocking is managed by ",(0,r.jsx)(s.code,{children:"PortKnockSequenceManagerDesktop"})," (and its mobile counterpart). Each sequence stores:"]}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Name"})," \u2014 human label"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Protected service"})," \u2014 ",(0,r.jsx)(s.code,{children:"protectedProtocol:protectedPort"})," (e.g., ",(0,r.jsx)(s.code,{children:"tcp:22"})," for SSH)"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Knock ports"})," \u2014 ordered list of ports that must be sequentially knocked; displayed as ",(0,r.jsx)(s.code,{children:"Badge"})," chips in the table"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Status"})," \u2014 ",(0,r.jsx)(s.code,{children:"isEnabled"})," boolean with an inline ",(0,r.jsx)(s.code,{children:"Switch"})," toggle; changing it calls ",(0,r.jsx)(s.code,{children:"useTogglePortKnockSequence"})]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Recent access count"})," \u2014 live counter of successful knock-and-opens"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Timeouts"})," \u2014 knock timeout (K) and access timeout (A) in seconds; displayed side by side with a Clock icon"]}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:["The delete flow uses a confirmation ",(0,r.jsx)(s.code,{children:"Dialog"})," that includes an SSH-specific warning when ",(0,r.jsx)(s.code,{children:"protectedPort === 22"}),"."]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"8-zustand-stores-used",children:"8. Zustand Stores Used"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Store"}),(0,r.jsx)(s.th,{children:"Import"}),(0,r.jsx)(s.th,{children:"Usage in Firewall"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"useConnectionStore"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"@nasnet/state/stores"})}),(0,r.jsxs)(s.td,{children:["Read ",(0,r.jsx)(s.code,{children:"activeRouterId"})," and ",(0,r.jsx)(s.code,{children:"currentRouterIp"})," for query scoping"]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"useNATUIStore"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"@nasnet/state/stores"})}),(0,r.jsxs)(s.td,{children:["Track active NAT chain tab selection in ",(0,r.jsx)(s.code,{children:"NATRulesPage"})]})]})]})]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"9-schemas-and-validation",children:"9. Schemas and Validation"}),"\n",(0,r.jsxs)(s.h3,{id:"91-template-schemas-schemastemplateschemasts",children:["9.1 Template Schemas (",(0,r.jsx)(s.code,{children:"schemas/templateSchemas.ts"}),")"]}),"\n",(0,r.jsxs)(s.p,{children:["Re-exports the canonical types from ",(0,r.jsx)(s.code,{children:"@nasnet/core/types"})," and adds application-level validation utilities:"]}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Export"}),(0,r.jsx)(s.th,{children:"Type"}),(0,r.jsx)(s.th,{children:"Description"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"FirewallTemplateSchema"})}),(0,r.jsx)(s.td,{children:"Zod"}),(0,r.jsx)(s.td,{children:"Full template object (id, name, description, category, complexity, variables, rules)"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"TemplateVariableSchema"})}),(0,r.jsx)(s.td,{children:"Zod"}),(0,r.jsx)(s.td,{children:"Variable definition (name, type, label, options, isRequired, defaultValue)"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"TemplateRuleSchema"})}),(0,r.jsx)(s.td,{children:"Zod"}),(0,r.jsx)(s.td,{children:"Individual rule within a template"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"TemplatePreviewResultSchema"})}),(0,r.jsx)(s.td,{children:"Zod"}),(0,r.jsx)(s.td,{children:"Preview response (resolvedRules, conflicts, impactAnalysis)"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"FirewallTemplateResultSchema"})}),(0,r.jsx)(s.td,{children:"Zod"}),(0,r.jsx)(s.td,{children:"Apply response (isSuccessful, appliedRulesCount, rollbackId)"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"createVariableValueSchema(variable)"})}),(0,r.jsx)(s.td,{children:"Function"}),(0,r.jsxs)(s.td,{children:["Generates a Zod schema for a variable value based on its ",(0,r.jsx)(s.code,{children:"VariableType"})]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"createTemplateVariablesSchema(template)"})}),(0,r.jsx)(s.td,{children:"Function"}),(0,r.jsxs)(s.td,{children:["Builds a ",(0,r.jsx)(s.code,{children:"z.object({...})"})," for all variables in a template"]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"validateTemplateVariables(template, values)"})}),(0,r.jsx)(s.td,{children:"Function"}),(0,r.jsxs)(s.td,{children:["Returns ",(0,r.jsx)(s.code,{children:"{ success, errors }"})," without throwing"]})]})]})]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Variable type to Zod mapping:"})}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:(0,r.jsx)(s.code,{children:"VariableType"})}),(0,r.jsx)(s.th,{children:"Zod Rule"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"INTERFACE"})}),(0,r.jsxs)(s.td,{children:[(0,r.jsx)(s.code,{children:"z.string().refine(validateInterface)"})," or ",(0,r.jsx)(s.code,{children:"z.enum(options)"})]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"SUBNET"})}),(0,r.jsxs)(s.td,{children:[(0,r.jsx)(s.code,{children:"z.string().refine(validateCIDR)"})," \u2014 expects ",(0,r.jsx)(s.code,{children:"x.x.x.x/n"})]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"IP"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"z.string().refine(validateIPv4)"})})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"PORT"})}),(0,r.jsxs)(s.td,{children:[(0,r.jsx)(s.code,{children:"z.string().refine(validatePort)"})," \u2014 1\u201365535"]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"PORT_RANGE"})}),(0,r.jsxs)(s.td,{children:[(0,r.jsx)(s.code,{children:"z.string().refine(validatePortRange)"})," \u2014 ",(0,r.jsx)(s.code,{children:"start-end"})]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"VLAN_ID"})}),(0,r.jsxs)(s.td,{children:[(0,r.jsx)(s.code,{children:"z.string().refine(validateVlanId)"})," \u2014 1\u20134094"]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"STRING"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"z.string().min(1).max(255)"})})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"NUMBER"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"z.number().int()"})})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"BOOLEAN"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"z.boolean()"})})]})]})]}),"\n",(0,r.jsxs)(s.h3,{id:"92-core-type-definitions-libscoretypessrcfirewall",children:["9.2 Core Type Definitions (",(0,r.jsx)(s.code,{children:"libs/core/types/src/firewall/"}),")"]}),"\n",(0,r.jsxs)(s.p,{children:["These ",(0,r.jsx)(s.code,{children:".d.ts"})," files are generated (do not edit manually) and provide the TypeScript types consumed throughout the feature:"]}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"File"}),(0,r.jsx)(s.th,{children:"Key Types"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"filter-rule.types.d.ts"})}),(0,r.jsxs)(s.td,{children:[(0,r.jsx)(s.code,{children:"FilterRule"}),", ",(0,r.jsx)(s.code,{children:"FilterChain"})," (`input"]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"nat-rule.types.d.ts"})}),(0,r.jsxs)(s.td,{children:[(0,r.jsx)(s.code,{children:"NATRule"}),", ",(0,r.jsx)(s.code,{children:"NatChain"})," (`srcnat"]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"mangle-rule.types.d.ts"})}),(0,r.jsxs)(s.td,{children:[(0,r.jsx)(s.code,{children:"MangleRule"}),", ",(0,r.jsx)(s.code,{children:"MangleChain"}),", ",(0,r.jsx)(s.code,{children:"MangleAction"})]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"raw-rule.types.d.ts"})}),(0,r.jsxs)(s.td,{children:[(0,r.jsx)(s.code,{children:"RawRule"}),", ",(0,r.jsx)(s.code,{children:"RawChain"})]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"firewall-log.types.d.ts"})}),(0,r.jsxs)(s.td,{children:[(0,r.jsx)(s.code,{children:"FirewallLogEntry"}),", ",(0,r.jsx)(s.code,{children:"LogAction"}),", ",(0,r.jsx)(s.code,{children:"LogChain"})]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"port-knock.types.d.ts"})}),(0,r.jsxs)(s.td,{children:[(0,r.jsx)(s.code,{children:"PortKnockSequence"}),", ",(0,r.jsx)(s.code,{children:"KnockPort"})]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"service-port.types.d.ts"})}),(0,r.jsxs)(s.td,{children:[(0,r.jsx)(s.code,{children:"ServicePort"}),", ",(0,r.jsx)(s.code,{children:"ServiceName"})]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"rate-limit.types.d.ts"})}),(0,r.jsxs)(s.td,{children:[(0,r.jsx)(s.code,{children:"RateLimit"}),", ",(0,r.jsx)(s.code,{children:"QueueType"})]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"template.types.d.ts"})}),(0,r.jsxs)(s.td,{children:[(0,r.jsx)(s.code,{children:"FirewallTemplate"}),", ",(0,r.jsx)(s.code,{children:"TemplateVariable"}),", ",(0,r.jsx)(s.code,{children:"TemplateRule"}),", ",(0,r.jsx)(s.code,{children:"ImpactAnalysis"}),", ",(0,r.jsx)(s.code,{children:"TemplateConflict"})]})]})]})]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"10-key-pattern-details",children:"10. Key Pattern Details"}),"\n",(0,r.jsx)(s.h3,{id:"readonlynotice",children:(0,r.jsx)(s.code,{children:"ReadOnlyNotice"})}),"\n",(0,r.jsxs)(s.p,{children:["Displayed at the top of the firewall tab in Phase 0. Explains that editing is disabled and previews the Safety Pipeline coming in Phase 1. Dismissed state is persisted to ",(0,r.jsx)(s.code,{children:"localStorage"})," under the key ",(0,r.jsx)(s.code,{children:"nasnet:firewall:notice-dismissed"}),". The component renders ",(0,r.jsx)(s.code,{children:"null"})," once dismissed."]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-tsx",children:'<ReadOnlyNotice className="mb-4" />\n'})}),"\n",(0,r.jsx)(s.h3,{id:"rulesearchfilters",children:(0,r.jsx)(s.code,{children:"RuleSearchFilters"})}),"\n",(0,r.jsx)(s.p,{children:"Universal filter panel used on Filter, Mangle, RAW, and Logs pages. Features:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Debounced text search"})," (300ms) across comment, IPs, and ports"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Dropdown filters"}),": chain, action, protocol, status \u2014 each with an ",(0,r.jsx)(s.code,{children:"'all'"})," option"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Active filter badges"})," with individual ",(0,r.jsx)(s.code,{children:"\xd7"})," remove buttons"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Clear all"})," button"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Mobile collapse"}),": hidden by default on ",(0,r.jsx)(s.code,{children:"<md"}),' breakpoints; toggled via a "Show Filters" button']}),"\n"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-tsx",children:"<RuleSearchFilters\n  filters={filters}\n  onChange={handleFilterChange}\n  onClearAll={handleClearAll}\n  activeFilterCount={2}\n/>\n"})}),"\n",(0,r.jsx)(s.h3,{id:"undofloatingbutton",children:(0,r.jsx)(s.code,{children:"UndoFloatingButton"})}),"\n",(0,r.jsx)(s.p,{children:"The UndoFloatingButton uses urgency-based styling driven by remaining seconds:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-ts",children:"function getUrgencyLevel(seconds: number): 'normal' | 'warning' | 'critical' {\n  if (seconds <= 30) return 'critical';  // bg-error\n  if (seconds <= 60) return 'warning';   // bg-warning\n  return 'normal';                       // bg-card border\n}\n"})}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"11-hooks",children:"11. Hooks"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Hook"}),(0,r.jsx)(s.th,{children:"File"}),(0,r.jsx)(s.th,{children:"Description"})]})}),(0,r.jsx)(s.tbody,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"useCustomTemplates"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"hooks/useCustomTemplates.ts"})}),(0,r.jsx)(s.td,{children:"Provides CRUD (save, remove, exportTemplates, importTemplates) against IndexedDB for user-created firewall templates"})]})})]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"12-cross-references",children:"12. Cross-References"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"XState machine"})," \u2014 ",(0,r.jsx)(s.code,{children:"createTemplateApplyMachine"})," is the canonical Safety Pipeline implementation. See ",(0,r.jsx)(s.code,{children:"Docs/architecture/novel-pattern-designs.md"})," for the general pattern. The machine file is also referenced in ",(0,r.jsx)(s.code,{children:"xstate-machines.md"}),"."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Headless + Platform Presenters"})," \u2014 ",(0,r.jsx)(s.code,{children:"FilterRulesTable"}),", ",(0,r.jsx)(s.code,{children:"MangleRulesTable"}),", ",(0,r.jsx)(s.code,{children:"RawRulesTable"}),", ",(0,r.jsx)(s.code,{children:"PortKnockSequenceManager"}),", and ",(0,r.jsx)(s.code,{children:"ServicePortsTable"})," all follow the dispatcher + presenter pattern described in ",(0,r.jsx)(s.code,{children:"Docs/design/PLATFORM_PRESENTER_GUIDE.md"}),"."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"TemplateGallery (Layer 2 pattern)"})," \u2014 ",(0,r.jsx)(s.code,{children:"TemplatesPage"})," composes the ",(0,r.jsx)(s.code,{children:"TemplateGallery"})," component from ",(0,r.jsx)(s.code,{children:"@nasnet/ui/patterns/template-gallery"}),". The firewall feature only provides the data and handlers."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"AddressListManager (Layer 2 pattern)"})," \u2014 ",(0,r.jsx)(s.code,{children:"AddressListView"})," composes ",(0,r.jsx)(s.code,{children:"AddressListManager"})," from ",(0,r.jsx)(s.code,{children:"@nasnet/ui/patterns/address-list-manager"}),"."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"GraphQL queries"})," \u2014 All data-fetching hooks (",(0,r.jsx)(s.code,{children:"useAddressLists"}),", ",(0,r.jsx)(s.code,{children:"useNATRules"}),", ",(0,r.jsx)(s.code,{children:"usePortKnockSequences"}),", ",(0,r.jsx)(s.code,{children:"useApplyTemplate"}),", ",(0,r.jsx)(s.code,{children:"useRollbackTemplate"}),", etc.) live in ",(0,r.jsx)(s.code,{children:"@nasnet/api-client/queries/firewall"}),"."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Design tokens"})," \u2014 Semantic tokens are used throughout (",(0,r.jsx)(s.code,{children:"bg-error"}),", ",(0,r.jsx)(s.code,{children:"bg-warning"}),", ",(0,r.jsx)(s.code,{children:"bg-success"}),", ",(0,r.jsx)(s.code,{children:"text-info"}),", ",(0,r.jsx)(s.code,{children:"border-border"}),"). See ",(0,r.jsx)(s.code,{children:"Docs/design/DESIGN_TOKENS.md"}),"."]}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},71184:(e,s,n)=>{n.d(s,{R:()=>d,x:()=>i});var l=n(14041);const r={},t=l.createContext(r);function d(e){const s=l.useContext(t);return l.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function i(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:d(e.components),l.createElement(t.Provider,{value:s},e.children)}}}]);