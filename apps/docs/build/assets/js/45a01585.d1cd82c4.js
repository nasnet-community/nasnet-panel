"use strict";(globalThis.webpackChunk_nas_net_docs=globalThis.webpackChunk_nas_net_docs||[]).push([[17902],{71184:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>c});var s=t(14041);const i={},r=s.createContext(i);function o(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(r.Provider,{value:n},e.children)}},91326:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"stores/history-undo-redo","title":"History & Undo/Redo Store","description":"This document covers the undo/redo history system that enables users to reverse actions with keyboard shortcuts.","source":"@site/../../libs/state/docs/stores/history-undo-redo.md","sourceDirName":"stores","slug":"/stores/history-undo-redo","permalink":"/docs/state/stores/history-undo-redo","draft":false,"unlisted":false,"editUrl":"https://github.com/nasnet-community/nasnet-panel/tree/main/../../libs/state/docs/stores/history-undo-redo.md","tags":[],"version":"current","frontMatter":{},"sidebar":"sidebar","previous":{"title":"Drift Detection Store & Utilities","permalink":"/docs/state/stores/drift-detection"},"next":{"title":"State Stores Overview","permalink":"/docs/state/stores/overview"}}');var i=t(31085),r=t(71184);const o={},c="History & Undo/Redo Store",a={},d=[{value:"Overview",id:"overview",level:2},{value:"History State and Types",id:"history-state-and-types",level:2},{value:"State Shape",id:"state-shape",level:3},{value:"UndoableAction Interface",id:"undoableaction-interface",level:3},{value:"Action Scopes",id:"action-scopes",level:3},{value:"Non-Undoable Actions",id:"non-undoable-actions",level:3},{value:"History Store API",id:"history-store-api",level:2},{value:"State Shape in Store",id:"state-shape-in-store",level:3},{value:"Actions",id:"actions",level:3},{value:"Selectors",id:"selectors",level:3},{value:"Convenience Functions",id:"convenience-functions",level:3},{value:"Command Pattern Utilities",id:"command-pattern-utilities",level:2},{value:"Factory Functions",id:"factory-functions",level:3},{value:"createUndoableAction()",id:"createundoableaction",level:4},{value:"executeAction()",id:"executeaction",level:4},{value:"Common Pattern Helpers",id:"common-pattern-helpers",level:3},{value:"createEditAction()",id:"createeditaction",level:4},{value:"createDeleteAction()",id:"createdeleteaction",level:4},{value:"createCreateAction()",id:"createcreateaction",level:4},{value:"createReorderAction()",id:"createreorderaction",level:4},{value:"Composite and Batch Actions",id:"composite-and-batch-actions",level:3},{value:"createCompositeAction()",id:"createcompositeaction",level:4},{value:"executeBatch()",id:"executebatch",level:4},{value:"Change Set Integration",id:"change-set-integration",level:3},{value:"React Hook: useFieldEdit()",id:"react-hook-usefieldedit",level:3},{value:"Keyboard Shortcuts Integration",id:"keyboard-shortcuts-integration",level:2},{value:"Shortcut Behavior",id:"shortcut-behavior",level:3},{value:"Persistence Model",id:"persistence-model",level:2},{value:"Stored Actions",id:"stored-actions",level:3},{value:"Serialization",id:"serialization",level:3},{value:"Rehydration Limitations",id:"rehydration-limitations",level:3},{value:"State Flow Diagram",id:"state-flow-diagram",level:2},{value:"Interaction with Change Sets",id:"interaction-with-change-sets",level:2},{value:"Limitations and Edge Cases",id:"limitations-and-edge-cases",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"Related Documentation",id:"related-documentation",level:2}];function l(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"history--undoredo-store",children:"History & Undo/Redo Store"})}),"\n",(0,i.jsx)(n.p,{children:"This document covers the undo/redo history system that enables users to reverse actions with keyboard shortcuts."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Source:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"libs/state/stores/src/history/types.ts"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"libs/state/stores/src/history/history.store.ts"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"libs/state/stores/src/history/command-utils.ts"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"libs/state/stores/src/history/useHistoryShortcuts.ts"})}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsx)(n.p,{children:"The history store provides:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Unlimited Undo/Redo"}),": Default max 50 actions (configurable)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Async Support"}),": Actions can be async (API calls, validations)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Scoped History"}),": Page-local and global action scopes with different persistence"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Change Set Integration"}),": Entire change sets as single undo entries"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Keyboard Shortcuts"}),": Cmd+Z/Ctrl+Z for undo, Cmd+Shift+Z/Ctrl+Y for redo"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Notifications"}),": Toast notifications with redo action button"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Command Pattern"}),": Factory functions for common operations"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"history-state-and-types",children:"History State and Types"}),"\n",(0,i.jsx)(n.h3,{id:"state-shape",children:"State Shape"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"export interface HistoryState {\n  // Stack of executed actions (oldest to newest)\n  past: UndoableAction[];\n\n  // Stack of undone actions (newest to oldest)\n  future: UndoableAction[];\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"undoableaction-interface",children:"UndoableAction Interface"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"export interface UndoableAction {\n  // Auto-generated unique ID (format: action-{timestamp}-{random})\n  id: string;\n\n  // Action type for categorization and icons\n  type: 'edit' | 'delete' | 'create' | 'reorder' | 'changeset' | 'custom';\n\n  // Human-readable description for UI and notifications\n  // Examples: \"Edit interface name\", \"Delete firewall rule\"\n  description: string;\n\n  // When the action was executed\n  timestamp: Date;\n\n  // Scope determines persistence and lifecycle\n  scope: 'page' | 'global';\n\n  // Execute the action (for redo)\n  execute: () => void | Promise<void>;\n\n  // Undo the action (restore previous state)\n  undo: () => void | Promise<void>;\n\n  // Optional resource context\n  resourceId?: string;           // UUID of affected resource\n  resourceType?: string;         // Type for categorization (e.g., 'network.interface')\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"action-scopes",children:"Action Scopes"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Scope"}),(0,i.jsx)(n.th,{children:"Persistence"}),(0,i.jsx)(n.th,{children:"Lifecycle"}),(0,i.jsx)(n.th,{children:"Use Cases"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"page"})}),(0,i.jsx)(n.td,{children:"None"}),(0,i.jsx)(n.td,{children:"Cleared on navigation"}),(0,i.jsx)(n.td,{children:"Form edits, UI state changes"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"global"})}),(0,i.jsx)(n.td,{children:"localStorage"}),(0,i.jsx)(n.td,{children:"Survives page refresh"}),(0,i.jsx)(n.td,{children:"Router config changes, important edits"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"non-undoable-actions",children:"Non-Undoable Actions"}),"\n",(0,i.jsx)(n.p,{children:"Certain action categories should NOT be added to history:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"export const NON_UNDOABLE_CATEGORIES = [\n  'applied-configuration',    // Already sent to router\n  'confirmed-delete',         // User explicitly confirmed\n  'security-change',          // Password, certificate changes\n  'authentication',           // Logout, session changes\n  'restart-required',         // Service restart needed\n  'external-integration',     // External system actions\n];\n\n// Check before adding to history\nif (isNonUndoableCategory(actionCategory)) {\n  return; // Skip history\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"history-store-api",children:"History Store API"}),"\n",(0,i.jsx)(n.h3,{id:"state-shape-in-store",children:"State Shape in Store"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"export const useHistoryStore = create<HistoryState & HistoryActions>()...\n"})}),"\n",(0,i.jsx)(n.h3,{id:"actions",children:"Actions"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Action"}),(0,i.jsx)(n.th,{children:"Signature"}),(0,i.jsx)(n.th,{children:"Purpose"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"pushAction"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"(action: UndoableActionInput) => string"})}),(0,i.jsx)(n.td,{children:"Add to past, clear future, return action ID"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"undo"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"() => Promise<boolean>"})}),(0,i.jsx)(n.td,{children:"Undo last, true if successful"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"redo"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"() => Promise<boolean>"})}),(0,i.jsx)(n.td,{children:"Redo last undone, true if successful"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"jumpToIndex"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"(index: number) => Promise<void>"})}),(0,i.jsx)(n.td,{children:"Jump to specific point in past"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"clearHistory"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"() => void"})}),(0,i.jsx)(n.td,{children:"Clear past and future"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"clearPageHistory"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"() => void"})}),(0,i.jsx)(n.td,{children:"Clear only page-scoped actions"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"selectors",children:"Selectors"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"selectCanUndo: (state) => state.past.length > 0;\nselectCanRedo: (state) => state.future.length > 0;\nselectLastAction: (state) => state.past[length - 1];\nselectHistoryLength: (state) => state.past.length;\nselectPastActions: (state) => state.past;  // For history panel\nselectFutureActions: (state) => state.future;\nselectCurrentPosition: (state) => state.past.length - 1;\n"})}),"\n",(0,i.jsx)(n.h3,{id:"convenience-functions",children:"Convenience Functions"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// Imperative API (outside React components)\nawait undoLast();\nawait redoLast();\npushHistoryAction(action);\nclearAllHistory();\nclearPageScopedHistory();  // Call on navigation\n\n// State access\ngetHistoryState();                    // Get state snapshot\nsubscribeHistoryState(callback);      // Subscribe to changes\n"})}),"\n",(0,i.jsx)(n.h2,{id:"command-pattern-utilities",children:"Command Pattern Utilities"}),"\n",(0,i.jsx)(n.h3,{id:"factory-functions",children:"Factory Functions"}),"\n",(0,i.jsx)(n.h4,{id:"createundoableaction",children:"createUndoableAction()"}),"\n",(0,i.jsx)(n.p,{children:"Generic factory for creating actions:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const action = createUndoableAction({\n  type: 'edit',\n  description: 'Edit interface name',\n  scope: 'page',\n  execute: () => setName(newName),\n  undo: () => setName(oldName),\n  resourceId: 'interface-ether1',\n  resourceType: 'network.interface',\n});\n"})}),"\n",(0,i.jsx)(n.h4,{id:"executeaction",children:"executeAction()"}),"\n",(0,i.jsx)(n.p,{children:"Execute action and auto-push to history:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// Action executes immediately, then adds to history\nconst actionId = await executeAction({\n  type: 'edit',\n  description: 'Change interface IP',\n  scope: 'page',\n  execute: async () => await api.updateInterface(id, { ip: newIp }),\n  undo: async () => await api.updateInterface(id, { ip: oldIp }),\n});\n"})}),"\n",(0,i.jsx)(n.h3,{id:"common-pattern-helpers",children:"Common Pattern Helpers"}),"\n",(0,i.jsx)(n.h4,{id:"createeditaction",children:"createEditAction()"}),"\n",(0,i.jsx)(n.p,{children:"Single field change with old/new values:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const action = createEditAction({\n  fieldName: 'name',\n  oldValue: 'ether1',\n  newValue: 'WAN',\n  apply: (value) => updateInterface({ name: value }),\n  resourceId: 'interface-ether1',\n  resourceType: 'network.interface',\n  scope: 'page',\n});\n"})}),"\n",(0,i.jsx)(n.h4,{id:"createdeleteaction",children:"createDeleteAction()"}),"\n",(0,i.jsx)(n.p,{children:"Delete with restore capability:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const action = createDeleteAction({\n  itemName: 'Bridge interface',\n  deletedItem: bridgeData,\n  onDelete: async () => await api.deleteBridge(id),\n  onRestore: async (item) => await api.createBridge(item),\n  resourceId: 'bridge-1',\n  resourceType: 'network.bridge',\n  scope: 'global',  // Global by default\n});\n"})}),"\n",(0,i.jsx)(n.h4,{id:"createcreateaction",children:"createCreateAction()"}),"\n",(0,i.jsx)(n.p,{children:"Create with delete as undo:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const action = createCreateAction({\n  itemName: 'WireGuard peer',\n  onCreate: async () => {\n    const peer = await api.createPeer(config);\n    return peer.id;\n  },\n  onDelete: async (id) => await api.deletePeer(id),\n  resourceType: 'vpn.wireguard.peer',\n  scope: 'global',\n});\n"})}),"\n",(0,i.jsx)(n.h4,{id:"createreorderaction",children:"createReorderAction()"}),"\n",(0,i.jsx)(n.p,{children:"List item reordering:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const action = createReorderAction({\n  listName: 'Firewall rules',\n  fromIndex: 2,\n  toIndex: 0,\n  apply: (from, to) => moveRule(from, to),\n  resourceType: 'firewall.rule',\n  scope: 'page',\n});\n"})}),"\n",(0,i.jsx)(n.h3,{id:"composite-and-batch-actions",children:"Composite and Batch Actions"}),"\n",(0,i.jsx)(n.h4,{id:"createcompositeaction",children:"createCompositeAction()"}),"\n",(0,i.jsx)(n.p,{children:"Group multiple changes as single undo unit:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const action = createCompositeAction({\n  description: 'Create LAN network',\n  actions: [\n    {\n      execute: () => createBridge(),\n      undo: () => deleteBridge()\n    },\n    {\n      execute: () => createDHCP(),\n      undo: () => deleteDHCP()\n    },\n    {\n      execute: () => createFirewall(),\n      undo: () => deleteFirewall()\n    },\n  ],\n  scope: 'global',\n});\n\n// Executes in order, undoes in reverse order\n"})}),"\n",(0,i.jsx)(n.h4,{id:"executebatch",children:"executeBatch()"}),"\n",(0,i.jsx)(n.p,{children:"Execute multiple actions as single history entry:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"await executeBatch({\n  description: 'Bulk delete interfaces',\n  actions: interfaces.map(iface => ({\n    execute: () => deleteInterface(iface.id),\n    undo: () => restoreInterface(iface),\n  })),\n  scope: 'global',\n});\n"})}),"\n",(0,i.jsx)(n.h3,{id:"change-set-integration",children:"Change Set Integration"}),"\n",(0,i.jsx)(n.p,{children:"Treat entire change sets as single undo entries:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import { useChangeSetStore } from '@nasnet/state/stores';\n\nconst action = createChangeSetAction({\n  changeSetId: 'cs-123',\n  changeSetName: 'Create LAN Network',\n  onReapply: async () => {\n    // Re-apply the change set (for redo)\n    await applyChangeSet(changeSetId);\n  },\n  onRollback: async () => {\n    // Mark as rolled back\n    const { markRolledBack } = useChangeSetStore.getState();\n    markRolledBack(changeSetId);\n  },\n});\n\n// Now entire changeset is one undoable unit\nawait executeAction(action);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"react-hook-usefieldedit",children:"React Hook: useFieldEdit()"}),"\n",(0,i.jsx)(n.p,{children:"Hook for tracking field edits in forms:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"function InterfaceNameInput({ value, onChange }) {\n  const recordEdit = useFieldEdit({\n    fieldName: 'name',\n    resourceId: 'interface-1',\n    resourceType: 'network.interface',\n    scope: 'page',\n  });\n\n  const handleChange = (newValue: string) => {\n    // Record before applying\n    recordEdit(value, newValue, (v) => onChange(v));\n  };\n\n  return (\n    <Input value={value} onChange={e => handleChange(e.target.value)} />\n  );\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"keyboard-shortcuts-integration",children:"Keyboard Shortcuts Integration"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"useHistoryShortcuts()"})," hook registers undo/redo shortcuts:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"function App() {\n  useHistoryShortcuts();  // Call once at app root\n  return <RouterProvider router={router} />;\n}\n\n// Automatically registers:\n// - Cmd+Z / Ctrl+Z \u2192 undo\n// - Cmd+Shift+Z / Ctrl+Y \u2192 redo (Windows)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"shortcut-behavior",children:"Shortcut Behavior"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// Undo notification with redo action\nif (success) {\n  notification({\n    type: 'info',\n    title: `Undone: ${lastAction.description}`,\n    duration: 10000,\n    action: {\n      label: 'Redo',\n      onClick: async () => await redoLast(),\n    },\n  });\n}\n\n// Redo notification\nnotification({\n  type: 'info',\n  title: `Redone: ${actionToRedo.description}`,\n  duration: 4000,\n});\n"})}),"\n",(0,i.jsx)(n.h2,{id:"persistence-model",children:"Persistence Model"}),"\n",(0,i.jsx)(n.h3,{id:"stored-actions",children:"Stored Actions"}),"\n",(0,i.jsxs)(n.p,{children:["Only ",(0,i.jsx)(n.strong,{children:"global-scope"})," actions are persisted to localStorage:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// In partialize middleware\npartialize: (state) => ({\n  past: state.past\n    .filter((a) => a.scope === 'global')\n    .map(serializeAction),\n  future: state.future\n    .filter((a) => a.scope === 'global')\n    .map(serializeAction),\n}),\n"})}),"\n",(0,i.jsx)(n.h3,{id:"serialization",children:"Serialization"}),"\n",(0,i.jsx)(n.p,{children:"Functions cannot be persisted, so only metadata is stored:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"interface SerializedAction {\n  id: string;\n  type: UndoableAction['type'];\n  description: string;\n  timestamp: string;  // ISO string\n  scope: UndoableAction['scope'];\n  resourceId?: string;\n  resourceType?: string;\n  // execute/undo functions are LOST\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"rehydration-limitations",children:"Rehydration Limitations"}),"\n",(0,i.jsx)(n.p,{children:"After page refresh, persisted actions show in history but cannot execute:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// On rehydration, provide no-op functions\nexecute: () => {\n  console.warn('[history-store] Cannot re-execute persisted action');\n},\nundo: () => {\n  console.warn('[history-store] Cannot undo persisted action');\n},\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Implication"}),": Full undo/redo requires keeping execute/undo functions in memory. Use global scope only for display purposes or re-register actions on mount."]}),"\n",(0,i.jsx)(n.h2,{id:"state-flow-diagram",children:"State Flow Diagram"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n         \u2502   Push New Action       \u2502\n         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                      \u2502\n                      \u25bc\n              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n              \u2502 past \u2190 action    \u2502\n              \u2502 future.clear()   \u2502\n              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518\n                           \u2502\n                \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                \u2502                     \u2502\n                \u25bc                     \u25bc\n        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n        \u2502   Undo()     \u2502     \u2502   Redo()     \u2502\n        \u2502 past.pop()   \u2502     \u2502 future.pop() \u2502\n        \u2502 future.push()\u2502     \u2502 past.push()  \u2502\n        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n               \u2502                    \u2502\n               \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                      \u2502\n                      \u25bc\n          \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n          \u2502 Execute action.undo()  \u2502\n          \u2502 or action.execute()    \u2502\n          \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                       \u2502\n                \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n           async         sync \u2502\n              \u2502                \u2502\n              \u25bc                \u25bc\n         (awaited)       (immediate)\n"})}),"\n",(0,i.jsx)(n.h2,{id:"interaction-with-change-sets",children:"Interaction with Change Sets"}),"\n",(0,i.jsx)(n.p,{children:"The change set store (NAS-4.14) produces UndoableActions for the history system:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Change Set (NAS-4.14)\n       \u2502\n       \u251c\u2500 Item 1: CREATE bridge\n       \u251c\u2500 Item 2: CREATE DHCP\n       \u2514\u2500 Item 3: CREATE firewall\n              \u2502\n              \u25bc\n    [Apply-Confirm-Merge]\n    (Docs/architecture/data-architecture.md)\n              \u2502\n              \u25bc\n    createChangeSetAction()  \u2190 Creates single undo entry\n              \u2502\n              \u25bc\n    useHistoryStore.pushAction()\n              \u2502\n              \u25bc\n    User can now Ctrl+Z to undo entire changeset\n"})}),"\n",(0,i.jsx)(n.h2,{id:"limitations-and-edge-cases",children:"Limitations and Edge Cases"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Persisted Actions Cannot Undo"}),": After page refresh, execute/undo are no-ops"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Solution"}),": Design persistence around config snapshots, not action replay"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Async Errors"}),": If undo/redo throws, action isn't moved to other stack"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Solution"}),": Retry UI, manual intervention, error logging"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Memory Overhead"}),": 50 actions \xd7 complex state can exceed memory on slow devices"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Solution"}),": Adjust MAX_ACTIONS constant for resource-constrained environments"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Change Set Rollbacks"}),": If change set fails, history still contains successful items"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Solution"}),": Use composite action to ensure all-or-nothing with change sets"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Use Scopes Correctly"}),": Global only for important user changes (config edits), page for temp UI state"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Avoid Circular Dependencies"}),": Action A undoes to state B, but action B redoes to state A \u2192 infinite loop"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Keep Descriptions Clear"}),": Used in notifications and history panel"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Use Resource IDs"}),": Help correlate actions to affected resources"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Test with Async"}),": API calls may fail; test both success and error paths"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Consider Granularity"}),": Batch small changes (e.g., form fields) as single action"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Disable on Destructive Routes"}),": Some pages (delete confirmation) shouldn't have undo"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Test Persistence"}),": Verify global actions survive page refresh (even if execution fails)"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Change Set Store"}),": ",(0,i.jsx)(n.code,{children:"change-set.md"})," - Integration with multi-resource operations"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Command Palette"}),": ",(0,i.jsx)(n.code,{children:"command-shortcut.md"})," - Keyboard shortcut binding"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Core State Architecture"}),": ",(0,i.jsx)(n.code,{children:"overview.md"})," - Zustand patterns"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Apply-Confirm-Merge Flow"}),": ",(0,i.jsx)(n.code,{children:"../../architecture/data-architecture.md#state-flow-apply--confirm--merge"})]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}}}]);