"use strict";(globalThis.webpackChunk_nas_net_docs=globalThis.webpackChunk_nas_net_docs||[]).push([[73529],{57239:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"data-fetching/codegen","title":"GraphQL Code Generation","description":"The project uses @graphql-codegen/cli to generate TypeScript types, Apollo React hooks, and a fragment matcher from the GraphQL schema. Generated files are never edited by hand.","source":"@site/../connect/docs/data-fetching/codegen.md","sourceDirName":"data-fetching","slug":"/data-fetching/codegen","permalink":"/docs/frontend/data-fetching/codegen","draft":false,"unlisted":false,"editUrl":"https://github.com/nasnet-community/nasnet-panel/tree/main/../connect/docs/data-fetching/codegen.md","tags":[],"version":"current","frontMatter":{},"sidebar":"sidebar","previous":{"title":"Virtual Interface Factory (VIF)","permalink":"/docs/frontend/cross-cutting-features/virtual-interface-factory"},"next":{"title":"GraphQL Hooks","permalink":"/docs/frontend/data-fetching/graphql-hooks"}}');var r=t(31085),i=t(71184);const o={},c="GraphQL Code Generation",d={},a=[{value:"What Gets Generated",id:"what-gets-generated",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Schema source",id:"schema-source",level:3},{value:"Document sources (operations)",id:"document-sources-operations",level:3},{value:"Type generation options",id:"type-generation-options",level:3},{value:"Hook generation options",id:"hook-generation-options",level:3},{value:"Running Codegen",id:"running-codegen",level:2},{value:"Generated Hook Naming Convention",id:"generated-hook-naming-convention",level:2},{value:"Fragment Matcher",id:"fragment-matcher",level:2},{value:"After Schema Changes",id:"after-schema-changes",level:2},{value:"Import Path",id:"import-path",level:2}];function l(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"graphql-code-generation",children:"GraphQL Code Generation"})}),"\n",(0,r.jsxs)(n.p,{children:["The project uses ",(0,r.jsx)(n.code,{children:"@graphql-codegen/cli"})," to generate TypeScript types, Apollo React hooks, and a fragment matcher from the GraphQL schema. Generated files are never edited by hand."]}),"\n",(0,r.jsx)(n.h2,{id:"what-gets-generated",children:"What Gets Generated"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Output file"}),(0,r.jsx)(n.th,{children:"Plugin(s)"}),(0,r.jsx)(n.th,{children:"Content"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"libs/api-client/generated/types.ts"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"typescript"})}),(0,r.jsxs)(n.td,{children:["All schema types as TypeScript ",(0,r.jsx)(n.code,{children:"type"})," aliases"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"libs/api-client/generated/operations.ts"})}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"typescript-operations"}),", ",(0,r.jsx)(n.code,{children:"typescript-react-apollo"})]}),(0,r.jsx)(n.td,{children:"Typed hooks for every query/mutation/subscription"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"libs/api-client/generated/schema.graphql"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"schema-ast"})}),(0,r.jsx)(n.td,{children:"Full schema AST (used by IDEs and tooling)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"libs/api-client/generated/fragment-matcher.ts"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"fragment-matcher"})}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"possibleTypes"})," result for Apollo cache union resolution"]})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,r.jsxs)(n.p,{children:["File: ",(0,r.jsx)(n.code,{children:"codegen.ts"})," (root of the monorepo)"]}),"\n",(0,r.jsx)(n.h3,{id:"schema-source",children:"Schema source"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"schema: './schema/**/*.graphql'\n"})}),"\n",(0,r.jsxs)(n.p,{children:["The schema is split across many files in ",(0,r.jsx)(n.code,{children:"schema/"}),". Codegen reads all of them."]}),"\n",(0,r.jsx)(n.h3,{id:"document-sources-operations",children:"Document sources (operations)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"documents: [\n  'apps/connect/src/**/*.graphql',\n  'apps/connect/src/**/*.tsx',\n  'libs/**/*.graphql',\n  'libs/**/*.tsx',\n  '!libs/api-client/generated/**/*',  // Exclude generated output\n  '!libs/core-ui-qwik/**/*',\n  '!libs/star-setup/**/*',\n  '!libs/**/*.stories.tsx',\n]\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Codegen scans both ",(0,r.jsx)(n.code,{children:".graphql"})," files and ",(0,r.jsx)(n.code,{children:".tsx"})," files for ",(0,r.jsx)(n.code,{children:"gql"})," tagged template literals."]}),"\n",(0,r.jsx)(n.h3,{id:"type-generation-options",children:"Type generation options"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// types.ts config\ndeclarationKind: 'type',    // 'type' not 'interface' for better tree-shaking\nimmutableTypes: true,        // All fields are readonly\nenumsAsConst: true,          // Enums as const objects\nskipTypename: true,           // No __typename in generated types\nmaybeValue: 'T | null | undefined',\n\n// Custom scalar mappings\nscalars: {\n  DateTime: 'string',\n  IPv4: 'string',\n  IPv6: 'string',\n  MAC: 'string',\n  CIDR: 'string',\n  Port: 'number',\n  PortRange: 'string',\n  Duration: 'string',\n  Bandwidth: 'string',\n  Size: 'string',\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"hook-generation-options",children:"Hook generation options"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// operations.ts config\nwithHooks: true,              // Generate useXxx hooks\nwithHOC: false,               // No higher-order components\nwithComponent: false,         // No render prop components\napolloClientVersion: 3,\ndocumentMode: 'documentNode', // Export DocumentNode objects\ndedupeFragments: true,\n"})}),"\n",(0,r.jsx)(n.h2,{id:"running-codegen",children:"Running Codegen"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Full codegen (TypeScript + Go)\nnpm run codegen\n\n# TypeScript only (types, hooks)\nnpm run codegen:ts\n\n# Go only (ent ORM + gqlgen resolvers)\nnpm run codegen:go\n\n# Verify generated code is in sync with schema\nnpm run codegen:check\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Prettier is run automatically after generation via the ",(0,r.jsx)(n.code,{children:"hooks.afterAllFileWrite"})," option."]}),"\n",(0,r.jsx)(n.h2,{id:"generated-hook-naming-convention",children:"Generated Hook Naming Convention"}),"\n",(0,r.jsx)(n.p,{children:"Codegen derives hook names from the GraphQL operation name:"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Operation"}),(0,r.jsx)(n.th,{children:"Generated hook"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"query GetRouters"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"useGetRoutersQuery"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"mutation CreateResource"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"useCreateResourceMutation"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"subscription OnServiceStatus"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"useOnServiceStatusSubscription"})})]})]})]}),"\n",(0,r.jsxs)(n.p,{children:["The custom hooks in ",(0,r.jsx)(n.code,{children:"libs/api-client/queries/src/"})," often wrap these generated hooks to add type safety, default variables, or convenience patterns."]}),"\n",(0,r.jsx)(n.h2,{id:"fragment-matcher",children:"Fragment Matcher"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"fragment-matcher.ts"})," output provides ",(0,r.jsx)(n.code,{children:"possibleTypes"})," for the Apollo cache. This lets Apollo correctly normalise union and interface types (e.g., the ",(0,r.jsx)(n.code,{children:"Resource"})," interface implemented by ",(0,r.jsx)(n.code,{children:"WireGuardClient"}),", ",(0,r.jsx)(n.code,{children:"LANNetwork"}),", ",(0,r.jsx)(n.code,{children:"WANLink"}),", etc.)."]}),"\n",(0,r.jsxs)(n.p,{children:["It is imported in ",(0,r.jsx)(n.code,{children:"apollo-client.ts"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"import { possibleTypesResult } from '@nasnet/api-client/generated';\n\nconst cache = new InMemoryCache({\n  possibleTypes: possibleTypesResult.possibleTypes,\n  // ...\n});\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Important"}),": After any schema change that adds or modifies union/interface types, regenerate this file or Apollo will silently fail to normalise cache entries correctly."]}),"\n",(0,r.jsx)(n.h2,{id:"after-schema-changes",children:"After Schema Changes"}),"\n",(0,r.jsxs)(n.p,{children:["Whenever ",(0,r.jsx)(n.code,{children:".graphql"})," files in ",(0,r.jsx)(n.code,{children:"schema/"})," are modified:"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Run ",(0,r.jsx)(n.code,{children:"npm run codegen:ts"})," to regenerate TypeScript types and hooks"]}),"\n",(0,r.jsxs)(n.li,{children:["If ent entities changed, run ",(0,r.jsx)(n.code,{children:"npm run codegen:ent"})]}),"\n",(0,r.jsxs)(n.li,{children:["If resolver signatures changed, run ",(0,r.jsx)(n.code,{children:"npm run codegen:gqlgen"})]}),"\n",(0,r.jsxs)(n.li,{children:["Run ",(0,r.jsx)(n.code,{children:"npm run codegen:check"})," in CI to verify generated files are up to date"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["The CI pipeline runs ",(0,r.jsx)(n.code,{children:"codegen:check"})," to block merges if generated files are stale."]}),"\n",(0,r.jsx)(n.h2,{id:"import-path",children:"Import Path"}),"\n",(0,r.jsxs)(n.p,{children:["Generated files are exposed under the ",(0,r.jsx)(n.code,{children:"@nasnet/api-client/generated"})," alias:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"import type { Router, Resource, WireGuardClient } from '@nasnet/api-client/generated';\nimport { useGetRoutersQuery } from '@nasnet/api-client/generated';\nimport { possibleTypesResult } from '@nasnet/api-client/generated';\n"})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},71184:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>c});var s=t(14041);const r={},i=s.createContext(r);function o(e){const n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);