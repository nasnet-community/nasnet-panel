"use strict";(globalThis.webpackChunk_nas_net_docs=globalThis.webpackChunk_nas_net_docs||[]).push([[26797],{45417:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>p,frontMatter:()=>i,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"testing/component-testing","title":"Component Testing","description":"Component tests verify that React components render correctly and respond to user interactions as expected. They sit at the integration level of the testing pyramid \u2014 components are rendered with real logic, connected to mocked network requests via MSW, and exercised through user events.","source":"@site/../connect/docs/testing/component-testing.md","sourceDirName":"testing","slug":"/testing/component-testing","permalink":"/docs/frontend/testing/component-testing","draft":false,"unlisted":false,"editUrl":"https://github.com/nasnet-community/nasnet-panel/tree/main/../connect/docs/testing/component-testing.md","tags":[],"version":"current","frontMatter":{},"sidebar":"sidebar","previous":{"title":"Zustand Stores Inventory","permalink":"/docs/frontend/state-management/zustand-stores"},"next":{"title":"E2E Testing","permalink":"/docs/frontend/testing/e2e-testing"}}');var s=t(31085),o=t(71184);const i={},c="Component Testing",a={},d=[{value:"Custom Render Wrapper",id:"custom-render-wrapper",level:2},{value:"Provider Stack",id:"provider-stack",level:3},{value:"renderWithUser",id:"renderwithuser",level:3},{value:"Component Test Patterns",id:"component-test-patterns",level:2},{value:"Rendering and Snapshot",id:"rendering-and-snapshot",level:3},{value:"User Interactions",id:"user-interactions",level:3},{value:"Expand/Collapse Interactions",id:"expandcollapse-interactions",level:3},{value:"Testing Error States",id:"testing-error-states",level:3},{value:"Storybook Component Testing",id:"storybook-component-testing",level:2},{value:"Story Structure",id:"story-structure",level:3},{value:"Story Conventions",id:"story-conventions",level:3},{value:"Running Storybook",id:"running-storybook",level:3},{value:"Testing Responsive Behavior",id:"testing-responsive-behavior",level:2},{value:"Platform Mock",id:"platform-mock",level:3},{value:"Testing Forms",id:"testing-forms",level:2},{value:"Testing with Apollo",id:"testing-with-apollo",level:2},{value:"Accessibility in Component Tests",id:"accessibility-in-component-tests",level:2},{value:"See Also",id:"see-also",level:2}];function l(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"component-testing",children:"Component Testing"})}),"\n",(0,s.jsx)(n.p,{children:"Component tests verify that React components render correctly and respond to user interactions as expected. They sit at the integration level of the testing pyramid \u2014 components are rendered with real logic, connected to mocked network requests via MSW, and exercised through user events."}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Tools:"})," React Testing Library, ",(0,s.jsx)(n.code,{children:"@testing-library/user-event"}),", MSW"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"custom-render-wrapper",children:"Custom Render Wrapper"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"apps/connect/src/test/test-utils.tsx"})," provides a ",(0,s.jsx)(n.code,{children:"render"})," function that wraps components with all application providers. This replaces the default ",(0,s.jsx)(n.code,{children:"render"})," from ",(0,s.jsx)(n.code,{children:"@testing-library/react"})," throughout the test suite."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { render, screen } from '@/test/test-utils';\n// NOT: import { render } from '@testing-library/react';\n"})}),"\n",(0,s.jsx)(n.h3,{id:"provider-stack",children:"Provider Stack"}),"\n",(0,s.jsx)(n.p,{children:"The test wrapper mirrors the production provider tree:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:"function AllProviders({ children }: AllProvidersProps): ReactElement {\n  const queryClient = createTestQueryClient();\n  const router = createTestRouter(children);\n\n  return (\n    <MockApolloProvider>\n      <I18nProvider>\n        <DirectionProvider>\n          <ThemeProvider>\n            <PlatformProvider>\n              <AnimationProvider>\n                <QueryClientProvider client={queryClient}>\n                  <ToastProvider>\n                    <RouterProvider router={router} />\n                  </ToastProvider>\n                </QueryClientProvider>\n              </AnimationProvider>\n            </PlatformProvider>\n          </ThemeProvider>\n        </DirectionProvider>\n      </I18nProvider>\n    </MockApolloProvider>\n  );\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Each test gets a ",(0,s.jsx)(n.strong,{children:"fresh"})," ",(0,s.jsx)(n.code,{children:"QueryClient"})," and in-memory router \u2014 state does not leak between tests."]}),"\n",(0,s.jsxs)(n.p,{children:["See ",(0,s.jsx)(n.code,{children:"../architecture/provider-stack.md"})," for the full production provider hierarchy and how it maps to this test wrapper."]}),"\n",(0,s.jsx)(n.h3,{id:"renderwithuser",children:"renderWithUser"}),"\n",(0,s.jsxs)(n.p,{children:["For tests that involve user interactions, use ",(0,s.jsx)(n.code,{children:"renderWithUser"})," to get a pre-configured ",(0,s.jsx)(n.code,{children:"userEvent"})," instance:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { renderWithUser, screen } from '@/test/test-utils';\n\nit('should update when clicked', async () => {\n  const { user } = renderWithUser(<MyComponent />);\n\n  await user.click(screen.getByRole('button', { name: /submit/i }));\n\n  expect(screen.getByText('Submitted')).toBeInTheDocument();\n});\n"})}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"user"})," object from ",(0,s.jsx)(n.code,{children:"userEvent.setup()"})," simulates realistic browser events (pointer events, input events, focus changes) rather than synthetic events."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"component-test-patterns",children:"Component Test Patterns"}),"\n",(0,s.jsx)(n.h3,{id:"rendering-and-snapshot",children:"Rendering and Snapshot"}),"\n",(0,s.jsxs)(n.p,{children:["Test that a component renders its expected structure. Prefer ",(0,s.jsx)(n.code,{children:"getByRole"})," and ",(0,s.jsx)(n.code,{children:"getByText"})," over snapshots, which are fragile to markup changes."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:"// ARPTable.test.tsx\nimport { render, screen } from '@testing-library/react';\nimport { ARPTable } from './ARPTable';\n\nconst mockEntries: ARPEntry[] = [\n  {\n    id: '*1',\n    ipAddress: '192.168.1.10',\n    macAddress: 'AA:BB:CC:DD:EE:FF',\n    interface: 'bridge',\n    status: 'complete',\n    isDynamic: true,\n  },\n  ...\n];\n\nit('should render table headers', () => {\n  render(<ARPTable entries={mockEntries} />);\n  expect(screen.getByText('IP Address')).toBeInTheDocument();\n  expect(screen.getByText('MAC Address')).toBeInTheDocument();\n  expect(screen.getByText('Interface')).toBeInTheDocument();\n  expect(screen.getByText('Status')).toBeInTheDocument();\n});\n\nit('should display all entries', () => {\n  render(<ARPTable entries={mockEntries} />);\n  expect(screen.getByText('192.168.1.10')).toBeInTheDocument();\n  expect(screen.getByText('AA:BB:CC:DD:EE:FF')).toBeInTheDocument();\n});\n\nit('should show empty state when no entries', () => {\n  render(<ARPTable entries={[]} />);\n  expect(screen.getByText('No ARP entries found')).toBeInTheDocument();\n});\n"})}),"\n",(0,s.jsx)(n.h3,{id:"user-interactions",children:"User Interactions"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:"// ARPTable.test.tsx \u2014 sort interaction\nimport userEvent from '@testing-library/user-event';\n\nit('should sort by IP address numerically', async () => {\n  const user = userEvent.setup();\n  const { container } = render(<ARPTable entries={mockEntries} />);\n\n  // Click column header to sort ascending\n  await user.click(screen.getByText('IP Address'));\n\n  const rows = container.querySelectorAll('tbody tr');\n  const firstIP = rows[0].querySelector('td')?.textContent;\n  expect(firstIP).toBe('10.0.0.1'); // Numerically lowest\n});\n\nit('should cycle sort states: asc \u2192 desc \u2192 none', async () => {\n  const user = userEvent.setup();\n  render(<ARPTable entries={mockEntries} />);\n\n  const ipHeader = screen.getByText('IP Address');\n  await user.click(ipHeader); // ascending\n  await user.click(ipHeader); // descending\n  await user.click(ipHeader); // no sort\n});\n"})}),"\n",(0,s.jsx)(n.h3,{id:"expandcollapse-interactions",children:"Expand/Collapse Interactions"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:"// InterfaceCard.test.tsx\nit('should expand to show traffic statistics when clicked', async () => {\n  const user = userEvent.setup();\n  (queries.useInterfaceTraffic as ReturnType<typeof vi.fn>).mockReturnValue({\n    data: {\n      interfaceId: '*1',\n      txBytes: 1024000,\n      rxBytes: 2048000,\n      txPackets: 1000,\n      rxPackets: 2000,\n      txErrors: 0,\n      rxErrors: 0,\n      txDrops: 0,\n      rxDrops: 0,\n    },\n    isLoading: false,\n    error: null,\n  });\n\n  render(<InterfaceCard interface={mockInterface} />);\n  await user.click(screen.getByRole('button'));\n\n  await waitFor(() => {\n    expect(screen.getByText('Traffic Statistics')).toBeInTheDocument();\n  });\n});\n\nit('should show loading state when fetching traffic stats', async () => {\n  const user = userEvent.setup();\n  (queries.useInterfaceTraffic as ReturnType<typeof vi.fn>).mockReturnValue({\n    data: undefined,\n    isLoading: true,\n    error: null,\n  });\n\n  render(<InterfaceCard interface={mockInterface} />);\n  await user.click(screen.getByRole('button'));\n\n  await waitFor(() => {\n    expect(screen.getByText('Loading traffic statistics...')).toBeInTheDocument();\n  });\n});\n"})}),"\n",(0,s.jsx)(n.h3,{id:"testing-error-states",children:"Testing Error States"}),"\n",(0,s.jsx)(n.p,{children:"Override the default MSW handler in a specific test to simulate failure:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:"import { server } from '@/mocks/server';\nimport { errorHandler } from '@/mocks/handlers/graphql';\n\nit('should display error when router is unreachable', async () => {\n  server.use(errorHandler);\n\n  render(<RouterDashboard routerId=\"r1\" />);\n\n  expect(await screen.findByText(/router connection failed/i)).toBeInTheDocument();\n});\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"storybook-component-testing",children:"Storybook Component Testing"}),"\n",(0,s.jsx)(n.p,{children:"Stories serve as visual documentation and as test fixtures. Each story represents a distinct component state. The connect app has 90+ story files across all components."}),"\n",(0,s.jsx)(n.h3,{id:"story-structure",children:"Story Structure"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:"// InterfaceCard.stories.tsx\nimport type { Meta, StoryObj } from '@storybook/react';\nimport { InterfaceCard } from './InterfaceCard';\n\nconst meta: Meta<typeof InterfaceCard> = {\n  title: 'App/Network/InterfaceCard',\n  component: InterfaceCard,\n  tags: ['autodocs'],\n  parameters: {\n    layout: 'padded',\n  },\n};\n\nexport default meta;\ntype Story = StoryObj<typeof InterfaceCard>;\n\n// Each export is a story \u2014 one per meaningful state\nexport const RunningLinkUp: Story = {\n  args: {\n    interface: makeInterface({ status: 'running', linkStatus: 'up' }),\n  },\n};\n\nexport const Disabled: Story = {\n  args: {\n    interface: makeInterface({ status: 'disabled', linkStatus: 'down' }),\n  },\n};\n\n// Platform-specific stories\nexport const Mobile: Story = {\n  ...RunningLinkUp,\n  parameters: {\n    viewport: { defaultViewport: 'mobile1' },\n  },\n};\n\nexport const Desktop: Story = {\n  ...RunningLinkUp,\n  parameters: {\n    viewport: { defaultViewport: 'desktop' },\n  },\n};\n"})}),"\n",(0,s.jsx)(n.h3,{id:"story-conventions",children:"Story Conventions"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Use ",(0,s.jsx)(n.code,{children:"makeInterface()"})," / factory functions for test data \u2014 avoid hard-coded objects duplicated across stories"]}),"\n",(0,s.jsx)(n.li,{children:"Each story covers exactly one meaningful state (running, disabled, loading, error, empty, etc.)"}),"\n",(0,s.jsxs)(n.li,{children:["Add ",(0,s.jsx)(n.code,{children:"Mobile"})," and ",(0,s.jsx)(n.code,{children:"Desktop"})," stories for components that have platform-specific rendering"]}),"\n",(0,s.jsxs)(n.li,{children:["Use ",(0,s.jsx)(n.code,{children:"tags: ['autodocs']"})," to auto-generate API documentation from JSDoc"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"running-storybook",children:"Running Storybook"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Connect app Storybook (port 4400)\nnpx nx run connect:storybook\n\n# Build all Storybooks for deployment\nnpx nx run-many -t build-storybook\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"testing-responsive-behavior",children:"Testing Responsive Behavior"}),"\n",(0,s.jsx)(n.h3,{id:"platform-mock",children:"Platform Mock"}),"\n",(0,s.jsxs)(n.p,{children:["Components use ",(0,s.jsx)(n.code,{children:"usePlatform()"})," to select between mobile and desktop presenters. In tests, the platform is controlled by mocking the media query:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// In test setup (setup.ts), matchMedia returns { matches: false } by default\n// This means isMobile = false, so desktop presenter is rendered\n\n// To test mobile presenter, override in the test:\nvi.mocked(window.matchMedia).mockImplementation(query => ({\n  matches: query.includes('max-width: 639px'), // mobile breakpoint\n  media: query,\n  onchange: null,\n  addListener: vi.fn(),\n  removeListener: vi.fn(),\n  addEventListener: vi.fn(),\n  removeEventListener: vi.fn(),\n  dispatchEvent: vi.fn(),\n}));\n"})}),"\n",(0,s.jsx)(n.p,{children:"In Storybook, use viewport presets:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"export const Mobile: Story = {\n  parameters: {\n    viewport: { defaultViewport: 'mobile1' }, // 375\xd7667\n  },\n};\n\nexport const Tablet: Story = {\n  parameters: {\n    viewport: { defaultViewport: 'tablet' }, // 768\xd71024\n  },\n};\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"testing-forms",children:"Testing Forms"}),"\n",(0,s.jsxs)(n.p,{children:["Forms typically need React Hook Form context. Use the full wrapper from ",(0,s.jsx)(n.code,{children:"test-utils.tsx"}),", or provide a minimal form wrapper:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:"import { useForm, FormProvider } from 'react-hook-form';\n\nfunction FormWrapper({ children }: { children: ReactNode }) {\n  const methods = useForm();\n  return <FormProvider {...methods}>{children}</FormProvider>;\n}\n\nit('should validate required fields', async () => {\n  const user = userEvent.setup();\n  render(\n    <FormWrapper>\n      <InterfaceEditForm />\n    </FormWrapper>\n  );\n\n  await user.click(screen.getByRole('button', { name: /save/i }));\n\n  expect(await screen.findByText(/interface name is required/i)).toBeInTheDocument();\n});\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"testing-with-apollo",children:"Testing with Apollo"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"MockApolloProvider"})," (from ",(0,s.jsx)(n.code,{children:"@nasnet/api-client/core"}),") is included in the test wrapper automatically. It intercepts Apollo Client operations and forwards them to MSW handlers, so GraphQL queries/mutations are mocked at the network level rather than the Apollo level."]}),"\n",(0,s.jsxs)(n.p,{children:["For tests that need precise control over specific GraphQL responses, use ",(0,s.jsx)(n.code,{children:"server.use()"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { graphqlEndpoint } from '@/mocks/handlers/graphql';\nimport { graphql, HttpResponse } from 'msw';\n\nit('should show empty state when no routers configured', () => {\n  server.use(\n    graphqlEndpoint.query('GetRouters', () =>\n      HttpResponse.json({\n        data: { routers: { edges: [], totalCount: 0 } },\n      })\n    )\n  );\n\n  render(<RouterListPage />);\n  expect(screen.getByText(/no routers configured/i)).toBeInTheDocument();\n});\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"accessibility-in-component-tests",children:"Accessibility in Component Tests"}),"\n",(0,s.jsxs)(n.p,{children:["Use ",(0,s.jsx)(n.code,{children:"axe-core"})," for automated accessibility checks in component tests:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { axe, toHaveNoViolations } from 'jest-axe';\nexpect.extend(toHaveNoViolations);\n\nit('should have no accessibility violations', async () => {\n  const { container } = render(<ARPTable entries={mockEntries} />);\n  const results = await axe(container);\n  expect(results).toHaveNoViolations();\n});\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"see-also",children:"See Also"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"apps/connect/src/test/test-utils.tsx"})," \u2014 Custom render utilities"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"apps/connect/src/test/setup.ts"})," \u2014 Global test setup"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"10-testing/mocking.md"})," \u2014 MSW handler details"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"10-testing/unit-testing.md"})," \u2014 Hook testing, vi.mock patterns"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"../architecture/provider-stack.md"})," \u2014 Provider hierarchy for test wrapper context"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"../ui-system/overview.md"})," \u2014 Component architecture (Layer 1/2/3 dependency rules)"]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},71184:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>c});var r=t(14041);const s={},o=r.createContext(s);function i(e){const n=r.useContext(o);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),r.createElement(o.Provider,{value:n},e.children)}}}]);