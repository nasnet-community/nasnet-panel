# Generated GraphQL Code

This directory contains auto-generated Go code from GraphQL schema definitions.

## ⚠️ DO NOT EDIT

All files in this directory (except this README and migration scripts) are automatically generated by [gqlgen](https://gqlgen.com/).

**To regenerate:**
```bash
cd apps/backend
go generate ./...
# or
go run github.com/99designs/gqlgen@latest generate
```

## Directory Structure

```
generated/graphql/
├── README.md              # This file
├── package.go             # Package declaration (ensures package exists)
├── generated.go           # GraphQL execution layer (resolver scaffolding)
├── models.go              # Generated GraphQL types (Input, Payload, etc.)
├── MIGRATION_PLAN.md      # Migration documentation
├── analyze_imports.sh     # Helper script to analyze import usage
└── update_imports.sh      # Helper script to update imports
```

## Generated Files

### `generated.go`
- Contains GraphQL execution code
- Implements the GraphQL resolver interface
- Wires up query, mutation, and subscription resolvers
- **Import as:** `import "backend/generated/graphql"`

### `models.go`
- Contains all GraphQL input types (e.g., `AddRouterInput`)
- Contains all GraphQL payload types (e.g., `AddRouterPayload`)
- Contains GraphQL enums, interfaces, unions
- Contains connection/edge types for Relay pagination
- **Import as:** `import "backend/generated/graphql"`

## Custom Scalars (NOT Generated)

Custom scalar implementations remain in `apps/backend/graph/model/`:
- `IPv4`, `IPv6` - IP address types
- `MAC` - MAC address type
- `CIDR` - CIDR notation type
- `Port`, `PortRange` - Network port types
- `Duration` - Time duration type
- `Bandwidth` - Bandwidth measurement type
- `Size` - File size type
- `ULID` - ULID identifier type

**Import custom scalars as:** `import "backend/graph/model"`

## Configuration

GraphQL code generation is configured in `apps/backend/gqlgen.yml`:

```yaml
# Generated server code
exec:
  filename: generated/graphql/generated.go
  package: graphql

# Generated model structs
model:
  filename: generated/graphql/models.go
  package: graphql

# Custom scalar mappings (point to backend/graph/model)
models:
  IPv4:
    model: backend/graph/model.IPv4
  MAC:
    model: backend/graph/model.MAC
  # ... etc
```

## Schema Location

GraphQL schema files are in `schema/` (workspace root):
```
schema/
├── scalars.graphql        # Custom scalar definitions
├── core/*.graphql         # Core router types
├── alerts/*.graphql       # Alert system types
├── services/*.graphql     # Service marketplace types
├── network/*.graphql      # Network configuration types
├── firewall/*.graphql     # Firewall types
├── diagnostics/*.graphql  # Diagnostic types
├── wan/*.graphql          # WAN interface types
├── resources/*.graphql    # Universal State v2 resource model
├── changeset/*.graphql    # Change set management
└── storage/*.graphql      # Storage management
```

## Resolver Implementation

Resolvers are implemented in `apps/backend/graph/resolver/`:
- Each domain has its own resolver file(s)
- Resolvers implement the generated interfaces from `generated.go`
- Follow the `follow-schema` layout (one file per schema file)

Example:
```go
package resolver

import "backend/generated/graphql"

// This resolver implements graphql.MutationResolver
type mutationResolver struct{ *Resolver }

func (r *mutationResolver) AddRouter(ctx context.Context, input graphql.AddRouterInput) (*graphql.AddRouterPayload, error) {
    // Implementation
}
```

## Import Guidelines

### Use `backend/generated/graphql` when:
- Using generated input types (`AddRouterInput`, `UpdateRouterInput`, etc.)
- Using generated payload types (`AddRouterPayload`, `QueryPayload`, etc.)
- Using generated enums, interfaces, unions
- Implementing resolvers (need the generated interfaces)
- Using connection/edge types for pagination

### Use `backend/graph/model` when:
- Using custom scalar types (`model.IPv4`, `model.MAC`, etc.)
- Implementing custom scalar marshaling/unmarshaling
- Using manually-written authentication types

### Use both (with alias) when:
```go
import (
    "backend/graph/model"                      // Custom scalars
    gqlmodel "backend/generated/graphql"       // Generated types
)

func example(ip model.IPv4, input gqlmodel.AddRouterInput) {
    // Use both
}
```

## Migration Notes

This directory structure was created as part of the "Generated Code Consolidation" refactoring:
- **Before:** GraphQL generated code was in `apps/backend/graph/`
- **After:** GraphQL generated code is in `apps/backend/generated/graphql/`
- **Reason:** Clear separation of generated vs hand-written code

See `MIGRATION_PLAN.md` for detailed migration steps and status.

## Troubleshooting

### "package graphql is not in GOROOT"
Run `go generate ./...` to generate the code first.

### "cannot find package backend/generated/graphql"
Ensure you're in the `apps/backend` directory and run `go generate ./...`.

### Import cycle errors
- Don't import resolver packages from generated code
- Keep resolvers separate from generated types
- Use dependency injection for services

### Duplicate type errors after regeneration
Delete `apps/backend/graph/generated.go` and `apps/backend/graph/model/models_gen.go` (old locations).

## Related Documentation

- [gqlgen Documentation](https://gqlgen.com/)
- [GraphQL Schema Design Guidelines](../../../Docs/architecture/api-contracts.md)
- [Backend Architecture](../../../Docs/architecture/backend-architecture.md)
- [Universal State v2](../../../Docs/architecture/data-architecture.md)
