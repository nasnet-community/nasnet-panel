<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>NasNetConnect</title>
    <base href="/" />

    <meta
      name="viewport"
      content="width=device-width, initial-scale=1"
    />

    <!-- Content Security Policy - defense-in-depth alongside server headers -->
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: blob:; font-src 'self'; connect-src 'self' ws: wss:; frame-src 'none'; object-src 'none'; base-uri 'self';"
    />

    <!-- Theme Flash Prevention Script -->
    <!-- Runs before React loads to prevent FOUC (Flash of Unstyled Content) -->
    <script>
      (function () {
        try {
          // Read theme from localStorage (Zustand persist format)
          var stored = localStorage.getItem('nasnet-theme');
          var theme = 'system'; // Default to system if no preference saved

          if (stored) {
            var data = JSON.parse(stored);
            theme = (data.state && data.state.theme) || 'system';
          }

          // Determine if dark mode should be applied
          var shouldUseDark = false;

          if (theme === 'dark') {
            // Explicitly dark mode
            shouldUseDark = true;
          } else if (theme === 'system') {
            // Detect system preference
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
              shouldUseDark = true;
            }
          }
          // If theme === 'light', shouldUseDark stays false

          // Apply dark class and data-theme attribute if needed
          if (shouldUseDark) {
            document.documentElement.classList.add('dark');
            document.documentElement.setAttribute('data-theme', 'dark');
          } else {
            document.documentElement.setAttribute('data-theme', 'light');
          }
        } catch (e) {
          // Silently fail if localStorage unavailable or parsing fails
          // App will use default light theme
        }
      })();
    </script>

    <link
      rel="icon"
      type="image/png"
      href="/favicon.png"
    />
    <link
      rel="stylesheet"
      href="/src/styles.css"
    />
  </head>
  <body>
    <div id="root"></div>
    <script
      type="module"
      src="/src/main.tsx"
    ></script>
  </body>
</html>
